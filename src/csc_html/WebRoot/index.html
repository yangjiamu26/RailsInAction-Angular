<!DOCTYPE html>
<html lang='en'>
  
  <head>
    <meta charset='utf-8'>
    <title>CSC云服务中心</title>
    <meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport'>
    <link href='assets/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/animate.min.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/font-awesome.min.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/simple-line-icons.css' rel='stylesheet' type='text/css'>
    <link href="assets/lib/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <link href='assets/css/font.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/angulr.css' rel='stylesheet' type='text/css'>
    <link href='assets/css/knockout-datatable.css' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" media="all" href="assets/css/app.css" />
  	<!-- 解决接口跨域的问题 -->
	<script src="api/v5.0.0/uap/register"></script>
	<!-- 解决js跨域的问题 -->
	<script src="api/register.js"></script>  
	<!-- 解决调用servlet跨域问题 -->
	<script src="api/file/uploadServlet"></script>
    </head>
    
  
  <body>
    <div class='app app-header-fixed app-aside-fixed'>
      <!-- header -->
      <header class='app-header navbar' id='header' role='menu'>
        <!-- navbar header -->
        <div class='navbar-header bg-dark'>
          <button class='pull-right visible-xs dk' target='.navbar-collapse' ui-toggle='show'>
            <i class='glyphicon glyphicon-cog'></i>
          </button>
          <button class='pull-right visible-xs' target='.app-aside' ui-scroll='app' ui-toggle='off-screen'>
            <i class='glyphicon glyphicon-align-justify'></i>
          </button>
          <!-- brand -->
          <a class='navbar-brand text-lt' href='#/'>
            <span><img alt='.' src='assets/img/csc_logo.png'></span>
            <span class='hidden-folded m-l-xs' style="margin-left:20px;">云服务中心</span></a>
          <!-- / brand --></div>
        <!-- / navbar header -->
        <!-- navbar collapse -->
        <div class='collapse pos-rlt navbar-collapse box-shadow bg-white-only'>
          <!-- buttons -->
          <div class='nav navbar-nav hidden-xs'>
            <a class='btn no-shadow navbar-btn' href='#' target='.app' ui-toggle='app-aside-folded'>
              <i class='fa fa-dedent fa-fw text'></i>
              <i class='fa fa-indent fa-fw text-active'></i>
            </a>
          </div>
          <!-- / buttons -->
          <!-- nabar right -->
          <ul class='nav navbar-nav navbar-right'>
            <li data-bind="visible: roleVO().roleFlag()=='ALL'"><a href="#pages/guide/index">向导页预览</a></li>
            <li class="dropdown">
                <a data-toggle="dropdown" class="dropdown-toggle" aria-expanded="true">
                    <i class="fa fa-fw fa-plus visible-xs-inline-block"></i>
                    <span data-bind="text: roleVO().currentRole"></span> <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu" data-bind="foreach: roleVO().roleName">
                    <li data-bind="click: function(data, event){ $root.selectRole(name) }">
                    	<a href="#" >
                    		<i class="fa fa-fw fa-angle-right text-muted m-r-xs"></i><span data-bind="text: name"></span>
                    	</a>
                    </li>
                </ul>
            </li>
            <li class='dropdown' data-bind="visible: (roleVO().roleFlag()!='AG' && roleVO().roleFlag()!='AS')">
                <a data-toggle="dropdown" class="dropdown-toggle" aria-expanded="true">
                    <i class="fa fa-fw fa-warning"></i>
                    <span>告警</span> <span class='badge badge-sm up bg-danger' data-bind="text: alarmStatVO().totalAlarm()"></span> <span class="caret"></span>
                </a>
                <ul class="dropdown-menu" role="menu" id="warnings-tabs">
                    <li data-bind="visible: roleVO().roleFlag()=='ALL'"><a href="#pages/systems/warnings/index?showTab=sysTab"><i class="fa fa-fw fa-angle-right text-muted m-r-xs"></i>系统告警：<span class="text-danger" data-bind="text: alarmStatVO().systemAlarm()"></span>个</a></li>
                    <!-- ko if: roleVO().platForm()=='operate' -->
                    <li ><a href="#pages/systems/warnings/index?showTab=vmTab"><i class="fa fa-fw fa-angle-right text-muted m-r-xs"></i>云主机告警：<span class="text-danger" data-bind="text: alarmStatVO().vmAlarm()"></span>个</a></li>
                    <!-- /ko -->
        			<!-- ko if: roleVO().platForm()=='self' -->
                    <li ><a href="#pages/systems/warnings/index?type=vm&showTab=vmTab"><i class="fa fa-fw fa-angle-right text-muted m-r-xs"></i>云主机告警：<span class="text-danger" data-bind="text: alarmStatVO().vmAlarm()"></span>个</a></li>
        			<!-- /ko -->
                    <li data-bind="visible: roleVO().roleFlag()!='COMMON'"><a href="#pages/systems/warnings/index?showTab=vdcTab"><i class="fa fa-fw fa-angle-right text-muted m-r-xs"></i>VDC配额告警：<span class="text-danger" data-bind="text: alarmStatVO().vdcQuotaAlarm()"></span>个</a></li>
                </ul>                
            </li>
            <li class='dropdown' data-bind="visible: (roleVO().roleFlag()!='AG' && roleVO().roleFlag()!='AS')">
              <!-- ko if: roleVO().platForm()=='operate' -->
              <a  href='#pages/systems/notices/index'>
                <i class='fa fa-bell'></i> 通知
                <span class='badge badge-sm up bg-info' data-bind="text: noticeStatVO()"></span></a>
              <!-- /ko -->
        	  <!-- ko if: roleVO().platForm()=='self' -->
        	  <a  href='#pages/systems/notices/index?showTab=sysTab'>
                <i class='fa fa-bell'></i> 通知
                <span class='badge badge-sm up bg-info' data-bind="text: noticeStatVO()"></span></a>
        	  <!-- /ko -->
            </li>
            <li data-bind="visible: roleVO().roleFlag()=='COMMON'"><a href="#pages/services/shopping_carts/index"><i class="fa fa-shopping-cart"></i> 购物车 <span class='badge badge-sm up bg-danger' data-bind="text:cartNum"></span></a></li>
            <li >
              <a  data-bind="attr:{href: uapUrl}">
                <i class='fa fa-desktop'></i> 统一认证平台
                <span class=' up bg-info'></span></a>
            </li>
            <li class='dropdown'>
              <a class='dropdown-toggle clear' data-toggle='dropdown' data-bind="click:loadUserInfo">
                <i class='fa fa-user'></i>
                <span class='hidden-sm hidden-md' data-bind="text:$root.user().account"></span>
                <b class='caret'></b>
              </a>
              <!-- dropdown -->
              <ul class='dropdown-menu animated fadeInRight w-lg bg-light'>
                <li>
                    <table class="table text-xs">
                        <tbody data-bind="with:user">
                            <tr data-bind="visible: userType()=='0'">
                                <td><a href="#" onclick="showModal('pages/systems/users/edit_profile.html')" class="btn btn-info btn-xs">修改信息</a></td>
                                <td><a href="#" onclick="showModal('pages/systems/users/edit_password.html')" class="btn btn-primary btn-xs">修改密码</a></td>
                            </tr>
                            <tr>
                                <td>账号：</td>
                                <td data-bind="text:account"></td>
                            </tr>
                            <tr>
                                <td>昵称：</td>
                                <td data-bind="text:name"></td>
                            </tr>
                            <tr>
                                <td>角色：</td>
                                <td data-bind="text:$root.roleVO().currentRole()"></td>
                            </tr>
                            <tr>
                                <td>组织：</td>
                                <td data-bind="text:organizationName()==''?'本地组织':organizationName()"></td>
                            </tr>
                            <tr>
                                <td>手机：</td>
                                <td data-bind="text:mobile"></td>
                            </tr>
                            <tr>
                                <td>邮箱：</td>
                                <td data-bind="text:email"></td>
                            </tr>
                            <!-- <tr>
                                <td>用户状态：</td>
                                <td><span class='label bg-success' data-bind="css:$root.userStatusCss(status),text:status==1?'有效':'无效'"></span></td>
                            </tr> -->
                        </tbody>
                    </table>                
                </li>
                <li class='divider'></li>
                <li>
                  <div class="padder"><a href="api/logoutServlet" class="btn btn-danger btn-xs"><i class='fa fa-power-off'></i> 退出系统</a></div></li>
              </ul>
              <!-- / dropdown --></li>
          </ul>
          <!-- / navbar right --></div>
        <!-- / navbar collapse --></header>
      <!-- / header -->
      <!-- aside -->
      
      <aside class='app-aside hidden-xs bg-dark' id='aside'>
        <!-- ko if: roleVO().platForm()=='operate' -->
        <div class='aside-wrap'>
          <div class='navi-wrap'>
            <nav class='navi clearfix' ui-nav=''>
              <ul class='nav navbox'>
                <li data-bind="check_action:'firstPage'">
                  <a data-url="pages/welcome/index" data-url-params="role" href="#pages/welcome/index">
                  <i class="icon home"></i>
                    <span class='text-base'>首页</span></a>
                </li>
                <li data-bind="check_action:'service'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon service"></i>
                    <span class='text-base'>服务</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>服务</span></a>
                    </li>
                    <li data-bind="check_action:'proDef'">
                      <a data-url="pages/services/product_definitions/index" href="#pages/services/product_definitions/index">
                        <span>产品定义</span></a>
                    </li>
                    <li data-bind="check_action:'servManage'">
                      <a data-url="pages/services/service_definitions/index" href="#pages/services/service_definitions/index">
                        <span>服务管理</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'resource'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon resource"></i>
                    <span class='text-base'>资源</span>
                  </a>
                  <ul class='nav nav-sub dk'>
                      <li class='nav-sub-header'>
                        <a>
                          <span class='text-base'>资源</span></a>
                      </li>
                      <li data-bind="check_action:'dataCenter'">
                        <a data-url="pages/resources/partitions/datacenters/index" href="#pages/resources/partitions/datacenters/index">
                          <span>数据中心</span></a>
                      </li>
                      <li data-bind="check_action:'diskAcce'">
                        <a data-url="pages/resources/partitions/index" href="#pages/resources/partitions/index">
                          <span>可用分区</span></a>
                      </li>
                      <li data-bind="check_action:'resoInstance'">
                        <a data-url="pages/resources/instances/index" data-url-params="showTab" href="#pages/resources/instances/index">
                          <span>资源实例</span></a>
                      </li>
                      <li data-bind="check_action:'bussiCut'">
                        <a data-url="pages/resources/partitions/business_cutover/index" href="#pages/resources/partitions/business_cutover/index">
                          <span>业务割接</span></a>
                      </li>
                      <li data-bind="check_action:'resourceBack'">
                        <a data-url="pages/resources/partitions/recovery/index" href="#pages/resources/partitions/recovery/index">
                          <span>资源回收</span></a>
                      </li>
                  </ul>
                </li>
                <li data-bind="check_action:'orderForm'">
                  <a data-url="pages/orders/service_orders?type=order" href="#pages/orders/service_orders?type=order">
                    <i class="icon order"></i>
                    <span class='text-base'>订单</span></a>
                </li>
                <li data-bind="check_action:'vdcManger'">
                  <a data-url="pages/vdcs/vdcs/index" href="#pages/vdcs/vdcs/index">
                    <i class="icon task"></i>
                    <span class='text-base'>VDC管理</span>
                  </a>
                </li>
                <li data-bind="check_action:'vpcManger'">
                  <a data-url="pages/vdcs/vpcs/index" data-url-params="type,showTab" href="#pages/vdcs/vpcs/index?type=0">
                    <i class="icon resource"></i>
                    <span class='text-base'>VPC管理</span>
                  </a>
                </li>
                <li data-bind="check_action:'busiSystem'">
                  <a data-url="pages/vdcs/businesses/index" href="#pages/vdcs/businesses/index">
                    <i class="icon app"></i>
                    <span class='text-base'>业务系统</span>
                  </a>
                </li>                 
                 <li data-bind="check_action:'appli'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon app"></i>
                    <span class='text-base'>应用</span>
                  </a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>应用</span></a>
                    </li>
                    <li data-bind="check_action:'softWare'">
                      <a data-url="pages/softwares/softwares" href="#pages/softwares/softwares">
                        <span>软件</span></a>
                    </li>
                    <li data-bind="check_action:'script'">
                      <a data-url="pages/softwares/scripts" href="#pages/softwares/scripts">
                        <span>脚本</span></a>
                    </li>
                    <li data-bind="check_action:'softInstall'">
                      <a data-url="pages/softwares/installs" href="#pages/softwares/installs">
                        <span>软件安装</span></a>
                    </li>
                    <li data-bind="check_action:'softUpdate'">
                      <a data-url="pages/softwares/upgrades" href="#pages/softwares/upgrades">
                        <span>软件升级</span></a>
                    </li>
                    <li data-bind="check_action:'installLog'">
                      <a data-url="pages/softwares/logs" href="#pages/softwares/logs">
                        <span>安装日志</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'work'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon task"></i>
                    <span class='text-base'>工作</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>工作</span></a>
                    </li>
                    <li data-bind="check_action:'newWork'">
                      <a data-url="pages/workflows/apply" href="#pages/workflows/apply">
                        <span>新建工作</span></a>
                    </li>
                    <li data-bind="check_action:'myWork'">
                      <a data-url="pages/workflows/tasks" data-url-params="type,showTab" href="#pages/workflows/tasks?type=work">
                        <span>我的工作</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'billing'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon charge"></i>
                    <span class='text-base'>计费</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>计费</span></a>
                    </li>
                    <li data-bind="check_action:'bilRule'">
                      <a data-url="pages/charges/factors" href="#pages/charges/factors">
                        <span>计费规则</span></a>
                    </li>
                    <li data-bind="check_action:'bilCount'">
                      <a data-url="pages/charges/reports" href="#pages/charges/reports">
                        <span>计费清单统计</span></a>
                    </li>
                  </ul>
                </li>                   
                <li data-bind="check_action:'report'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon report"></i>
                    <span class='text-base'>报表</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>报表</span></a>
                    </li>
                    <li data-bind="check_action:'systemDesign'">
                      <a data-url="pages/reports/stats" href="#pages/reports/stats">
                        <span>报表统计</span></a>
                    </li>
                    <li data-bind="check_action:'repoDef'">
                      <a data-url="pages/reports/definitions" href="#pages/reports/definitions">
                        <span>自定义报表</span></a>
                    </li>
                  </ul>
                </li>                                
                <li data-bind="check_action:'system'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon system"></i>
                    <span class='text-base'>系统</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>系统</span></a>
                    </li>
                    <li data-bind="check_action:'sysUserManage'">
                      <a data-url="pages/systems/users/index" href="#pages/systems/users/index">
                        <span>用户管理</span></a>
                    </li>
                    <li data-bind="check_action:'sysRoleManage'">
                      <a data-url="pages/systems/roles/index" href="#pages/systems/roles/index">
                        <span>角色管理</span></a>
                    </li>
                    <li data-bind="check_action:'flowManage'">
                      <a data-url="pages/systems/workflows/index" href="#pages/systems/workflows/index">
                        <span>流程管理</span></a>
                    </li>   
                    <li data-bind="check_action:'serverConf'">
                      <a data-url="pages/systems/servers/index" href="#pages/systems/servers/index">
                        <span>服务器配置</span></a>
                    </li>      
                    <li data-bind="check_action:'warnConf'">
                      <a data-url="pages/systems/warning_configs/index" href="#pages/systems/warning_configs/index">
                        <span>告警配置</span></a>
                    </li>                    
                    <li data-bind="check_action:'firstPgConf'">
                      <a data-url="pages/systems/dashboards/index" href="#pages/systems/dashboards/index">
                        <span>首页配置</span></a>
                    </li>       
                    <li data-bind="check_action:'license'">
                      <a data-url="pages/systems/licenses/index" href="#pages/systems/licenses/index">
                        <span>License</span></a>
                    </li>
                    <li data-bind="check_action:'wordConf'">
                      <a data-url="pages/systems/dictionaries/index" href="#pages/systems/dictionaries/index">
                        <span>字典管理</span></a>
                    </li>  
                    <li data-bind="check_action:'resoProperty'">
                      <a data-url="pages/systems/properties/index" href="#pages/systems/properties/index">
                        <span>资源属性</span></a>
                    </li>                                                                                  
                    <li data-bind="check_action:'warn'">
                      <a data-url="pages/systems/warnings/index" data-url-params="showTab" href="#pages/systems/warnings/index">
                        <span>告警</span></a>
                    </li>                    
                    <li data-bind="check_action:'notify'">
                      <a data-url="pages/systems/notices/index" href="#pages/systems/notices/index">
                        <span>通知</span></a>
                    </li>
                    <li data-bind="check_action:'operaLog'">
                      <a data-url="pages/systems/operLog/index" href="#pages/systems/operLog/index">
                        <span>操作日志</span></a>
                    </li>
                    <li data-bind="check_action:'loginLog'">
                      <a data-url="pages/systems/loginLog/index" href="#pages/systems/loginLog/index">
                        <span>登录日志</span></a>
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /ko -->
        
        <!-- ko if: roleVO().platForm()=='self' -->
        <div class='aside-wrap'>
          <div class='navi-wrap'>
            <nav class='navi clearfix' ui-nav=''>
              <ul class='nav navbox'>
                <li data-bind="check_action:'firstPage'">
                  <a data-url="pages/welcome/index" data-url-params="role" href="#pages/welcome/index">
                  <i class="icon home"></i>
                    <span class='text-base'>首页</span></a>
                </li>
                <li data-bind="check_action:'myResource'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon resource"></i>
                    <span class='text-base'>我的资源</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class="text-base">我的资源</span></a>
                    </li>
                    <li data-bind="check_action:'cloudServer'">
                      <a data-url="pages/resources/instances/index?type=0" href="#pages/resources/instances/index?type=0">
                        <span>云主机</span></a>
                    </li>
                    <li data-bind="check_action:'cloudDisk'">
                      <a data-url="pages/resources/instances/index?type=1" href="#pages/resources/instances/index?type=1">
                        <span>云硬盘</span></a>
                    </li>
                    <li data-bind="check_action:'publicIp'">
                      <a data-url="pages/resources/instances/index?type=2" href="#pages/resources/instances/index?type=2">
                        <span>公网IP</span></a>
                    </li>
                    <li data-bind="check_action:'loadBalan'">
                      <a data-url="pages/resources/instances/index?type=3" href="#pages/resources/instances/index?type=3">
                        <span>负载均衡器</span></a>
                    </li>
                    <li data-bind="check_action:'sshKey'">
                      <a data-url="pages/resources/instances/index?type=4" href="#pages/resources/instances/index?type=4">
                        <span>SSH密钥</span></a>
                    </li>
                    <li data-bind="check_action:'instanStore'">
                      <a data-url="pages/resources/instances/index?type=5" href="#pages/resources/instances/index?type=5">
                        <span>对象存储</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'serviceAppl'">
                    <a class='auto'>
                      <span class='pull-right text-muted'>
                        <i class='fa fa-fw fa-angle-right text'></i>
                        <i class='fa fa-fw fa-angle-down text-active'></i>
                      </span>
                      <i class="icon home"></i>
                      <span class='text-base'>服务申请</span>
                    </a>
                    <ul class='nav nav-sub dk'>
                      <li class='nav-sub-header'>
                        <a>
                        <span class="text-base">服务申请</span></a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=0" href="#pages/services/service_applies/index?type=0">
                          <span>VDC</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=1" href="#pages/services/service_applies/index?type=1">
                          <span>云主机</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=2" href="#pages/services/service_applies/index?type=2">
                          <span>云硬盘</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=3" href="#pages/services/service_applies/index?type=3">
                          <span>对象存储</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=4" href="#pages/services/service_applies/index?type=4">
                          <span>公网IP</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=5" href="#pages/services/service_applies/index?type=5">
                          <span>负载均衡器</span>
                        </a>
                      </li>
                      <li>
                        <a data-url="pages/services/service_applies/index?type=6" href="#pages/services/service_applies/index?type=6">
                          <span>SSH密钥</span>
                        </a>
                      </li>
<!--                       <li>
                        <a data-url="pages/services/service_applies/index?type=7" href="#pages/services/service_applies/index?type=7">
                          <span>自定义产品</span>
                        </a>
                      </li> -->
                      
                    </ul>
                </li>  
                <li data-bind="check_action:'shopCart'">
                  <a data-url="pages/services/shopping_carts/index" href="#pages/services/shopping_carts/index">
                    <i class="icon order"></i>
                    <span class='text-base'>购物车</span>
                  </a>
                </li>          
                <li data-bind="check_action:'myOrder'">
                  <a data-url="pages/orders/service_orders" href="#pages/orders/service_orders">
                    <i class="icon order"></i>
                    <span class='text-base'>我的订单</span>
                  </a>
                </li> 
                <li data-bind="check_action:'busiSystem'">
                  <a data-url="pages/vdcs/businesses/index" href="#pages/vdcs/businesses/index">
                    <i class="icon app"></i>
                    <span class='text-base'>业务系统</span>
                  </a>
                </li>
                <li data-bind="check_action:'appli'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon app"></i>
                    <span class='text-base'>应用</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>应用</span></a>
                    </li>
                    <li data-bind="check_action:'softInstall'">
                      <a data-url="pages/softwares/installs" href="#pages/softwares/installs">
                        <span>软件安装</span></a> 
                    </li>
                    <li data-bind="check_action:'softUpdate1'">
                      <a data-url="pages/softwares/upgrades" href="#pages/softwares/upgrades">
                        <span>软件升级</span></a>
                    </li>
                    <li data-bind="check_action:'installLog'">
                      <a data-url="pages/softwares/logs" href="#pages/softwares/logs">
                        <span>安装日志</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'work'">
                  <a class='auto'>
                    <span class='pull-right text-muted'>
                      <i class='fa fa-fw fa-angle-right text'></i>
                      <i class='fa fa-fw fa-angle-down text-active'></i>
                    </span>
                    <i class="icon task"></i>
                    <span class='text-base'>工作</span></a>
                  <ul class='nav nav-sub dk'>
                    <li class='nav-sub-header'>
                      <a>
                        <span class='text-base'>工作</span></a>
                    </li>
                    <li data-bind="check_action:'newWork'">
                      <a data-url="pages/workflows/apply_user" href="#pages/workflows/apply_user">
                        <span>新建工作</span></a>
                    </li>
                    <li data-bind="check_action:'myWork'">
                      <a data-url="pages/workflows/tasks" data-url-params="type,showTab"  href="#pages/workflows/tasks">
                        <span>我的工作</span></a>
                    </li>
                  </ul>
                </li>
                <li data-bind="check_action:'billingCount'">
                  <a data-url="pages/charges/reports" href="#pages/charges/reports">
                    <i class="icon charge"></i>
                    <span class='text-base'>计费清单统计</span>
                  </a>
                </li>
                <li data-bind="check_action:'warn'">
                  <a data-url="pages/systems/warnings/index?type=vm&showTab=vmTab" data-url-params="type,showTab" href="#pages/systems/warnings/index?type=vm&showTab=vmTab">
                    <i class="icon system"></i>
                    <span class='text-base'>云主机告警</span>
                  </a>
                </li> 
                <li data-bind="check_action:'notify'">
                  <a data-url="pages/systems/notices/index?showTab=sysTab" data-url-params="showTab" href="#pages/systems/notices/index?showTab=sysTab">
                    <i class="icon system"></i>
                    <span class='text-base'>通知</span>
                  </a>
                </li>
                <li data-bind="check_action:'report'">
                  <a data-url="pages/reports/stats?showTab=selfTab" data-url-params="showTab" href="#pages/reports/stats?showTab=selfTab">
                    <i class="icon report"></i>
                    <span class='text-base'>报表统计</span></a>
                </li>                                                      
              </ul>
            </nav>
          </div>
        </div>
        <!-- /ko -->
      </aside>
      
      <!-- / aside -->
      <!-- content -->
      <div class='app-content' id='content' role='main'>
        <div class='app-content-body page-content-area' data-ajax-content="true">
          
        </div>
      </div>
      <!-- / content -->
      <!-- footer -->
      <footer class='app-footer' id='footer' role='footer'>
        <div class='wrapper b-t bg-light'>
          <span class='pull-right'>5.0.0
            <a class='m-l-sm text-muted' href='#' ui-scroll='app'>
              <i class='fa fa-long-arrow-up'></i></a>
          </span>&copy; 版权所有 2016 航天云宏技术有限公司</div>
      </footer>
      <!-- / footer --></div>

    <div class="modal fade modal-draggable" id="ajax_modal_0" tabindex="-1" role="dialog"></div>
    <div class="modal fade modal-draggable" id="ajax_modal_1" tabindex="-1" role="dialog"></div>
    <div class="modal fade modal-draggable" id="ajax_modal_2" tabindex="-1" role="dialog"></div>
	
    <script src='assets/js/jquery.min.js'></script>

    <script src="assets/js/underscore.js"></script>
    <script src="assets/js/backbone.js"></script>

    <script src="assets/js/knockout.js"></script>
    <script src="assets/js/knockout.bootstrap.modal.js"></script>
    <script src="assets/js/knockout-datatable.js"></script>
    <script src="assets/js/knockout.validation.js"></script>

    <script src='assets/js/bootstrap.min.js'></script>
    <script src="assets/js/jquery-drag.js"></script>

    <script src='assets/js/ui-load.js'></script>
    <script src='assets/js/ui-jp.config.js'></script>
    <script src='assets/js/ui-jp.js'></script>
    <script src='assets/js/ui-nav.js'></script>
    <script src='assets/js/ui-toggle.js'></script>

    <script src="assets/js/ace.js"></script>
    <script src="assets/js/ace.ajax-content.js"></script>
    <script src="assets/js/app.ajax-content.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/request.js"></script>

    <script src="assets/js/api.js"></script>
    <script src="assets/js/api_test.js"></script>

    <script src='assets/js/ajax-pushlet-client.js'></script>
    <script src='assets/js/common.js'></script>
    <script src='assets/lib/moment/moment.js'></script>
    <script src='assets/lib/bootstrap-daterangepicker/daterangepicker.js'></script>
    <script src="api/img/uploadPreview.js"></script>
    <script>

    /* PL.webRoot = "";
      PL._init();
	    PL.joinListen('/source/event');//事件标识 在数据源中引用 
	    function onPlushletError(event){//网络连接断开时 重新注册
	    	  console.log("onPlushletError...")
	    	   setTimeout(function(){
	    		    PL._init();
	    		    PL.joinListen('/source/event');//事件标识 在数据源中引用 
	    	   }, 3000);
	    }
	    
	    function onPushLetData(event) {
	    	console.log(event)
	    } */
	    
	    function ViewModel(){
	    	var self = this;
	    	
	    	this.setUrl = function() {
		    	var url = window.location.href;
		    	var vals = url.split(";jsessionid=");
		    	if (vals.length > 1) {
		    		var newUrl = "";
		    		if (vals[1].indexOf("#") > 0) {
		    			newUrl = vals[1].substring(vals[1].indexOf("#"), vals[1].length);
		    		}
		    		window.location.href = vals[0] + newUrl;
		    	}
		    }
	    	//截取浏览器地址
	    	this.setUrl();
	    	
	    	this.uapUrl = ko.observable();
	    	this.getUapUrl = function(){
	    		csc.rest.get("api/v5.0.0/homepage/uapUrl", function(data){
	    			self.uapUrl(data+"/index.html#/app/home");
	    		});
	    	}
	    	this.getUapUrl();
	    	
	    	this.fetchActionsForCheck = function(role){
	    		csc.rest.get("api/v5.0.0/roles/currentRole/getCurrUserPrivMenuToList?role="+role, function(data){
	    			ko.actionsMap(data.currentPriv);
	    			/* setTimeout(function(){
	    		  	  ko.actionsMap = ["action1", "action2"]
	    		    }, 2000) */
	    		});
	    	}
	    	this.roleVO = ko.observable({
		    	roleName: ko.observableArray([]),
		    	currentRole: ko.observable(),
		    	roleFlag: ko.observable(),
		    	platForm: ko.observable()
		    });
		    this.loadRoles = function(){
		    	csc.rest.get("api/v5.0.0/homepage/roles", function(data){
		    		self.roleVO().roleName(data.roles);
		    		var currentRole = data.currentRole==''?data.roles[0].name:data.currentRole;
		    		self.roleVO().currentRole(currentRole);
		    		//查看当前角色是否具有自助门户权限
		    		csc.rest.get("api/v5.0.0/homepage/gateway/"+currentRole, function(data){
		    			self.roleVO().platForm(data);
		    			var putBody = {
		    				roleName: currentRole,
		    				platform: self.roleVO().platForm()
		          		}
			    		csc.rest.post("api/v5.0.0/homepage/role", putBody,function(data){
			    			self.loadAlarmStat();
			    			self.loadNoticeStat();
			    			self.loadUserInfo();
			    			if(window.location.hash=="#pages/welcome/home"){
			    				window.location.hash = '#pages/welcome/index';
			    			}
			    		});
		    		});
		    		if((data[0].name == "系统管理员") || (data[0].name == "运营管理员") || (data[0].name == "运维管理员")){
		    			self.roleVO().roleFlag("ALL")
		    		}else if(data[0].name == "VDC管理员"){
		    			self.roleVO().roleFlag("VDC");
		    		}else if(data[0].name == "安全管理员"){
		    			self.roleVO().roleFlag("AG");
		    		}else if(data[0].name == "安全审计员"){
		    			self.roleVO().roleFlag("AS");
		    		}else{
		    			self.roleVO().roleFlag("COMMON");
		    		}
		    		self.fetchActionsForCheck(currentRole);//加载角色权限,在后台判断运营门户还是自助门户
		   	    });
		    	
		    }
		    self.roleVO().roleFlag("ALL");
		    this.loadRoles();
		    this.selectRole = function(role){
		    	//查看当前角色是否具有自助门户权限
	    		csc.rest.get("api/v5.0.0/homepage/gateway/"+role, function(data){
	    			self.roleVO().platForm(data);
	    			var putBody = {
	    				roleName: role,
	    				platform: self.roleVO().platForm()
	          		}
	    			csc.rest.post("api/v5.0.0/homepage/role", putBody,function(data){
			    		self.loadAlarmStat();
			    		self.loadNoticeStat();
			    	}); 
	    		});
		    	self.roleVO().currentRole(role);
		    	if(role == "系统管理员"){
	    			self.roleVO().roleFlag("ALL")
	    			window.location.hash = '#pages/welcome/index?role=sys';
	    		}else if(role == "运营管理员"){
	    			self.roleVO().roleFlag("ALL")
	    			window.location.hash = '#pages/welcome/index?role=yy';
	    		}else if(role == "运维管理员"){
	    			self.roleVO().roleFlag("ALL")
	    			window.location.hash = '#pages/welcome/index?role=yw';
	    		}else if(role == "VDC管理员"){
	    			self.roleVO().roleFlag("VDC");
	    			window.location.hash = '#pages/welcome/index?role=vdc';
	    		}else if(role == "安全管理员"){
	    			self.roleVO().roleFlag("AG");
	    			window.location.hash = '#pages/systems/roles/index';
	    		}else if(role == "安全审计员"){
	    			self.roleVO().roleFlag("AS");
	    			window.location.hash = '#pages/systems/operLog/index';
	    		}else{
	    			self.roleVO().roleFlag("COMMON");
	    			window.location.hash = '#pages/welcome/index?role=com';
	    		}
		    	self.fetchActionsForCheck(role);//加载角色权限
		    }
		    
		    this.alarmStatVO = ko.observable({
		    	systemAlarm: ko.observable(),
		    	vdcQuotaAlarm: ko.observable(),
		    	vmAlarm: ko.observable(),
		    	totalAlarm: ko.observable()
		    });
		    this.loadAlarmStat = function(){
		    	csc.rest.get("api/v5.0.0/homepage/alarmStat", function(data){
		    		self.alarmStatVO().systemAlarm(data.systemAlarm);
		    		self.alarmStatVO().vdcQuotaAlarm(data.vdcQuotaAlarm);
		    		self.alarmStatVO().vmAlarm(data.vmAlarm);
		    		self.alarmStatVO().totalAlarm(data.systemAlarm+data.vdcQuotaAlarm+data.vmAlarm);
		   	    });
		    }
		    
		    this.noticeStatVO = ko.observable();
		    this.loadNoticeStat = function(){
				csc.rest.get("api/v5.0.0/homepage/notice?noticeType=SysNotice&noticeState=NoRealize", function(data){
					var num = 0;
					if(data.results && !isNaN(data.results.length)){
						num = data.results.length;
					}
					self.noticeStatVO(num);
				});
		    }
		    
		    /* ------------------ 用户信息模块  ---------------start */
			var cscUser = function() {
				this.account = ko.observable("");
				this.name = ko.observable("").extend({required: true,userNameSpecial:true});
				this.mobile = ko.observable("").extend({userPhone:true});
				this.email = ko.observable("").extend({email:{params:true,message:"请填写正确格式的邮箱，格式如example@email.com"}});
				this.status = ko.observable("");
				this.roleName = ko.observable("");
				this.organizationName = ko.observable("");
				this.userType = ko.observable("");
			}
				
			this.user = ko.validatedObservable(new cscUser());
			this.editUser = ko.validatedObservable(new cscUser());
			
			//加载次数
			this.loadUserInfoCount = 0;
			//加载用户信息
			this.loadUserInfo = function(){
				csc.rest.get("api/v5.0.0/homepage/user", function(data){
					var loadedFlag = false;
					for(var attr in data){
						loadedFlag = true;
						break;
					}
					if(loadedFlag){
						//还原加载次数
						self.loadUserInfoCount = 0;
						self.user.fromJSON(data);
						self.editUser.fromJSON(data);
					} else {
						if(self.loadUserInfoCount < 3){
							self.loadUserInfoCount++;
							self.loadUserInfo();
						}
					}
					
				});
			}
			
			//修改用户信息
			this.editAction = function(){
				ko.validation.group(self.editUser).showAllMessages();
	    	    if(self.editUser.isValid()){
					csc.rest.post("api/v5.0.0/homepage/user",self.editUser.toJSON() ,function(data){
						if("success" == data.result){
							hideModal();
							systemMsg.alert("修改用户信息成功！");
							self.user.fromJSON(self.editUser.toJSON());
						}else if("fail" == data.result){
							systemMsg.alert("修改失败");
							self.editUser.fromJSON(self.user.toJSON());
						}else{
							systemMsg.alert(data.result);
						}
					});
	    	    }
			}
			//不同用户状态，使用不同颜色显示
		    this.userStatusCss = function(status){
				switch(status){
					case '1':
						return "bg-success";
					default :
						return "bg-danger";
				}
			};
			//点击取消，隐藏对话框后，初始化表单值
			this.editCancel = function(){
				self.editUser.fromJSON(self.user.toJSON());
				hideModal();
			}
			
			//使用逗号分隔显示多个角色
			this.showRoles = function(roles){
				var rolesText = "";
				for(var i=0; i<roles().length; i++){
					var role = roles()[i];
					if(rolesText){
						rolesText += ",";
					}
					rolesText += role.name;
				}
				return rolesText;
			}
			
		    /* ------------------ 用户信息模块  ---------------end */
		    
	        /* ------------------ 修改用户密码模块  ---------------start */
			var userPassword = function() {
		    	_upSelf = this;
				this.oldPassword = ko.observable("").extend({required: {params:true,message:"请输入旧密码"}});
				this.password = ko.observable("").extend({required: {params:true,message:"请输入密码"},minLength:{params:6,message:"请至少输入6个字符"}});
				this.passwordRepeat = ko.observable("").extend({required: true,equal:{params:_upSelf.password,message:"必须输入一致的密码！"}});
			}
			this.userPasswordObj = ko.validatedObservable(new userPassword());
			
			this.userPasswordObj.fromJSON({
				oldPassword:"",
				password:"",
				passwordRepeat:""
			});
			
			//修改用户密码
			this.editPasswordAction = function(){
				ko.validation.group(self.userPasswordObj).showAllMessages();
	    	    if(self.userPasswordObj.isValid()){
					csc.rest.post("api/v5.0.0/homepage/user/password",self.userPasswordObj.toJSON() ,function(data){
						if("success" == data.result){
							hideModal();
							systemMsg.alert("修改用户密码成功！");
						}else if("fail" == data.result){
							systemMsg.alert("修改用户密码失败");
						}else{
							systemMsg.alert(data.result);
						}
						self.userPasswordObj(new userPassword());
					});
	    	    }
			}
			
			//点击取消，隐藏对话框后，初始化表单值
			this.editPasswordCancel = function(){
				self.userPasswordObj(new userPassword());
				hideModal();
			}
		    /* ------------------ 修改用户密码模块  ---------------end */
		    
		    /* ------------------ 购物车 -------------------------start */
		    this.cartNum = ko.observable("");
		    this.loadCartNum = function(){
			    csc.rest.get("api/v5.0.0/homepage/cart",function(data){
			    	self.cartNum(data);
				});
		    }
		    this.loadCartNum();
		    /* ------------------ 购物车 -------------------------end */
	    }
	    
	    //其他模块需使用viewModel变量，声明为全局变量
	    var frameViewModel;
	    $(function(){
	    	frameViewModel = new ViewModel();
	    	ko.applyBindings(frameViewModel,$('.app-header')[0]);
	    	ko.applyBindings(frameViewModel,$('.app-aside')[0]);
	    })
    </script>
  </body>

</html>