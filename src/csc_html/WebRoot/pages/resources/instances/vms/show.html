<div class="bg-light lter b-b wrapper-sm">
  <ol class="breadcrumb">
    <li>当前位置：</li>
    <li>资源</li>
    <li><a href="#pages/resources/instances/index">资源实例</a></li>
    <li class="active" data-bind="text: $root.show_vm_name"></li>
  </ol>
</div>
<div class="wrapper-md">
  <div class='nav-tabs-alt bg-white-only b b-blue'>
    <ul class='nav nav-tabs' role='tablist'>
      <li class='active' role='presentation'>
        <a aria-controls='instance_vm_summary' data-toggle='tab' href='#instance_vm_summary' role='tab'>云主机摘要</a></li>
      <li role='presentation' data-bind="check_action:'cs_Minitor'">
        <a aria-controls='instance_vm_softwares' data-toggle='tab' id="vm_monitor_tab" href='#instance_vm_monitor' role='tab'>监控</a></li>
      <li role='presentation'>
    </ul>
    <div class='tab-content'>
      <div class='tab-pane active' id='instance_vm_summary' role='tabpanel'>

          <div class="wrapper">
              <a class="btn btn-sm btn-default" href="#pages/resources/instances/index"><i class="fa fa-arrow-left"></i> 返回</a>
              <a data-bind="click: $root.startOne,if: vmVO().state == 'SHUTOFF' && vmVO().isValidate == true,check_action:'cs_PowerOn'"><button class="btn btn-sm btn-info" >开机</button></a>
              <a data-bind="click: $root.shutoffOne,if: vmVO().state == 'ACTIVE' && vmVO().isValidate == true,check_action:'cs_PowerOff'"><button class="btn btn-sm btn-info" >关机</button></a>
              <a data-bind="click: $root.restartOne,if: vmVO().state == 'ACTIVE' && vmVO().isValidate == true,check_action:'cs_Reboot'"><button class="btn btn-sm btn-info" >重启</button></a>
              <a data-bind="click: $root.restartForceOne,if: vmVO().state == 'ACTIVE' && vmVO().isValidate == true,check_action:'cs_PoweReboot'"><button class="btn btn-sm btn-info" >强制重启</button></a>
              <a data-bind="click: $root.console,check_action:'cs_Console'"><button class="btn btn-sm btn-info" >控制台</button></a>
              <a data-bind="click: $root.suspend,if: vmVO().state == 'ACTIVE' && vmVO().isValidate == true,check_action:'cs_Wait'"><button class="btn btn-sm btn-info" >挂起</button></a>
              <a data-bind="click: $root.resume,if: vmVO().state == 'SUSPENDED' && vmVO().isValidate == true,check_action:'cs_Recovery'"><button class="btn btn-sm btn-info" >恢复</button></a>
              <a data-bind="click: $root.vmAdjustment,if: vmVO().isValidate == true && vmVO().state != 'SUSPENDED',check_action:'cs_Resomodify'"><button class="btn btn-sm btn-info" >调整资源</button></a>
              <a data-bind="click: $root.editValidateTime,check_action:'cs_TimeMidify'"><button class="btn btn-sm btn-info">有效时间变更</button></a>
              <a data-bind="click: $root.validate,if: vmVO().isValidate == true,check_action:'cs_Stop'"><button class="btn btn-sm btn-info">终止</button></a>
              <a data-bind="click: $root.removeOne,if: (vmVO().state == 'SHUTOFF' || vmVO().state == 'ACTIVE' || vmVO().state == 'SUSPENDED') && vmVO().isValidate == false,check_action:'cs_Delete'"><button class="btn btn-sm btn-info" >删除</button></a>
          </div>
          
          <div class="wrapper">
            <h5 class="text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>基本信息</h5>
            <div class="bg-light b-t b-b wrapper-sm text-nowarp">
              <div class="row m-b">
                <div class="col-xs-1 font-bold">云主机名称：</div>
                <div class="col-xs-3" data-bind="text: vmVO().name"></div>
                <div class="col-xs-1 font-bold">IP地址：</div>
                <div class="col-xs-3" data-bind="text: vmVO().ip"></div>
                <div class="col-xs-1 font-bold">公网IP：</div>
                <div class="col-xs-3" data-bind="text: vmVO().publicIp"></div>
              </div>
              <div class="row m-b">
                <div class="col-xs-1 font-bold">云主机状态：</div>
                <div class="col-xs-3">
                    		<span class="label label-success" data-bind="if: vmVO().state == 'ACTIVE' && vmVO().taskState == null">运行中</span>
							<span class="label label-danger" data-bind="if: vmVO().state == 'SHUTOFF' && vmVO().taskState == null">已关机</span>
							<span class="label label-info" data-bind="if: vmVO().state == 'SUSPENDED' && vmVO().taskState == null">已挂起</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'POWERING_OFF'">正在关机</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'POWERING_ON'">正在启动</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'REBOOTING'">正在重启</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'REBOOTING_HARD'">正在强制重启</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'SUSPENDING'">正在挂起</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'RESUMING'">正在恢复</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'DELETING'">正在删除</span>
							<span class="label label-warning" data-bind="if: vmVO().taskState == 'RESIZING'">正在调整</span>                 
                </div>
                <div class="col-xs-1 font-bold">操作系统：</div>
                <div class="col-xs-3" data-bind="text:vmVO().osVersion"></div>
                <div class="col-xs-1 font-bold">所属物理主机：</div>
                <div class="col-xs-3" data-bind="text:vmVO().ownerHostName"></div>
              </div>
              <div class="row m-b">
                <div class="col-xs-1 font-bold">所属VPC：</div>
                <div class="col-xs-3" data-bind="text:vmVO().vpcName"></div>
                <div class="col-xs-1 font-bold">所属VDC：</div>
                <div class="col-xs-3" data-bind="text:vmVO().vdcName"></div>
				<div class="col-xs-1 font-bold">可用分区：</div>
                <div class="col-xs-3" data-bind="text:vmVO().azName"></div>
              </div>
              <div class="row m-b">
                <div class="col-xs-1 font-bold">业务系统：</div>
                <div class="col-xs-3" data-bind="text:vmVO().busSysName"></div>
                <div class="col-xs-1 font-bold">创建人：</div>
                <div class="col-xs-3" data-bind="text:vmVO().account"></div>
                <div class="col-xs-1 font-bold">创建时间：</div>
                <div class="col-xs-3" data-bind="text:vmVO().createTime"></div>
              </div>
              <div class="row m-b">
              	<div class="col-xs-1 font-bold">UUID：</div>
                <div class="col-xs-3" data-bind="text:vmVO().originalId"></div>
                <div class="col-xs-1 font-bold">密钥：</div>
                <div class="col-xs-7" data-bind="text:vmVO().sshKeyName"></div>
              </div>
            </div>
          </div>

          <div class="row wrapper detail-others">
            <div class="col-xs-3">
              <div class="clear bg-primary wrapper">
                <div class="detail-others-img img-settings">资源配置</div>
                <div class="detail-others-text">
                  <p>CPU（个）：<span data-bind="text:vmVO().vcpu"></span></p>
                  <p>内存（MB）：<span data-bind="text:vmVO().memory"></span></p>
                  <p>存储（GB）：<span data-bind="text:vmVO().storage"></span></p>
                </div>                
              </div>
            </div>
            <div class="col-xs-3">
              <div class="clear btn-info wrapper">
                <div class="detail-others-img img-chart">资源使用率</div>
                <div class="detail-others-text">
                  <p>CPU使用率：<span data-bind="text:vmVO().cpuUsedPer"></span></p>
                  <p>内存使用率：<span data-bind="text:vmVO().memoryUsedPer"></span></p>
                </div>  
              </div>            
            </div>
            <div class="col-xs-3">
              <div class="clear btn-success wrapper">
                <div class="detail-others-img img-serverinfo">服务信息</div>
                <div class="detail-others-text">
                  <p>服务状态：<span data-bind="if: vmVO().isValidate == true">正常</span><span data-bind="if: vmVO().isValidate == false">已过期</span>
                  </p>
                  <p>生效时间：<span data-bind="text:vmVO().effectiveTime"></span></p>
                  <p>失效时间：<span data-bind="text:vmVO().expiryTime"></span></p>
                </div> 
              </div>             
            </div>
          </div>
          
          <div role="dialog" aria-hidden="true" id="modal_edit_validate_1" class="modal fade" data-bind="modal: { show: isValidateTime }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
                <div class="form-group">
                  <label class="col-sm-3 control-label">有效期：</label>
                  <div class="col-sm-8">
                    <input type="text" value="" class="form-control inline w" id="resource_instance_vm_validate_edit_1" data-bind="value: validateTimeVO().time">
                  </div>
                </div>
              </div>
              <div class='modal-footer' style="text-align:center;">
                <a class="btn btn-default btn-info" data-bind="click: validateTime">确定</a>
                <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
              </div>
            </div>
          </div>
        </div>
        
          <div class="wrapper">
            <div class="clear">
              <h5 class="pull-left text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>云硬盘列表</h5>
              <a class="pull-right m-t-sm text-info" data-bind="click: $root.reloadVolume">刷新</a>
            </div>
            <div id='instance_storages'>
              <div class='table-responsive no-height' data-bind="with: vm_volume_table">
                <table class='table table-striped'>
                  <thead>
                    <tr>
                      <th>云硬盘名称</th>
                      <!-- <th>云硬盘类型</th> -->
                      <th>虚拟化类型</th>
                      <th>存储池</th>
                      <th>大小（GB）</th>
                      <th>状态</th>
                      <th>保存路径</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody>
  	                <tr data-bind="visible: showNoData">
  		              <td colspan=14 class="aligncenter">
  		                	暂无数据
  		              </td>
  		            </tr>
  	            	<!-- ko foreach: {data: pagedRows, as: '$row'}  -->
  	                <tr>
  	                    <td data-bind="text: volumeName"></td>
  	                    <!-- <td ></td> -->
  	                    <td ></td>
  	                    <td ></td>
  	                    <td data-bind="text: volumeSize"></td>
  	                    <td data-bind="text: volumeStatus"></td>
  	                    <td data-bind="text: path"></td>
  	                    <td>
  	                      <a data-bind="click: $root.storageExpand">扩展</a>
  	                    </td>
                    	</tr>
                    	<!-- /ko -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>   

          <div class="wrapper">
            <div class="clear">
              <h5 class="pull-left text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>软件列表</h5>
            </div>
            <div class="row padder-v">
              <div class="col-xs-1" data-bind="if: vmVO().state == 'ACTIVE'">
                <a class="btn btn-info btn-sm" data-bind="click: install">安装软件</a>
              </div>
              <div class="col-xs-3">
                <div class="input-group w">
                  <span class="input-group-addon">软件类型</span>
                  <select class="form-control input-sm" data-bind="value: softwareSearchParam().softTypeName, options: $root.software_check_table_softTypeName_partitions, optionsText: 'name', optionsValue: 'name'">
                  </select>
                </div>                
              </div>            
              <div class="col-xs-5">
                <div class="input-group w">
                  <span class="input-group-addon">安装类型</span>
                  <select class="form-control input-sm" data-bind="value: softwareSearchParam().installType">
                    <option value="安装">安装</option>
                    <option value="升级">升级</option>
                  </select>
                </div>                
              </div>            
              <div class="col-xs-3">
                <div class="input-group">
                  <input type="text" class="input-sm form-control" placeholder="请输入软件名称" data-bind="value: softwareSearchParam().softwareName">
                  <span class="input-group-btn">
                    <button class="btn btn-sm btn-default" type="button" data-bind="click: $root.reloadSoftware">搜索</button>
                  </span>
                </div>
              </div>
            </div>                     
            <div id='instance_storages'>
              <div class='table-responsive no-height' data-bind="with: vm_software_table">
                <table class='table table-striped'>
                  <thead>
                    <tr>
                      <th>软件名称</th>
                      <th>软件版本</th>
                      <th>软件类型</th>
                      <th>静默安装属性</th>
                      <th>安装时间</th>
                      <th>安装状态</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody>
                  	<tr data-bind="visible: showNoData">
  		              <td colspan=14 class="aligncenter">
  		               	 暂无数据
  		              </td>
  		            </tr>
  	            	<!-- ko foreach: {data: pagedRows, as: '$row'}  -->
  	                <tr>
  	                  <td data-bind="text: softwareName"></td>
                      <td data-bind="text: softwareVersion"></td>
                      <td data-bind="text: softwareTypeName"></td>
                      <td>
                      	<a data-bind="click: $root.showScriptConfig">查看</a>
                      </td>
                      <td data-bind="text: installTime"></td>
                      <td>
	                      <span class="label label-info" data-bind="if: status == 0">安装中</span>
	                      <span class="label label-success" data-bind="if: status == 1">安装成功</span>
	                      <span class="label label-danger" data-bind="if: status == 2">安装失败</span>
                      </td>
                      <td>
                      	<span data-bind="if: $root.vmVO().state == 'ACTIVE' && status == 2"><a data-bind="click: $root.doReInstall">重安装</a> | </span>
                      	<a data-bind="click: $root.doInstallLog">安装日志</a>
                      	<span data-bind="if: $root.vmVO().state == 'ACTIVE' && status == 1"> | <a data-bind="click: $root.update">升级</a></span>
                      </td>
                    </tr>
                    <!-- /ko -->
                  </tbody>
                </table>
              </div>
            </div>          
          </div>   
           
      </div>

      <div class='tab-pane' id='instance_vm_monitor' role='tabpanel'>
        <div class='panel panel-default'>

          <div class="row wrapper">
            <div class="col-xs-9">
              <strong>采集</strong>
              <select class="input-sm form-control w-sm inline v-middle" id="minute_select">
                 <option value="10">10分钟</option>
                 <option value="20">20分钟</option>
                 <option value="30">30分钟</option>
                 <option value="60">60分钟</option>
              </select>
              <strong>之内数据</strong>&nbsp;
              <button class="btn btn-sm btn-default" data-bind="click: config">告警配置</button>
            </div>
          </div> 
          
          <div class="wrapper">
            <div class="row">
              <div class="col-xs-6">
                <div class="panel panel-default">
                  <div class='panel-heading'>CPU使用率(%)</div>
                  <div class="panel-body">
                    <div id="cpuUse_chart" style="height:150px;"></div>
                  </div>
                </div>
              </div>
              <div class="col-xs-6">
                <div class="panel panel-default">
                  <div class='panel-heading'>内存使用率(%)</div>
                  <div class="panel-body">
                    <div id="memoryUse_chart" style="height:150px;"></div>
                  </div>
                </div>
              </div>
            </div>
            <!-- <div class="row">
              <div class="col-xs-6">
                <div class="panel panel-default">
                  <div class='panel-heading'>存储使用率(%)</div>
                  <div class="panel-body">
                    <div id="storageUse_chart" style="height:150px;"></div>
                  </div>
                </div>
              </div>
            </div>  -->
            
          </div>

        </div>
      </div>
      
      
    </div>
  </div>
</div>

<div role="dialog" aria-hidden="true" id="alarmModal" class="modal fade" data-bind="modal: { show: isConfig }">
  <div class='modal-dialog modal-md'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>告警配置</h3>
      </div>
      <div class='modal-body form-horizontal wrapper'>

        <p class="text-muted">在这里，您可以启用云主机的资源使用率监控项，包括对CPU和内存的监控</p>
        <h4>监控选择</h4>
        <div class="text-dark">
            <div class="checkbox inline">
              <label class="i-checks">
                <input type="checkbox" value="cpu_util" name="checkbox" id="cpu_util" onclick="cpuCheckboxClick(this);">
                <i></i>
              </label>
            </div>
            启用CPU使用率告警       
        </div>
        <div class="m-t m-l-lg text-primary">
           当CPU使用率超过
           <div class="inline v-middle">
             <div class="input-group w-xs">
                 <input type="text" value="50" class="form-control input-sm" disabled="disabled" id="cpu_util_threshold">
                 <span class="input-group-addon">%</span>
              </div>
           </div>
          ，且持续时间超过
          <div class="inline v-middle">
              <div class="input-group w-xs">
                 <input type="text" value="5" class="form-control input-sm" disabled="disabled" id="cpu_util_period">
                 <span class="input-group-addon">分钟</span>
              </div>
          </div>，触发告警     
        </div>
        
        <div class="text-dark">
            <div class="checkbox inline">
              <label class="i-checks">
                <input type="checkbox" value="memory.resident" name="checkbox" id="memory_resident" onclick="cpuCheckboxClick(this);">
                <i></i>
              </label>
            </div>
            启用内存使用率告警       
        </div>
        <div class="m-t m-l-lg text-primary">
           当内存使用率超过
           <div class="inline v-middle">
             <div class="input-group w-xs">
                 <input type="text" value="50" class="form-control input-sm" disabled="disabled" id="memory_resident_threshold">
                 <span class="input-group-addon">%</span>
              </div>
           </div>
          ，且持续时间超过
          <div class="inline v-middle">
              <div class="input-group w-xs">
                 <input type="text" value="1" class="form-control input-sm" disabled="disabled" id="memory_resident_period">
                 <span class="input-group-addon">分钟</span>
              </div>
          </div>，触发告警     
        </div>
        
        <!--
        <h4>告警配置</h4>
        <div class="m-t m-l-lg text-primary">
           告警重复间隔
           <div class="inline v-middle">
             <div class="input-group w-xs">
                 <input type="text" value="60" class="form-control input-sm" disabled="disabled">
                 <span class="input-group-addon">分钟</span>
              </div>
           </div>    
        </div>
	     -->
      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info"  onclick="confirmBtn();">确定</a>
        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
      </div>
    </div>
  </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isInstall }">
  <div class='modal-dialog modal-lg' role='document' data-bind="visible: !isInstallVM()">
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>安装软件</h3>
      </div>
      <div class='modal-body form-horizontal'>
        <div>
          <button class="btn btn-default btn-sm pull-right" data-bind="click: installVM">选择软件</button>
          虚拟机名称：<span data-bind="text: vmVO().name"></span>
        </div>
        <hr />
         <div class="form-inline">
          用户名：<input type="text" class="form-control" data-bind="value: installSoftwareVO().userName"/>&nbsp;&nbsp;&nbsp;&nbsp; 
          <span data-bind="if: vmVO().sshKeyName == null">密码：<input type="password" class="form-control" data-bind="value: installSoftwareVO().password"/></span>
        </div>
        	<p class="text-muted" style="padding-top:10px;">注：没有密钥对的虚拟机需输入虚拟机用户密码。</p>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>软件名称</th>
              <th>软件版本</th>
              <th>软件类型</th>
              <th>软件分类</th>
              <th>静默安装属性</th>
              <th>是否重复安装</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody data-bind="foreach: softwareItems">
            <tr>
              <td data-bind="text: name"></td>
              <td data-bind="text: version"></td>
              <td data-bind="text: softTypeName"></td>
              <td data-bind="text: softType"></td>
              <td><a data-bind="click: $root.showScriptConfig">查看</a></td>
              <td data-bind="text: reInstall"></td>
              <td>
                <a data-bind="click:$root.deleteSoftware">移除</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class='modal-footer' style="text-align: center">
        <input type="button" name="commit" value="确定安装" class="btn btn-default btn-info" data-bind="click: $root.submitInstallSoftwares"/>
        <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
      </div>
    </div>
  </div>
  <div class='modal-dialog modal-lg' role='document' data-bind="visible: isInstallVM()">
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>安装软件</h3>
      </div>
      <div class='modal-body form-horizontal'>
        <div>
          虚拟机名称：<span data-bind="text:vmVO().name"></span>
        </div>
        <hr />
        <div class="form-inline">
          软件名称：<input type="text" class="form-control" data-bind="value: software_param().softwareName"/>&nbsp;&nbsp;
          软件分类：
          <select class="form-control" data-bind="value: software_param().softType, options: $root.software_check_table_softTypeName_partitions, optionsText: 'type', optionsValue: 'type'">
          </select>&nbsp;&nbsp;
          软件类型：
          <select class="form-control" data-bind="value: software_param().softTypeName, options: $root.software_check_table_softTypeName_partitions, optionsText: 'name', optionsValue: 'name'">
          </select>&nbsp;&nbsp;&nbsp;&nbsp;
          <button class="btn btn-default" data-bind="click: $root.software_check_search">搜索</button>
        </div>
        <p>&nbsp;</p>
        <div data-bind="with: software_check_table">
	        <table class="table">
	          <thead>
	            <tr>
	              <th>选择</th>
	              <th>软件名称</th>
	              <th>软件版本</th>
	              <th>软件类型</th>
	              <th>软件分类</th>
	            </tr>
	          </thead>
	          <tbody>
		        <tr data-bind="visible: showNoData">
	              <td colspan=14 class="aligncenter">
	                	暂无数据
	              </td>
	            </tr>
	          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
	            <tr>
	              <td>
	                <div class="checkbox">
	                  <label class="i-checks">
	                    <input type="checkbox" name="vm_show_software_install_check" value="" data-bind="value: uuid"/>
	                    <i></i>
	                  </label>
	                </div> 
	              </td>
	              <td data-bind="text: name"></td>
	              <td data-bind="text: version"></td>
	              <td data-bind="text: softTypeName"></td>
	              <td data-bind="text: softType"></td>
	            </tr>
	            <!-- /ko -->
	          </tbody>
	        </table>
      	</div>
      </div>
      <div class='modal-footer'>
        <input type="button" name="commit" value="选择" class="btn btn-default btn-primary" data-bind="click: installVMConfirm" />
        <button name="button" class="btn btn-default btn btn-default" data-bind="click: installVMCancel">取消</button>
      </div>
    </div>
  </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isUpdate }">
  <div class='modal-dialog modal-lg' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>软件升级</h3>
      </div>
      <div class='modal-body'>
        <div>
           脚本名称：<span data-bind="text: updateSoftwareVO().scriptName"></span> 软件版本：<span data-bind="text: updateSoftwareVO().version"></span>
        </div>
        <hr />
        <div data-bind="with: software_update_table">
	        <table class="table table-bordered">
	          <thead>
	            <tr>
	              <th style="width:60px" class="text-center">选择</th>
	              <th>软件名称</th>
	              <th>软件名称版本</th>
	            </tr>
	          </thead>
	          <tbody>
	          	<tr data-bind="visible: showNoData">
	              <td colspan=14 class="aligncenter">
	                	暂无数据
	              </td>
	            </tr>
	          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
	            <tr>
	              <td>
	                <div class="radio">
	                  <label class="i-checks">
	                    <input type="radio" name="softwareupdate" data-bind="value: uuid"/>
	                    <i></i>
	                  </label>
	                </div>
	              </td>
	              <td data-bind="text: name"></td>
	              <td data-bind="text: version"></td>
	            </tr>
	            <!-- /ko -->
	          </tbody>
	        </table>
        </div>
        <div class="form-inline">
          用户名：<input type="text" class="form-control" data-bind="value: updateSoftwareVO().userName"/>&nbsp;&nbsp;&nbsp;&nbsp; 
          <span data-bind="if: vmVO().sshKeyName == null">
          密码：<input type="password" class="form-control" data-bind="value: updateSoftwareVO().password"/>
          </span>
        </div>
      </div>
      <div class='modal-footer'>
        <input type="button" name="commit" value="确定升级" class="btn btn-default btn-primary" data-bind="click: $root.doUpdateSoftware"/>
        <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
      </div>
    </div>
  </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isVmAdjustment }">
	<div class='modal-dialog modal-md'>
		<div class='modal-content'>
			<div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>调整资源</h3>
			</div>
			<div class='modal-body form-horizontal row'>
			    <div class="form-group">
                  <label class="col-sm-3 control-label">名称：</label>
                  <div class="col-sm-8">
                    <input type="email" class="form-control" data-bind="value: adjustmentVO().name" disabled="disabled">
                  </div>
                </div>
				<div class="form-group">
                  <label class="col-sm-3 control-label">VCPU数：</label>
                  <div class="col-sm-8">
                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().vcpu">
                  </div>
                </div>
				<div class="form-group">
	                  <label class="col-sm-3 control-label">内存(MB)：</label>
	                  <div class="col-sm-8">
	                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().memory">
	                  </div>
				</div>
				<div class="form-group">
	                  <label class="col-sm-3 control-label">存储(GB)：</label>
	                  <div class="col-sm-8">
	                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().storage">
	                  </div>
				</div>
			</div>
			<div class='modal-footer' style="text-align:center;">
	                <a class="btn btn-default btn-info" data-bind="click: adjust">确定</a>
	                <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
			</div>
		</div>
	</div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isStorageExpand }">
    <div class='modal-dialog modal-lg' style="width:600px;">
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>扩展云硬盘</h3>
        </div>
        <div class='modal-body form-horizontal row'>
          <div class="form-group">
            <label class="col-sm-3 control-label">云硬盘名称：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" data-bind="value: volumeVO().name">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">云硬盘大小(GB)：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" data-bind="value: volumeVO().size">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">扩展后大小(GB)：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" data-bind="value: volumeVO().targetSize">
            </div>
          </div>

        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: $root.doExpand">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
</div>        
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isDeleteProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源删除</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>资源删除</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: deleteProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: deleteProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: deleteProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: deleteProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>    
    
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdjustProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>资源变更</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: adjustProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: adjustProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		            <table class="table">
			            <thead>
			              <tr>
			                <th></th>
			                <th>调整前</th>
			                <th>调整后</th>
			              </tr>
			            </thead>
			            <tbody>
			              <tr>
			                <td>CPU(个)</td>
			                <td data-bind="text: adjustProcessVO().vcpu"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetVcpu" /></td>
			              </tr>
			              <tr>
			                <td>内存(MB)</td>
			                <td data-bind="text: adjustProcessVO().memory"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetMemory"/></td>
			              </tr>
			              <tr>
			                <td>存储(GB)</td>
			                <td data-bind="text: adjustProcessVO().storage"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetStorage"/></td>
			              </tr>
			            </tbody>
			         </table> 
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: adjustProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		          <table class="table">
			            <thead>
			              <tr>
			                <th></th>
			                <th>调整前</th>
			                <th>调整后</th>
			              </tr>
			            </thead>
			            <tbody>
			              <tr>
			                <td>CPU(个)</td>
			                <td data-bind="text: adjustProcessVO().vcpu"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetVcpu" /></td>
			              </tr>
			              <tr>
			                <td>内存(MB)</td>
			                <td data-bind="text: adjustProcessVO().memory"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetMemory"/></td>
			              </tr>
			              <tr>
			                <td>存储(GB)</td>
			                <td data-bind="text: adjustProcessVO().storage"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetStorage"/></td>
			              </tr>
			            </tbody>
			         </table> 
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: adjustProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isValidateProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content' style="width:700px;">
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>有效时间变更</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: validateProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: validateProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: validateProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		          <div class="row">
		            <div class="col-xs-6"><p>调整前失效时间：<input type="text" value="" class="form-control inline w" data-bind="value: validateProcessVO().validateTime" disabled="disabled"></p></div>
		            <div class="col-xs-6"><p>调整后失效时间：<input type="text" value="" class="form-control inline w" id="resource_instance_vm_validate_process" data-bind="value: validateProcessVO().targetValidateTime"></p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: validateProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdjustVolumeProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: adjustVolumeProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云硬盘</p></div>
		          </div>
		           <table class="table">
			            <thead>
			              <tr>
			                <th></th>
			                <th>调整前</th>
			                <th>调整后</th>
			              </tr>
			            </thead>
			            <tbody>
			              <tr>
			                <td>存储(GB)</td>
			                <td data-bind="text: adjustVolumeProcessVO().size"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustVolumeProcessVO().targetSize"/></td>
			              </tr>
			            </tbody>
			         </table> 
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: adjustVolumeProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<!-- 安装日志弹窗   start --> 
   <div role="dialog" aria-hidden="true" class="modal fade" 
      data-bind="modal: { show: isLogText }"> 

      <div class='modal-dialog' role='document'> 
         <div class='modal-content'> 
            <div class='modal-header'> 
               <button type="button" class="close" data-dismiss="modal"> 
                  <span aria-hidden="true">&times;</span> 
               </button> 
               <h3 class='modal-title'>安装日志</h3> 
            </div> 
            <div class='modal-body form-horizontal'> 
               <div class="form-group"> 
                  <div class="col-xs-12"> 
                     <textarea class="form-control" style="min-height: 250px;" data-bind="text: installLogVO().logText"> 
                     </textarea> 
                  </div> 
               </div> 
               <div class='modal-footer' style="text-align: center"> 
                  <button name="button" type="submit" 
                     class="btn btn-default btn btn-default" data-dismiss="modal">关闭</button> 
               </div> 
            </div> 
         </div> 
      </div> 
   </div> 
   <!-- 安装日志弹窗   end -->

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isReInstall }">
    <div class='modal-dialog modal-lg' style="width:600px;">
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>软件重安装</h3>
        </div>
        <div class='modal-body form-horizontal row'>
          <div class="form-group">
            <label class="col-sm-3 control-label">用户名：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" data-bind="value: reInstallVO().userName">
            </div>
          </div>
          <div data-bind="if: vmVO().sshKeyName == null">
	          <div class="form-group">
	            <label class="col-sm-3 control-label">密码：</label>
	            <div class="col-sm-8">
	              <input type="password" class="form-control" data-bind="value: reInstallVO().password">
	            </div>
	          </div>
		  </div>
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: $root.submitReInstall">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
</div>   

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isScriptConfig }">
    <div class='modal-dialog modal-lg' style="width:600px;">
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>静默安装属性</h3>
        </div>
        <div class='modal-body form-horizontal row'>
          <div class="form-group">
        	<div data-bind="with: software_script_table">
		        <table class="table">
		          <thead>
		            <tr>
		              <th>参数名称</th>
		              <th>参数代码</th>
		              <th>默认值</th>
		            </tr>
		          </thead>
		          <tbody>
		          	<tr data-bind="visible: showNoData">
		              <td colspan=14 class="aligncenter">
		                	暂无数据
		              </td>
		            </tr>
		          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
		            <tr>
		              <td data-bind="text: name"></td>
		              <td data-bind="text: code"></td>
		              <td data-bind="text: value"></td>
		            </tr>
		            <!-- /ko -->
		          </tbody>
		        </table>
      		</div>
          </div>
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn btn-default" data-dismiss="modal">确定</a>
        </div>
      </div>
    </div>
</div>   

<div id="resource_instance_show_vm_console" style="display:none;"></div> 
<!-- page specific plugin scripts -->
<script type="text/javascript">
  //var scripts = [null, "assets/lib/highcharts/highstock.js"]
  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js","assets/lib/highcharts/highstock.js"];
  
  var cpu_chart ;
  var vmUuid;
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    vmUuid = args.vmUuid;
	this.show_vm_name = ko.observable("");
    function ViewModel(){
      var self = this;
    	
      this.isConfig = ko.observable(false);//告警配置
      this.isInstall = ko.observable(false);//安装软件
      this.isInstallVM = ko.observable(false);//安装软件
      this.isLogText = ko.observable(false);//已安装软件的安装日志
      this.isUpdate = ko.observable(false);//软件升级
      this.isVmAdjustment = ko.observable(false);//调整资源
      this.isValidateTime = ko.observable(false);//调整有效期
      
      this.config = function(){
          this.isConfig(true);
      };
      this.install = function(){
        this.isInstall(true);
      }
      this.installVM = function(){
        this.isInstallVM(true);
      }
      //初始化所有软件列表
      var software_all_data;
      this.init_software_all_data = function(){
	      csc.rest.get('api/v5.0.0/soft/softwares',function(allSoft){
	      	if(allSoft){
	      		software_all_data = allSoft.results;
	      	}
	      });
      }
      //初始化已安装软件
      var software_installed_data;
      this.init_software_installed_data = function(){
	      csc.rest.get('api/v5.0.0/install/logs?vmUuid='+self.vmVO().uuid+'&status=1',function(vmSoft){
	        	if(vmSoft){
	        		software_installed_data = vmSoft.results;
	        	}
	      });
      }
      
      //确定选择
      this.installVMConfirm = function(){
        this.isInstallVM(false);
        //获取选择好的软件更新到待提交列表中
        var checkedSofts = $("input:checkbox[name='vm_show_software_install_check']:checked");
        //组装选择的软件
	    for(var j=0;j<software_all_data.length;j++){
	      for(var i=0;i<checkedSofts.length;i++){
		     if(software_all_data[j].uuid == checkedSofts[i].value){
		    	 //判断是否重复安装
		    	 software_all_data[j].reInstall = "否";
		    	 for(var l=0;l<software_installed_data.length;l++){
		    		 if(software_installed_data[l].uuid == software_all_data[j].uuid){
		    			 software_all_data[j].reInstall = "是";
		    			 break;
		    		 }
		    	 }
		         self.addSoftware(software_all_data[j]);
		     }
	      }
	    }
      }
      this.installVMCancel = function(){
        this.isInstallVM(false);
      }
      
      //获取云主机摘要
      this.vmVO = ko.validatedObservable({});
      
      this.reloadVmInfo = function(){
    	  csc.rest.get('api/v5.0.0/vms/'+vmUuid,function(data){
    		  if(data){
    			  self.vmVO(data);
    			  self.reloadVolume();
    			  self.reloadSoftware();
    			  self.init_software_all_data();
    			  self.init_software_installed_data();
    		  }
    	  });
      }
      
      this.reloadVmInfo();
      
    //------------------------------------------软件列表开始----------------------------
    this.vm_software_table = new DataTable([]);
    this.softwareSearchParam = ko.observable({
    	softTypeName: '',
    	installType: '',
    	softwareName: ''
  	})
  	
  	this.reloadSoftware = function(){
     	if(self.softwareSearchParam().softTypeName == "全部"){
     		self.softwareSearchParam().softTypeName = null;
    	}
    	self.vm_software_table.params(self.softwareSearchParam());
    	self.vm_software_table.path('api/v5.0.0/install/logs?vmUuid='+self.vmVO().uuid);
    }
    this.softTypeNamePartitions = ko.observableArray([]);
    
    //------------------------------------------软件列表结束----------------------------
    
    
    //------------------------------------------软件重安装开始------------------------
  	this.doReInstall = function(object,event){
    	self.isReInstall(true);
    	self.reInstallVO().uuid(object.uuid);
    	self.reInstallVO().softwareUuid(object.softwareUuid);
    	self.reInstallVO().userName('');
    	self.reInstallVO().password('');
    }
    this.isReInstall = ko.observable(false);//初始化重安装的确认提示框（内容包括虚拟机操作系统的用户名和密码，有密钥的不用填）
    
    this.reInstallVO = ko.observable({
    	uuid: ko.observable(),
    	softwareUuid: ko.observable(),
    	userName: ko.observable(),
    	password: ko.observable()
    })
    
    this.submitReInstall = function(){
    	var vm = {};
    	vm.id = self.vmVO().id;
    	vm.uuid = self.vmVO().uuid;
    	vm.userName = self.reInstallVO().userName();
    	vm.userPwd = self.reInstallVO().password();
    	vm.softwareUuid = self.reInstallVO().softwareUuid();
    	vm.logUuid = self.reInstallVO().uuid();
    	var vms = [];
    	vms.push(vm);
    	
    	var postBody = {};
    	postBody.vms = vms;
    	csc.rest.post("api/v5.0.0/install/retry",postBody,function(data){
    		//重安装结束
    		self.isReInstall(false);
    		if(data.message){
    			systemMsg.alert(data.message+'！');
    		}
    	});
    }
    
    //------------------------------------------软件重安装结束------------------------
    
    //------------------------------------------软件升级开始------------------------

    //this.isUpdate(true);
    
    this.software_update_table = new DataTable([]);
    
    this.updateSoftwareVO = ko.observable({
    	scriptName: ko.observable(),
    	version: ko.observable(),
    	userName: ko.observable(),
    	password: ko.observable()
    });
    
    this.updateSearchParam = ko.observable({
    	firstResult: -1,
    	maxResult: -1
    });
    
    this.update = function(object,event){
        self.isUpdate(true);
        self.software_update_table.params(self.updateSearchParam());
    	self.software_update_table.path('api/v5.0.0/soft/softwares?installable=Y&installType='+encodeURIComponent('升级')+'&softwareName='+object.softwareName);
    	self.updateSoftwareVO().scriptName(object.scriptName);
    	self.updateSoftwareVO().version(object.version);
    };
    
    this.doUpdateSoftware = function(){
    	//获取选中的软件
    	var softwareUuid= "";
    	var temp = document.getElementsByName("softwareupdate");
	  	for(var i=0;i<temp.length;i++){
	  	  if(temp[i].checked){
	  	    softwareUuid = temp[i].value;
	  	    break;
	  	  }
	  	}
	  	if(csc.util.isNull(softwareUuid)){
	  		systemMsg.alert('请选择一个软件！');
	  		return;
	  	}
	  	//TODO　要获取高版本的软件
    	var vm = {};
    	vm.id = self.vmVO().id;
    	vm.uuid = self.vmVO().uuid;
    	vm.userName = self.updateSoftwareVO().userName();
    	vm.userPwd = self.updateSoftwareVO().password();
    	vm.softwareUuid = softwareUuid;
    		
    	var vms = [];
    	vms.push(vm);
    	
    	var postBody = {};
    	postBody.vms = vms;
    	csc.rest.post("api/v5.0.0/install",postBody,function(data){
    		//升级结束
    		self.isUpdate(false);
    		if(data.message){
    			systemMsg.alert(data.message+'！');
    		}
    	});
    }
    
    
    //------------------------------------------软件升级结束------------------------
  
    //------------------------------------------软件安装日志开始------------------------
    this.installLogVO = ko.observable({
    	logText: ko.observable()
    })
    this.doInstallLog = function(object,event){
    	var softwareUuid = object.uuid;
    	csc.rest.get("api/v5.0.0/install/log/"+softwareUuid,function(logData){
    		if(logData){
    			self.installLogVO().logText(logData.logText);
    		}
    	});
	    self.isLogText(true);
    }
    //------------------------------------------软件安装日志结束------------------------
    
    //------------------------------------------安装软件开始----------------------------
    
    this.softwareItems = ko.observableArray([]);
    
    this.installSoftwareVO = ko.observable({
    	userName: ko.observable(),
    	password: ko.observable()
    });
    
    //增加数据
	/*人和骰子一样，向自己决定的地方扔出自己，正是因为这样，人才是自由的；
	    每个人的境遇都不一样，但是无论多么微不足道的选择，都可以投入自己，不是偶然；也不是随波逐流，而是自己选择的结果。 */
    this.addSoftware = function(softItem){
      //去重
      var has = false;
      for(var ia=0;ia<self.softwareItems().length;ia++){
    	  if(self.softwareItems()[ia].uuid == softItem.uuid){
    		  has = true;
    		  break;
    	  }
      }
      //填装
      if(!has){
	  	  self.softwareItems.push(softItem);
      }
    }
    //删除数据
    this.deleteSoftware = function(){
      //调用删除接口，成功后回调以下方法
      self.softwareItems.remove(this);
    }
    
    //备选软件
    this.software_check_table = new DataTable([]);
    
    this.software_check_table_softTypeName_partitions = ko.observableArray([]);
    csc.rest.get("api/v5.0.0/soft/softTypes",function(softTypeNameData){
    	if(softTypeNameData){
    		var defualObj = {};
    		defualObj.name = "全部";
    		defualObj.type = "全部";
    		softTypeNameData.results.unshift(defualObj);
	    	self.software_check_table_softTypeName_partitions(softTypeNameData.results);
    	}
    });
    this.software_param = ko.observable({
      softwareName: '',
  	  softTypeName: '',
  	  softType: '',
  	  firstResult: -1,
	  maxResult: -1
    })
    
    this.software_check_search = function(){
     	if(self.software_param().softTypeName == "全部"){
     		self.software_param().softTypeName = null;
    	}
     	if(self.software_param().softType == "全部"){
     		self.software_param().softType = null;
    	}
  	  	self.software_check_table.params(self.software_param());
		self.software_check_table.path('api/v5.0.0/soft/softwares?installable=Y&installType='+encodeURIComponent('安装');
    }
    self.software_check_search();
    
    //软件提交
    //1.将虚拟机与预置的公网IP关联起来
    //2.根据虚拟机的操作系统类型判断默认用户名，windows-Administrator linux-root
    //3.windows必须有密码，linux如果没有密码使用密钥（用户名、密码保存在数据库，以后可以做修改功能）
    //4.安装完成后将公网IP与虚拟机解绑
    this.submitInstallSoftwares = function(){
    	if(self.softwareItems().length == 0){
    		systemMsg.alert('请选择一个软件！');
    		return;
    	}
    	if(csc.util.isNull(self.installSoftwareVO().userName())){
    		systemMsg.alert('请填写用户名	！');
    		return;
    	}
    	var vms = [];
    	for(var ia=0;ia<self.softwareItems().length;ia++){
    		var vm = {};
        	vm.id = self.vmVO().id;
        	vm.uuid = self.vmVO().uuid;
        	vm.userName = self.installSoftwareVO().userName();
        	if(csc.util.isNotNull(self.installSoftwareVO().password())){
    	    	vm.userPwd = self.installSoftwareVO().password();
        	}
        	vm.softwareUuid = self.softwareItems()[ia].uuid;
        	vms.push(vm);
    	}
    	var postBody = {};
    	postBody.vms = vms;
    	csc.rest.post("api/v5.0.0/install",postBody,function(data){
    		self.isInstall(false);
    		if(data.message){
    			systemMsg.alert(data.message+'！');
    		}
    	}); 
    }
    
    //------------------------------------------安装软件结束----------------------------
    
    //------------------------------------------静默安装属性列表开始----------------------------
/*      
    静默安装属性
    参数名称	参数代码		默认值 */
    this.isScriptConfig = ko.observable(false);
    
    this.software_script_param = ko.observable({
	  	  firstResult: -1,
		  maxResult: -1
	})
	 
    this.showScriptConfig = function(object,event){
    	self.software_script_table.params(self.software_script_param());
    	self.software_script_table.path('api/v5.0.0/script/defaultAttrs?status=1&scriptUuid='+object.scriptUuid);
    	self.isScriptConfig(true);
    }
    
    this.software_script_table = new DataTable([]);
    //------------------------------------------静默安装属性列表结束----------------------------
    
      //------------------------------------------云硬盘列表开始----------------------------
      this.vm_volume_table = new DataTable([]);
      
      this.volume_param = ko.observable({
    	  firstResult: -1,
    	  maxResult: -1,
          vmUuid: vmUuid
      })
        
      this.reloadVolume = function(){
    	  self.vm_volume_table.params(self.volume_param());
		  self.vm_volume_table.path('api/v5.0.0/volumes');
      }
      
      this.isStorageExpand = ko.observable(false);

      this.storageExpand = function(objcet,event){
    	  if(csc.util.isNotNull(objcet.serviceInstanceUuid)){
    		  //走流程
    		  self.doAdjustVolumeProcessPost(objcet);
    	  }else{
		        self.isStorageExpand(true);
		        self.volumeVO().uuid(objcet.uuid);
		        self.volumeVO().name(objcet.volumeName);
		        self.volumeVO().size(objcet.volumeSize);
    	  }
      };
      
      this.volumeVO = ko.validatedObservable({
    	  uuid: ko.observable(),
    	  name: ko.observable(),
    	  size: ko.observable(),
    	  targetSize: ko.observable()
      });
      
      this.doExpand = function(){
    	  var putBody = {};
    	  putBody.newSize = parseInt(self.volumeVO().targetSize());
    	  putBody.volumeSize = parseInt(self.volumeVO().size());
    	  csc.rest.put('api/v5.0.0/volumes/'+self.volumeVO().uuid(), putBody, function(data){
 	            self.isStorageExpand(false);
 	            if(data.taskId){
	 	            systemMsg.alert('扩展云硬盘请求成功，任务ID：'+data.taskId+'！');
 	            }
 	            self.vm_volume_table.refreshData();
 		  });
      }
      //------------------------------------------云硬盘列表结束----------------------------
      
      
      
      //--------------------------------操作开始---------------------------------
      
      //控制台
      this.console = function(){
    	  csc.rest.get('api/v5.0.0/vms/'+vmUuid+'/vmConsole',function(data){
    		  if(data.consoleUrl){
    			  var consoleUrl = data.consoleUrl;
        		  //模拟点击
        		  $("#resource_instance_show_vm_console").html("<a id='resource_instance_show_vm_console_a' href='"+consoleUrl+"' target='_blank'></a>");
          		  $("#resource_instance_show_vm_console_a")[0].click();
    		  }
		  });
      }
      //启动
      this.startOne = function(){
    		systemMsg.confirm("确定要启动云主机 "+self.vmVO().name+"？",function(){
    			var startPutBody = {"operationType":"START"};
      			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('启动云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
      		});
      }
      //关闭
      this.shutoffOne = function(){
    	  systemMsg.confirm("确定要关闭云主机 "+self.vmVO().name+"？",function(){
  			var startPutBody = {"operationType":"STOP"};
    			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('关闭云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
    		});
      }
      //重启
      this.restartOne = function(){
    	  systemMsg.confirm("确定要重启云主机 "+self.vmVO().name+"？",function(){
  			var startPutBody = {"operationType":"RESTART"};
    			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('重启云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
    		});
      }
      //强制重启
      this.restartForceOne = function(){
    	  systemMsg.confirm("确定要强制重启云主机 "+self.vmVO().name+"？",function(){
  			var startPutBody = {"operationType":"FORCERESTART"};
    			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('强制重启云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
    		});
      }
      //挂起
      this.suspend = function(){
    	  systemMsg.confirm("确定要挂起云主机 "+self.vmVO().name+"？",function(){
  			var startPutBody = {"operationType":"SUSPEND"};
    			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('挂起云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
    		});
      }
      //恢复（从挂起状态）
      this.resume = function(){
    	  systemMsg.confirm("确定要恢复云主机 "+self.vmVO().name+"？",function(){
  			var startPutBody = {"operationType":"RESUME"};
    			csc.rest.put('api/v5.0.0/vms/'+self.vmVO().uuid,startPutBody,function(data){
			 		systemMsg.alert('恢复云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.reloadVmInfo();
			    });
    		});
      }
      //删除
      this.removeOne = function(){
    	  if(csc.util.isNotNull(self.vmVO().serviceInstanceUuid)){
    		  //走流程
    		  self.doDeleteProcessPost();
    	  }else{
    		  //不走流程
	    	  systemMsg.confirm("确定要删除云主机 "+self.vmVO().name+"？",function(){
	    			csc.rest.del('api/v5.0.0/vms/'+self.vmVO().uuid,function(data){
				 		systemMsg.alert('删除云主机请求成功，调度任务ID：'+data.taskId+'！');
				 		self.reloadVmInfo();
				    });
	    		});
    	  }
      }
      
      //终止（服务实例）
      this.validate = function(){
    	  systemMsg.confirm("确定要终止云主机 "+self.vmVO().name+"？",function(){
    		var putBody = {"expiryDate":""};
  			csc.rest.put('api/v5.0.0/resourceInstances/'+self.vmVO().uuid,putBody,function(data){
			 		systemMsg.alert('云主机终止成功！');
			 		self.reloadVmInfo();
			    });
  		});
      }
      
      //--------------------------------操作结束---------------------------------
      
      //------------------------------------------调整配置开始------------------------------
      this.adjustmentVO = ko.validatedObservable({
    	  vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  vmUuid: ko.observable(),
    	  name: ko.observable()
      });
      
      this.vmAdjustment = function(){
    	  if(csc.util.isNotNull(self.vmVO().serviceInstanceUuid)){
    		  //走流程
    		  self.doAdjustProcessPost();
    	  }else{
    		  //不走流程
	          self.isVmAdjustment(true);
	          self.adjustmentVO().vcpu(self.vmVO().vcpu);
	          self.adjustmentVO().memory(self.vmVO().memory);
	          self.adjustmentVO().storage(self.vmVO().storage);
	          self.adjustmentVO().vmUuid(self.vmVO().uuid);
	          self.adjustmentVO().name(self.vmVO().name);
    	  }
      };
      
      //调整资源
      this.adjust = function(){
    	  ko.validation.group(this.adjustmentVO).showAllMessages();
    	  if(self.adjustmentVO.isValid()){
	    	  var putBody = {};
	    	  putBody.operationType = "RESIZE";
	    	  putBody.vcpu = self.adjustmentVO().vcpu();
	    	  putBody.memory = self.adjustmentVO().memory();
	    	  putBody.storage = self.adjustmentVO().storage();
	    	  csc.rest.put('api/v5.0.0/vms/'+self.adjustmentVO().vmUuid(),putBody,function(data){
			 		systemMsg.alert('云主机调整资源请求成功，调度任务ID：'+data.taskId+'！');
			 		self.isVmAdjustment(false);
			 		self.reloadVmInfo();
			  });
    	  }
      }
      //------------------------------------------调整配置结束------------------------------
      
      //------------------------------------------修改有效期开始----------------------------
      //modal_edit_validate
     $("#modal_edit_validate_1").on("shown.bs.modal",function(){
		  
          // daterange             
          $('#resource_instance_vm_validate_edit_1').val(self.validateTimeVO().time()).daterangepicker(
            {
              format:'YYYY/MM/DD',
              minDate:moment(),
              singleDatePicker: true,
              locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                weekLabel: '周',
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              }
            }

          ); 

      })
      this.validateTimeVO = ko.validatedObservable({
    	  metaTime: ko.observable(),
    	  time: ko.observable(),
    	  uuid: ko.observable()
      });
      
      this.editValidateTime = function(){
       	  if(csc.util.isNotNull(self.vmVO().serviceInstanceUuid)){
    		  //走流程
    		  self.doValidateProcessPost();
    	  }else{
    		  //不走流程
	    	  self.isValidateTime(true);
	    	  self.validateTimeVO().uuid(self.vmVO().uuid);
	    	  self.validateTimeVO().time(self.vmVO().expiryTime);
	    	  self.validateTimeVO().metaTime(self.vmVO().expiryTime);
    	  }
      }
      
      //修改有效期
      this.validateTime = function(){
    	  //检查日期相同的，不发送请求直接关闭页面
    	  if(self.validateTimeVO().metaTime() == self.validateTimeVO().time()){
    		  self.isValidateTime(false);
    		  return;
    	  }
    	  var putBody = {};
    	  putBody.expiryDate = self.validateTimeVO().time() + " 23:59:59";
    	  csc.rest.put('api/v5.0.0/resourceInstances/'+self.validateTimeVO().uuid(),putBody,function(data){
		 		systemMsg.alert('云主机修改有效期成功！');
		 		self.isValidateTime(false);
		 		self.reloadVmInfo();
		  });
      }
      //------------------------------------------修改有效期结束----------------------------
      
      //------------------------------------------删除-流程开始--------------------------------
      this.isDeleteProcess = ko.observable(false);
      
      this.doDeleteProcessPost = function(){
    	  self.isDeleteProcess(true);
		  self.deleteProcessVO().name(self.vmVO().name);
		  self.deleteProcessVO().uuid(self.vmVO().uuid);
		  self.deleteProcessVO().vdcUuid(self.vmVO().vdcUuid);
		  self.deleteProcessVO().azUuid(self.vmVO().azUuid);
		  var myDate = new Date();
		  self.deleteProcessVO().time(myDate.toLocaleString());
		  self.deleteProcessVO().serviceInstanceUuid(self.vmVO().serviceInstanceUuid);
      }
  
      this.deleteProcessVO = ko.observable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  vdcUuid: ko.observable(),
    	  azUuid: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  serviceInstanceUuid: ko.observable()
      });
      
      this.deleteProcessPost = function(){
		  csc.rest.get("api/v5.0.0/volumes?vmUuid="+self.deleteProcessVO().uuid(),function(volumeData){
        	  var orderItem = {};
        	  orderItem.instanceName = self.deleteProcessVO().name();
        	  orderItem.serviceInstanceUuid = self.deleteProcessVO().serviceInstanceUuid();
        	  orderItem.resourceType = "VM";
        	  orderItem.metaData =  "{\"resBaseInfo\": {\"vpc\": \""+self.vmVO().vpcName+"\",\"cpu\": \""+self.vmVO().vcpu+"\",\"memory\": \""+self.vmVO().memory+"\",\"storage\": \""+self.vmVO().storage+"\",\"ip\": \""+self.vmVO().ip+"\",\"expireTime\": \""+self.vmVO().expiryDate+"\"}}";
        	  orderItem.resourceUuid = self.deleteProcessVO().uuid();
        	  orderItem.vdcUuid = self.deleteProcessVO().vdcUuid();
        	  orderItem.vdcName = self.vmVO().vdcName;
        	  orderItem.azUuid = self.deleteProcessVO().azUuid();
        	  orderItem.azName = self.vmVO().azName;
        	  
        	  var orderItems = [];
        	  orderItems.push(orderItem);
        	  
        	  if(volumeData.results){
        		  var volumes = volumeData.results;
            	  for(var i=0;i<volumes.length;i++){
            		  var volumeItem = {};
            		  volumeItem.instanceName = volumes[i].volumeName;
            		  volumeItem.serviceInstanceUuid = volumes[i].serviceInstanceUuid;
            		  volumeItem.resourceType = "DISK";
            		  volumeItem.metaData =  "{\"resBaseInfo\": {\"type\": \"DISK\",\"size\": \""+volumes[i].volumeSize+"\",\"storageName\": \""+volumes[i].storagePoolName+"\"}}";
            		  volumeItem.vdcUuid = volumes[i].vdcUuid;
            		   volumeItem.azUuid =  volumes[i].azUuid;
            		  orderItems.push(volumeItem);
            	  }
        	  }
        	  
        	  var postBody = {};
        	  postBody.resourceType = "VM";
        	  postBody.orderItems = orderItems;
        	  
        	  csc.rest.post("api/v5.0.0/orders/deleteResource",postBody,function(data){
        		  if(data.taskId){
          			systemMsg.alert('删除资源请求成功，任务ID：' + data.taskId + '！');
          		  }else if(data.code){
        			systemMsg.alert('删除资源申请成功，订单编号：'+data.code+'！');
        		  }
        		  self.reloadVmInfo();
      		 	  self.isDeleteProcess(false);
        	  });
		  });
  		}
      
      //------------------------------------------删除-流程结束--------------------------------
      
      //------------------------------------------资源变更-流程开始--------------------------------
	  this.isAdjustProcess = ko.observable(false);
      
      this.doAdjustProcessPost = function(){
    	  self.isAdjustProcess(true);
		  self.adjustProcessVO().name(self.vmVO().name);
		  self.adjustProcessVO().uuid(self.vmVO().uuid);
		  self.adjustProcessVO().serviceInstanceUuid(self.vmVO().serviceInstanceUuid);
		  var myDate = new Date();
		  self.adjustProcessVO().time(myDate.toLocaleString());
		  self.adjustProcessVO().user("");
		  
		  self.adjustProcessVO().vcpu(self.vmVO().vcpu);
		  self.adjustProcessVO().memory(self.vmVO().memory);
		  self.adjustProcessVO().storage(self.vmVO().storage);
		  
		  self.adjustProcessVO().targetVcpu('');
		  self.adjustProcessVO().targetMemory('');
		  self.adjustProcessVO().targetStorage('');
		  
		  self.adjustProcessVO().vdcUuid(self.vmVO().vdcUuid);
		  self.adjustProcessVO().vdcName(self.vmVO().vdcName);
		  self.adjustProcessVO().azUuid(self.vmVO().azUuid);
		  self.adjustProcessVO().busSysName(self.vmVO().busSysName);
      }
  
      this.adjustProcessVO = ko.validatedObservable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  serviceInstanceUuid: ko.observable(),
    	  
    	  vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  
    	  targetVcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  targetMemory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  targetStorage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  
    	  vdcUuid: ko.observable(),
    	  vdcName: ko.observable(),
    	  azUuid: ko.observable(),
    	  busSysName: ko.observable()
      });
      
      //申请
      this.adjustProcessPost = function(){
    	  ko.validation.group(this.adjustProcessVO).showAllMessages();
    	  if(self.adjustProcessVO.isValid()){
	    	  //var metaData = "{\"resBaseInfo\":{\"vcpu\": \""+self.adjustProcessVO().targetVcpu()+"\",\"memory\": \""+self.adjustProcessVO().targetMemory()+"\",\"storage\": \""+self.adjustProcessVO().targetStorage()+"\"}}";
	    	  var metaData = "{\"resBaseInfo\":{\"vcpu\": \""+self.adjustProcessVO().targetVcpu()+"\",\"memory\": \""+self.adjustProcessVO().targetMemory()+"\",\"storage\": \""+self.adjustProcessVO().targetStorage()
	    		  +"\",\"metaVcpu\": \""+self.adjustProcessVO().vcpu()+"\",\"metaMemory\": \""+self.adjustProcessVO().memory()+"\",\"metaStorage\": \""+self.adjustProcessVO().storage()
	    		  +"\",\"vdcName\": \""+self.adjustProcessVO().vdcName()+"\",\"busSysName\": \""+self.adjustProcessVO().busSysName()+"\"}}";
	    	  
	    	  var orderItem = {};
	    	  orderItem.instanceName = self.adjustProcessVO().name();
	    	  orderItem.serviceInstanceUuid = self.adjustProcessVO().serviceInstanceUuid();
	    	  orderItem.resourceType = "VM";
	    	  orderItem.metaData = metaData;
	    	  orderItem.resourceUuid = self.adjustProcessVO().uuid();
	    	  orderItem.vdcUuid = self.adjustProcessVO().vdcUuid();
	    	  orderItem.azUuid = self.adjustProcessVO().azUuid();
	    	  
	    	  var orderItems = [];
	    	  orderItems.push(orderItem);
	    	  
	    	  var postBody = {};
	    	  postBody.resourceType = "VM";
	    	  postBody.type = "RESOURCE_CHANGE";
	    	  postBody.orderItems = orderItems;
	    	  postBody.vdcUuid = self.adjustProcessVO().vdcUuid();
	    	  postBody.azUuid = self.adjustProcessVO().azUuid();
	    	  
	    	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
	    		  if(data.code){
	    			systemMsg.alert('资源变更申请成功，订单编号：'+data.code+'！');
	  		 		self.isAdjustProcess(false);
	    		  }
	    	  });
    	  }
      }
      //------------------------------------------资源变更-流程结束--------------------------------
      
    　　//------------------------------------------有效期-流程开始--------------------------------
	  this.isValidateProcess = ko.observable(false);
      
      this.doValidateProcessPost = function(){
    	  self.isValidateProcess(true);
		  self.validateProcessVO().name(self.vmVO().name);
		  self.validateProcessVO().uuid(self.vmVO().uuid);
		  self.validateProcessVO().vdcName(self.vmVO().vdcName);
		  self.validateProcessVO().vdcUuid(self.vmVO().vdcUuid);
		  self.validateProcessVO().azUuid(self.vmVO().azUuid);
		  self.validateProcessVO().busSysName(self.vmVO().busSysName);
		  self.validateProcessVO().serviceInstanceUuid(self.vmVO().serviceInstanceUuid);
		  var myDate = new Date();
		  self.validateProcessVO().time(myDate.toLocaleString());
		  self.validateProcessVO().metaTime(self.vmVO().expiryTime);
		  
		  self.validateProcessVO().validateTime(self.vmVO().expiryTime);
		  self.validateProcessVO().targetValidateTime("");
		  
		  $('#resource_instance_vm_validate_process').val(moment().format('YYYY/MM/DD')).daterangepicker(
		            {
		              format:'YYYY/MM/DD',
		              minDate:moment(),
		              singleDatePicker: true,
		              locale:{
		                applyLabel: '确认',
		                cancelLabel: '取消',
		                weekLabel: '周',
		                daysOfWeek:["日","一","二","三","四","五","六"],
		                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
		              }
		            }
		  ); 
      }
  
      this.validateProcessVO = ko.observable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  metaTime: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  vdcName: ko.observable(),
    	  vdcUuid: ko.observable(),
    	  azUuid: ko.observable(),
    	  busSysName: ko.observable(),
    	  serviceInstanceUuid: ko.observable(),
    	  validateTime: ko.observable(),
    	  targetValidateTime: ko.observable()
      });
      
      //申请
      this.validateProcessPost = function(){
    	  //检查日期相同的，不发送请求直接关闭页面
    	  if(self.validateProcessVO().metaTime() == self.validateProcessVO().targetValidateTime()){
    		  self.isValidateProcess(false);
    		  return;
    	  }
    	  var metaData = "{\"resBaseInfo\":{\"metaExpireTime\":\""+self.validateProcessVO().metaTime() +"\",\"vdcName\": \""+self.validateProcessVO().vdcName()+"\",\"busSysName\":\""+self.validateProcessVO().busSysName()+"\"}}";
    	  
    	  var orderItem = {};
    	  orderItem.instanceName = self.validateProcessVO().name();
    	  orderItem.serviceInstanceUuid = self.validateProcessVO().serviceInstanceUuid();
    	  orderItem.expireTime = self.validateProcessVO().targetValidateTime() + " 23:59:59";
    	  orderItem.resourceType = "VM";
    	  orderItem.resourceUuid = self.validateProcessVO().uuid();
    	  orderItem.metaData = metaData;
    	  orderItem.vdcUuid = self.validateProcessVO().vdcUuid();
    	  orderItem.azUuid = self.validateProcessVO().azUuid();
    	  
    	  var orderItems = [];
    	  orderItems.push(orderItem);
    	  
    	  var postBody = {};
    	  postBody.resourceType = "VM";
    	  postBody.type = "VALIDTIME_CHANGE";
    	  postBody.orderItems = orderItems;
    	  postBody.vdcUuid = self.validateProcessVO().vdcUuid();
    	  postBody.azUuid = self.validateProcessVO().azUuid();
    	  
    	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
    		  if(data.code){
    			systemMsg.alert('有效时间变更申请成功，订单编号：'+data.code+'！');
  		 		self.isValidateProcess(false);
    		  }
    	  });
      }
      //------------------------------------------有效期-流程结束--------------------------------
      
      //------------------------------------------云硬盘扩展-流程开始--------------------------------
      this.isAdjustVolumeProcess = ko.observable(false);
      
      this.doAdjustVolumeProcessPost = function(object){
    	  self.isAdjustVolumeProcess(true);
		  self.adjustVolumeProcessVO().name(object.volumeName);
		  self.adjustVolumeProcessVO().uuid(object.uuid);
		  self.adjustVolumeProcessVO().vmUuid(object.vmUuid);
		  self.adjustVolumeProcessVO().vdcUuid(object.vdcUuid);
		  self.adjustVolumeProcessVO().azUuid(object.azUuid);
		  self.adjustVolumeProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
		  self.adjustVolumeProcessVO().size(object.volumeSize);
		  self.adjustVolumeProcessVO().targetSize('');
      }
  
      this.adjustVolumeProcessVO = ko.observable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  vdcUuid: ko.observable(),
    	  azUuid: ko.observable(),
    	  serviceInstanceUuid: ko.observable(),
    	  vmUuid: ko.observable(),
    	  size: ko.observable(),
    	  targetSize: ko.observable()
      });
      
      //申请 
      this.adjustVolumeProcessPost = function(){
    	  var metaData = "{\"resBaseInfo\":{\"vmUuid\":\"" + self.adjustVolumeProcessVO().vmUuid() + "\",\"volumeSize\":\""+self.adjustVolumeProcessVO().targetSize()
    	 	+ "\",\"metaSize\":\""+self.adjustVolumeProcessVO().size()+"\"}}";
    	  
    	  var orderItem = {};
    	  orderItem.instanceName = self.adjustVolumeProcessVO().name();
    	  orderItem.serviceInstanceUuid = self.adjustVolumeProcessVO().serviceInstanceUuid();
    	  orderItem.resourceType = "DISK";
    	  orderItem.metaData = metaData;
    	  orderItem.resourceUuid = self.adjustVolumeProcessVO().uuid();
    	  orderItem.vdcUuid = self.adjustVolumeProcessVO().vdcUuid();
    	  orderItem.azUuid = self.adjustVolumeProcessVO().azUuid();
    	  
    	  var orderItems = [];
    	  orderItems.push(orderItem);
    	  
    	  var postBody = {};
    	  postBody.resourceType = "DISK";
    	  postBody.type = "RESOURCE_CHANGE";
    	  postBody.orderItems = orderItems;
    	  postBody.vdcUuid = self.adjustVolumeProcessVO().vdcUuid();
    	  postBody.azUuid = self.adjustVolumeProcessVO().azUuid();
    	  
    	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
    		  if(data.code){
    			systemMsg.alert('资源变更申请成功，订单编号：'+data.code+'！');
  		 		self.isAdjustVolumeProcess(false);
    		  }
    	  });
      }
      
      
      
      //------------------------------------------云硬盘扩展-流程结束--------------------------------
    }

    ko.applyBindings(new ViewModel(), $('#page-content')[0]);  

    //--------------------------------------------性能监控 开始-------------------------------------
    //cpu使用率
    	cpu_chart = new Highcharts.Chart({
    		chart: {  
                //将报表对象渲染到层上  
            renderTo: 'cpuUse_chart'  
        },   
        title: {
            text: '',
        },
        credits:{
          enabled: false,
          text : ""
        },  
        colors: [
            '#E35733', // orange
            '#4c97d7', // blue
            '#52d74c', // green
            '#e268de' // purple
        ],               
        xAxis: {
            categories: []
        },
        yAxis: {
            title: {
                text: ''
            },
        },        
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            borderWidth: 0,
            itemMarginTop: 0,
            itemMarginBottom: 0
        },
        series: [{
            name: 'cpu使用率',
            data: []
        }]
    });

    // 内存使用率
    $('#memoryUse_chart').highcharts({
        title: {
            text: '',
        },
        credits:{
          enabled: false,
          text : ""
        },  
        colors: [
            '#E35733', // orange
            '#4c97d7', // blue
            '#52d74c', // green
            '#e268de' // purple
        ],               
        xAxis: {
            categories: ['15:55', '16:00', '16:05', '16:10', '16:15', '16:20','16:25', '16:30']
        },
        yAxis: {
            title: {
                text: ''
            },
        },        
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            borderWidth: 0,
            itemMarginTop: 0,
            itemMarginBottom: 0
        },
        series: [{
            name: '内存使用率',
            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5]
        }]
    });
    // 存储使用率
    $('#storageUse_chart').highcharts({
        title: {
            text: '',
        },
        credits:{
          enabled: false,
          text : ""
        },  
        colors: [
            '#E35733', // orange
            '#4c97d7', // blue
            '#52d74c', // green
            '#e268de' // purple
        ],               
        xAxis: {
            categories: ['15:55', '16:00', '16:05', '16:10', '16:15', '16:20','16:25', '16:30']
        },
        yAxis: {
            title: {
                text: ''
            },
        },        
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            borderWidth: 0,
            itemMarginTop: 0,
            itemMarginBottom: 0
        },
        series: [{
            name: '存储使用率',
            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5]
        }]
    });
    // 存储IO
    $('#storageIO_chart').highcharts({
        title: {
            text: '',
        },
        credits:{
          enabled: false,
          text : ""
        },  
        colors: [
            '#E35733', // orange
            '#4c97d7', // blue
            '#52d74c', // green
            '#e268de' // purple
        ],               
        xAxis: {
            categories: ['15:55', '16:00', '16:05', '16:10', '16:15', '16:20','16:25', '16:30']
        },
        yAxis: {
            title: {
                text: ''
            },
        },        
        tooltip: {
            valueSuffix: 'kB/s'
        },
        legend: {
            borderWidth: 0,
            itemMarginTop: 0,
            itemMarginBottom: 0
        },
        series: [
        {
            name: '写入速率',
            data: [428307, 414470, 452582, 412358, 425369, 42513, 401258, 402356]
        },
        {
            name: '读出速率',
            data: [73400, 65235, 56842, 85123, 45879, 56875, 65854, 45712]
        }        
        ]
    });
	
	
  });
  // 存放指标数据;
  var jsonArray = new Array();
  var meter ;
  // 指标选中事件;

	function cpuCheckboxClick(obj) {
		meter = $(obj).attr('id');
		if ($('#' + meter).prop("checked")) {
			$("#" + meter + "_threshold").removeAttr("disabled");
			$("#" + meter + "_period").removeAttr("disabled");
		} else {
			$("#" + meter + "_threshold").attr("disabled", "disabled");
			$("#" + meter + "_period").attr("disabled", "disabled");
		}
	};

   //弹出窗弹出后执行回调方法，对弹出窗里面的内容进行初始化操作;

	$("#alarmModal").on("shown.bs.modal", function() {
		$.ajax("api/v5.0.0/vms/" + vmUuid + "/configAlarm").done(function(data) {
			$.each(data, function(id, obj) {
				$("input:checkbox[name='checkbox']").each(function() {
					if (obj.meter == $(this).attr('value') && obj.enable == 'true') {
						$(this).attr("checked", "checked");
						// checkbox选中;
						meter = $(this).attr('id');
						// 指标名称;
						$("#" + meter + "_threshold").removeAttr("disabled");
						$("#" + meter + "_period").removeAttr("disabled");
						$("#" + meter + "_threshold").val(obj.threshold);
						$("#" + meter + "_period").val(obj.period);
					};
				});
			});
		});
	});

  // 确定按钮;
  function confirmBtn() {
    jsonArray = [];
    $("input:checkbox[name='checkbox']:checked").each(function() {
      meter = $(this).attr('id');  // 指标;
      var obj = {
        "meter"     : $(this).attr('value'),
        "threshold" : $("#" + meter + "_threshold").val(),
        "period"    : $("#" + meter + "_period").val(),
        "enable"    : true
      };
      jsonArray.push(obj);
    });
    if (jsonArray.length != 0) {// 异步提交信息;
      $.ajax({
        type: 'PUT',
        url: "api/v5.0.0/vms/" + vmUuid + "/configAlarm",
        data: JSON.stringify(jsonArray),
        dataType: 'json',
        success: function (data) {
          systemMsg.alert("配置成功!");
          var modal = $("#systemMessageAlertModal");
          modal.on("hidden.bs.modal", function () {
            modal.remove();
            $("#alarmModal").modal('hide');
          });
        },
        error: function () {
          systemMsg.alert("配置时发生内部错误");
        }
      });
    }else{
      // 数组为空，提示重新选择;
      systemMsg.alert("请配置告警信息");
    }
  }

	// change事件;
	$("#minute_select").change(function() {
		var before = $("#minute_select option:selected").val();
		getMonitorData(before);
	});

	// 监控面板打开事件;
	$("#vm_monitor_tab").on("click", function() {
		// 获取select 选中内容;
		var before = $("#minute_select option:selected").val();
		getMonitorData(before);
	});

	// 查询监控指标数据;
	function getMonitorData(time) {
		var period = "60";
		// 周期不长, 可调整默认为60s;
		// 获取当前时间之前xx分钟;
		var nowDate = new Date();
		nowDate.setMinutes(nowDate.getMinutes() - time);
		$.get("api/v5.0.0/vms/" + vmUuid + "/performance?startTime=" + nowDate.getTime() + "&step=" + period).done(function(data) {
			if(data!=null && data!=""){
				$.each(data,function(id,element){
					if(element.name.indexOf("CPU")!=-1){
						cpu_chart.series[0].setData(element.ydataList);    
						cpu_chart.xAxis[0].setCategories(element.xdataList);
					};
				});
			}
			//若无数据，什么都不显示
			/* else{
				systemMsg.alert("监控信息查询为空!");
			} */
		});
	};
	 //--------------------------------------------性能监控 结束-------------------------------------
</script>