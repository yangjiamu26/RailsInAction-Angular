<div>
<!-- 负载均衡器列表 -->
<div data-bind="visible: !isShowDetail()">
  <!-- 负载均衡器搜索栏 -->
  <div class="row wrapper">
    <div class="col-xs-1">
      <button class="btn btn-sm btn-info" data-bind="click:showCreatePageFun, check_action:'lb_Creat'">创建</button>     
    </div>
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">所属VDC</span>
        <select class="form-control input-sm" data-bind="optionsCaption: '全部', value: searchParam().vdcUuid, options: searchVdcList, optionsText: 'name', optionsValue: 'uuid'">
          <option>VDC1</option>
        </select>
      </div>     
    </div>   
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">所属可用分区</span>
        <select class="form-control input-sm" data-bind="value: searchParam().azUuid, optionsCaption: '全部', options: searchAzList, optionsText: 'name', optionsValue: 'uuid'">
          <option>可用分区1</option>
        </select>
      </div>     
    </div>            
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">名称</span>
        <input type="text" class="input-sm form-control" placeholder="请输入名称" data-bind="value: searchParam().name, enterKey: searchLb">
      </div>
    </div>
    <div class="col-xs-2">
      <button class="btn btn-sm" type="button" data-bind="click:reset">重置</button>
      <button class="btn btn-sm btn-default" type="button" data-bind="click: searchLb">搜索</button>
    </div>
  </div> 
  <!-- 负载均衡器列表 -->                       
  <div id='instance_balancers'>
    <div class='table-responsive' data-bind="with: loadBalancerTable">
      <table class='table table-striped'>
        <thead>
          <tr>
            <th>负载均衡器名称</th>
            <th>所属VDC</th>
            <th>可用分区</th>
            <th>所属VPC</th>
            <th>网络</th>
            <th>协议</th>
            <th>负载方式</th>
            <th>状态</th>
            <th>VIP</th>
            <th>VIP地址</th>
            <th>公网IP</th>
            <th>服务状态</th>
            <th>有效期</th>
            <th>创建人</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr data-bind="visible: showNoData">
            <td colspan=15 class="aligncenter">
             	 暂无数据
            </td>
          </tr>
          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
          <tr>
            <td><a data-bind="click: $root.showDetailFun"><span data-bind="text: $row.name_, attr:{'title': $row.name}"></span></a></td><!-- 负载均衡器名称 -->
            <td data-bind="text: $row.vdcName">VDC1</td> <!-- 所属VDC -->
            <td data-bind="text: $row.azName">AZ1</td>  <!-- 可用分区 -->
            <td data-bind="text: $row.vpcName">VPC1</td><!-- 所属VPC -->
            <td data-bind="text: $row.cidr">192.168.208.0/24</td><!-- 网络 -->
            <td data-bind="text: $row.protocol">TCP</td><!-- 协议 -->
            <td data-bind="text: $row.lbMethod_">ROUNB_ROBIN</td><!-- 负载方式 -->
            <td>
            	<span class="label label-success" data-bind="if: $row.state == 'ACTIVE'">运行中</span>
	            <span class="label label-danger" data-bind="if: $row.state == 'ERROR'">异常</span>
	            <span class="label label-warning" data-bind="if: $row.state == 'PENDING_CREATE'">正在创建</span>
	            <span class="label label-warning" data-bind="if: $row.state == 'PENDING_UPDATE'">正在修改</span>
            </td><!-- 状态 -->
            
            <td data-bind="text: $row.vipName_, attr:{'title': $row.vipName}">VIP1</td><!-- VIP名称 -->
            <td data-bind="text: $row.vipAddress">1</td><!-- VIP地址 -->
            <td data-bind="text: $row.publicIp">1</td><!-- 公网IP地址 -->
            <td>
            	<span class="label label-success" data-bind="if: $row.isValidate == true">正常</span>
	            <span class="label label-danger" data-bind="if: $row.isValidate == false">已过期</span>
            </td><!-- 服务状态 -->
            <td data-bind="text: $row.expiryDate">20160605</td><!-- 有效期 -->
            <td data-bind="text: $row.account">admin</td><!-- 创建人 -->
            <td>
            	<span data-bind="check_action:'lb_Creat'"><a href="#" data-bind="click: $root.showChangeValiTimePage">有效时间变更</a> |</span>
            	<div class="btn-group">
                    <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">更多<span class="fa fa-caret-down"></span></a>
                    <ul style="right:0;min-width:50px;left:auto;" class="dropdown-menu">
                        <li data-bind="if: csc.util.isNull($row.vipUuid)&&isValidate == true, check_action:'lb_VIP_Add'"><a data-bind="click: $root.showAddVip">添加VIP</a></li>
                      	<li data-bind="if: csc.util.isNotNull($row.vipUuid)&&isValidate == true, check_action:'lb_VIP_Edit'"><a data-bind="click:$root.showEditVip">编辑VIP</a></li>
                      	<li data-bind="if: csc.util.isNotNull($row.vipUuid), check_action:'lb_TimeModify'"><a data-bind="click:$root.delVip">删除VIP</a></li>
                      	<li data-bind="if: isValidate == true, check_action:'lb_Stop'"><a data-bind="click: $root.terminateService">终止</a></li>
                      	<li data-bind="if: isValidate == false, check_action:'lb_Delete'"><a data-bind="click: $root.delLoadBalancer">删除</a></li>
                    </ul>
                </div> 
            </td>
          </tr>
          <!-- /ko -->
        </tbody>
      </table>
    </div>
     <!-- 负载均衡器分页 -->
    <footer class="panel-footer" data-bind="with: loadBalancerTable, visible: loadBalancerTable.pages() > 1">
      <ul class="pagination">
        <li data-bind="css: leftPagerClass, click: gotoPage(1)">
          <a href="#">首页</a>
        </li>
        <li data-bind="css: leftPagerClass, click: prevPage">
          <a href="#">&laquo;</a>
        </li>
        <li >
          <a href="#"  data-bind="text: currentPage"></a>
        </li>
        <li data-bind="css: rightPagerClass, click: nextPage">
          <a href="#">&raquo;</a>
        </li>
        <li data-bind="css: rightPagerClass, click: gotoPage(pages())">
          <a href="#">末页</a>
        </li>
        <li class="page-control-li">
          <div class="input-group form-group-sm">
            <input type="text" class="form-control" data-bind="value: targetPage"  />
            <div class="input-group-btn">
              <a href="#" class="btn btn-sm btn-default" data-bind="click: gotoTargetPage()">跳转</a>
            </div>
          </div>
          <div class="page-info-div" data-bind="text: recordsText"></div>
        </li>
      </ul>
    </footer>
  </div>
</div>
<!-- 创建负载均衡器页面 -->
  <div role="dialog" aria-hidden="true"  id="modal_addLoadBalancer" class="modal fade" data-bind="modal:{show:showCreatePage}">
    <div class='modal-dialog modal-lg' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
          </button>
          <h3 class='modal-title'>创建负载均衡器</h3>
        </div>
        <div class='modal-body form-horizontal' data-bind="with: createBlVo">
          <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-4 control-label">负载均衡器名称</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" maxlength="32" placeholder="负载均衡器名称" data-bind="value: name">
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">所属VDC</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.vdcList,optionsText:'name', optionsValue:'uuid',value: vdcUuid">
                  	<option>可用分区1</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">可用分区</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.azList,optionsText:'name',optionsValue:'uuid',value: azUuid, disable: vdcUuid==null">
                    <option>可用分区1</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">VPC</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.vpcList,optionsText:'name',optionsValue:'uuid',value: vpcUuid, disable: csc.util.isNull(azUuid)">
                    <option>208</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">网络</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.vpcNetworkList,optionsText:'name',optionsValue:'uuid',value: vpcNetworkUuid, disable: vpcUuid==null">
                    <option>192.168.0.0/24</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">协议</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.protocolList, value: protocol">
                    <option>TCP</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">负载均衡方式</label>
                <div class="col-sm-8">
                  <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.lbMethodList, optionsText: 'value', optionsValue: 'key', value: lbMethod">
                    <option>RoUND_ROBIN</option>
                  </select>
                </div>
                <div class="col-sm-1">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="form-group">
                <label class="col-sm-3 control-label">备注</label>
                <div class="col-sm-8">
                  <textarea maxlength="255" class="form-control" data-bind="text: remark"></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
   			<div class="form-group">
               <label class="col-xs-1 control-label no-padder-h">申请时长</label>
               <div class="col-xs-10">
                 <label class="radio-inline" style="padding-top: 2px">
                   <input type="radio" name="lbExpiredRadioOptions" id="inlineRadio1" value="option1" checked="checked" data-bind="checked: $root.applyTime,click:$root.RadioClick"> 永久
                 </label>
                 <label class="radio-inline">
                   <input type="radio" name="lbExpiredRadioOptions" id="inlineRadio2" value="option2" style="margin-top:10px" data-bind="checked: $root.applyTime,click:$root.RadioClick"> 
                   <input type="text" class="form-control inline w-xxs" id="resource_load_balancer_time_value" data-bind="value: yearMonth">
                   <select class="form-control inline w-xs" id="resource_load_balancer_time_unit">
                     <option value="MONTH">月</option>
                     <option value="YEAR">年</option>
                   </select>  
                 </label>
                 <label class="radio-inline">
                   <input type="radio" name="lbExpiredRadioOptions" id="inlineRadio3" value="option3" style="margin-top:10px" data-bind="checked: $root.applyTime,click:$root.RadioClick"> 有效期至
                   <input type="text" value="" class="form-control inline w" id="resource_load_balancer_datePicker" data-bind="value:toDate">
                 </label>                                    
               </div>
              <!--  <div class="col-xs-1">
                 <span class="text-danger inline m-l-n m-t-sm">*</span>
               </div> -->
             </div>
          </div>
        </div>
        <div class='modal-footer'>
          <button name="button" class="btn btn-primary " data-bind="attr: {disabled: $root.disableCreateLbBtn()}, click: createLoadBalancer">确定</button>
          <button name="button" class="btn btn-default " data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>
<!-- 创建负载均衡器页面 END -->

<!-- 添加和修改VIP页面 -->
  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal:{show:isShowAddVip}">
    <div class='modal-dialog' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal">
            <span aria-hidden="true">&times;</span>
          </button>
          <h3 class='modal-title' data-bind="visible: !isVipEditFlag()">添加VIP</h3>
          <h3 class='modal-title' data-bind="visible: isVipEditFlag()">编辑VIP</h3>
        </div>
        <div class='modal-body form-horizontal' data-bind="with: createVipVo">
          <div class="form-group">
            <label class="col-xs-3 control-label">VIP名称</label>
            <div class="col-xs-8">
              <input type="text" class="form-control" maxlength="32" data-bind="value: name">
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">网络</label>
            <div class="col-xs-8">
            	<input type="text" class="form-control" data-bind="value: cidr" disabled>
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">指定IP</label>
            <div class="col-xs-8">
            	<span data-bind="if: $root.isVipEditFlag()">
            		<input type="text" class="form-control" data-bind="value: address" disabled>
            	</span>
                <span data-bind="if: !$root.isVipEditFlag()">
	                <select class="form-control" data-bind="optionsCaption: '请选择',options:$root.availIpList, optionsText: 'ip', optionsValue: 'ip', value:address">
	                	<option>192.168.0.7</option>
	                </select>
                </span>
              
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">协议</label>
            <div class="col-xs-8">
              <input type="text" class="form-control" data-bind="value: protocol" disabled>
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">协议端口</label>
            <div class="col-xs-8">
              <input type="text" class="form-control" data-bind="value: protocolPort, enable: !$root.isVipEditFlag()">
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">会话持久性</label>
            <div class="col-xs-8">
              <select class="form-control" data-bind="optionsCaption: '请选择', options:$root.spTypeList, value: sessionPersistenceType">
                <option>SOURCE_IP</option>
              </select>
            </div>
          </div>
          <div class="form-group" data-bind="visible: sessionPersistenceType()=='APP_COOKIE'">
            <label class="col-xs-3 control-label">Cookie名称</label>
            <div class="col-xs-8">
              <input type="text" class="form-control"  maxlength="32" data-bind="value: cookieName">
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">连接限制</label>
            <div class="col-xs-8">
              <input type="text" class="form-control"  data-bind="value: connectionLimit">
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">备注</label>
            <div class="col-xs-8">
              <textarea class="form-control" maxlength="255" data-bind="value: desc"></textarea>
            </div>
            <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm"></span>
            </div>
          </div>
        </div>
        <div class='modal-footer'>
          <button name="button" class="btn btn-primary " data-bind="attr: {disabled: $root.disableUpdateVipBtn()},click: $root.updateVip">确定</button>
          <button name="button" class="btn btn-default " data-dismiss="modal">取消</button>
        </div>
      </div>
    </div>
  </div>
<!-- 添加VIP页面 END -->

<!-- 修改有效时间 -->
<div role="dialog" aria-hidden="true" id="modal_balancer_valiTime" class="modal fade" data-bind="modal: { show: isValidateTime}">
   <div class='modal-dialog modal-md'>
     <div class='modal-content'>
       <div class='modal-header'>
         <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
       </div>
       <div class='modal-body form-horizontal row'>
         <div class="form-group">
           <label class="col-sm-3 control-label">有效期</label>
           <div class="col-sm-8">
             <input type="text" value="" class="form-control inline w" id="resource_loadBalancer_validate_edit" data-bind="value: validateTimeVO().time">
           </div>
         </div>
       </div>
       <div class='modal-footer' style="text-align:center;">
         <a class="btn btn-default btn-info" data-bind="click: changeExpiredTime">确定</a>
         <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
       </div>
     </div>
   </div>
 </div>

  <!-- 负载均衡器详情 -->
  <div id="instance_balancer_details" data-bind="visible: isShowDetail()">
		<!-- 负载均衡器基本信息 -->
        <div class="wrapper" data-bind="with: $root.currentLbVo">
          <a class="btn btn-sm btn-default" data-bind="click: $root.showDetailFun"><i class="fa fa-arrow-left"></i> 返回</a>
          <a class="btn btn-sm btn-info" data-bind="visible: csc.util.isNotNull(vipUuid)&&isValidate==true, click:$root.showEditVip">编辑VIP</a>
          <a class="btn btn-sm btn-info" data-bind="visible: csc.util.isNotNull(vipUuid)&&isValidate==false, click:$root.delVip">删除VIP</a>
          <a class="btn btn-sm btn-info" data-bind="click: $root.showChangeValiTimeInDetail">有效时间变更</a>
          <span data-bind="if: isValidate == true">
          	<a class="btn btn-sm btn-info" data-bind="click: $root.terminateService">终止</a>
          </span>
          <span data-bind="if: isValidate == false">
          	<a class="btn btn-sm btn-info" data-bind="click: $root.delLoadBalancerInDetail">删除</a>
          </span>
        </div>

        <div class="wrapper">
          <h5 class="text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>基本信息</h5>
          <div class="bg-light b-t b-b wrapper-sm text-nowarp" data-bind="with: $root.currentLbVo">
            <div class="row m-b">
              <div class="col-xs-1 font-bold">负载均衡器名称：</div>
              <div class="col-xs-3" data-bind="text: name_, attr:{'title': name}">负载均衡器</div>
              <div class="col-xs-1 font-bold">所属VDC：</div>
              <div class="col-xs-3" data-bind="text: vdcName">VDC1</div>
              <div class="col-xs-1 font-bold">可用分区：</div>
              <div class="col-xs-3" data-bind="text: azName">可用分区1</div>
            </div>
            <div class="row m-b">
              <div class="col-xs-1 font-bold">所属VPC：</div>
              <div class="col-xs-3" data-bind="text: vpcName">VPC1</div>
              <div class="col-xs-1 font-bold">网络名称：</div>
              <div class="col-xs-3" data-bind="text: networkName">208</div>
              <div class="col-xs-1 font-bold">网段：</div>
              <div class="col-xs-3" data-bind="text: cidr">208</div>
            </div>
            <div class="row m-b">
              <div class="col-xs-1 font-bold">协议：</div>
              <div class="col-xs-3" data-bind="text: protocol">TCP</div>
              <div class="col-xs-1 font-bold">负载方式：</div>
              <div class="col-xs-3" data-bind="text: lbMethod_">SOURCE_IP</div>
              <div class="col-xs-1 font-bold">公网IP：</div>
              <div class="col-xs-3" data-bind="text: publicIp">192.168.212.5</div>
            </div>
            <div class="row m-b">
              <div class="col-xs-1 font-bold">状态：</div>
              <div class="col-xs-3">
              	<span class="label label-success" data-bind="if: state == 'ACTIVE'">运行中</span>
	            <span class="label label-danger" data-bind="if: state == 'ERROR'">异常</span>
	            <span class="label label-warning" data-bind="if: state == 'PENDING_CREATE'">正在创建</span>
	            <span class="label label-warning" data-bind="if: state == 'PENDING_UPDATE'">正在修改</span>
              </div>
              <div class="col-xs-1 font-bold">创建人：</div>
              <div class="col-xs-3" data-bind="text: account">admin</div>
            </div>
            <div class="row m-b">
              <div class="col-xs-1 font-bold">备注：</div>
              <div class="col-xs-11" data-bind="text: remark"></div>
            </div>
          </div>
        </div>
        
        <div class="row wrapper detail-others">
          <div class="col-xs-3">
            <div class="clear bg-success wrapper">
              <div class="detail-others-img img-serverinfo">服务信息</div>
              <div class="detail-others-text h-xs" data-bind="with: $root.currentLbVo">
                <p>服务状态：
                    <span class="label" data-bind="if: isValidate == true">正常</span>
	            	<span class="label" data-bind="if: isValidate == false">已过期</span>
                </p>
                <p>创建时间：<span data-bind="text: createTime">2016-08-04 14:28:50</span></p>
                <p>生效时间：<span data-bind="text: createTime">2016-08-04 14:28:54</span></p>
                <p>失效时间：<span data-bind="text: expiryDate">2016-08-04 14:28:54</span></p>
              </div> 
            </div>             
          </div>
          <div class="col-xs-9" data-bind="visible: isShowVipInfo()">
            <div class="clear bg-primary wrapper" data-bind="with: $root.currentVipVo">
              <div class="detail-others-img img-settings">VIP信息</div>
              <div class="detail-others-text h-xs" style="width:85%">
                <div class="row">
                  <div class="col-xs-4">
                    <p>VIP名称：<span data-bind="text: name_, attr:{'title': name}"></span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>网络：<span data-bind="text: networkName">208</span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>IP地址：<span data-bind="text: address"></span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>协议：<span data-bind="text: protocol"></span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>协议端口：<span data-bind="text: protocolPort"></span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>连接限制：<span data-bind="text: connectionLimit"></span></p>
                  </div>
                  <div class="col-xs-4">
                    <p>会话持久性：<span data-bind="text: sessionPersistenceType">是</span></p>
                  </div>
                  <div class="col-xs-4" data-bind="visible: sessionPersistenceType=='APP_COOKIE'">
                    <p>Cookie名称：<span data-bind="text: cookieName_, attr:{'title': cookieName}">是</span></p>
                  </div>
                  <div class="col-xs-12">
                    <p>备注：<span data-bind="text: desc">XXXX</span></p>
                  </div>
                </div>
              </div>                
            </div>
          </div>
        </div>
        <!-- 负载均衡器基本信息  END -->
        
        <!-- 负载均衡器成员列表 -->  
        <div class="wrapper">
          <h5 class="text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>成员列表</h5>
          <p class="clearfix">
          	<span data-bind="if: $root.isLbValidate()">
          		<a class="btn btn-sm btn-info" data-bind="click: showAddMember">添加成员</a>
          	</span>
          	<span>
          		<a class="text-info pull-right m-t-sm" data-bind="click: refreshMemberList">刷新</a>
          	</span>
          </p>
          <div class='table-responsive no-height'>
            <table class="table table-striped" data-bind="with: lbMemberTable">
              <thead>
                <tr>
                  <th>云主机名称</th>
                  <th>IP地址</th>
                  <th>状态</th>
                  <th>协议端口</th>
                  <th>权重</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr data-bind="visible: showNoData">
	              <td colspan=13 class="aligncenter">
	             	 暂无数据
	              </td>
	            </tr>
	            <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                <tr>
                  <td data-bind="text: $row.vmName">VM1</td>
                  <td data-bind="text: $row.address">192.169.22.56</td>
                  <td>
	                  <span class="label label-success" data-bind="if: $row.state == 'ACTIVE'">运行中</span>
		              <span class="label label-danger" data-bind="if: $row.state == 'ERROR'">异常</span>
		              <span class="label label-warning" data-bind="if: $row.state == 'PENDING_CREATE'">正在创建</span>
		              <span class="label label-warning" data-bind="if: $row.state == 'PENDING_UPDATE'">正在修改</span>
                  </td>
                  <td data-bind="text: $row.protocolPort">8080</td>
                  <td data-bind="text: $row.weight">20</td>
                  <td>
	                  <span data-bind="if: $root.isLbValidate()">
	                  	  <a data-bind="click: $root.showEditMember">修改</a> |
	                  </span>
                  	 <a data-bind="click: $root.deleteLbMember">删除</a></td>
                </tr>
                <!-- /ko -->
              </tbody>
            </table>
          </div>
        </div>
		<!-- 负载均衡器成员列表  END-->  
		
		<!-- 负载均衡器监控列表 -->  
        <div class="wrapper">
          <h5 class="text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>监控列表</h5>
          <p class="clearfix">
          	<span data-bind="if: $root.isLbValidate()">
          		<a class="btn btn-sm btn-info" data-bind="click: showAddMonitor">添加监控</a>
          	</span>
          	<span>
          		<a class="text-info pull-right m-t-sm" data-bind="click: refreshMonitorList">刷新</a>
          	</span>
          </p>
          <div class='table-responsive no-height'>
            <table class="table table-striped" data-bind="with: lbMonitorTable">
              <thead>
                <tr>
                  <th>监控类型</th>
                  <th>延迟</th>
                  <th>超时</th>
                  <th>最大重试次数</th>
                  <th>详情</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
              	<tr data-bind="visible: showNoData">
	              <td colspan=13 class="aligncenter">
	             	 暂无数据
	              </td>
	            </tr>
	            <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                <tr>
                  <td data-bind="text: $row.type">TCP</td><!-- 监控类型 -->
                  <td data-bind="text: $row.delay">7</td><!-- 延迟 -->
                  <td data-bind="text: $row.timeout">10</td><!-- 超时 -->
                  <td data-bind="text: $row.maxRetries">5</td><!-- 最大重试次数 -->
                  <td data-bind="text: $row.detail">GET/192.168.1.1:8090=>200</td><!-- 详情 -->
                  <td>
                  		<span data-bind="if: $root.isLbValidate()">
                  			<a data-bind="click: $root.showEditMonitor">修改</a> | 
                  		</span>
                  		<a data-bind="click: $root.delMonitor">删除</a>
                  </td>
                </tr>
                 <!-- /ko -->
              </tbody>
            </table>
          </div>
        </div>
		<!-- 负载均衡器成员列表 -->  
  </div> 
  <!-- 负载均衡器详情 END -->

    <!-- 添加和修改成员页面 -->
    <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isShowAddMember }">
      <div class='modal-dialog' role='document'>
        <div class='modal-content'>
          <div class='modal-header'>
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
            <h3 class='modal-title' data-bind="visible: !isEditMemberFlag()">添加成员</h3>
            <h3 class='modal-title' data-bind="visible: isEditMemberFlag()">修改成员</h3>
          </div>
          <div class='modal-body form-horizontal' data-bind="with: createMemberVo">
        	<div class="tab-pane active">
          	  <div class="form-group">
                <label class="col-xs-4 control-label">负载均衡器名称</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" value="负载均衡器1" data-bind="value: lbName" disabled/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">云主机</label>
                <div class="col-xs-5" data-bind="visible:!$root.isEditMemberFlag()">
                  <select class="form-control" data-bind="optionsCaption: '请选择', options: $root.memberVmList, optionsText:'vmName',value: vm">
                    <option value="">VM1</option>
                  </select>
                </div>
                <div class="col-xs-5" data-bind="visible:$root.isEditMemberFlag()">
                  <input class="form-control" type="text" data-bind="value: vmName, enable:!$root.isEditMemberFlag()"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">协议端口</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: protocolPort, enable:!$root.isEditMemberFlag()"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">权重</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: weight"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
            </div>  
          </div>

          <div class='modal-footer'>
            <input type="button" name="commit" value="确定" class="btn btn-default btn-info" data-bind="attr: {disabled: $root.disableUpdateMemberBtn()}, click: $root.updateMember"/>
            <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
          </div>
        </div>
      </div>
    </div>
    <!-- 添加成员 END -->

    <!-- 添加和修改监控页面 -->
    <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isShowAddMonitor}">
      <div class='modal-dialog' role='document'>
        <div class='modal-content'>
          <div class='modal-header'>
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
            <h3 class='modal-title' data-bind="visible: !isEditMonitorFlag()">添加监控</h3>
            <h3 class='modal-title' data-bind="visible: isEditMonitorFlag()">修改监控</h3>
          </div>
          <div class='modal-body form-horizontal' data-bind="with: createMonitorVo">
            <div class="tab-pane active">
              <div class="form-group">
                <label class="col-xs-4 control-label">监控类型</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: type" disabled/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">延迟</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: delay"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">超时</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: timeout"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group">
                <label class="col-xs-4 control-label">最大重试次数</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: maxRetries"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                  <span>(1~10)</span>
                </div>          
              </div>
              <div class="form-group" data-bind="visible: !$root.isTcpHide()">
                <label class="col-xs-4 control-label">http方式</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: httpMethod" disabled/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group" data-bind="visible: !$root.isTcpHide()">
                <label class="col-xs-4 control-label">URL</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: urlPath"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
              <div class="form-group" data-bind="visible: !$root.isTcpHide()">
                <label class="col-xs-4 control-label">期待http状态代码</label>
                <div class="col-xs-5">
                  <input class="form-control" type="text" data-bind="value: expectedCodes"/>
                </div>
                <div class="col-xs-3">
                  <span class="text-danger inline m-l-n m-t-sm">*</span>
                </div>          
              </div>
            </div>  
          </div>

          <div class='modal-footer'>
            <input type="button" name="commit" value="确定" class="btn btn-default btn-info" data-bind="attr: {disabled: $root.disableUpdateMonitorBtn()}, click: $root.updateMonitor"/>
            <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
          </div>
        </div>
      </div>
    </div>
    <!-- 添加或修改监听器END -->

  </div>
  <!-- 负载均衡器详情 end -->
  
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isDeleteProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源删除</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
		    <!-- <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>资源删除</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: deleteProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: deleteProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: deleteProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：负载均衡器</p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: deleteProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isValidateProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content' style="width:700px;">
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
		    <!-- <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>有效时间变更</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: validateProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: validateProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: validateProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：负载均衡器</p></div>
		          </div>
		          <div class="row">
		            <div class="col-xs-6"><p>调整前失效时间：<input type="text" value="" class="form-control inline w" data-bind="value: validateProcessVO().validateTime" disabled="disabled"></p></div>
		            <div class="col-xs-6"><p>调整后失效时间：<input type="text" value="" class="form-control inline w" id="resource_instance_balancer_validate_process" data-bind="value: validateProcessVO().targetValidateTime"></p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: validateProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>
<script type="text/javascript">
  var scripts = ["api/resource/az/az.js", 
                 "api/vdc/vdc.js", 
                 "api/vpc/vpc.js", 
                 "api/resource/network/port.js",
                 "api/resourceInstance/instance.js",
                 "api/resourceInstance/loadBalancer/loadBalancer.js", 
                 "assets/lib/moment/moment.js",
                 "assets/lib/bootstrap-daterangepicker/daterangepicker.js"]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    function ViewModel_Balancer(){
    	var self = this;
    	
    	/**********************  搜索栏   **********************/
    	//搜索栏
        this.searchVdcList = ko.observableArray();
        this.searchAzList = ko.observableArray();
        
        this.searchParam = ko.observable({
       	  	vdcUuid: ko.observable(""),
            azUuid: ko.observable(""),
            name: ko.observable("")
        });
        
        var subSearchVdc;//subscription.dispose();
        this.init = function(){
	      	  self.searchVdcList([]);
	      	  $.VDC.getVDCs({},function(data){
	      			if(data && data.results){
	      				self.searchVdcList(data.results);
	      			}
	      	  });
	      	  
	      	  self.searchAzList([]);
	      	  var azParams = {
	    	  	  cloudPlatform:"OpenStack"
	    	  };
	      	  $.AZ.getAzs(azParams, function(data){
	   			if(data && data.results){
	   				self.searchAzList(data.results);
	   			}
	   		  });
	      	  
	      	subSearchVdc = self.searchParam().vdcUuid.subscribe(function(val){
			    self.searchAzList([]);
			    if(csc.util.isNotNull(val)){
			    	$.VDC.getVdcAzs(val,azParams,function(data){
		   				 if(data && data.results){
		   					 self.searchAzList(data.results);
		   				 }
		   			});
			    }else{
			    	$.AZ.getAzs(azParams,function(data){
		   				 if(data && data.results){
		   					 self.searchAzList(data.results);
		   				 }
		   			});
			    }
    	    	
    	    });
      	  
        }();
        
      //重置
        this.reset = function(){
            this.searchParam({
            	vdcUuid: '',
            	azUuid: '',
            	name: ''
            });
            this.loadBalancerTable.params({})
        }
      	
        this.searchLb = function(){
        	var p = {
        		 "vdcUuid": self.searchParam().vdcUuid(),
        		 "azUuid": self.searchParam().azUuid(),
        		 "name": self.searchParam().name()
        	};
        	self.loadBalancerTable.params(p);
        }
        
        /**********************  搜索栏 END   **********************/
    	
    	/**********************  负载均衡器列表   **********************/
    	
        this.loadBalancerTable = new DataTable({
      		  perPage: 10,
                path: 'api/v5.0.0/loadBalancers',
                loader: function(result){
              	    result.name_ = csc.util.trimName(result.name, 16);
            	    result.vipName_ = csc.util.trimName(result.vipName, 16);
                    result.lbMethod_ = $.LOAD_BALANCER.lbMethodView[result.lbMethod];
                    result.expiryDate = result.expiryDate && result.expiryDate.length >10?result.expiryDate.substring(0, 10):result.expiryDate;
                    return result;
                }
        });
    	
    	
    	/********  负载均衡器列表  END *********/
    	
    	
    	/********  创建负载均衡器   *********/
      //处理选中年月时输入框的验证问题
        this.applyTime = ko.observable("option1");
        this.RadioClick = function(){
      	  if (self.applyTime() == "option2") {
      		  self.changeYearMonthValidateYesOrNot(true);
            }else{
          	  self.changeYearMonthValidateYesOrNot(false);
            }
        }
        this.changeYearMonthValidateYesOrNot = function(t){
      	  if(t){
      		  self.createBlVo({
      			  name: 		ko.observable(self.createBlVo().name()).extend({required: true, cscNameRule:true, maxLength:32}),
        		  vdcUuid: 	ko.observable(self.createBlVo().vdcUuid()).extend({required: true}),
        		  azUuid:		ko.observable(self.createBlVo().azUuid()).extend({required: true}),
        		  vpcUuid: 	ko.observable(self.createBlVo().vpcUuid()).extend({required: true}),
        		  vpcNetworkUuid: ko.observable(self.createBlVo().vpcNetworkUuid()).extend({required: true}),
        		  protocol: 	ko.observable(self.createBlVo().protocol()).extend({required: true}),
        		  lbMethod: 	ko.observable(self.createBlVo().lbMethod()).extend({required: true}),
        		  remark: 	ko.observable(self.createBlVo().remark()).extend({maxLength:255}),
        		  yearMonth:	ko.observable(self.createBlVo().yearMonth()).extend({required: true,positiveIntegerRule:true}),
    	    	  toDate: 	self.createBlVo().toDate
              });
      	  }else{
      		  self.createBlVo({
      			  name: 	ko.observable(self.createBlVo().name()).extend({required: true, cscNameRule:true, maxLength:32}),
           		  vdcUuid: 	ko.observable(self.createBlVo().vdcUuid()).extend({required: true}),
           		  azUuid:	ko.observable(self.createBlVo().azUuid()).extend({required: true}),
           		  vpcUuid: 	ko.observable(self.createBlVo().vpcUuid()).extend({required: true}),
           		  vpcNetworkUuid: ko.observable(self.createBlVo().vpcNetworkUuid()).extend({required: true}),
           		  protocol: ko.observable(self.createBlVo().protocol()).extend({required: true}),
           		  lbMethod: ko.observable(self.createBlVo().lbMethod()).extend({required: true}),
           		  remark: 	ko.observable(self.createBlVo().remark()).extend({maxLength:255}),
           		  yearMonth:ko.observable(self.createBlVo().yearMonth()).extend({required: false}),
       	    	  toDate: 	self.createBlVo().toDate
              });
      	  }
      	  //重新初始化日期控制，如果不设置清空，具体不明
    	  $('#resource_load_balancer_datePicker').val(self.createBlVo().toDate).daterangepicker({
              format:'YYYY-MM-DD',
              minDate:moment(),
              singleDatePicker: true,
              locale:{
                  applyLabel: '确认',
                  cancelLabel: '取消',
                  weekLabel: '周',
                  daysOfWeek:["日","一","二","三","四","五","六"],
                  monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              }
 	       });
        }
      	  
    	$("#modal_addLoadBalancer").on("shown.bs.modal",function(){
	          // daterange             
	          $('#resource_load_balancer_datePicker').val(moment().format('YYYY-MM-DD')).daterangepicker({
	        	  format:'YYYY-MM-DD',
	              minDate:moment(),
	              singleDatePicker: true,
	              locale:{
	                applyLabel: '确认',
	                cancelLabel: '取消',
	                weekLabel: '周',
	                daysOfWeek:["日","一","二","三","四","五","六"],
	                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
	              }
	          }); 
        });
    	
    	
      	this.showCreatePage = ko.observable(false);
    	//创建的负载均衡器对象
    	this.createBlVo = ko.validatedObservable({
    		name: 		ko.observable("").extend({required: true, cscNameRule:true, maxLength:32}),
    		vdcUuid: 	ko.observable("").extend({required: true}),
    		azUuid:		ko.observable("").extend({required: true}),
    		vpcUuid: 	ko.observable("").extend({required: true}),
    		vpcNetworkUuid: ko.observable("").extend({required: true}),
    		protocol: 	ko.observable("").extend({required: true}),
    		lbMethod: 	ko.observable("").extend({required: true}),
    		remark: 	ko.observable("").extend({maxLength:255}),
    		yearMonth:	ko.observable("").extend({required: false}),
	    	toDate: 	""
    	});
    	
    	this.vdcList = ko.observableArray();
        this.azList = ko.observableArray();
        this.vpcList = ko.observableArray();
        this.vpcNetworkList = ko.observableArray();
        this.protocolList = ko.observableArray();
        this.lbMethodList = ko.observableArray();
      	
        this.disableCreateLbBtn = ko.observable(false);
        
      	this.showCreatePageFun = function(){
        	self.showCreatePage(true);
        	self.disableCreateLbBtn(false);
        	//置空所有选项
        	self.createBlVo.fromJSON({
        		name: 		"",
        		vdcUuid:	"",
        		azUuid:		"",
        		vpcUuid: 	"",
        		vpcNetworkUuid:	"",
        		protocol: 	"",
        		lbMethod: 	"",
        		remark: 	"",
        		yearMonth:	"",
        		toDate: 	""
        	});
        	
        	self.lbMethodList($.LOAD_BALANCER.lbMethods);
    		self.protocolList($.LOAD_BALANCER.lbProtocols);
        	
        	var subscriptionVdc;//subscription.dispose();
            var subscriptionAz;
            var subscriptionVpc;
            self.vdcList([]);
            $.VDC.getVDCs({},function(data){
				 if(data && data.results){
					 self.vdcList(data.results);
				 }
			});
            
          //vdc获取AZ
			subscriptionVdc = self.createBlVo().vdcUuid.subscribe(function(val){
			    self.azList([]);
			    if(csc.util.isNotNull(val)){
			    	var azParams = {
				    	cloudPlatform:"OpenStack"
				    };
			    	$.VDC.getVdcAzs(val,azParams,function(data){
		   				 if(data && data.results){
		   					 self.azList(data.results);
		   				 }
		   			});
			    }
    	    	
    	    });
          
			//vdc和AZ获取VPC
			subscriptionAz = self.createBlVo().azUuid.subscribe(function(val){
			    self.vpcList([]);
			    if(csc.util.isNotNull(val)){
			    	var vpcParams = {
			    		vdcUuid: self.createBlVo().vdcUuid(),
			    		azUuid:val
			    	};
			    	$.VPC.getVpcs(vpcParams, function(data){
		   				 if(data && data.results){
		   					 self.vpcList(data.results);
		   				 }
		   			});
			    }else{
			    	var vpcParams = {
			    		vdcUuid: self.createBlVo().vdcUuid()
			    	};
			    	$.VPC.getVpcs(vpcParams, function(data){
		   				 if(data && data.results){
		   					 self.vpcList(data.results);
		   				 }
		   			});
			    }
    	    	
    	    });
			
			//VPC获取vpcNetworkList
			subscriptionVpc = self.createBlVo().vpcUuid.subscribe(function(val){
			    self.vpcNetworkList([]);
			    if(csc.util.isNotNull(val)){
			    	$.VPC.getVpcNet({vpcUuid:val,type:"INNER"},function(data){
		   				 if(data && data.results){
		   					 self.vpcNetworkList(data.results);
		   				 }
		   			});
			    }
    	    });
        	
      	};
      	
      	this.createLoadBalancer = function(){
      		if(self.disableCreateLbBtn()){
      			return;
      		}
      		ko.validation.group(self.createBlVo).showAllMessages();
            if(self.createBlVo.isValid()){
            	var p = self.createBlVo.toJSON();
          		var expiryTime = "";
        	  	var temp = document.getElementsByName("lbExpiredRadioOptions");
        	  	for(var i=0;i<temp.length;i++){
        	       if(temp[i].checked){
        	    	 if(temp[i].value == "option1"){
        	    		 expiryTime = "2099-12-31 23:59:59";
        	    	 }else if(temp[i].value == "option2"){
        	    		 if($("#resource_load_balancer_time_unit").val() == "MONTH"){
        	    			 var plusMonth = parseInt($("#resource_load_balancer_time_value").val());
        	    			 var dd = new Date();
        	    			 var y = dd.getFullYear(); 
        	    			 var m = dd.getMonth()+1+plusMonth;//获取当前月份的日期 
        	    			 var selfM = dd.getMonth()+1;
        	    			 var d = dd.getDate();
        	    			 y = y + parseInt(m/12);
        	    			 m = m%12;
        	    			 if(m == 0){
        	    				 m = selfM;
        	    			 }
        	    		 }else if($("#resource_load_balancer_time_unit").val() == "YEAR"){
        	    			 var plusYear = parseInt($("#resource_load_balancer_time_value").val());
        	    			 var dd = new Date();
        	    			 var y = dd.getFullYear(); 
        	    			 var m = dd.getMonth()+1;//获取当前月份的日期 
        	    			 var d = dd.getDate();
        	    			 y = y + plusYear;
        	    		 }
        	    		 expiryTime = y+"-"+m+"-"+d+" 23:59:59";
        	    	 }else{
        	    		 var timeStr = $("#resource_load_balancer_datePicker").val();
        	    		 expiryTime = $.trim(timeStr) + " 23:59:59";
        	    	 }
        	       }
        	  	}
          		p.expiryDate = expiryTime;
          		
          		self.disableCreateLbBtn(true);
          		$.LOAD_BALANCER.createLoadBalancer(p, function(data){
          			self.showCreatePage(false);
     	    		self.loadBalancerTable.refreshData();
     				alert("创建负载均衡器成功！");
          		}, function(data){
          			self.disableCreateLbBtn(false);
          		});
            }
      		
      	}
      	/********  创建负载均衡器 END   *********/
      	
      	/********  创建负载均衡器详情页面   *********/
      	
      	this.currentLbVo = ko.observable();
      	
      	this.isShowDetail = ko.observable(false);
    	this.isLbValidate = ko.observable(true);//当前负载均衡器是否在有效期内
      	
      	this.showDetailFun = function(row,event){
    		self.isShowDetail(!self.isShowDetail());
    		if(self.isShowDetail()){
    			self.currentLbVo(row);
    			self.isLbValidate(row.isValidate);
    			var p = {
    				"lbUuid": 	row.uuid
    			};
    			self.lbMemberTable.params(p);
    			self.lbMonitorTable.params(p);
    			
    			loadVipInfo(row.vipUuid);
    		}
    	}
    	
      	this.currentVipVo = ko.observable();
      	this.isShowVipInfo = ko.observable(false);
      	function loadVipInfo(vipUuid){
      		if(csc.util.isNotNull(vipUuid)){
      			self.isShowVipInfo(true);
      			$.LOAD_BALANCER.getLoadBalancerVip(vipUuid, function(data){
            		self.currentVipVo(data);
          		});
      		}else{
      			self.isShowVipInfo(false);
      		}
      	}
      	
      	
      	/********  创建负载均衡器基本信息 END   *********/
      	this.delLoadBalancer = function(row){
      		if(csc.util.isNotNull(row.serviceInstanceUuid)){
         		  //走流程
         		  self.doDeleteProcessPost(row);
         	  }else{
         		  //不走流程
	      		var name = row.name;
	      		confirm("确定删除负载均衡器[" + name + "]？", function(arg){
	      			$.LOAD_BALANCER.deleteLoadBalancer(row.uuid, function(data){
	      				self.loadBalancerTable.refreshData();
	      				alert("删除负载均衡器[" + name + "]成功！")
	           		});
	      		});
         	  }
      	}
      	
      	this.delLoadBalancerInDetail = function(){
      		if(csc.util.isNotNull(self.currentLbVo().serviceInstanceUuid)){
       		  //走流程
       		  self.doDeleteProcessPost(self.currentLbVo());
       	  }else{
       		  //不走流程
      		var name = self.currentLbVo().name;
      		var uuid = self.currentLbVo().uuid;
      		confirm("确定删除负载均衡器[" + name + "]？", function(arg){
      			$.LOAD_BALANCER.deleteLoadBalancer(uuid, function(data){
      				self.isShowDetail(false);
      				self.loadBalancerTable.refreshData();
      				alert("删除负载均衡器[" + name + "]成功！")
           		});
      		});
       	  }
      	}
      	
      	
      	/********************  VIP模块   ************************/
      	/********  添加VIP   *********/
      	this.isShowAddVip = ko.observable(false);
      	this.isVipEditFlag = ko.observable(false);
      	this.createVipVo = ko.validatedObservable({
    		"uuid": "",
    		"azUuid": "",
      		"lbId": "",
      		"lbUuid": "",
      		"lbName": "",
      		"name":  ko.observable("").extend({required: true, cscNameRule:true, maxLength:32}),
      		"vpcNetworkUuid":  "",
      		"networkName": "",
      		"cidr": ko.observable(""),
      		"address":  ko.observable("").extend({required: true}),
      		"protocol": ko.observable(""),
      		"protocolPort":  ko.observable(80).extend({required: true, min:1, max:65535}),
      		"sessionPersistenceType":  ko.observable(""),
      		"cookieName":  ko.observable("").extend({cscNameRule:true, maxLength:32}),
      		"connectionLimit":ko.observable("").extend({required: true, positiveIntegerRule:true}),
      		"desc":ko.observable("").extend({maxLength:255})
    	});
      	this.spTypeList = ko.observableArray();
         //选择IP
        this.availIpList = ko.observableArray([]);
      	
      	this.disableUpdateVipBtn = ko.observable(false);
      	this.showAddVip = function(row, event){
        	self.isShowAddVip(true);
			self.isVipEditFlag(false);//添加页面
			self.disableUpdateVipBtn(false);
			//
			self.spTypeList([]);
        	self.spTypeList($.LOAD_BALANCER.sessionPersistenceType);
        	//可用IP列表
        	self.availIpList([]);
        	if(csc.util.isNotNull(row.vpcNetworkUuid)){
        		$.VPC.getNetworkAvailableIp(row.vpcNetworkUuid, function(data){
            		if(csc.util.isNotNull(data)){
            			self.availIpList(data);
            		}
            	});
        	}
        	
        	//初始化VIP参数
        	self.createVipVo.fromJSON({
        		"uuid": "",
        		"azUuid": row.azUuid,
          		"lbId": row.originalId,
          		"lbUuid": row.uuid,
          		"lbName": row.name,
          		"name":  "",
          		"vpcNetworkUuid":  row.vpcNetworkUuid,
          		"networkName": row.networkName,
          		"cidr": row.cidr,
          		"address":  "",
          		"protocol": row.protocol,
          		"protocolPort":  80,
          		"sessionPersistenceType":  "",
          		"cookieName":  "",
          		"connectionLimit":"",
          		"desc":""
        	});
        	
      	};
      	
      	this.addVip = function(){
      		ko.validation.group(self.createVipVo).showAllMessages();
            if(self.createVipVo.isValid()){
            	var p = ko.toJS(self.createVipVo());
            	self.disableUpdateVipBtn(true);
          		$.LOAD_BALANCER.createLoadBalancerVip(p, function(data){
          			self.isShowAddVip(false);
     	    		self.loadBalancerTable.refreshData();
     				alert("创建负载均衡器VIP成功！");
          		}, function(data){
          			self.disableUpdateVipBtn(false);
          		});
            }
      	}
      	
      	var oldEditVip = {};
      	this.showEditVip = function(row, event){
        	self.isShowAddVip(true);
        	self.isVipEditFlag(true);//编辑页面
        	self.disableUpdateVipBtn(false);
        	//
        	self.spTypeList([]);
        	self.spTypeList($.LOAD_BALANCER.sessionPersistenceType);
        	//初始化VIP参数
        	$.LOAD_BALANCER.getLoadBalancerVip(row.vipUuid, function(data){
        		oldEditVip.name = data.name;
        		oldEditVip.desc = data.desc;
        		oldEditVip.sessionPersistenceType = data.sessionPersistenceType == null?"":data.sessionPersistenceType;
        		oldEditVip.cookieName = data.cookieName == null ? "": data.cookieName;
        		oldEditVip.connectionLimit = data.connectionLimit;
        		self.createVipVo.fromJSON(data);
      		});
        	
      	};
      	
      	var loadCurrentVipInfo = function(vipUuid){
      		$.LOAD_BALANCER.getLoadBalancerVip(vipUuid, function(data){
        		self.currentVipVo(data);
      		});
      	};
      	
      	//VIP是否修改
      	var isVipChange = function(o, n){
      		n.cookieName = n.cookieName == null ? "":n.cookieName;
      		if(o.name.trim() != n.name.trim()
      		 || o.desc.trim() != n.desc.trim()
      		 || o.sessionPersistenceType != n.sessionPersistenceType
      		 || o.cookieName.trim() != n.cookieName.trim()
      		 || o.connectionLimit != n.connectionLimit
      		 ){
      			return true;
      		}
      		return false;
      	}
      	
      	this.editVip = function(){
      		ko.validation.group(self.createVipVo).showAllMessages();
            if(self.createVipVo.isValid()){
            	var p = ko.toJS(self.createVipVo());
          		if(isVipChange(oldEditVip, p)){
          			self.disableUpdateVipBtn(true);
          			$.LOAD_BALANCER.editLoadBalancerVip(p.uuid, p, function(data){
              			self.isShowAddVip(false);
         	    		self.loadBalancerTable.refreshData();
         	    		if(self.isShowDetail()){
         	    			loadCurrentVipInfo(p.uuid);
         	    		}
         				alert("修改负载均衡器VIP成功！");
              		}, function(data){
              			self.disableUpdateVipBtn(false);
              		})
          		}else{
          			self.isShowAddVip(false);
          		}
            }
      	}
      	
      	this.updateVip = function(){
      		if(self.disableUpdateVipBtn()){
      			return;
      		}
      		if(self.isVipEditFlag()){
      			self.editVip();
      		}else{
      			self.addVip();
      		}
      	}
      	
      	this.delVip = function(row){
	      		var name = row.vipName;
	      		confirm("确定删除负载均衡器VIP[" + name + "]？", function(arg){
	      			$.LOAD_BALANCER.deleteLoadBalancerVip(row.vipUuid, function(data){
	      				self.loadBalancerTable.refreshData();
	      				//如果进入详情页，则更新详情页
	      				if(self.isShowDetail()){
	      					self.currentLbVo().vipUuid = "";
	      				}
	      				alert("删除负载均衡器VIP[" + name + "]成功！")
	           		});
	      		});
      	}
      	
      	/********************  VIP模块 END  ************************/
      	
      	
      	/********************  成员列表   ************************/
        
        this.lbMemberTable = new DataTable({
  		  perPage: 10,
            path: 'api/v5.0.0/loadBalancerMembers',
            loader: function(result){
                //result.account_ = "超级管理员"; 
                return result;
            }
    	});
        
        /********************  成员列表  END ************************/
      	/********************  添加成员   ************************/
      	this.isShowAddMember = ko.observable(false);
        this.isEditMemberFlag = ko.observable(false);
        
      	this.createMemberVo = ko.validatedObservable({
      		"vpcUuid": "",
      		"lbId": "",
      		"lbUuid": "",
      		"lbName": ko.observable(""),
      		"vmName": ko.observable(""),
      		"vm":ko.observable().extend({required: true}),
      		"protocolPort":ko.observable(80).extend({required: true, min:1, max: 65535}),
      		"weight":ko.observable(1).extend({required: true, positiveIntegerRule:true})
      	});
      	this.memberVmList = ko.observableArray();
      	
      	this.disableUpdateMemberBtn = ko.observable(false);
        this.showAddMember = function(){
          	self.isShowAddMember(true);
          	self.isEditMemberFlag(false);
          	self.disableUpdateMemberBtn(false);
          	
          	self.createMemberVo({
          		"vpcUuid": "",
          		"lbId": "",
          		"lbUuid": "",
          		"lbName": ko.observable(""),
          		"vmName": ko.observable(""),
          		"vm":ko.observable().extend({required: true}),
          		"protocolPort":ko.observable(80).extend({required: true, min:1, max: 65535}),
          		"weight":ko.observable(1).extend({required: true, positiveIntegerRule:true})
          	});
          	
          	self.memberVmList([]);
          	var p = {
             	   tenantId: 	self.currentLbVo().tenantId,
             	   networkUuid:	self.currentLbVo().vpcNetworkUuid,
             	   lbUuid: 		self.currentLbVo().uuid
            };
            self.memberVmList([]);
            $.PORT.getLbMemberVmList(p, function(data){
         	   if(data && data.results){
         		   self.memberVmList(data.results);
         	   }
            })
          	
          	self.createMemberVo.fromJSON({
          		"vpcUuid": self.currentLbVo().vpcUuid,
          		"lbId": self.currentLbVo().originalId,
          		"lbUuid": self.currentLbVo().uuid,
          		"lbName": self.currentLbVo().name,
          		"vmName": "",
          		"vm":"",
          		"protocolPort":80,
          		"weight":1
          	});
          	
        }
        
        this.addMember = function(){
        	if(self.disableUpdateMemberBtn()){
      			return;
      		}
        	ko.validation.group(self.createMemberVo).showAllMessages();
            if(self.createMemberVo.isValid()){
            	var p = {
                		"vpcUuid": self.createMemberVo().vpcUuid,
                		"lbId": 	self.createMemberVo().lbId,
                		"lbUuid": 	self.createMemberVo().lbUuid,
                		"address":	self.createMemberVo().vm().address,
                  		"protocolPort":self.createMemberVo().protocolPort(),
                  		"weight":   self.createMemberVo().weight(),
                  		"vmName":	self.createMemberVo().vm().vmName
                	};
                	var lbName = self.createMemberVo().lbName();
                	self.disableUpdateMemberBtn(true);
                	$.LOAD_BALANCER.createLoadBalancerMember(p, function(data){
                		self.isShowAddMember(false);
                		self.lbMemberTable.refreshData();
        				alert("创建负载均衡器[" + lbName + "]成员成功！")
                	}, function(data){
              			self.disableUpdateMemberBtn(false);
              		});
            }
        }
        
        /********************  修改成员  ************************/
        var oldEditMember = {};
        
        this.showEditMember = function(row, event){
        	self.isShowAddMember(true);
        	self.isEditMemberFlag(true);
        	self.disableUpdateMemberBtn(false);
        	
        	self.createMemberVo({
          		"vpcUuid": "",
          		"lbId": "",
          		"lbUuid": "",
          		"lbName": ko.observable(""),
          		"vmName": ko.observable(""),
          		"vm":ko.observable(),
          		"protocolPort":ko.observable(80).extend({required: true, min:1, max: 65535}),
          		"weight":ko.observable(1).extend({required: true, positiveIntegerRule:true})
          	});
        	
          	oldEditMember.weight = row.weight;
           	//将数据行的数据传入createMemberVo
           	self.createMemberVo.fromJSON({
           		"uuid":			row.uuid,
           		"vpcUuid": 		row.vpcUuid,
         		"lbId": 		row.lbId,
         		"lbUuid": 		row.lbUuid,
         		"lbName":		row.lbName,
         		"address":		row.address,
           		"protocolPort":	row.protocolPort,
           		"weight":   	row.weight,
           		"vmName":		row.vmName,
           		"vm":	{"address":row.address, "vmName": row.vmName}
           	});
        }
        
        this.editMember = function(){
        	if(self.disableUpdateMemberBtn()){
      			return;
      		}
        	var p = {
            		"vpcUuid": self.createMemberVo().vpcUuid,
            		"lbId": 	self.createMemberVo().lbId,
            		"lbUuid": 	self.createMemberVo().lbUuid,
            		"address":	self.createMemberVo().address,
              		"protocolPort":self.createMemberVo().protocolPort(),
              		"weight":   self.createMemberVo().weight(),
              		"vmName":	self.createMemberVo().vmName
            	};
        	var uuid = self.createMemberVo().uuid;
        	if(oldEditMember.weight == p.weight){
        		//没有修改，则只是隐藏页面
        		self.isShowAddMember(false);
        	}else{
        		ko.validation.group(self.createMemberVo).showAllMessages();
                if(self.createMemberVo.isValid()){
                	self.disableUpdateMemberBtn(true);
            		$.LOAD_BALANCER.editLoadBalancerMember(uuid, p, function(data){
                   		self.isShowAddMember(false);
                   		self.lbMemberTable.refreshData();
           				alert("修改成员成功！")
                   	}, function(data){
              			self.disableUpdateMemberBtn(false);
              		});
                }
        	}
        	
        }
        
        
        this.updateMember = function(){
        	if(self.isEditMemberFlag()){
        		self.editMember();
        	}else{
        		self.addMember();
        	}
        	
        }
        
        /********************  删除成员  ************************/
        this.deleteLbMember = function(vo){
      	  var name = vo.vmName;
  		  confirm("确定删除负载均衡器成员[" + name + "]？", function(arg){
  			$.LOAD_BALANCER.deleteLoadBalancerMember(vo.uuid, function(data){
  				self.lbMemberTable.refreshData();
  				alert("删除负载均衡器成员[" + name + "]成功！")
       		});
  		  });
        }
        
        this.refreshMemberList = function(){
        	self.lbMemberTable.refreshData();
        }
        
        /********************  负载均衡器监听模块   ************************/
        /********************  添加列表   ************************/
        this.lbMonitorTable = new DataTable({
  		  	perPage: 10,
            path: 'api/v5.0.0/loadBalancerMonitors',
            loader: function(result){
            	if(result.type == "TCP"){
            		result.detail = "-";
            	}else{
            		result.detail = result.httpMethod + result.urlPath + " => " + result.expectedCodes;
            	}
                return result;
            }
    	});
        
        /********************  添加监控   ************************/
        this.isShowAddMonitor = ko.observable(false);
        this.isEditMonitorFlag = ko.observable(false);
        
        this.createMonitorVo = ko.validatedObservable({
        	vpcUuid:	"",
    		lbUuid:		"",
    		type: 		ko.observable(),
    		delay:		ko.observable().extend({required: true,positiveIntegerRule:true}),
    		timeout:	ko.observable().extend({required: true,positiveIntegerRule:true}),
    		maxRetries:	ko.observable(1).extend({required: true, min:1, max: 10}),
    		httpMethod: "GET",
    		urlPath:	ko.observable("/").extend({required: true, maxLength:255}),
    		expectedCodes:ko.observable(200).extend({required: true, min:1, max: 999})
        });
        
        this.redefineCreateMonitorVo = function(isTcp){
        	if(isTcp){
        		self.createMonitorVo({
        			vpcUuid:	"",
            		lbUuid:		"",
            		type: 		ko.observable(),
            		delay:		ko.observable().extend({required: true,positiveIntegerRule:true}),
            		timeout:	ko.observable().extend({required: true,positiveIntegerRule:true}),
            		maxRetries:	ko.observable(1).extend({required: true, min:1, max: 10}),
            		httpMethod: "GET",
            		urlPath:	ko.observable("/").extend({required: false, maxLength:255}),
            		expectedCodes:ko.observable(200).extend({required: false, min:1, max: 999})
        		});
        	}else{
        		self.createMonitorVo({
					vpcUuid:	"",
		    		lbUuid:		"",
		    		type: 		ko.observable(),
		    		delay:		ko.observable().extend({required: true,positiveIntegerRule:true}),
		    		timeout:	ko.observable().extend({required: true,positiveIntegerRule:true}),
		    		maxRetries:	ko.observable(1).extend({required: true, min:1, max: 10}),
		    		httpMethod: "GET",
		    		urlPath:	ko.observable("/").extend({required: true, maxLength:255}),
		    		expectedCodes:ko.observable(200).extend({required: true, min:1, max: 999})
        		});
        	}
        }
        
        this.isTcpHide = ko.observable();//当协议类型为TCP时，需要隐藏的字段
        
        this.disableUpdateMonitorBtn = ko.observable(false);
        this.showAddMonitor = function(){
        	self.isShowAddMonitor(true);
        	self.isEditMonitorFlag(false);
        	self.disableUpdateMonitorBtn(false);
        	//初始化createMonitorVo数据
        	var protocolType = self.currentLbVo().protocol;
        	if("TCP" == protocolType){
        		self.isTcpHide(true);
        	}else{
        		self.isTcpHide(false);
        	}
        	self.redefineCreateMonitorVo(self.isTcpHide());
        	self.createMonitorVo.fromJSON({
        		vpcUuid:		self.currentLbVo().vpcUuid,
        		lbUuid:		self.currentLbVo().uuid,
        		type: 	self.currentLbVo().protocol,
        		delay:		"",
        		timeout:	"",
        		maxRetries:	"",
        		httpMethod: "GET",
        		urlPath:	"/",
        		expectedCodes:"200"
        	});
        	
        }
        
        this.addMonitor = function(){
        	if(self.disableUpdateMonitorBtn()){
      			return;
      		}
        	var p = self.createMonitorVo.toJSON();
        	ko.validation.group(self.createMonitorVo).showAllMessages();
            if(self.createMonitorVo.isValid()){
            	if(p.timeout > p.delay){
            		alert("超时时间不能大于延迟时间！");
            		return;
            	}
            	self.disableUpdateMonitorBtn(true);
            	$.LOAD_BALANCER.createLoadBalancerMonitor(p, function(data){
            		self.isShowAddMonitor(false);
            		self.lbMonitorTable.refreshData();
    				alert("添加监听成功！");
            	}, function(data){
          			self.disableUpdateMonitorBtn(false);
          		});
            }
        }
        /********************  修改监听   ************************/
        var oldMonitorVo = {};
        this.showEditMonitor = function(row){
        	self.isShowAddMonitor(true);
        	self.isEditMonitorFlag(true);
        	self.disableUpdateMonitorBtn(false);
        	
        	oldMonitorVo.delay = row.delay;
        	oldMonitorVo.timeout = row.timeout;
        	oldMonitorVo.maxRetries = row.maxRetries;
        	oldMonitorVo.urlPath = row.urlPath;
        	oldMonitorVo.expectedCodes = row.expectedCodes;
        	if("TCP" == row.type){
        		self.isTcpHide(true);
        	}else{
        		self.isTcpHide(false);
        	}
        	self.redefineCreateMonitorVo(self.isTcpHide());
        	self.createMonitorVo.fromJSON(row);
        }
        
        var isMonitorChange = function(o, n){
        	if(o.delay != n.delay
        	|| o.timeout != n.timeout
         	|| o.maxRetries != n.maxRetries
         	|| o.urlPath != n.urlPath
         	|| o.expectedCodes != n.expectedCodes
   			){
        		return true;
        	}else{
        		return false;
        	}
        }
        
        this.editMonitor = function(){
        	if(self.disableUpdateMonitorBtn()){
      			return;
      		}
        	var p = self.createMonitorVo.toJSON();
        	if(isMonitorChange(oldMonitorVo, p)){
        		ko.validation.group(self.createMonitorVo).showAllMessages();
                if(self.createMonitorVo.isValid()){
					if(p.timeout > p.delay){
                		alert("超时时间不能大于延迟时间！");
                		return;
                	}
                	self.disableUpdateMonitorBtn(true);
            		$.LOAD_BALANCER.editLoadBalancerMonitor(p.uuid, p, function(data){
                		self.isShowAddMonitor(false);
                		self.lbMonitorTable.refreshData();
        				alert("修改监听成功！")
                	}, function(data){
              			self.disableUpdateMonitorBtn(false);
              		});
                }
        	}else{
        		self.isShowAddMonitor(false);
        	}
        	
        }
        
        this.updateMonitor = function(){
        	if(self.isEditMonitorFlag()){
        		self.editMonitor();
        	}else{
        		self.addMonitor();
        	}
        }
        
        /********************  删除监听   ************************/
        this.delMonitor = function(vo){
    		  confirm("确定删除该负载均衡器监听？", function(arg){
    			$.LOAD_BALANCER.deleteLoadBalancerMonitor(vo.uuid, function(data){
    				self.lbMonitorTable.refreshData();
    				alert("删除负载均衡器监听成功！")
         		});
    		  });
        }
        
        this.refreshMonitorList = function(){
        	self.lbMonitorTable.refreshData();
        }
        /********************  监听模块   ************************/
        /********************  服务模块   ************************/
        //修改有效时间
        $("#modal_balancer_valiTime").on("shown.bs.modal",function(){
          // daterange             
          $('#resource_loadBalancer_validate_edit').val(self.validateTimeVO().time()).daterangepicker(
            {
              minDate:moment(),
              singleDatePicker: true,
              locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                weekLabel: '周',
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              }
            }
          ); 
        })
        
        this.isValidateTime = ko.observable(false);
        this.validateTimeVO = ko.validatedObservable({
      	  uuid: ko.observable(),
      	  name: ko.observable(),
      	  time: ko.observable(),
      	  metaTime: ko.observable()
        });
        this.showChangeValiTimePage = function(object, event){
        	if(csc.util.isNotNull(object.serviceInstanceUuid)){
         		  //走流程
         		  self.doValidateProcessPost(object);
         	  }else{
         		  //不走流程
		      	  self.isValidateTime(true);
		      	  //设置修改对象的uuid
		      	  self.validateTimeVO().uuid(object.uuid);
		      	  self.validateTimeVO().name(object.name);
		      	  self.validateTimeVO().time(object.expiryDate);
		      	  self.validateTimeVO().metaTime(object.expiryDate);
         	  }
        }
        
        this.showChangeValiTimeInDetail = function(){
        	if(csc.util.isNotNull(self.currentLbVo().serviceInstanceUuid)){
       		  //走流程
       		  	self.doValidateProcessPost(self.currentLbVo());
       	  	}else{
       		  //不走流程
	        	self.isValidateTime(true);
	        	//设置修改对象的uuid
	        	self.validateTimeVO().uuid(self.currentLbVo().uuid);
	        	self.validateTimeVO().name(self.currentLbVo().name);
	        	self.validateTimeVO().time(self.currentLbVo().expiryDate);
	        	self.validateTimeVO().metaTime(self.currentLbVo().expiryDate);
       	  	}
        }
        
        this.changeExpiredTime = function(){
	        //检查日期相同的，不发送请求直接关闭页面
	        if(self.validateTimeVO().time() == self.validateTimeVO().metaTime()){
	        	self.isValidateTime(false);
	        	return;
	        }
      	  var uuid = self.validateTimeVO().uuid();
      	  var name = self.validateTimeVO().name();
      	  var p = {
      		  expiryDate : self.validateTimeVO().time() + " 23:59:59"
      	  };
      	  $.INSTANCE.setExpiredDate(uuid, p, function(data){
      		  self.loadBalancerTable.refreshData();
  		 	  self.isValidateTime(false);
  		 	  alert('修改负载均衡器['+ name+ ']服务的有效期成功！');
      	  });
        }
        
        
      	//终止服务
        this.terminateService = function(vo){
      	  var name = vo.name;
  		  confirm("确定终止负载均衡器[" + name + "]的服务？", function(arg){
  			  $.INSTANCE.terminalService(vo.uuid, function(data){
  				self.loadBalancerTable.refreshData();
  				alert("终止负载均衡器[" + name + "]的服务成功！")
       		});
  		  });
        }
        
        
        
        /********************  服务模块   ************************/
        
      //------------------------------------------删除-流程开始--------------------------------
        this.isDeleteProcess = ko.observable(false);
        
        this.doDeleteProcessPost = function(object){
      	  self.isDeleteProcess(true);
  		  self.deleteProcessVO().name(object.name);
  		  self.deleteProcessVO().uuid(object.uuid);
  		  self.deleteProcessVO().vdcUuid(object.vdcUuid);
  		  self.deleteProcessVO().azUuid(object.azUuid);
  		  self.deleteProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
  		  var myDate = new Date();
  		  self.deleteProcessVO().time(myDate.toLocaleString());
  		  self.deleteProcessVO().user("");
        }
    
        this.deleteProcessVO = ko.observable({
      	  name: ko.observable(),
      	  uuid: ko.observable(),
      	  vdcUuid: ko.observable(),
      	  azUuid: ko.observable(),
      	  serviceInstanceUuid: ko.observable(),
      	  time: ko.observable(),
      	  user: ko.observable()
        });
        
        this.deleteProcessPost = function(){
         	  var orderItem = {};
         	  orderItem.instanceName = self.deleteProcessVO().name();
         	  orderItem.serviceInstanceUuid = self.deleteProcessVO().serviceInstanceUuid();
         	  orderItem.resourceType = "LOAD_BALANCING";
         	  orderItem.resourceUuid = self.deleteProcessVO().uuid();
         	  orderItem.vdcUuid = self.deleteProcessVO().vdcUuid;
         	  orderItem.azUuid = self.deleteProcessVO().azUuid();
         	  orderItem.metaData =  "{\"resBaseInfo\": {}}";
         	  
         	  var orderItems = [];
         	  orderItems.push(orderItem);
         	  
         	  var postBody = {}; 
         	  postBody.resourceType = "LOAD_BALANCING";
         	  postBody.vdcUuid = self.deleteProcessVO().vdcUuid();
         	  postBody.orderItems = orderItems;
         	  
         	  csc.rest.post("api/v5.0.0/orders/deleteResource",postBody,function(data){
         		if(data.code){
          			systemMsg.alert('删除资源申请成功，订单编号：'+data.code+'！');
          		}else{
          			systemMsg.alert('删除负载均衡器成功！'); 
                    self.loadBalancerTable.refreshData();
          		}
         		self.isDeleteProcess(false);
         	  });
   		}
        
        //------------------------------------------删除-流程结束--------------------------------
      

      //------------------------------------------有效期-流程开始--------------------------------
  	  this.isValidateProcess = ko.observable(false);
        
        this.doValidateProcessPost = function(object){
      	  self.isValidateProcess(true);
  		  self.validateProcessVO().name(object.name);
  		  self.validateProcessVO().uuid(object.uuid);
  		  self.validateProcessVO().vdcUuid(object.vdcUuid);
  		  self.validateProcessVO().vdcName(object.vdcName);
  		  self.validateProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
  		  var myDate = new Date();
  		  self.validateProcessVO().time(myDate.toLocaleString());
  		  self.validateProcessVO().user("");
  		  
  		  self.validateProcessVO().validateTime(object.expiryDate);
  		  self.validateProcessVO().targetValidateTime("");
  		  
  		  $('#resource_instance_balancer_validate_process').val(moment().format('YYYY/MM/DD')).daterangepicker(
  		            {
  		              format:'YYYY/MM/DD',
  		              minDate:moment(),
  		              singleDatePicker: true,
  		              locale:{
  		                applyLabel: '确认',
  		                cancelLabel: '取消',
  		                weekLabel: '周',
  		                daysOfWeek:["日","一","二","三","四","五","六"],
  		                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
  		              }
  		            }
  		  ); 
        }
    
        this.validateProcessVO = ko.observable({
      	  name: ko.observable(),
      	  uuid: ko.observable(),
      	  vdcUuid: ko.observable(),
      	  vdcName: ko.observable(),
      	  time: ko.observable(),
      	  user: ko.observable(),
      	  serviceInstanceUuid: ko.observable(),
      	  
      	  validateTime: ko.observable(),
      	  targetValidateTime: ko.observable()
        });
        
        //申请
        this.validateProcessPost = function(){
        	//检查日期相同的，不发送请求直接关闭页面
      	  if(self.validateProcessVO().validateTime() == self.validateProcessVO().targetValidateTime()){
      		  self.isValidateProcess(false);
      		  return;
      	  }
      	  var metaData =  "{\"resBaseInfo\": {\"vdcName\": \"" + self.validateProcessVO().vdcName() 
      		            + "\",\"metaExpireTime\": \"" + self.validateProcessVO().validateTime() + "\"}}";
          var orderItem = {};
      	  orderItem.instanceName = self.validateProcessVO().name();
      	  orderItem.serviceInstanceUuid = self.validateProcessVO().serviceInstanceUuid();
      	  orderItem.expireTime = self.validateProcessVO().targetValidateTime() + " 23:59:59";
      	  orderItem.resourceType = "LOAD_BALANCING";
      	  orderItem.resourceUuid = self.validateProcessVO().uuid();
      	  orderItem.metaData = metaData;
      	  
      	  var orderItems = [];
      	  orderItems.push(orderItem);
      	  
      	  var postBody = {};
      	  postBody.resourceType = "LOAD_BALANCING";
      	  postBody.type = "VALIDTIME_CHANGE";
      	  postBody.vdcUuid = self.validateProcessVO().vdcUuid();
      	  postBody.orderItems = orderItems;
      	  
      	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
      		  if(data.code){
      			systemMsg.alert('有效时间变更申请成功，订单编号：'+data.code+'！');
    		 		self.isValidateProcess(false);
      		  }
      	  });
        }
        //------------------------------------------有效期-流程结束--------------------------------
    };
    window.viewModelBalancer = new ViewModel_Balancer();
    ko.applyBindings(window.viewModelBalancer, $('#partition_balancer')[0]);
  })

</script>