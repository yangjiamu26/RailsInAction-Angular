  <div class="row wrapper">
      <div class="col-xs-1">
        <button class="btn btn-sm btn-info" data-bind="click: addvm,check_action:'cloudServerCreate'">创建</button>
      </div>  
       <div class="col-xs-2">
        <div class="input-group">
          <span class="input-group-addon">所属VDC</span>
          <select class="form-control input-sm" data-bind="value: searchParam().vdcUuid, options: $root.vdcs, optionsText: 'name', optionsValue: 'uuid',event: {change: $root.onchange_vdcs}"></select>
        </div>      
      </div>             
      <div class="col-xs-3">
        <div class="input-group">
          <span class="input-group-addon">所属可用分区</span>
          <select class="form-control input-sm" data-bind="value: searchParam().azUuid, options: $root.partitions, optionsText: 'name', optionsValue: 'uuid'"></select>
        </div>      
      </div>  
      <div class="col-xs-2">
        <div class="input-group">
          <span class="input-group-addon">状态</span>
          <select class="form-control input-sm" data-bind="value: searchParam().state">
            <option value="">全部</option>
            <option value="ACTIVE">运行中</option>
            <option value="SHUTOFF">已关机</option>
            <option value="SUSPENDED">已挂起</option>
          </select>
        </div>      
      </div>        
      <div class="col-xs-2">
        <div class="input-group">
          <span class="input-group-addon">名称</span>
          <input type="text" class="input-sm form-control" placeholder="请输入名称" data-bind="value: searchParam().name">
        </div>
      </div>                                     
      <div class="col-xs-2">
        <button class="btn btn-sm" type="button" data-bind="click: reset">重置</button>
        <button class="btn btn-default btn-sm" type="submit" data-bind="click: search">搜索</button>
      </div>        
  </div>        

  <div id='instance_vms'>
    <div class='table-responsive' data-bind="with: table">
      <table class='table table-striped'>
        <thead>
          <tr>
            <th>云主机名称</th>
            <th>IP地址</th>  
            <th>状态</th>
            <th>所属VDC</th>
            <th>所属可用分区</th>
            <th>所属VPC</th>
            <th>服务状态</th>
            <!-- <th>公网IP</th> -->
            <th>CPU（个）</th>
            <th>内存（MB）</th>
            <th>存储（GB）</th>                                  
            <th>创建人</th>
            <!-- <th>创建时间</th> -->
            <th>操作</th>
          </thead>
          <tbody>
            <tr data-bind="visible: showNoData">
              <td colspan=14 class="aligncenter">
                	暂无数据
              </td>
            </tr>
            <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
            <tr> 
                <td>
               	 	<a data-url="" data-bind="text: $row.name,attr:{href:'#pages/resources/instances/vms/show?vmUuid='+$row.uuid}"></a>
               	</td>
               	<td data-bind="text: ip"></td>
                <td>
	                <span class="label label-success" data-bind="if: state == 'ACTIVE' && taskState == null">运行中</span>
	                <span class="label label-danger" data-bind="if: state == 'SHUTOFF' && taskState == null">已关机</span>
	                <span class="label label-info" data-bind="if: state == 'SUSPENDED' && taskState == null">已挂起</span>
	                <span class="label label-warning" data-bind="if: taskState == 'POWERING_OFF'">正在关机</span>
	                <span class="label label-warning" data-bind="if: taskState == 'POWERING_ON'">正在启动</span>
	                <span class="label label-warning" data-bind="if: taskState == 'REBOOTING'">正在重启</span>
	                <span class="label label-warning" data-bind="if: taskState == 'REBOOTING_HARD'">正在强制重启</span>
	                <span class="label label-warning" data-bind="if: taskState == 'SUSPENDING'">正在挂起</span>
	                <span class="label label-warning" data-bind="if: taskState == 'RESUMING'">正在恢复</span>
	                <span class="label label-warning" data-bind="if: taskState == 'DELETING'">正在删除</span>
	                <span class="label label-warning" data-bind="if: taskState == 'RESIZING'">正在调整</span>
                </td>
                <td data-bind="text: vdcName"></td>
                <td data-bind="text: azName"></td>
                <td data-bind="text: vpcName"></td>
                <td>
                	<span class="label label-success" data-bind="if: isValidate == true">正常</span>
	                <span class="label label-danger" data-bind="if: isValidate == false">已过期</span>
                </td>
               <!--  <td data-bind="text: publicIp"></td> -->
                <td data-bind="text: vcpu"></td>
                <td data-bind="text: memory"></td>
                <td data-bind="text: storage"></td>
                <td data-bind="text: account"></td>
<!--                 <td data-bind="text: createTime"></td> -->
                <td><span data-bind="check_action:'cs_Console'"><a data-bind="click: $root.console">控制台</a> | </span> <span data-bind="check_action:'cs_TimeMidify'"><a href="#" data-bind="click: $root.editValidateTime">有效时间变更</a> |</span>
                  <div class="btn-group">
                    <a class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                      更多<span class="fa fa-caret-down"></span>
                    </a>
                    <ul style="right:0;min-width:50px;left:auto;" class="dropdown-menu">
                         <li data-bind="check_action:'cs_Resomodify',if: isValidate == true && state != 'SUSPENDED'"><a data-bind="click: $root.vmAdjustment">调整资源</a></li>
                        <li data-bind="if: state == 'SHUTOFF' && isValidate == true,check_action:'cs_PowerOn'"><a data-bind="click: $root.startOne">开机</a></li>
                        <li data-bind="if: state == 'ACTIVE' && isValidate == true,check_action:'cs_PowerOff'"><a data-bind="click: $root.shutoffOne">关机</a></li>
                        <li data-bind="if: state == 'ACTIVE' && isValidate == true,check_action:'cs_Reboot'"><a data-bind="click: $root.restartOne">重启</a></li>
                        <li data-bind="if: state == 'ACTIVE' && isValidate == true,check_action:'cs_PoweReboot'"><a data-bind="click: $root.restartForceOne">强制重启</a></li>
                        <li data-bind="if: state == 'ACTIVE' && isValidate == true,check_action:'cs_Wait'"><a data-bind="click: $root.suspend">挂起</a></li>
                        <li data-bind="if: state == 'SUSPENDED' && isValidate == true,check_action:'cs_Recovery'"><a data-bind="click: $root.resume">恢复</a></li>
                        <li data-bind="if: isValidate == true,check_action:'cs_Stop'"><a data-bind="click: $root.validate">终止</a></li>
                        <li data-bind="check_action:'cs_Delete',if: (state == 'SHUTOFF' || state == 'ACTIVE' || state == 'SUSPENDED') && isValidate == false"><a data-bind="click: $root.removeOne">删除</a></li>
                    </ul>
                  </div>                     
                </td>
              </tr>
              <!-- /ko -->
            </tbody>
          </table>
        </div>
        <footer class="panel-footer" data-bind="with: table, visible: table.pages() > 1">
				     <ul class="pagination">
				       <li data-bind="css: leftPagerClass, click: gotoPage(1)">
				         <a href="#">首页</a>
				       </li>
				       <li data-bind="css: leftPagerClass, click: prevPage">
				         <a href="#">&laquo;</a>
				       </li>
				       <li >
				         <a href="#"  data-bind="text: currentPage"></a>
				       </li>
				       <li data-bind="css: rightPagerClass, click: nextPage">
				         <a href="#">&raquo;</a>
				       </li>
				       <li data-bind="css: rightPagerClass, click: gotoPage(pages())">
				         <a href="#">末页</a>
				       </li>
				       <li class="page-control-li">
				         <div class="input-group form-group-sm">
				           <input type="text" class="form-control" data-bind="value: targetPage"  />
				           <div class="input-group-btn">
				             <a href="#" class="btn btn-sm btn-default" data-bind="click: gotoTargetPage()">跳转</a>
				           </div>
				         </div>
				         <div class="page-info-div" data-bind="text: recordsText"></div>
				       </li>
				     </ul>
				   </footer>


        <!-- 创建云主机弹窗 -->
        <div role="dialog" aria-hidden="true" id="modal_addvm" class="modal fade" data-bind="modal: { show: isAddvm }">
          <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>创建云主机</h3>
              </div>
              <div class='modal-body form-horizontal'>

                <div class="panel panel-default">
                  <div class="panel-heading">基本信息</div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label class="col-xs-1 control-label no-padder-h">云主机名称</label>
                      <div class="col-xs-2">
                        <input type="text" class="form-control" data-bind="value: currentVO().name" placeholder="请输入名称"/>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                      <label class="col-xs-1 control-label no-padder-h">所属VDC</label>
                      <div class="col-xs-2">
                      	<select class="form-control input-sm" data-bind="optionsCaption: '请选择VDC',value: currentVO().vdc, options: $root.add_vdcs, optionsText: 'name', optionsValue: 'uuid',event: {change: $root.onchange_add_vdcs}"></select>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                      <label class="col-xs-1 control-label no-padder-h">可用分区</label>
                      <div class="col-xs-2">
                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择分区', value: currentVO().partition, options: $root.add_partitions, optionsText: 'name', optionsValue: 'uuid',event: {change: $root.onchange_add_partitions}"></select>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-xs-1 control-label no-padder-h">CPU(个)</label>
                      <div class="col-xs-2">
                        <input type="text" maxlength="9" class="form-control" data-bind="value: currentVO().vcpu" placeholder="请输入CPU"/>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                      <label class="col-xs-1 control-label no-padder-h">内存(MB)</label>
                      <div class="col-xs-2">
                        <input type="text" maxlength="9" class="form-control" data-bind="value: currentVO().memory" placeholder="请输入内存"/>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                      <label class="col-xs-1 control-label no-padder-h">存储(GB)</label>
                      <div class="col-xs-2">
                        <input type="text" maxlength="9" class="form-control" data-bind="value: currentVO().storage" placeholder="请输入存储"/>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                    </div>
                    <div class="form-group">
                     <label class="col-xs-1 control-label no-padder-h">镜像</label>
                      <div class="col-xs-2">
                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择镜像',value: currentVO().image, options: $root.add_images, optionsText: 'imageName', optionsValue: 'imageId',event: {change: $root.onchange_add_images}"></select>
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                    </div>
                    <div id="add_vm_params_cnware" style="display:none;">
                    	<div class="form-group">
	                      <label class="col-xs-1 control-label no-padder-h">物理主机</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择物理主机',value: cnwareCurrentVO().host, options: $root.add_hosts_cn, optionsText: 'name', optionsValue: 'id',event: {change: $root.onchange_add_hosts_cn}"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                      <label class="col-xs-1 control-label no-padder-h">存储池</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择存储池',value: cnwareCurrentVO().storagePool, options: $root.add_storagePools_cn, optionsText: 'name', optionsValue: 'id',event: {change: $root.onchange_add_storagePools_cn}"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                    </div>
	                    <div class="form-group">
	                      <label class="col-xs-1 control-label no-padder-h">IP池</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择IP池',value: cnwareCurrentVO().ipPool, options: $root.add_ipPools_cn, optionsText: 'name', optionsValue: 'id',event: {change: $root.onchange_add_ipPools_cn}"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                      <label class="col-xs-1 control-label no-padder-h">IP</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择IP',value: cnwareCurrentVO().ip, options: $root.add_ips_cn, optionsText: 'name', optionsValue: 'id'"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                    </div>
                    </div>
                    <div id="add_vm_params_openstack" style="display:none;">
	                    <div class="form-group">
	                      <label class="col-xs-1 control-label no-padder-h">VPC</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择VPC',value: openstackCurrentVO().vpc, options: $root.add_vpcs, optionsText: 'name', optionsValue: 'uuid',event: {change: $root.onchange_add_vpcs}"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                      <label class="col-xs-1 control-label no-padder-h">网络名称</label>
	                      <div class="col-xs-2">
	                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择网络',value: openstackCurrentVO().network, options: $root.add_networks, optionsText: 'name', optionsValue: 'uuid',event: {change: $root.onchange_add_networks}"></select>
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm">*</span>
	                      </div>
	                      <label class="col-xs-1 control-label no-padder-h">指定IP</label>
	                      <div class="col-xs-2">
	                        <select class="form-control" data-bind="optionsCaption: '请选择IP',value: openstackCurrentVO().ip, options: $root.add_isIps, optionsText: 'ip', optionsValue: 'ip'">
	                        </select>
	                      </div>
	                       <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm"></span>
	                      </div>
	                    </div>
	                    <div class="form-group">
	                      <div id="resource_instance_vm_add_ssh_switch">
		                      <label class="col-xs-1 control-label no-padder-h">绑定密钥</label>
		                      <div class="col-xs-2">
		                        <select class="form-control" data-bind="value: openstackCurrentVO().isBind, options: $root.add_isBinds, optionsText: 'text', optionsValue: 'option', event: {change: $root.onchange_add_isBind}">
		                        </select>
		                      </div>
		                      <div class="col-xs-1">
		                        <span class="text-danger inline m-l-n m-t-sm">*</span>
		                      </div>
	                      </div>
	                      <div id="resource_instance_vm_add_ssh">
		                      <label class="col-xs-1 control-label no-padder-h">选择密钥</label>
		                      <div class="col-xs-2">
		                        <select class="form-control input-sm" data-bind="optionsCaption: '请选择密钥',value: openstackCurrentVO().sshKey, options: $root.add_sshKeys, optionsText: 'name', optionsValue: 'uuid'"></select>
		                      </div>
	                      </div>
                    	</div>
	                    <div class="form-group">
	                      <label class="col-xs-1 control-label no-padder-h">管理员密码</label>
	                      <div class="col-xs-2">
	                        <input type="password" class="form-control" data-bind="value: $root.adminPass" placeholder="请输入密码">
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm"></span>
	                      </div> 
	                      <label class="col-xs-1 control-label no-padder-h">重复密码</label>
	                      <div class="col-xs-2">
	                        <input type="password" class="form-control" data-bind="value: $root.adminPassReinput" placeholder="请输入密码">
	                      </div>
	                      <div class="col-xs-1">
	                        <span class="text-danger inline m-l-n m-t-sm"></span>
	                      </div>
	                    </div>
	                </div>
                    <div class="form-group">
                      <label class="col-xs-1 control-label no-padder-h">申请时长</label>
                      <div class="col-xs-10">
                        <label class="radio-inline" style="padding-top: 2px">
                          <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1" checked> 永久
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2" style="margin-top:10px"> 
                          <input type="text" class="form-control inline w-xxs" id="resource_instance_vm_limit_option2">
                          <select class="form-control inline w-xs" id="resource_instance_vm_limit_option2_unit">
                            <option value="MONTH">月</option>
                            <option value="YEAR">年</option>
                          </select>  
                        </label>
                        <label class="radio-inline">
                          <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="option3" style="margin-top:10px"> 有效期至
                          <input type="text" value="" class="form-control inline w" id="resource_instance_vm_limit_option3">
                        </label>                                    
                      </div>
                      <div class="col-xs-1">
                        <span class="text-danger inline m-l-n m-t-sm">*</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="panel panel-default">
                  <div class="panel-heading">
                    挂载云硬盘
                    <a href="#" class="pull-right" data-bind="click: $root.addAction">添加硬盘</a>
                  </div>
                  <div class="panel-body">
                    <table class="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th >云硬盘名称*</th>
                          <th >存储大小(GB)*</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody data-bind="foreach: diskItems">
                        <tr>
                          <td><input type="text" class="form-control input-sm" data-bind="value: volumeName" maxlength="32"/></td>
                          <td><input type="text" class="form-control input-sm" data-bind="value: volumeSize"/></td>
                          <td><a data-bind="click:$root.delAction">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <!-- <div class="panel panel-default">
                  <div class="panel-heading">
                    安装软件
                    <a href="#" class="pull-right">添加软件</a>
                  </div>
                  <div class="panel-body">
                    <table class="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>软件名称</th>
                          <th>软件分类</th>
                          <th>软件类型</th>
                          <th>软件版本</th>
                          <th>静默安装属性</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>oracle</td>
                          <td>数据库</td>
                          <td>oracle</td>
                          <td>10g企业版</td>
                          <td><a href="#">查看</a> | <a href="#">修改</a></td>
                          <td><a href="#">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div> -->
                <!-- <div class="panel panel-default">
                  <div class="panel-heading">
                    系统盘分区
                    <a href="#" class="pull-right">添加分区</a>
                  </div>
                  <div class="panel-body">
                    <table class="table table-striped table-hover">
                      <thead>
                        <tr>
                          <th>分区名称</th>
                          <th>分区大小</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>NFS</td>
                          <td>100G</td>
                          <td><a href="#">修改</a> | <a href="#">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div> -->
                <!-- <div class="panel panel-default">
                  <div class="panel-heading">高级选项</div>
                  <div class="panel-body">
                    <div class="form-group">
                      <label class="col-xs-3 control-label">所属业务系统</label>
                      <div class="col-xs-8">
                        <select class="form-control">
                          <option value="">VDC1</option>
                        </select>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-xs-3 control-label">备注</label>
                      <div class="col-xs-8">
                        <textarea cols="5" rows="5" class="form-control"></textarea>
                      </div>
                    </div>
                  </div>
                </div> -->
              </div>
              <div class='modal-footer' style="text-align:center;">
                <a class="btn btn-default btn-info" data-bind="click:initSave">确定</a>
                <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
              </div>
            </div>
          </div>
        </div>
        <!-- end -->

        <div role="dialog" aria-hidden="true" id="modal_edit_validate" class="modal fade" data-bind="modal: { show: isValidateTime }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
                <div class="form-group">
                  <label class="col-sm-3 control-label">有效期：</label>
                  <div class="col-sm-8">
                    <input type="text" value="" class="form-control inline w" id="resource_instance_vm_validate_edit" data-bind="value: validateTimeVO().time">
                  </div>
                </div>
              </div>
              <div class='modal-footer' style="text-align:center;">
                <a class="btn btn-default btn-info" data-bind="click: validateTime">确定</a>
                <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
              </div>
            </div>
          </div>
        </div>
        
        <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isVmAdjustment }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>调整资源</h3>
              </div>
              <div class='modal-body form-horizontal row'>
                <div class="form-group">
                  <label class="col-sm-3 control-label">名称：</label>
                  <div class="col-sm-8">
                    <input type="email" class="form-control" data-bind="value: adjustmentVO().name" disabled="disabled">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">VCPU数：</label>
                  <div class="col-sm-8">
                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().vcpu">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">内存(MB)：</label>
                  <div class="col-sm-8">
                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().memory">
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label">存储(GB)：</label>
                  <div class="col-sm-8">
                    <input type="email" maxlength="9" class="form-control" data-bind="value: adjustmentVO().storage">
                  </div>
                </div>
              </div>
              <div class='modal-footer' style="text-align:center;">
                <a class="btn btn-default btn-info" data-bind="click: adjust">确定</a>
                <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
              </div>
            </div>
          </div>
        </div>

      </div>
     <div id="resource_instance_index_vm_console" style="display:none;"></div> 
     
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isDeleteProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源删除</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>资源删除</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: deleteProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: deleteProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: deleteProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: deleteProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdjustProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content'>
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>资源变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>资源变更</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: adjustProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: adjustProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		            <table class="table">
			            <thead>
			              <tr>
			                <th></th>
			                <th>调整前</th>
			                <th>调整后</th>
			              </tr>
			            </thead>
			            <tbody>
			              <tr>
			                <td>CPU(个)</td>
			                <td data-bind="text: adjustProcessVO().vcpu"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetVcpu" /></td>
			              </tr>
			              <tr>
			                <td>内存(MB)</td>
			                <td data-bind="text: adjustProcessVO().memory"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetMemory"/></td>
			              </tr>
			              <tr>
			                <td>存储(GB)</td>
			                <td data-bind="text: adjustProcessVO().storage"></td>
			                <td><input class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetStorage"/></td>
			              </tr>
			            </tbody>
			         </table> 
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: adjustProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		          
		          <table class="table">
			            <thead>
			              <tr>
			                <th></th>
			                <th>调整前</th>
			                <th>调整后</th>
			              </tr>
			            </thead>
			            <tbody>
			              <tr>
			                <td>CPU(个)</td>
			                <td data-bind="text: adjustProcessVO().vcpu"></td>
			                <td><input maxlength="9" class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetVcpu" /></td>
			              </tr>
			              <tr>
			                <td>内存(MB)</td>
			                <td data-bind="text: adjustProcessVO().memory"></td>
			                <td><input maxlength="9" class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetMemory"/></td>
			              </tr>
			              <tr>
			                <td>存储(GB)</td>
			                <td data-bind="text: adjustProcessVO().storage"></td>
			                <td><input maxlength="9" class="form-control w-xxs input-sm" data-bind="value: adjustProcessVO().targetStorage"/></td>
			              </tr>
			            </tbody>
			         </table> 
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: adjustProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isValidateProcess }">
          <div class='modal-dialog modal-md'>
            <div class='modal-content' style="width:700px;">
              <div class='modal-header'>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>有效时间变更</h3>
              </div>
              <div class='modal-body form-horizontal row'>
		<div class='wrapper-md'>
<!-- 		    <div class="panel panel-info">
		        <div class="panel-heading">基本信息</div>
		        <div class="panel-body">
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>流程类型：</strong>有效时间变更</p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>流程状态：</strong><span class="label label-info">未提交</span></p>
		                </div>
		            </div>
		            <div class="row">
		                <div class="col-xs-6">
		                    <p><strong>申请人：<span data-bind="text: validateProcessVO().user"></span></strong></p>
		                </div>
		                <div class="col-xs-6">
		                    <p><strong>申请日期：<span data-bind="text: validateProcessVO().time"></span></strong></p>
		                </div>
		            </div>
		        </div>
		    </div> -->

		    <div class="panel panel-info">
		        <div class="panel-heading">申请信息</div>
		        <div id="orderDetailedList" class="wrapper">
		          <div class="row">
		            <div class="col-xs-6"><p>资源名称：<span data-bind="text: validateProcessVO().name"></span></p></div>
		            <div class="col-xs-6"><p>资源类型：云主机</p></div>
		          </div>
		          <div class="row">
		            <div class="col-xs-6"><p>调整前失效时间：<input type="text" value="" class="form-control inline w" data-bind="value: validateProcessVO().validateTime" disabled="disabled"></p></div>
		            <div class="col-xs-6"><p>调整后失效时间：<input type="text" value="" class="form-control inline w" id="resource_instance_vm_validate_process" data-bind="value: validateProcessVO().targetValidateTime"></p></div>
		          </div>
		        </div>
		    </div>
		</div>         
		</div>     
			<div class='modal-footer' style="text-align:center;">
              <a class="btn btn-default btn-info" data-bind="click: validateProcessPost">确定</a>
              <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
           </div>
       </div>
   </div>
</div>
<script type="text/javascript">
  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js"];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    function ViewModel_VM(){
    	//当前用户所辖VDC列表（包括VDC对应的可用分区信息）
      var vdcList = [];
    	//当前用户所辖可用分区列表
      var azList = [];
      var vdcListForAdd = [];
    	
    	
      var self = this;

      this.isVmAdjustment = ko.observable(false);

      this.isAddvm = ko.observable(false);
      
      this.isValidateTime = ko.observable(false);
      
      this.addvm = function(){
    	 //初始化公共参数
    	self.currentVO({
  			name: ko.observable().extend({required: true,cscNameRule:true,
				 validation: {
		                validator: function (val, someOtherVal) {
		                	if (val != null && val.length <= 32)
		                    {
		                        return true;
		                    }
		                    else
		                    {
		                        return false;
		                    }
		                },
		                message: '输入的字符数不能超过 32 个'
		            }
			}),
  			vdc: ko.observable().extend({required: true}),
  			partition: ko.observable().extend({required: true}),
  			image:  ko.observable().extend({required: true}),
  			vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
  			}),
  			memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
  			}),
  			storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
  			})
  	  	});
    	 
    	//初始化OpenStack参数
    	self.openstackCurrentVO({
			vpc: ko.observable().extend({required: true}),
			network: ko.observable().extend({required: true}),
			ip: ko.observable(),
			isBind: ko.observable(),
			sshKey: ko.observable(),
			adminPass: ko.observable(),
			adminPassReinput: ko.observable()
      	});
    	
    	//初始化CNware 参数
    	self.cnwareCurrentVO = ko.validatedObservable({
    		host: ko.observable().extend({required: true}),
    	    storagePool: ko.observable().extend({required: true}),
    	    ipPool: ko.observable().extend(),
    	    ip: ko.observable().extend()
      	});
    	
    	//初始化自定义参数
	    self.adminPass('');
	    self.adminPassReinput('');
    	
        self.isAddvm(true);
        $("#inlineRadio1").prop("checked",true);
      }

      $("#modal_addvm").on("shown.bs.modal",function(){

          // daterange             
          $('#resource_instance_vm_limit_option3').val(moment().format('YYYY/MM/DD')).daterangepicker(
            {
              format:'YYYY/MM/DD',
              minDate:moment(),
              singleDatePicker: true,
              locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                weekLabel: '周',
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              }
            }

          ); 

      })
	  //控制台
      this.console = function(object, event){
    	  csc.rest.get('api/v5.0.0/vms/'+object.uuid+'/vmConsole',function(data){
    		  if(data.consoleUrl){
    			  var consoleUrl = data.consoleUrl;
        		  //模拟点击
        		  $("#resource_instance_index_vm_console").html("<a id='resource_instance_index_vm_console_a' href='"+consoleUrl+"' target='_blank'></a>");
          		  $("#resource_instance_index_vm_console_a")[0].click();
    		  }
		  });
      }
      //启动
      this.startOne = function(object, event){
    		systemMsg.confirm("确定要启动云主机 "+object.name+"？",function(){
    			var startPutBody = {"operationType":"START"};
      			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('启动云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
      		});
      }
      //关机
      this.shutoffOne = function(object, event){
    	  systemMsg.confirm("确定要关闭云主机 "+object.name+"？",function(){
  			var startPutBody = {"operationType":"STOP"};
    			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('关闭云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
    		});
      }
      //重启
      this.restartOne = function(object, event){
    	  systemMsg.confirm("确定要重启云主机 "+object.name+"？",function(){
  			var startPutBody = {"operationType":"RESTART"};
    			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('重启云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
    		});
      }
      //强制重启
      this.restartForceOne = function(object, event){
    	  systemMsg.confirm("确定要强制重启云主机 "+object.name+"？",function(){
  			var startPutBody = {"operationType":"FORCERESTART"};
    			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('强制重启云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
    		});
      }
      //挂起
      this.suspend = function(object, event){
    	  systemMsg.confirm("确定要挂起云主机 "+object.name+"？",function(){
  			var startPutBody = {"operationType":"SUSPEND"};
    			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('挂起云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
    		});
      }
      //恢复（从挂起状态）
      this.resume = function(object, event){
    	  systemMsg.confirm("确定要恢复云主机 "+object.name+"？",function(){
  			var startPutBody = {"operationType":"RESUME"};
    			csc.rest.put('api/v5.0.0/vms/'+object.uuid,startPutBody,function(data){
			 		systemMsg.alert('恢复云主机请求成功，调度任务ID：'+data.taskId+'！');
			 		self.table.refreshData();
			    });
    		});
      }
      //删除
      this.removeOne = function(object, event){
    	  if(csc.util.isNotNull(object.serviceInstanceUuid)){
    		  //走流程
    		  self.doDeleteProcessPost(object);
    	  }else{
    		  //不走流程
	    	  systemMsg.confirm("确定要删除云主机 "+object.name+"？",function(){
	    			csc.rest.del('api/v5.0.0/vms/'+object.uuid,function(data){
				 		systemMsg.alert('删除云主机请求成功，调度任务ID：'+data.taskId+'！');
				 		self.table.refreshData();
				    });
	    		});
    	  }
      }
      
      //终止（服务实例）
      this.validate = function(object, event){
    	  systemMsg.confirm("确定要终止云主机 "+object.name+"？",function(){
    		var putBody = {"expiryDate":""};
  			csc.rest.put('api/v5.0.0/resourceInstances/'+object.uuid,putBody,function(data){
			 		systemMsg.alert('云主机终止成功！');
			 		self.table.refreshData();
			    });
  		});
      }
      //查询条件初始化
      this.searchParam = ko.observable({
        state: '',
        name: '',
        vdcUuid: '',
        azUuid: ''
      })
      
      //重置查询条件
      this.reset = function(){
    	  this.searchParam({
    	        state: '',
    	        name: '',
    	        vdcUuid: '',
    	        azUuid: ''
    	  })
    	  self.search();
      }
      
      this.search = function(){
        this.table.params(this.searchParam());
      }
      this.table = new DataTable([],{perPage:10});
      //获取可用分区数据
      this.partitions = ko.observableArray([]);
      this.loadPartitions = function(){
    	  csc.rest.get('api/v5.0.0/azs',function(data){
    		  if(data.results){
    			  azList = data.results;
    			  //为备选列表添加一个名为"全部"的选项
/*     			  var azUuids = "";
		    	  for(var i=0;i<azList.length;i++){
		    		  if(i == (azList.length-1)){
		    			  azUuids = azUuids + azList[i].uuid;
					  }else{
						  azUuids = azUuids + azList[i].uuid + ",";
					  }
		    	  } */
		    	  var azDef = {};
		    	  azDef.name = "全部";
		    	  azDef.azUuid = "";
		    	  azList.unshift(azDef);
    			  //self.reBandai();
    			  self.partitions(azList);
    		  }
    		  self.table.params(self.searchParam());
    		  self.table.path('api/v5.0.0/vms/list/byAccount');
    	  });
      }
      
      //获取VDC数据
      this.vdcs = ko.observableArray([]);
      this.loadVdcs = function(){
    	  csc.rest.get('api/v5.0.0/vdcs',function(data){
    		  if(data.results){
    			  vdcList = data.results;
    			  //为备选列表添加一个名为"全部"的选项
/*     			  var vdcUuids = "";
		    	  for(var i=0;i<vdcList.length;i++){
		    		  if(i == (vdcList.length-1)){
						  vdcUuids = vdcUuids + vdcList[i].uuid;
					  }else{
						  vdcUuids = vdcUuids + vdcList[i].uuid + ",";
					  }
		    	  } */
		    	  var vdcDef = {};
		    	  vdcDef.name = "全部";
		    	  vdcDef.vdcUuid = "";
				  vdcList.unshift(vdcDef);
    			  //self.reBandai();
    			  self.vdcs(vdcList);
    		  }
    		  self.loadPartitions();
    	  });
      }
      
      this.loadVdcs();
      
      /* //选择不同VDC后，可用分区下拉框要跟着改变
      this.onchange_vdcs = function(){
    	  var vdcUuid = self.searchParam().vdcUuid;
    	  for(var i=0;i<vdcList.length;i++){
    		  if(vdcList[i].uuid == vdcUuid){
    			  self.loadPartitions(vdcList[i].azs);
    		      self.table.params(self.searchParam());
    			  break;
    		  }
    	  }
      } */
      
      /* 为VDC和可用分区下拉框添加"全部"备选项
      "Well briefly, Sir, I am the Permanent Under Secretary of State, 
      known as the Permanent Secretary. 
      Woolley here is your Principal Private Secretary, 
      I too have a Principal Private Secretary and he is the Principal Private Secretary to the Permanent Secretary. 
      Directly responsible to me are 10 Deputy Secretaries, 
      87 Under Secretaries and 219 Assistant Secretaries. 
      Directly responsible to the Principal Private Secretary are plain Private Secretaries, 
      and the Prime Minister will be appointing 2 Parliamentary Under Secretaries and you will be appointing your own Parliamentary Private Secretary." */
      /* this.reBandai = function(){
		  var vdcUuids = "";
		  var azs = [];
    	  for(var i=0;i<vdcList.length;i++){
			  if(i == (vdcList.length-1)){
				  vdcUuids = vdcUuids + vdcList[i].uuid;
			  }else{
				  vdcUuids = vdcUuids + vdcList[i].uuid + ",";
			  }
			  azs.push(vdcList[i].azs);
			  var azList = [];
			  var azUuids = "";
			  if(vdcList[i].azs != null){
				  azList = vdcList[i].azs;
				  for(var j=0;j<azList.length;j++){
					  if(j == (azList.length-1)){
						  azUuids = azUuids + azList[j].uuid;
					  }else{
						  azUuids = azUuids + azList[j].uuid + ",";
					  }
				  }
			  }
			  var azDef = {"name":"全部","uuid":azUuids};
			  azList.unshift(azDef);
    	  }
    	  var vdcDef = {"name":"全部","uuid":vdcUuids,"azs":azs};
		  vdcList.unshift(vdcDef);
      } */

      //------------------------------------------创建开始------------------------------
      
      //初始化
      this.isAddvm = ko.observable(false);
      //公共参数
      this.currentVO = ko.validatedObservable({
    	  	name: ko.observable().extend({required: true,cscNameRule:true,
				 validation: {
		                validator: function (val, someOtherVal) {
		                	if (val != null && val.length <= 32)
		                    {
		                        return true;
		                    }
		                    else
		                    {
		                        return false;
		                    }
		                },
		                message: '输入的字符数不能超过 32 个'
		            }
			}),
			vdc: ko.observable().extend({required: true}),
			partition: ko.observable().extend({required: true}),
			image:  ko.observable().extend({required: true}),
			vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
			}),
			memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
			}),
			storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
			})
	  });
      
      //OpenStack参数
      this.openstackCurrentVO = ko.validatedObservable({
			vpc: ko.observable().extend({required: true}),
			network: ko.observable().extend({required: true}),
			ip: ko.observable(),
			isBind: ko.observable(),
			sshKey: ko.observable()
      });
      
      //CNware参数
      this.cnwareCurrentVO = ko.validatedObservable({
    	    host: ko.observable().extend({required: true}),
    	    storagePool: ko.observable().extend({required: true}),
    	    ipPool: ko.observable().extend(),
    	    ip: ko.observable().extend()
      });
      
      //自定义参数
      this.adminPass=ko.observable().extend({minLength:6});
      this.adminPassReinput=ko.observable().extend({equal: { params:this.adminPass ,onlyIf : this.adminPass, message :
      	(function(_this){  
				return function(){
					if(_this.adminPassReinput()!=null && _this.adminPassReinput()!=""){
						 return "密码不一致";
					}else if(_this.adminPass() !=null && _this.adminPass() !=""){
						return  "请再次输入密码";
					}
				} 
		    })(this)
	  }});
      
      //是否绑定
      this.add_isBinds = ko.observableArray([]);
      this.isBinds_def = function(){
    	  var bindList = [];
    	  bindList.push({text:"是",option:"YES"})
    	  bindList.push({text:"否",option:"NO"});
    	  self.add_isBinds(bindList);
      }
      this.isBinds_def();
      
      //是否绑定->SSH
      this.onchange_add_isBind = function(){
    	  if(this.openstackCurrentVO().isBind() == "YES"){
    		  $("#resource_instance_vm_add_ssh").show();
    	  }else{
    		  $("#resource_instance_vm_add_ssh").hide();
    	  }
      }
      
      //VDC
      this.add_vdcs = ko.observableArray([]);
      this.add_vdcs_def = function(){
    	  csc.rest.get('api/v5.0.0/vdcs',function(data){
    		  if(data.results){
    			  vdcListForAdd = data.results;
		    	  self.add_vdcs(vdcListForAdd);
    		  }
    	  });
      }
      this.add_vdcs_def();
      
      //VDC->可用分区
      this.onchange_add_vdcs = function(){
    	  var vdcUuid = self.currentVO().vdc();
    	  csc.rest.get('api/v5.0.0/vdcs/'+vdcUuid+'/azs',function(data){
    		  if(data.results){
		    	  self.add_partitions(data.results);
    		  }
    	  });
      }
      
      //可用分区
      this.add_partitions = ko.observableArray([]);
      
      var cloudPlatform = "";
      //可用分区->镜像 + vpc + ip池
      this.onchange_add_partitions = function(){
    	  $("#add_vm_params_openstack").hide();
    	  $("#add_vm_params_cnware").hide();
    	  var azUuid = self.currentVO().partition();
    	  csc.rest.get('api/v5.0.0/azs/'+azUuid,function(azData){
    		  cloudPlatform = azData.cloudPlatform;
    		  //根据可用分区虚拟化平台不同展示不同参数
    		  if(cloudPlatform == "OpenStack"){
    			  $("#add_vm_params_openstack").show();
            	  self.add_vpcs_def();
        	  }else if(cloudPlatform == "CNware"){
        		  $("#add_vm_params_cnware").show();
        		  self.add_ipPools_def_cn();
        	  }
    	  });
    	  self.add_images_def();
      }
      
      //镜像
      var images = [];
      this.add_images = ko.observableArray([]);
      this.add_images_def = function(){
    	  var azUuid = self.currentVO().partition();
    	  csc.rest.get('api/v5.0.0/images?azUuid='+azUuid,function(data){
    		  images = data.results;
    		  self.add_images(data.results);
    	  });
      }
      
      var chosenImage = {};
      //镜像-> SSH + 物理主机
      this.onchange_add_images = function(){
    	  var imageId = self.currentVO().image();
    	  for(var i=0;i<images.length;i++){
    		  if(images[i].imageId == imageId){
		    	  chosenImage = images[i];
    			  break;
    		  }
    	  }
    	  //根据不同云管理平台处理不同事务
    	  if(cloudPlatform == "OpenStack"){
    		  self.add_sshKeys_def();
    	  }else if(cloudPlatform == "CNware"){
    		  //填写模板推荐的资源数值
    		  self.currentVO().vcpu(chosenImage.vcpu);
	    	  self.currentVO().memory(chosenImage.memory);
	    	  self.currentVO().storage(chosenImage.minDisk);
/* 	    	  console.log(chosenImage);
	    	  return; */
    		  self.add_hosts_def_cn();
    	  }
      }
      
      //SSH
      this.add_sshKeys = ko.observableArray([]);
      this.add_sshKeys_def = function(){
    	  var azUuid = self.currentVO().partition();
    	  var chosenImageOs = chosenImage.opSysType;
    	  if("windows" == chosenImageOs){
    		  //windows类型的操作系统对应镜像不用设置ssh密钥
    		  $("#resource_instance_vm_add_ssh_switch").hide();
    		  $("#resource_instance_vm_add_ssh").hide();
    	  }else{
    		  $("#resource_instance_vm_add_ssh_switch").show();
    		  $("#resource_instance_vm_add_ssh").show();
	    	  csc.rest.get('api/v5.0.0/sshKeys?byCurrentUser=true&isValidate=true&azUuid='+azUuid,function(data){
	    		  self.add_sshKeys(data.results);
	    	  });
    	  }
      }
      
      
      //----------------------------CNware-STD
      
      //物理主机
      this.add_hosts_cn = ko.observableArray([]);
      this.add_hosts_def_cn = function(){
    	  var imageId = self.currentVO().image();
    	  if(csc.util.isNotNull(imageId)){
	    	  // 根据所选镜像获取可部署的目标物理主机
	    	  var azUuid = self.currentVO().partition();
	    	  csc.rest.get('api/v5.0.0/images/targetHosts?azUuid='+azUuid+'&imageId='+imageId,function(hostData){
		    	  self.add_hosts_cn(hostData.results);
	    	  });
    	  }else{
    		  self.add_hosts_cn([]);
    	  }
      }
      
      //物理主机 -> 存储池
      this.onchange_add_hosts_cn = function(){
    	  self.add_storagePools_def_cn();
      }
      
      //存储池
      this.add_storagePools_cn = ko.observableArray([]);
      this.add_storagePools_def_cn = function(){
    	  var hostId = self.cnwareCurrentVO().host();
    	  if(csc.util.isNotNull(hostId)){
	    	  var azUuid = self.currentVO().partition();
	    	  csc.rest.get('api/v5.0.0/storagePools/targetStoragePools?azUuid='+azUuid+'&hostId='+hostId,function(storagePoolData){
		    	  //根据所选物理主机获取可使用的目标存储池
		    	  self.add_storagePools_cn(storagePoolData.results);
	    	  });
    		  
    	  }else{
    		  self.add_storagePools_cn([]);
    	  }
      }
      this.onchange_add_storagePools_cn = function(){
      }
      
      //IP池
      this.add_ipPools_cn = ko.observableArray([]);
      this.add_ipPools_def_cn = function(){
    	  //TODO 根据可用分区获取IP池列表
    	  self.add_ipPools_cn([]);
      }
      
      //IP池 -> IP地址
      this.onchange_add_ipPools_cn = function(){
    	  self.add_ips_def_cn();
      }
      
      //IP地址
      this.add_ips_cn = ko.observableArray([]);
      this.add_ips_def_cn = function(){
    	  //TODO 根据IP池获取IP列表
    	  self.add_ips_cn([]);
      }
      
      //----------------------------CNware-END
      
      //----------------------------OpenStack-STD
      //VPC
      this.add_vpcs = ko.observableArray([]);
      this.add_vpcs_def = function(){
    	  var vdcUuid = self.currentVO().vdc();
    	  var azUuid = self.currentVO().partition();
    	  csc.rest.get('api/v5.0.0/vpcs?vdcUuid='+vdcUuid+'&azUuid='+azUuid,function(data){
    		  self.add_vpcs(data.results);
    	  });
      }
      var network = [];
      //VPC->网络
      this.onchange_add_vpcs = function(){
    	  var vpcUuid = self.openstackCurrentVO().vpc();
    	  csc.rest.get('api/v5.0.0/vpcNetworks?type=INNER&vpcUuid='+vpcUuid,function(data){
    		  network = data.results;
    		  self.add_networks(data.results);
    	  });
      }
      
      //网络
      this.add_networks = ko.observableArray([]);
      
      //网络->IP
      this.onchange_add_networks = function(){
    	  var networkUuid = self.openstackCurrentVO().network();
    	  if(csc.util.isNotNull(networkUuid)){
    		  csc.rest.get('api/v5.0.0/vpcNetworks/'+networkUuid+'/availableIp',function(data){
        		  self.add_isIps(data);
        	  });
    	  }else{
    		  self.add_isIps([]);
    	  }
      }
      //选择IP
      this.add_isIps = ko.observableArray([]);
      
      //----------------------------OpenStack-END
      
      //提交创建
      this.save = function(postBody){
    	  	//通用参数
	    	  postBody.name = self.currentVO().name();
	    	  postBody.vdcUuid = self.currentVO().vdc();
	    	  postBody.azUuid = self.currentVO().partition();
	    	  postBody.imageUuid = self.currentVO().image();
	    	  postBody.vcpu = self.currentVO().vcpu();
	    	  postBody.memory = self.currentVO().memory();
	    	  postBody.storage = self.currentVO().storage();
	    	  var expiryTime = "";
	    	  var temp = document.getElementsByName("inlineRadioOptions");
	    	  for(var i=0;i<temp.length;i++)
	    	  {
	    	     if(temp[i].checked){
	    	    	 if(temp[i].value == "option1"){
	    	    		 expiryTime = "2099-12-30 23:59:59";
	    	    	 }else if(temp[i].value == "option2"){
	    	    		 if($("#resource_instance_vm_limit_option2_unit").val() == "MONTH"){
	    	    			 var plusMonth = parseInt($("#resource_instance_vm_limit_option2").val());
	    	    			 var dd = new Date();
	    	    			 var y = dd.getFullYear(); 
	    	    			 var m = dd.getMonth()+1+plusMonth;//获取当前月份的日期 
	    	    			 var selfM = dd.getMonth()+1;
	    	    			 var d = dd.getDate();
	    	    			 y = y + parseInt(m/12);
	    	    			 m = m%12;
	    	    			 if(m == 0){
	    	    				 m = selfM;
	    	    			 }
	    	    		 }else if($("#resource_instance_vm_limit_option2_unit").val() == "YEAR"){
	    	    			 var plusYear = parseInt($("#resource_instance_vm_limit_option2").val());
	    	    			 var dd = new Date();
	    	    			 var y = dd.getFullYear(); 
	    	    			 var m = dd.getMonth()+1;//获取当前月份的日期 
	    	    			 var d = dd.getDate();
	    	    			 y = y + plusYear;
	    	    		 }
	    	    		 expiryTime = y+"-"+m+"-"+d+" 23:59:59";
	    	    	 }else{
	    	    		 var timeStr = $("#resource_instance_vm_limit_option3").val();
	    	    		 expiryTime = $.trim(timeStr) + " 23:59:59";
	    	    	 }
	    	     }
	    	  }
	    	  postBody.expiryTime = expiryTime;
	    	  postBody.diskList = [];
	    	  postBody.diskList = ko.toJS(self.diskItems());
	    	  var isDiskPass = true;
	    	  for(var i=0;i<postBody.diskList.length;i++){
	    		  var name = postBody.diskList[i].volumeName.trim();
	    		  var size = postBody.diskList[i].volumeSize.trim();
	    		  if(csc.util.isNull(name) || csc.util.isNull(size)){
	    			  isDiskPass = false;
	    			  break;
	    		  }
	    	  }
	    	  
	    	  if(!isDiskPass){
	    		  systemMsg.alert('云硬盘信息缺失，请检查！');
	    		  return;
	    	  }
	    	  csc.rest.post('api/v5.0.0/vms',postBody,function(data){
			 		systemMsg.alert('创建云主机请求成功，任务ID：'+data.taskId+'！');
			 		self.isAddvm(false);
		        	self.table.refreshData();
			  });
      }
      
      //准备提交参数
      this.initSave = function(){
    	  
    	  //初始化提示信息
    	  ko.validation.group(this.currentVO).showAllMessages();
    	  ko.validation.group(this.openstackCurrentVO).showAllMessages();
    	  ko.validation.group(this.cnwareCurrentVO).showAllMessages();
    	  
    	  if(cloudPlatform == "OpenStack"){
    		  if(self.openstackCurrentVO.isValid() && self.currentVO.isValid() && self.adminPassReinput.isValid() && self.adminPass.isValid()){
    			  var postBody = {};
    			  //vpc
    			  postBody.vpcUuid = self.openstackCurrentVO().vpc();
    			  //network
    	    	  var networkList= [];
    	    	  var networkInfo = {};
    	    	  if(csc.util.isNotNull(self.openstackCurrentVO().ip())){
    	    		  for(var n=0;n<network.length;n++){
    	    			  if(network[n].uuid == self.openstackCurrentVO().network()){
    	    				  networkInfo.subNetworkId = network[n].originalSubId;
    	    				  break;
    	    			  }
    	    		  }
    	    		  networkInfo.ip = self.openstackCurrentVO().ip();
    	    	  }
    		      networkInfo.networkId = self.openstackCurrentVO().network();
    		      networkList.push(networkInfo);
    		      postBody.networkList = networkList;
    		      //ssh
    	    	  postBody.sshKeyUuid = self.openstackCurrentVO().sshKey();
    	    	  //设置admin用户的密码
    	    	  if(csc.util.isNotNull(self.adminPass())){
    				  postBody.adminPass = self.adminPass().trim();
    	    	  }
    		      self.save(postBody);
    		  }
    	  }else if(cloudPlatform == "CNware"){
    		  if(self.cnwareCurrentVO.isValid() && self.currentVO.isValid()){
    			  var postBody = {};
    			  //host
    			  postBody.hostPlatformId = self.cnwareCurrentVO().host();
    			  //network
    			  var networkList= [];
    	    	  var networkInfo = {};
    	    	  if(csc.util.isNotNull(self.cnwareCurrentVO().ip())){
    	    		  networkInfo.ip = self.cnwareCurrentVO().ip();
    	    	  }
    	    	  networkList.push(networkInfo);
    	    	  postBody.networkList = networkList;
    	    	  //storagePool
    	    	  postBody.storagePoolPlatformId = self.cnwareCurrentVO().storagePool();
    	    	  self.save(postBody);
    		  }
    	  }
    	  
      }
      //------------------------------------------创建结束------------------------------
      
      //------------------------------------------调整配置开始------------------------------
      this.adjustmentVO = ko.validatedObservable({
    	  vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  vmUuid: ko.observable(),
    	  name: ko.observable()
      });
      
      this.vmAdjustment = function(object, event){
    	  if(csc.util.isNotNull(object.serviceInstanceUuid)){
    		  //走流程
    		  self.doAdjustProcessPost(object);
    	  }else{
    		  //不走流程
	          self.isVmAdjustment(true);
	          self.adjustmentVO().vcpu(object.vcpu);
	          self.adjustmentVO().memory(object.memory);
	          self.adjustmentVO().storage(object.storage);
	          self.adjustmentVO().vmUuid(object.uuid);
	          self.adjustmentVO().name(object.name);
    	  }
      };
      
      //调整资源
      this.adjust = function(){
    	  ko.validation.group(this.adjustmentVO).showAllMessages();
    	  if(self.adjustmentVO.isValid()){
	    	  var putBody = {};
	    	  putBody.operationType = "RESIZE";
	    	  putBody.vcpu = self.adjustmentVO().vcpu();
	    	  putBody.memory = self.adjustmentVO().memory();
	    	  putBody.storage = self.adjustmentVO().storage();
	    	  csc.rest.put('api/v5.0.0/vms/'+self.adjustmentVO().vmUuid(),putBody,function(data){
			 		systemMsg.alert('云主机调整资源请求成功，调度任务ID：'+data.taskId+'！');
			 		self.isVmAdjustment(false);
			 		self.table.refreshData();
			  });
    	  }
      }
      //------------------------------------------调整配置结束------------------------------
      
      //------------------------------------------云硬盘列表开始----------------------------
      this.diskItems = ko.observableArray();
      //增加一条数据
      function PerDisk(){
        this.volumeName = ko.observable("");
        this.volumeSize = ko.observable("");
      };
      this.addAction = function(){
    	  this.diskItems.push(new PerDisk());
      }
      //删除数据
      this.delAction = function(){
        //调用删除接口，成功后回调以下方法
        self.diskItems.remove(this);
      }
      
      //------------------------------------------云硬盘列表结束----------------------------
      
      //------------------------------------------修改有效期开始----------------------------
      //modal_edit_validate
      $("#modal_edit_validate").on("shown.bs.modal",function(){
		  
          // daterange             
          $('#resource_instance_vm_validate_edit').val(self.validateTimeVO().time()).daterangepicker(
            {
              format:'YYYY/MM/DD',
              minDate:moment(),
              singleDatePicker: true,
              locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                weekLabel: '周',
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              }
            }

          ); 

      })
      this.validateTimeVO = ko.validatedObservable({
    	  metaTime: ko.observable(),
    	  time: ko.observable(),
    	  uuid: ko.observable()
      });
      
      this.editValidateTime = function(object, event){
    	  if(csc.util.isNotNull(object.serviceInstanceUuid)){
    		  //走流程
    		  self.doValidateProcessPost(object);
    	  }else{
    		  //不走流程
	    	  self.isValidateTime(true);
	    	  self.validateTimeVO().uuid(object.uuid);
	    	  self.validateTimeVO().metaTime(object.expiryTime);
	    	  self.validateTimeVO().time(object.expiryTime);
    	  }
      }
      
      //修改有效期
      this.validateTime = function(){
    	  var putBody = {};
    	  putBody.expiryDate = self.validateTimeVO().time() + " 23:59:59";
    	  //检查日期相同不发送请求，直接关闭页面
    	  if(self.validateTimeVO().metaTime() == self.validateTimeVO().time()){
    		  self.isValidateTime(false);
    		  return;
    	  }
    	  csc.rest.put('api/v5.0.0/resourceInstances/'+self.validateTimeVO().uuid(),putBody,function(data){
		 		systemMsg.alert('云主机修改有效期成功！');
		 		self.isValidateTime(false);
		 		self.table.refreshData();
		  });
      }
      //------------------------------------------修改有效期结束----------------------------
      
      //------------------------------------------删除-流程开始--------------------------------
      this.isDeleteProcess = ko.observable(false);
      
      this.doDeleteProcessPost = function(object){
    	  self.isDeleteProcess(true);
		  self.deleteProcessVO().name(object.name);
		  self.deleteProcessVO().uuid(object.uuid);
		  self.deleteProcessVO().vdcUuid(object.vdcUuid);
		  self.deleteProcessVO().vdcName(object.vdcName);
		  self.deleteProcessVO().azUuid(object.azUuid);
		  self.deleteProcessVO().azName(object.azName);
		  self.deleteProcessVO().vpcName(object.vpcName);
		  self.deleteProcessVO().vcpu(object.vcpu);
		  self.deleteProcessVO().memory(object.memory);
		  self.deleteProcessVO().storage(object.storage);
		  self.deleteProcessVO().expiryDate(object.expiryDate);
		  self.deleteProcessVO().ip(object.ip);
		  var myDate = new Date();
		  self.deleteProcessVO().time(myDate.toLocaleString());
		  self.deleteProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
      }
  
      this.deleteProcessVO = ko.observable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  vdcUuid: ko.observable(),
    	  vdcName: ko.observable(),
    	  azUuid: ko.observable(),
    	  azName: ko.observable(),
    	  vpcName: ko.observable(),
    	  vcpu: ko.observable(),
    	  memory: ko.observable(),
    	  storage: ko.observable(),
    	  expiryDate: ko.observable(),
    	  ip: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  serviceInstanceUuid: ko.observable()
      });
      
      this.deleteProcessPost = function(){
    		  csc.rest.get("api/v5.0.0/volumes?vmUuid="+self.deleteProcessVO().uuid(),function(volumeData){
            	  var orderItem = {};
            	  orderItem.instanceName = self.deleteProcessVO().name();
            	  orderItem.serviceInstanceUuid = self.deleteProcessVO().serviceInstanceUuid();
            	  orderItem.resourceType = "VM";
            	  orderItem.metaData =  "{\"resBaseInfo\": {\"vpc\": \""+self.deleteProcessVO().vpcName()+"\",\"cpu\": \""+self.deleteProcessVO().vcpu()+"\",\"memory\": \""+self.deleteProcessVO().memory()+"\",\"storage\": \""+self.deleteProcessVO().storage()+"\",\"ip\": \""+self.deleteProcessVO().ip()+"\",\"expireTime\": \""+self.deleteProcessVO().expiryDate()+"\"}}";
            	  orderItem.resourceUuid = self.deleteProcessVO().uuid();
            	  orderItem.vdcUuid = self.deleteProcessVO().vdcUuid();
            	  orderItem.vdcName = self.deleteProcessVO().vdcName();
            	  orderItem.azUuid = self.deleteProcessVO().azUuid();
            	  orderItem.azName = self.deleteProcessVO().azName();
            	  
            	  var orderItems = [];
            	  orderItems.push(orderItem);
            	  if(volumeData.results){
            		  var volumes = volumeData.results;
                	  for(var i=0;i<volumes.length;i++){
                		  var volumeItem = {};
                		  volumeItem.instanceName = volumes[i].volumeName;
                		  volumeItem.serviceInstanceUuid = volumes[i].serviceInstanceUuid;
                		  volumeItem.resourceType = "DISK";
                		  volumeItem.metaData =  "{\"resBaseInfo\": {\"type\": \"DISK\",\"size\": \""+volumes[i].volumeSize+"\",\"storageName\": \""+volumes[i].storagePoolName+"\"}}";
                		  volumeItem.vdcUuid = volumes[i].vdcUuid;
                		  volumeItem.azUuid =  volumes[i].azUuid;
                		  orderItems.push(volumeItem);
                	  }
            	  }
            	  
            	  var postBody = {}; 
            	  postBody.resourceType = "VM";
            	  postBody.vdcUuid = self.deleteProcessVO().vdcUuid();
            	  postBody.orderItems = orderItems;
            	  
            	  csc.rest.post("api/v5.0.0/orders/deleteResource",postBody,function(data){
            		  if(data.taskId){
            			systemMsg.alert('删除资源请求成功，任务ID：' + data.taskId + '！');
            		  }else if(data.code){
            			systemMsg.alert('删除资源申请成功，订单编号：' + data.code + '！');
            		  }
          		 	  self.isDeleteProcess(false);
            	  });
    		  });
      }
      
      //------------------------------------------删除-流程结束--------------------------------
      
      //------------------------------------------资源变更-流程开始--------------------------------
	  this.isAdjustProcess = ko.observable(false);
      
      this.doAdjustProcessPost = function(object){
    	  self.isAdjustProcess(true);
		  self.adjustProcessVO().name(object.name);
		  self.adjustProcessVO().uuid(object.uuid);
		  self.adjustProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
		  var myDate = new Date();
		  self.adjustProcessVO().time(myDate.toLocaleString());
		  
		  self.adjustProcessVO().vcpu(object.vcpu);
		  self.adjustProcessVO().memory(object.memory);
		  self.adjustProcessVO().storage(object.storage);
		  
		  self.adjustProcessVO().targetVcpu('');
		  self.adjustProcessVO().targetMemory('');
		  self.adjustProcessVO().targetStorage('');
		  
		  self.adjustProcessVO().vdcUuid(object.vdcUuid);
		  self.adjustProcessVO().vdcName(object.vdcName);
		  self.adjustProcessVO().azUuid(object.azUuid);
		  self.adjustProcessVO().busSysName(object.busSysName);
      }
  
      this.adjustProcessVO = ko.validatedObservable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  serviceInstanceUuid: ko.observable(),
    	  
    	  vcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  memory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  storage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  
    	  targetVcpu: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  targetMemory: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  targetStorage: ko.observable().extend({required: true,
				min: { params: 1, message: "请输入大于1的整数" }
		  }),
    	  
    	  vdcUuid: ko.observable(),
    	  vdcName: ko.observable(),
    	  azUuid: ko.observable(),
    	  busSysName: ko.observable()
      });
      
      //申请
      this.adjustProcessPost = function(){
    	  ko.validation.group(this.adjustProcessVO).showAllMessages();
    	  if(self.adjustProcessVO.isValid()){
    		  var metaData = "{\"resBaseInfo\":{\"vcpu\": \""+self.adjustProcessVO().targetVcpu()+"\",\"memory\": \""+self.adjustProcessVO().targetMemory()+"\",\"storage\": \""+self.adjustProcessVO().targetStorage()
    		  +"\",\"metaVcpu\": \""+self.adjustProcessVO().vcpu()+"\",\"metaMemory\": \""+self.adjustProcessVO().memory()+"\",\"metaStorage\": \""+self.adjustProcessVO().storage()
    		  +"\",\"vdcName\": \""+self.adjustProcessVO().vdcName()+"\",\"busSysName\": \""+self.adjustProcessVO().busSysName()+"\"}}";
    	  
	    	  var orderItem = {};
	    	  orderItem.instanceName = self.adjustProcessVO().name();
	    	  orderItem.serviceInstanceUuid = self.adjustProcessVO().serviceInstanceUuid();
	    	  orderItem.resourceType = "VM";
	    	  orderItem.metaData = metaData;
	    	  orderItem.resourceUuid = self.adjustProcessVO().uuid();
	    	  orderItem.vdcUuid = self.adjustProcessVO().vdcUuid();
	    	  orderItem.azUuid = self.adjustProcessVO().azUuid();
	    	  
	    	  var orderItems = [];
	    	  orderItems.push(orderItem);
	    	  
	    	  var postBody = {};
	    	  postBody.resourceType = "VM";
	    	  postBody.type = "RESOURCE_CHANGE";
	    	  postBody.vdcUuid = self.adjustProcessVO().vdcUuid();
	    	  postBody.azUuid = self.adjustProcessVO().azUuid();
	    	  postBody.orderItems = orderItems;
	    	  
	    	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
	    		  if(data.code){
	    			systemMsg.alert('资源变更申请成功，订单编号：'+data.code+'！');
	  		 		self.isAdjustProcess(false);
	    		  }
	    	  });
    	  }
      }
      //------------------------------------------资源变更-流程结束--------------------------------
      
      //------------------------------------------有效期-流程开始--------------------------------
	  this.isValidateProcess = ko.observable(false);
      
      this.doValidateProcessPost = function(object){
    	  self.isValidateProcess(true);
		  self.validateProcessVO().name(object.name);
		  self.validateProcessVO().uuid(object.uuid);
		  self.validateProcessVO().vdcUuid(object.vdcUuid);
		  self.validateProcessVO().vdcName(object.vdcName);
		  self.validateProcessVO().azUuid(object.azUuid);
		  self.validateProcessVO().busSysName(Object.busSysName);
		  self.validateProcessVO().serviceInstanceUuid(object.serviceInstanceUuid);
		  var myDate = new Date();
		  self.validateProcessVO().time(myDate.toLocaleString());
		  self.validateProcessVO().metaTime(object.expiryTime);
		  
		  self.validateProcessVO().validateTime(object.expiryTime);
		  self.validateProcessVO().targetValidateTime("");
		  
		  $('#resource_instance_vm_validate_process').val(moment().format('YYYY/MM/DD')).daterangepicker(
		            {
		              format:'YYYY/MM/DD',
		              minDate:moment(),
		              singleDatePicker: true,
		              locale:{
		                applyLabel: '确认',
		                cancelLabel: '取消',
		                weekLabel: '周',
		                daysOfWeek:["日","一","二","三","四","五","六"],
		                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
		              }
		            }
		  ); 
      }
  
      this.validateProcessVO = ko.observable({
    	  name: ko.observable(),
    	  uuid: ko.observable(),
    	  metaTime: ko.observable(),
    	  time: ko.observable(),
    	  user: ko.observable(),
    	  vdcUuid: ko.observable(),
    	  vdcName: ko.observable(),
    	  azUuid: ko.observable(),
    	  busSysName: ko.observable(),
    	  serviceInstanceUuid: ko.observable(),
    	  validateTime: ko.observable(),
    	  targetValidateTime: ko.observable()
      });
      
      //申请
      this.validateProcessPost = function(){
    	  //检查日期相同的，不发送请求直接关闭页面
    	  if(self.validateProcessVO().metaTime() == self.validateProcessVO().targetValidateTime()){
    		  self.isValidateProcess(false);
    		  return;
    	  }
    	  var metaData = "{\"resBaseInfo\":{\"metaExpireTime\":\""+self.validateProcessVO().metaTime() +"\",\"vdcName\": \""+self.validateProcessVO().vdcName()+"\",\"busSysName\":\""+self.validateProcessVO().busSysName()+"\"}}";
    	  var orderItem = {};
    	  orderItem.instanceName = self.validateProcessVO().name();
    	  orderItem.serviceInstanceUuid = self.validateProcessVO().serviceInstanceUuid();
    	  orderItem.expireTime = self.validateProcessVO().targetValidateTime() + " 23:59:59";
    	  orderItem.resourceType = "VM";
    	  orderItem.resourceUuid = self.validateProcessVO().uuid();
    	  orderItem.metaData = metaData;
    	  orderItem.vdcUuid = self.validateProcessVO().vdcUuid();
    	  orderItem.azUuid = self.validateProcessVO().azUuid();
    	  
    	  var orderItems = [];
    	  orderItems.push(orderItem);
    	  
    	  var postBody = {};
    	  postBody.resourceType = "VM";
    	  postBody.type = "VALIDTIME_CHANGE";
    	  postBody.vdcUuid = self.validateProcessVO().vdcUuid();
    	  postBody.azUuid = self.validateProcessVO().azUuid();
    	  postBody.orderItems = orderItems;
    	  
    	  csc.rest.post("api/v5.0.0/orders/changeResource",postBody,function(data){
    		  if(data.code){
    			systemMsg.alert('有效时间变更申请成功，订单编号：'+data.code+'！');
  		 		self.isValidateProcess(false);
    		  }
    	  });
      }
      //------------------------------------------有效期-流程结束--------------------------------
    }
    ko.applyBindings(new ViewModel_VM(), $('#partition_vms')[0]);
  })
</script>