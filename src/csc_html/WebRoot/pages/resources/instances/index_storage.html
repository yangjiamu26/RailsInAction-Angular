<div class='panel panel-default'>
  <div class="row wrapper">
    <div class="col-xs-1">
      <button class="btn btn-sm btn-primary" data-bind="click: addvdisk">创建</button>
    </div>
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">所属VDC</span>
        <select class="form-control input-sm" data-bind="value: searchParam().vdcUuid, options: $root.vdcs, optionsText: 'name', optionsValue: 'id'"></select>
      </div>      
    </div>  
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">所属可用分区</span>
        <select class="form-control input-sm" data-bind="value: searchParam().azUuid, options: $root.azUuids, optionsText: 'name', optionsValue: 'id'"></select>
      </div>      
    </div>
                                      
    <div class="col-xs-3">
      <div class="input-group">
        <span class="input-group-addon">名称</span>
        <input type="text" class="input-sm form-control" placeholder="请输入名称" data-bind="value: searchParam().volumeNameLike">
      </div>
    </div>
    <div class="col-xs-2">
      <button class="btn btn-sm" type="button" data-bind="click: reset">重置</button>
      <button class="btn btn-sm btn-default" type="button" data-bind="click: search">搜索</button>
    </div>
  </div>                      
  <div id='instance_storages'>
    <div class='table-responsive' data-bind="with: table">
      <table class='table table-striped'>
        <thead>
          <tr>
            <th>云硬盘名称</th>
            <th>所属可用分区</th>
            <th>所属VDC</th>
            <th>所属VPC</th>
            <th>大小(单位：G)</th>
            <th>状态</th>
            <th>关联云主机</th>
            <th>路径</th>
            <!-- <th>是否共享</th> -->
            <th>创建人</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr data-bind="visible: showNoData">
            <td colspan=11 class="aligncenter">
              This table has no data.
            </td>
          </tr>
          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
          <tr>
            <td data-bind="text:volumeName"></td>
            <td data-bind="text:azName"></td>
            <td data-bind="text:vdcName"></td>
            <td data-bind="text:vpcName"></td>
            <td data-bind="text:volumeSize"></td>
            <td data-bind="text:volumeStatus"></td>
            <td data-bind="text:hostUuid"></td>
            <td data-bind="text:path"></td>
            <!-- <td data-bind=""></td> -->
            <td data-bind="text:userName"></td>
            <td><a href="#" data-bind="click: $root.storageExpand">扩展</a> | <a data-bind="click: $root.removeOne">删除</a></td>
          </tr>
          <!-- /ko -->
        </tbody>
      </table>
    </div>
    <footer class="panel-footer" data-bind="with: table, visible: table.pages() > 1">
      <ul class="pagination">
        <li data-bind="css: leftPagerClass, click: prevPage">
          <a href="#">&laquo;</a>
        </li>
        <!-- ko foreach: {data: (new Array(pages()))} -->
        <li data-bind="css: $parent.pageClass($index() + 1)">
          <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
        </li>
        <!-- /ko -->
        <li data-bind="css: rightPagerClass, click: nextPage">
          <a href="#">&raquo;</a>
        </li>
      </ul>
    </footer>

    <!-- 创建云硬盘弹窗 -->
    <div role="dialog" aria-hidden="true" id="modal_addvdisk" class="modal fade" data-bind="modal: { show: isAddvdisk }">
      <div class='modal-dialog'>
        <div class='modal-content'>
          <div class='modal-header'>
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>创建云硬盘</h3>
          </div>       
          <div class='modal-body form-horizontal row' data-bind="with: currentVO">
            <div class="form-group">
              <label class="col-xs-3 control-label">云硬盘名称</label>
              <div class="col-xs-8">
                <input type="text" class="form-control" data-bind="value:volumeName">
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">存储大小(GB)</label>
              <div class="col-xs-8">
                <input type="text" class="form-control" data-bind="value:volumeSize">
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">所属VDC</label>
              <div class="col-xs-8">
                <select class="form-control" data-bind="value:vdcUuid">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">可用分区</label>
              <div class="col-xs-8">
                <select class="form-control" data-bind="value:azUuid">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">挂载云主机</label>
              <div class="col-xs-8">
                <select class="form-control" data-bind="value:volumeServerId">
                  <option value="">云主机1</option>
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-3 control-label">申请有效期至</label>
              <div class="col-xs-8">
                <div class="input-group">
                 <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                 <input type="text" value="" class="form-control input-sm" id="vdisk_duration" data-bind="value:effectiveDate">
               </div>                            
             </div>
             <div class="col-xs-1">
              <span class="text-danger inline m-l-n m-t-sm">*</span>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-3 control-label">备注</label>
            <div class="col-xs-8">
              <textarea class="form-control" cols="5" rows="5" data-bind="value:description"></textarea>
            </div>
          </div>
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click:ok">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div>
  <!-- end -->

  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isStorageExpand }">
    <div class='modal-dialog modal-lg' style="width:600px;">
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>拓展云硬盘</h3>
        </div>
        <div class='modal-body form-horizontal row'>
          <div class="form-group">
            <label class="col-sm-3 control-label">云硬盘名称：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" placeholder="盘1">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">云硬盘大小(GB)：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" placeholder="4">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-3 control-label">拓展后大小(GB)：</label>
            <div class="col-sm-8">
              <input type="email" class="form-control" placeholder="">
              可调整范围为：16至39.38
            </div>
          </div>

        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click:ok">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div>

</div>
</div>


<script type="text/javascript">
  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js"]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    function ViewModel_Storage(){
   	  
   	  this.isAddvdisk = ko.observable(false);
      var self = this;
      
      this.currentVO = ko.validatedObservable({
         volumeName: ko.observable().extend({required:true}),
         volumeSize: ko.observable().extend({required:true})
      });

      this.addvdisk = function(){
	    this.currentVO.fromJSON({
	    	volumeId: null,
	    	volumeName: '',
	    	volumeSize: '',
	    	volumeServerId: '',
	    	vpcUuid: '',
	    	vdcUuid: '',
	    	azUuid: '',
	    	effectiveDate: '2016-08-01 00:00:00',
	    	description:''
	    	
        });
        self.isAddvdisk(true);
      }
      
      this.ok = function(){
      	//console.log(this.currentVO.toJSON());
      	ko.validation.group(self.currentVO).showAllMessages();
      	if(self.currentVO.isValid()){
   			csc.rest.post('api/v5.0.0/volumes', this.currentVO.toJSON(), function(){
   	            self.isEdit(false);
   	            self.table.refreshData();
   			});
        }
      }

      $("#modal_addvdisk").on("shown.bs.modal",function(){

          // daterange             
          $('#vdisk_duration').val(moment().subtract('days', 29).format('YYYY/MM/DD')).datetimepicker({format: 'yyyy-mm-dd hh:ii'});; 

      })

      this.isStorageExpand = ko.observable(false);

      this.storageExpand = function(){
        self.isStorageExpand(true);
      };

      this.remove = function(){

      }

      this.removeOne = function(object, event){

      }

      this.searchParam = ko.observable({
        azUuid: '',
        vdcUuid: '',
        volumeNameLike: ''
      });
      
      this.reset = function(){
        this.searchParam({
       	   azUuid: '',
           vdcUuid: '',
           volumeNameLike: ''
        })
      }
      this.search = function(){
        console.log(this.searchParam());
        this.table.params(this.searchParam());
      }
      this.table = new DataTable([], {path: 'http://localhost:8098/csc/api/v5.0.0/volumes?type=Disk'})
      
      

      //下拉选择
      this.vdcs = ko.observableArray([]);
      this.loadVdcs = function(){
        $.ajax("pages/vdcs/vdcs/index.json").done(function(data){
          self.vdcs(data.results);
        });
      }
      this.partitions = ko.observableArray([]);
      this.loadPartitions = function(){
        $.ajax("pages/resources/partitions/index.json").done(function(data){
          self.partitions(data.results);
        });
      }
      this.loadVdcs();
      this.loadPartitions();
    }
    ko.applyBindings(new ViewModel_Storage(), $('#partition_storages')[0]);
  })
</script>