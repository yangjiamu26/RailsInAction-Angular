 <div class="bg-light lter b-b wrapper-sm">
    <ol class="breadcrumb">
        <li>当前位置：</li>
        <li>服务</li>
        <li class="active">购物车</li>
    </ol>
</div>

<div class='wrapper-md'>
    <div class="panel panel-default wrapper">
      <div class="form-inline">
          <div class="checkbox m-l-xs">
              <label class="i-checks">
                  <input type="checkbox" data-bind="checked: isSelectedAll">
                  <i></i>全选
              </label>
          </div>
          <a class="btn btn-info btn-sm" data-bind="click: generateOrder">生成订单</a>
      </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.vmNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: vmList_isSelectedAll">
                    <i></i>云主机
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:vmNum"></span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th></th>
                        <th>云主机名称</th>
                        <th>操作系统版本</th>
                        <th>CPU(个)</th>
                        <th>内存(G)</th>
                        <th>存储(G)</th>
                        <th>挂载云盘个数</th>
                        <th>云软件个数</th>
                        <th>所属VDC</th>
                        <th>VPC/IP池</th>
                        <th>网络名称</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach: vmList  -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.vmList_chosens"><i></i></label>
                                </div>
                            </td>
                            <td data-bind="text:vmName"></td>
                            <td data-bind="text:osVersionText"></td>
                            <td data-bind="text:cpu"></td>
                            <td data-bind="text:memory"></td>
                            <td data-bind="text:storage"></td>
                            <td data-bind="text:mountDiskNum"></td>
                            <td data-bind="text:softwareNum"></td>
                            <td data-bind="text:vdcName"></td>
                            <td data-bind="text:vpcName"></td>
                            <td data-bind="text:vpcNetworkName"></td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td><a data-bind="click: function(data, event){ $root.editElement(true,'vmCartInfo',data,event) }">
                            <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a>  
                            <a data-bind="click: function(data, event){ $root.editElement(false,'vmCartInfo',data,event) }">
                            <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a>  
                            <a data-bind="click: function(data, event){ $root.deleteElement('vmCartInfo',data,event) }">
                            <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->			
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.vdiskNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: vdiskList_isSelectedAll">
                    <i></i>云硬盘
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:vdiskNum">1</span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th>
                        </th>
                        <th>云硬盘名称</th>
                        <th>存储(G)</th>
                        <th>挂载云主机</th>
                        <th>所属VDC</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach: vdiskList  -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.vdiskList_chosens">
                                        <i></i>
                                    </label>
                                </div>
                            </td>
                            <td data-bind="text:name"></td>
                            <td data-bind="text:size"></td>
                            <td data-bind="text:mountVmName"></td>
                            <td data-bind="text:vdcName"></td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td><a data-bind="click: function(data, event){ $root.editElement(true,'vdiskCartInfo',data,event) }">
                            <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a> 
                            <a data-bind="click: function(data, event){ $root.editElement(false,'vdiskCartInfo',data,event) }">
                            <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a> 
                            <a data-bind="click: function(data, event){ $root.deleteElement('vdiskCartInfo',data,event) }">
                            <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.objectStorageNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: objectStorageList_isSelectedAll">
                    <i></i>对象存储
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:objectStorageNum"></span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th>
                        </th>
                        <th>对象存储名称</th>
                        <th>存储(G)</th>
                        <th>所属VDC</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach: objectStorageList  -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.objectStorageList_chosens">
                                        <i></i>
                                    </label>
                                </div>
                            </td>
                            <td data-bind="text:name"></td>
                            <td data-bind="text:size"></td>
                            <td data-bind="text:vdcName"></td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td><a data-bind="click: function(data, event){ $root.editElement(true,'objectStorageCartInfo',data,event) }">
                            <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a> 
                            <a data-bind="click: function(data, event){ $root.editElement(false,'objectStorageCartInfo',data,event) }">
                            <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a> 
                            <a data-bind="click: function(data, event){ $root.deleteElement('objectStorageCartInfo',data,event) }">
                            <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.publicNetworkNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: publicNetworkList_isSelectedAll">
                    <i></i>公网IP
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:publicNetworkNum"></span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th>
                        </th>
                        <th>公网IP名称</th>
                        <th>所属VDC</th>
                        <th>所属VPC</th>
                        <th>网络名称</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach:publicNetworkList -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.publicNetworkList_chosens">
                                        <i></i>
                                    </label>
                                </div>
                            </td>
                            <td data-bind="text:name"></td>
                            <td data-bind="text:vdcName"></td>
                            <td data-bind="text:vpcName"></td>
                            <td data-bind="text:netWorkName"></td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td>
                                <a data-bind="click: function(data, event){ $root.editElement(true,'publicNetworkCartInfo',data,event) }">
                                <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a> 
                                <a data-bind="click: function(data, event){ $root.editElement(false,'publicNetworkCartInfo',data,event) }">
                                <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a> 
                                <a data-bind="click: function(data, event){ $root.deleteElement('publicNetworkCartInfo',data,event) }">
                                <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.lbNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: loadbalancerList_isSelectedAll">
                    <i></i>负载均衡器
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:lbNum"></span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th>
                        </th>
                        <th>负载均衡器名称</th>
                        <th>所属VDC</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach:loadbalancerList -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.loadbalancerList_chosens">
                                        <i></i>
                                    </label>
                                </div>
                            </td>
                            <td data-bind="text:name"></td>
                            <td data-bind="text:vdcName">研发部</td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td>
                                <a data-bind="click: function(data, event){ $root.editElement(true,'loadbalancerCartInfo',data,event) }">
                                <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a> 
                                <a data-bind="click: function(data, event){ $root.editElement(false,'loadbalancerCartInfo',data,event) }">
                                <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a> 
                                <a data-bind="click: function(data, event){ $root.deleteElement('loadbalancerCartInfo',data,event) }">
                                <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="panel panel-default m-b-sm" data-bind="visible:$root.sshNum()>0">
        <div class="carts-list-title form-inline">
            <div class="checkbox">
                <label class="i-checks">
                    <input type="checkbox" data-bind="checked: sshKeytList_isSelectedAll">
                    <i></i>SSH密钥
                </label>
            </div>
            <span class="badge bg-danger" data-bind="text:sshNum"></span>
        </div>
        <div class="carts-list-box">
            <div class="table-responsive no-height">
                <table class="table">
                    <thead>
                        <th>
                        </th>
                        <th>SSH密钥名称</th>
                        <th>所属VDC</th>
                        <th>可用分区</th>
                        <th>申请时长</th>
                        <th>操作</th>
                    </thead>
                    <tbody>
                        <!-- ko foreach:sshKeytList -->
                        <tr>
                            <td>
                                <div class="checkbox">
                                    <label class="i-checks">
                                        <input type="checkbox" data-bind="checkedValue: $data, checked: $root.sshKeytList_chosens">
                                        <i></i>
                                    </label>
                                </div>
                            </td>
                            <td data-bind="text:name"></td>
                            <td data-bind="text:vdcName"></td>
                            <td data-bind="text:azName"></td>
                            <td data-bind="text:applyText"></td>
                            <td>
                                <a data-bind="click: function(data, event){ $root.editElement(true,'sshKeytCartInfo',data,event) }">
                                <i class="fa fa-search fa-lg text-success m-r-sm" title="查看"></i></a> 
                                <a data-bind="click: function(data, event){ $root.editElement(false,'sshKeytCartInfo',data,event) }">
                                <i class="fa fa-pencil fa-lg text-info m-r-sm" title="修改"></i></a> 
                                <a data-bind="click: function(data, event){ $root.deleteElement('sshKeytCartInfo',data,event) }">
                                <i class="fa fa-close fa-lg text-danger" title="删除"></i></a>
                            </td>
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="panel panel-default clear">
      <div class="form-inline m-l-xs pull-right">
          <div class="checkbox">
              <label class="i-checks">
                  <input type="checkbox" data-bind="checked: isSelectedAll">
                  <i></i>全选
              </label>
          </div>
          <a class="btn btn-info btn-sm btn-checkout" data-bind="click: generateOrder">生成订单</a>
      </div>
    </div>
</div>
    <!-- page specific plugin scripts -->
    <script type="text/javascript">
    var scripts = [null, "assets/lib/moment/moment.js", "assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
    $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
        $(".applyModeShow").on("shown.bs.modal", function() {
        	$('.applyDateFormat').each(function(n,v){
        		$(this).daterangepicker({
                	startDate: $(this).val(), 
                    endDate: false, 
                    singleDatePicker:true
                });
        	})
            
        })

        function ViewModel() {
            var self = this;
            /************************************ 购物车页面定义  ************************************/
            this.LBMothedList = ko.observableArray(csc.util.getLBMothedList());
	        this.ProtocolList = ko.observableArray(csc.util.getProtocolList());
	        this.MonthsList = ko.observableArray(csc.util.getMonthsList());
	        
	        this.AllSoftTypeList = ko.observableArray();
	        csc.rest.get("api/v5.0.0/soft/list/softTypes?type=true", function(data){
	        	self.AllSoftTypeList(data);
	        });
	        
	        this.AllSoftTypeNameList = ko.observableArray();
	        csc.rest.get("api/v5.0.0/soft/list/softTypes", function(data){
	        	self.AllSoftTypeNameList(data);
	        });
	        /************************************ 购物车页面定义  ************************************/
           
			/************************************ 购物车提交订单数据格式转换  ************************************/
			this.orders_vdisk=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
			this.orders_objectStorage=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
			this.orders_publicNetwork=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
			this.orders_loadbalancer=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
			this.orders_ssh=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
			this.orders_vm=ko.validatedObservable({
				resourceType : ko.observable(),
				orderItems : ko.observableArray([])
			});
    	  
    	   function items(e){
    		   this.instanceName = ko.observable(e.name != null? e.name: e.vmName);
    		   this.serviceUuid = ko.observable(e.serviceUuid);
    		   this.isBill = ko.observable(e.charge);
    		   this.expireType =  ko.observable(e.applyType);
    		   var expireValue="";
	    	   if(e.applyType == "2"){
	    		   expireValue = e.applyNum;
	    	   }else if(e.applyType == "3"){
	    		   expireValue = e.applyTime;
	    	   }
    		   this.expireValue = ko.observable(expireValue);
    		   this.billCycle = ko.observable(e.billRuleUuid);
    		   this.fee = ko.observable(e.price);
    		   this.metaData = ko.observable();
    		   this.desc = ko.observable(e.remark);
    		   this.azUuid = ko.observable(e.azUuid);
    		   this.resourceType = ko.observable();
    		   this.relateUuid = ko.observable();
    		   this.vdcUuid = ko.observable(e.vdcUuid);
    		   this.relateUuid = ko.observable();
    	   }
    	   
    	   function metaData(){
    		   this.resBaseInfo = ko.observable();
    	   }
    	   
    	   function DISK_baseInfo(){
    		   this.volumeSize = ko.observable();
    		   this.vmUuid = ko.observable();
    	   }
    	   
		   function OBJECT_STORAGE_baseInfo(){
			   this.applySize = ko.observable();
		   }
		   
		   function PUBLICIP_baseInfo(){
			   this.vpcUuid = ko.observable();
			   this.networkUuid = ko.observable();
		   }
		   
		   function LOAD_BALANCING_baseInfo(){
			   this.vpcUuid = ko.observable();
			   this.networkUuid = ko.observable();
			   this.lbMethod = ko.observable();
			   this.protocol = ko.observable();
		   }
		   
		   
		   function VM_baseInfo (){
			   this.azUuid = ko.observable();
			   this.osType = ko.observable();
			   this.osVersion = ko.observable();
			   this.expiryTime = ko.observable();
			   this.imageUuid = ko.observable();
			   this.memory = ko.observable();
			   this.name = ko.observable();
			   this.storage = ko.observable();
			   this.vcpu = ko.observable();
			   this.vdcUuid = ko.observable();
			   this.vpcUuid = ko.observable();
			   this.partitionList = ko.observableArray([]);
			   this.networkList = ko.observableArray([]);
			   this.softwareList = ko.observableArray([]);
			   
			   this.ip = ko.observable();
			   this.account = ko.observable();
			   this.password = ko.observable();
			   this.repeatPassword = ko.observable();
			   this.sshIsMount = ko.observable();
			   this.sshUuid = ko.observable();
			   this.busSysUuid = ko.observable();
			   
		   }
		   
		   function SOFT_baseInfo(){
			   //软件
			   this.softwareParamsList = ko.observableArray();
			   this.softwareUuid = ko.observable();
			   this.scriptUuid = ko.observable();
		   }
		   
		   function VM_network (){
			   this.networkId = ko.observable();
			   this.ip = ko.observable();
		   }
		   function VM_partition (){
			   this.name = ko.observable();
			   this.size = ko.observable();
		   }
		   
		   function VM_softwareVo(e){
			   this.softwareUuid = ko.observable(e.softwareUuid);
			   this.scriptUuid = ko.observable(e.scriptUuid);
			   this.softwareParamsList = ko.observableArray();
		   }
		   
		   function VM_softwareParamsVO(e){
			    this.paramsUuid = ko.observable(e.paramsUuid);
		    	this.paramsValue = ko.observable(e.paramsValue!=null?e.paramsValue:"");
		   }
		   
            this.generateOrder = function() {       
                var chose_length = self.vdiskList_chosens().length+self.objectStorageList_chosens().length
                +self.publicNetworkList_chosens().length+self.loadbalancerList_chosens().length
                +self.sshKeytList_chosens().length+self.vmList_chosens().length;
                if(chose_length==0){
                	systemMsg.alert('请先选择需要提交的申请！');	
                	 return;
                }
                csc.rest.get('api/v5.0.0/cart', function(data) {
                	systemMsg.alert('成功提交订单！');//后续优化，需改为提交后弹出
                    if (self.vdiskList_chosens().length > 0) {
                    	self.orders_vdisk().orderItems([]);
                    	self.orders_vdisk().resourceType("DISK");
                    	self.vdiskList_chosens().forEach(function (e){
                            data['vdiskCartInfo'].forEach(function(f) {
                            	if(e.uuid()==f.uuid){
                            	   var item =new items(f);
                     	    	   var meta=new metaData();
                    	    	   var baseInfo =new DISK_baseInfo();
                    	    	   item.resourceType("DISK");
                    	    	   baseInfo.volumeSize(f.size);
                    	    	   baseInfo.vmUuid(f.mountVmUuid);
                    	    	   meta.resBaseInfo(baseInfo);
                    	    	   item.metaData(ko.toJSON(meta));
                    	    	   self.orders_vdisk().orderItems.push(item);
                            	}
                            });
                    	})
					 	 csc.rest.post('api/v5.0.0/orders',self.orders_vdisk.toJSON(),function(result1){
						 		self.vdiskList_chosens().forEach(function (e){
						 			csc.rest.del('api/v5.0.0/cart/delete/vdiskCartInfo/'+e.id(),function(result2){
						 				self.vdiskList.remove(function (item) { return item.id() == result2.id; });
						 				self.vdiskNum(self.vdiskNum()-1);
				                         /* 
				                          *   提交购物车时，重新加载顶部购物车统计； 
				                          *   方法定义位置：WebRoot\index.html 
				                          */ 
				                         frameViewModel.loadCartNum();
						 			});
						 		});
						 		self.vdiskList_chosens.removeAll();
						    }); 
                    }
                    if(self.objectStorageList_chosens().length > 0){
                    	self.orders_objectStorage().orderItems([]);
                    	self.orders_objectStorage().resourceType("OBJECT_STORAGE");
                    	self.objectStorageList_chosens().forEach(function (e){
                            data['objectStorageCartInfo'].forEach(function(f) {
                            	if(e.uuid()==f.uuid){
                            	   var item =new items(f);
                     	    	   var meta=new metaData();
                    	    	   var baseInfo =new OBJECT_STORAGE_baseInfo();
                    	    	   item.resourceType("OBJECT_STORAGE");
                    	    	   baseInfo.applySize(f.size);
                    	    	   meta.resBaseInfo(baseInfo);
                    	    	   item.metaData(ko.toJSON(meta));
                    	    	   self.orders_objectStorage().orderItems.push(item);
                            	}
                            });
                    	});
					 	 csc.rest.post('api/v5.0.0/orders',self.orders_objectStorage.toJSON(),function(result1){
						 		self.objectStorageList_chosens().forEach(function (e){
						 			csc.rest.del('api/v5.0.0/cart/delete/objectStorageCartInfo/'+e.id(),function(result2){
						 				self.objectStorageList.remove(function (item) { return item.id() == result2.id; });
						 				self.objectStorageNum(self.objectStorageNum()-1);
				                         /* 
				                          *   提交购物车时，重新加载顶部购物车统计； 
				                          *   方法定义位置：WebRoot\index.html 
				                          */ 
				                         frameViewModel.loadCartNum();
						 			});
						 		});
						 		self.objectStorageList_chosens.removeAll();
						    }); 
                    }
                    
                    if(self.publicNetworkList_chosens().length > 0){
                    	self.orders_publicNetwork().orderItems([]);
                    	self.orders_publicNetwork().resourceType("PUBLICIP");
                    	self.publicNetworkList_chosens().forEach(function (e){
                            data['publicNetworkCartInfo'].forEach(function(f) {
                            	if(e.uuid()==f.uuid){
                            	   var item =new items(f);
                     	    	   var meta=new metaData();
                    	    	   var baseInfo =new PUBLICIP_baseInfo();
                    	    	   item.resourceType("PUBLICIP");
                    	    	   baseInfo.vpcUuid(f.vpcUuid);
                    	    	   baseInfo.networkUuid(f.netWorkId);
                    	    	   meta.resBaseInfo(baseInfo);
                    	    	   item.metaData(ko.toJSON(meta));
                    	    	   self.orders_publicNetwork().orderItems.push(item);
                            	}
                            });
                    	})
					 	 csc.rest.post('api/v5.0.0/orders',self.orders_publicNetwork.toJSON(),function(result1){
						 		self.publicNetworkList_chosens().forEach(function (e){
						 			csc.rest.del('api/v5.0.0/cart/delete/publicNetworkCartInfo/'+e.id(),function(result2){
						 				self.publicNetworkList.remove(function (item) { return item.id() == result2.id; });
						 				self.publicNetworkNum(self.publicNetworkNum()-1);
				                         /* 
				                          *   提交购物车时，重新加载顶部购物车统计； 
				                          *   方法定义位置：WebRoot\index.html 
				                          */ 
				                         frameViewModel.loadCartNum();
						 			});
						 		});
						 		self.publicNetworkList_chosens.removeAll();
						    }); 
                    }
                    if(self.loadbalancerList_chosens().length > 0){
                    	self.orders_loadbalancer().orderItems([]);
                    	self.orders_loadbalancer().resourceType("LOAD_BALANCING");
                    	self.loadbalancerList_chosens().forEach(function (e){
                            data['loadbalancerCartInfo'].forEach(function(f) {
                            	if(e.uuid()==f.uuid){
                            	   var item =new items(f);
                     	    	   var meta=new metaData();
                    	    	   var baseInfo =new LOAD_BALANCING_baseInfo();
                    	    	   item.resourceType("LOAD_BALANCING");
                    	    	   baseInfo.vpcUuid(e.vpcUuid());
                    	    	   baseInfo.networkUuid(e.vpcNetworkUuid());
                    	    	   baseInfo.lbMethod(e.loadBalanceWay());
                    	    	   baseInfo.protocol(e.agreement());
                    	    	   meta.resBaseInfo(baseInfo);
                    	    	   item.metaData(ko.toJSON(meta));
                    	    	   self.orders_loadbalancer().orderItems.push(item);
                            	}
                            });
                            
                    	})
                    	
					 	 csc.rest.post('api/v5.0.0/orders',self.orders_loadbalancer.toJSON(),function(result1){
						 		self.loadbalancerList_chosens().forEach(function (e){
						 			csc.rest.del('api/v5.0.0/cart/delete/loadbalancerCartInfo/'+e.id(),function(result2){
						 				self.loadbalancerList.remove(function (item) { return item.id() == result2.id; });
						 				self.lbNum(self.lbNum()-1);
				                         /* 
				                          *   提交购物车时，重新加载顶部购物车统计； 
				                          *   方法定义位置：WebRoot\index.html 
				                          */ 
				                         frameViewModel.loadCartNum();
						 			});
						 		});
						 		self.loadbalancerList_chosens.removeAll();
						    }); 
                     }
                    if(self.sshKeytList_chosens().length > 0){
                    	self.orders_ssh().orderItems([]);
                    	self.orders_ssh().resourceType("SECRET_KEY");
                    	self.sshKeytList_chosens().forEach(function (e){
                            data['sshKeytCartInfo'].forEach(function(f) {
                            	if(e.uuid()==f.uuid){
                            	   var item =new items(f);
                     	    	   var meta=new metaData();
                    	    	   item.resourceType("SECRET_KEY");
                    	    	   meta.resBaseInfo("");
                    	    	   item.metaData(ko.toJSON(meta));
                    	    	   self.orders_ssh().orderItems.push(item);
                            	}
                            });
                    	})
					 	 csc.rest.post('api/v5.0.0/orders',self.orders_ssh.toJSON(),function(result1){
						 		self.sshKeytList_chosens().forEach(function (e){
						 			csc.rest.del('api/v5.0.0/cart/delete/sshKeytCartInfo/'+e.id(),function(result2){
						 				self.sshKeytList.remove(function (item) { return item.id() == result2.id; });
						 				self.sshNum(self.sshNum()-1);
				                         /* 
				                          *   提交购物车时，重新加载顶部购物车统计； 
				                          *   方法定义位置：WebRoot\index.html 
				                          */ 
				                         frameViewModel.loadCartNum();
						 			});
						 		});
						 		self.sshKeytList_chosens.removeAll();
						    }); 
                     }
                    if(self.vmList_chosens().length > 0){
                    	self.orders_vm().orderItems([]);
                    	self.orders_vm().resourceType("VM");
                    	
                    	getOrderVm(function(isOk){
                    		if(isOk){
	       					 	 csc.rest.post('api/v5.0.0/orders',self.orders_vm.toJSON(),function(result1){
	 						 		self.vmList_chosens().forEach(function (e){
	 						 			csc.rest.del('api/v5.0.0/cart/delete/vmCartInfo/'+e.uuid(),function(result2){
	 						 				self.vmList.remove(function (item) { return item.uuid() == result2.id; });
	 						 				self.vmNum(self.vmNum()-1);
	 				                         /* 
	 				                          *   提交购物车时，重新加载顶部购物车统计； 
	 				                          *   方法定义位置：WebRoot\index.html 
	 				                          */ 
	 				                         frameViewModel.loadCartNum();
	 						 			});
	 						 		});
	 						 		self.vmList_chosens.removeAll();
	 						    }); 
                    		}
                    	})

                     }
                });
            };
            
            function getOrderVm(callback){
            	var count = 0;
            	self.vmList_chosens().forEach(function (e){
            		csc.rest.get('api/v5.0.0/cart/query/vmCartInfo/'+e.uuid(),function(f){
            			//云主机需要获取到挂载的云硬盘及软件的信息，所以需要调查询单个云主机的接口再去查询下该云主机的详细信息
                 	   var relateUuid=csc.util.getUuid();
                 	   var item =new items(f);
                 	   item.resourceType("VM");
         	    	   item.relateUuid(relateUuid);
         	    	   
         	    	   var meta=new metaData();
         	    	   var baseInfo =new VM_baseInfo();
         	    	   
         	    	   baseInfo.azUuid(f.azUuid);
         	    	   baseInfo.osType(f.osType);
         	    	   baseInfo.osVersion(f.osVersion);
         	    	   baseInfo.memory(f.memory);
         	    	   baseInfo.name(f.vmName);
         	    	   baseInfo.storage(f.storage);
         	    	   baseInfo.vcpu(f.cpu);
         	    	   baseInfo.vdcUuid(f.vdcUuid);
         	    	   baseInfo.vpcUuid(f.vpcUuid);
         	    	   baseInfo.ip(f.ip);
         	    	   baseInfo.account(f.account);
         	    	   baseInfo.password(f.password);
         	    	   baseInfo.repeatPassword(f.repeatPassword);
         	    	   baseInfo.sshIsMount(f.sshIsMount);
         	    	   baseInfo.sshUuid(f.sshUuid);
         	    	   baseInfo.busSysUuid(f.projectUuid);
         	    	   if(f.partitions!=null){
         	    		   f.partitions.forEach(function(p){
                	    		   var p=new VM_partition()
                	    		   p.name(p.name());
                	    		   p.size(p.size());
                	    		   baseInfo.partitionList.push(p)
                	    	   });
         	    	   }
         	    	   
         	    	   var n = new VM_network;
         	    	   n.networkId(f.vpcNetworkUuid);
         	    	   n.ip(f.ip);
         	    	   baseInfo.networkList.push(n);
         	    	   //安装软件
         	    	   if(f.softwares!=null){
         	    		   f.softwares.forEach(function(soft){
                	    		   var i =new items(soft);
        				    	   i.resourceType("SOFTWARE");
        				    	   i.relateUuid(relateUuid);
        				    	   var md=new metaData();
        				    	   var bi =new SOFT_baseInfo();
        				    	   bi.softwareUuid(soft.softwareUuid);
        				    	   bi.scriptUuid(soft.scriptUuid);
        				    	   soft.softwareParams.forEach(function(p){
        				    		   var softwareParam = new VM_softwareParamsVO(p);
        				    		   bi.softwareParamsList.push(softwareParam);
        				    	   });
        				    	   md.resBaseInfo(bi);
        				    	   i.metaData(ko.toJSON(md));
        				    	   self.orders_vm().orderItems.push(i);
                	       });
         	    	   }         	    	   
         	    	   
         	    	   meta.resBaseInfo(baseInfo);
         	    	   //云硬盘服务
         	    	   if(f.mountDisks!=null){
         	    		   f.mountDisks.forEach(function(m){
                	    		   var i =new items(m);
                		    	   i.resourceType("DISK");
                		    	   i.relateUuid(relateUuid);
                		    	   i.azUuid(e.azUuid);
        				    	   i.vdcUuid(e.vdcUuid);
        				    	   i.expireType(e.applyType);
	       						   var expireValue="";
	       				    	    if(e.applyType == "2"){
	       				    		   expireValue = e.applyNum;
	       				    	    }else if(e.applyType == "3"){
	       				    		   expireValue = e.applyTime;
	       				    	    }
	       				    		i.expireValue(expireValue);
        				    	   
                		    	   var md=new metaData();
                		    	   var bi =new DISK_baseInfo();
                		    	   
                		    	   bi.volumeSize(m.size);
                		    	   md.resBaseInfo(bi);
                		    	   i.metaData(ko.toJSON(md));
                		    	   self.orders_vm().orderItems.push(i);
                	    	   }); 
         	    	   }
         	    	   
         	    	   item.metaData(ko.toJSON(meta));
         	    	   self.orders_vm().orderItems.push(item);
         	    	   count = count+1;
         	    	   if(count == self.vmList_chosens().length){
         	    		   callback(true);
         	    	   }
            		})
            	})
            }
            /************************************ 购物车提交订单数据格式转换  ************************************/
            
            /************************************ 购物车列表全选  ************************************/
            this.vdiskList = ko.observableArray();
            this.objectStorageList = ko.observableArray();
            this.publicNetworkList = ko.observableArray();
            this.loadbalancerList = ko.observableArray();
            this.sshKeytList = ko.observableArray();
            this.vmList = ko.observableArray();
            
            this.loadbalancerList_chosens = ko.observableArray();
            this.sshKeytList_chosens = ko.observableArray();
            this.vmList_chosens = ko.observableArray();
            this.vdiskList_chosens = ko.observableArray();
            this.objectStorageList_chosens = ko.observableArray();
            this.publicNetworkList_chosens = ko.observableArray();
            
            this.isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.vdiskList_chosens().length === this.vdiskList().length) && (this.objectStorageList_chosens().length === this.objectStorageList().length) && (this.publicNetworkList_chosens().length === this.publicNetworkList().length) && (this.loadbalancerList_chosens().length === this.loadbalancerList().length) && (this.sshKeytList_chosens().length === this.sshKeytList().length) && (this.vmList_chosens().length === this.vmList().length);
                },
                write: function(value) {
                    if (value) {
                        this.vdiskList_isSelectedAll(true);
                        this.objectStorageList_isSelectedAll(true);
                        this.publicNetworkList_isSelectedAll(true);
                        this.loadbalancerList_isSelectedAll(true);
                        this.sshKeytList_isSelectedAll(true);
                        this.vmList_isSelectedAll(true);
                    } else {
                        this.vdiskList_isSelectedAll(false);
                        this.objectStorageList_isSelectedAll(false);
                        this.publicNetworkList_isSelectedAll(false);
                        this.loadbalancerList_isSelectedAll(false);
                        this.sshKeytList_isSelectedAll(false);
                        this.vmList_isSelectedAll(false);
                    }
                },
                owner: this
            });

            this.vdiskList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.vdiskList_chosens().length > 0) && (this.vdiskList_chosens().length === this.vdiskList().length);
                },
                write: function(value) {
                    if (value) {
                        this.vdiskList_chosens([]);
                        var rows = this.vdiskList();
                        for (var i = 0; i < rows.length; i++) {
                            this.vdiskList_chosens.push(rows[i]);
                        }
                    } else {
                        this.vdiskList_chosens([]);
                    }
                },
                owner: this
            });

            this.objectStorageList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.objectStorageList_chosens().length > 0) && (this.objectStorageList_chosens().length === this.objectStorageList().length);
                },
                write: function(value) {
                    if (value) {
                        this.objectStorageList_chosens([]);
                        var rows = this.objectStorageList();
                        for (var i = 0; i < rows.length; i++) {
                            this.objectStorageList_chosens.push(rows[i]);
                        }
                    } else {
                        this.objectStorageList_chosens([]);
                    }
                },
                owner: this
            });

            this.publicNetworkList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.publicNetworkList_chosens().length > 0) && (this.publicNetworkList_chosens().length === this.publicNetworkList().length);
                },
                write: function(value) {
                    if (value) {
                        this.publicNetworkList_chosens([]);
                        var rows = this.publicNetworkList();
                        for (var i = 0; i < rows.length; i++) {
                            this.publicNetworkList_chosens.push(rows[i]);
                        }
                    } else {
                        this.publicNetworkList_chosens([]);
                    }
                },
                owner: this
            });

            this.loadbalancerList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.loadbalancerList_chosens().length > 0) && (this.loadbalancerList_chosens().length === this.loadbalancerList().length);
                },
                write: function(value) {
                    if (value) {
                        this.loadbalancerList_chosens([]);
                        var rows = this.loadbalancerList();
                        for (var i = 0; i < rows.length; i++) {
                            this.loadbalancerList_chosens.push(rows[i]);
                        }
                    } else {
                        this.loadbalancerList_chosens([]);
                    }
                },
                owner: this
            });

            this.sshKeytList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.sshKeytList_chosens().length > 0) && (this.sshKeytList_chosens().length === this.sshKeytList().length);
                },
                write: function(value) {
                    if (value) {
                        this.sshKeytList_chosens([]);
                        var rows = this.sshKeytList();
                        for (var i = 0; i < rows.length; i++) {
                            this.sshKeytList_chosens.push(rows[i]);
                        }
                    } else {
                        this.sshKeytList_chosens([]);
                    }
                },
                owner: this
            });

            this.vmList_isSelectedAll = ko.pureComputed({
                read: function() {
                    return (this.vmList_chosens().length > 0) && (this.vmList_chosens().length === this.vmList().length);
                },
                write: function(value) {
                    if (value) {
                        this.vmList_chosens([]);
                        var rows = this.vmList();
                        for (var i = 0; i < rows.length; i++) {
                            this.vmList_chosens.push(rows[i]);
                        }
                    } else {
                        this.vmList_chosens([]);
                    }
                },
                owner: this
            });
            /************************************ 购物车列表全选  ************************************/
            
            function ListVO(obj) {
                for (var s in obj) {
                    var v = obj[s];
                    if (s == "applyText" && v == null) {
                        if ("1" == obj["applyType"]) {
                            v = "永久";
                        } else if ("2" == obj["applyType"]) {
                            v = obj["applyNum"] + "个月";
                        } else if ("3" == obj["applyType"]) {
                            v = "有效期至:" + obj["applyTime"].substr(0, 10);
                        }
                    }
                    this[s] = ko.observable(v);
                }
            }


            this.vdiskNum = ko.observable("");
            this.objectStorageNum = ko.observable("");
            this.publicNetworkNum = ko.observable("");
            this.lbNum = ko.observable("");
            this.sshNum = ko.observable("");
            this.vmNum = ko.observable("");
            csc.rest.get('api/v5.0.0/cart', function(data) {
                self.vdiskNum(data['vdiskCartInfo'].length);
                data['vdiskCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.vdiskList.push(vo);
                });
                self.objectStorageNum(data['objectStorageCartInfo'].length);
                data['objectStorageCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.objectStorageList.push(vo);
                });
                self.publicNetworkNum(data['publicNetworkCartInfo'].length);
                data['publicNetworkCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.publicNetworkList.push(vo);
                });

                self.lbNum(data['loadbalancerCartInfo'].length);
                data['loadbalancerCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.loadbalancerList.push(vo);
                });
                self.sshNum(data['sshKeytCartInfo'].length);
                data['sshKeytCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.sshKeytList.push(vo);
                });
                self.vmNum(data['vmCartInfo'].length);
                data['vmCartInfo'].forEach(function(e) {
                    var vo = new ListVO(e);
                    self.vmList.push(vo);
                });
            });

            //##########    查看、修改、删除     ##############
            this.isView_Vdisk = ko.observable(false);
            this.isView_ObjectStorage = ko.observable(false);
            this.isView_PublicNetwork = ko.observable(false);

            this.isView_loadbalancer = ko.observable(false);
            this.isView_sshKeyt = ko.observable(false);
            this.isView_vm = ko.observable(false);
            
            /************************************ 购物车下拉列表  ************************************/
            this.vdcChange = function(arg, data, event) { //根据变化的vdc及服务ID查找其下的可用分区
                csc.rest.get("api/v5.0.0/cart/getAzList/"+data[arg]().serviceUuid()+"/" + data[arg]().vdcUuid(), function(result) { //需修改为服务UUID作为参数传递
                    data[arg]().azList(result);
                });
            	if(arg=="vmCartInfo"){
            		data[arg]().mountDisks.removeAll();
            	}
            };

            this.azChangeGetVm = function(arg, data, event) {
                csc.rest.get("api/v5.0.0/vms?vdcUuid=" + data[arg]().vdcUuid() + "&azUuid=" + data[arg]().azUuid(), function(result) {
                    data[arg]().vmList(result.results);
                });
            }

            this.azChangeGetVpc = function(arg, data, event) {
                csc.rest.get("api/v5.0.0/cart/getVpcList/" + data[arg]().vdcUuid() + "/" + data[arg]().azUuid(), function(result) {
                    data[arg]().vpcList(result);
                });
                
                csc.rest.get("api/v5.0.0/sshKeys?getList=true&isValidate=true&azUuid="+data[arg]().azUuid()+"&vcdUuid="+data[arg]().vdcUuid(),function(result){
                	data[arg]().sshList(result);
                });
                
            	if(arg=="vmCartInfo"){
            		data[arg]().mountDisks.removeAll();
            	}
            }

            this.vpcChange = function(arg, data, event) {
                csc.rest.get("api/v5.0.0/cart/getNetworkList/"+data[arg]().serviceUuid()+"/" + data[arg]().vpcUuid(), function(result) { //需修改为服务UUID作为参数传递
                    data[arg]().networkList(result);
                });
            }
            
            this.vpcChangeByPublic = function(data, event) {
                csc.rest.get("api/v5.0.0/cart/getNetworkListByPublic/"+self.publicNetworkCartInfo().serviceUuid()+"/" + self.publicNetworkCartInfo().vpcUuid(), function(result) { //需修改为服务UUID作为参数传递
                	self.publicNetworkCartInfo().networkList(result);
                });
            }

            this.osTypeChangeGetOsVersion = function(arg, data, event) {
                csc.rest.get("api/v5.0.0/cart/getOsVersionList/" +data[arg]().serviceUuid()+ "/"+ data[arg]().azUuid() + "/" + data[arg]().osType(), function(result) {
                    data[arg]().osVersionList(result);
                });
            }
            this.networkChangeGetIp = function(arg, data, event) {
            	if(data[arg]().vpcNetworkUuid()!=null){
            		csc.rest.get("api/v5.0.0/vpcNetworks/" + data[arg]().vpcNetworkUuid() + "/availableIp", function(result) {
                    	data[arg]().ipList(result);
                    },function(){},null,true);
            	}
            }
            
            this.vmChangeGetDate = function(obj) {
                var vmItem = _.findWhere(self.vdiskCartInfo().vmList(), {
                    uuid: self.vdiskCartInfo().mountVmUuid()
                });
                if (typeof(vmItem) == "undefined") {
                    self.vdiskCartInfo().applyTime("");
                } else {
                    self.vdiskCartInfo().applyTime(vmItem.expiryTime);
                }

            }
            /************************************ 购物车下拉列表  ************************************/

            /************************************ 购物车VO定义  ************************************/
            this.vdiskCartInfo = ko.validatedObservable({
                id: ko.observable(""),
                name: ko.observable("").extend({required:true}),
                serviceUuid:ko.observable(""),
                size: ko.observable("").extend({required:true,number:true}),
                vdcUuid: ko.observable("").extend({required:true}),
                azUuid: ko.observable("").extend({required:true}),
                mountVmUuid: ko.observable("").extend({required:true}),
                vdcList: ko.observableArray([]),
                azList: ko.observableArray([]),
                vmList: ko.observableArray([]),
                applyTime: ko.observable(""),
                remark: ko.observable(""),
                charge:ko.observable(""),
                price:ko.observable(""),
                billRuleUuid:ko.observable(""),
                billRuleList: ko.observableArray([]),
                unitPrice:ko.observable("")
            });
            this.vdiskCartInfo().charge.subscribe(function(value){
            	if(value=='true'){
            		self.vdiskCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}}})
            	}else{
            		self.vdiskCartInfo().billRuleUuid.extend({required: {params: false, onlyIf:function(){return true}}})
            	}
            });

            this.objectStorageCartInfo = ko.validatedObservable({
                id: ko.observable(""),
                name: ko.observable("").extend({required:true}),
                serviceUuid:ko.observable(""),
                size: ko.observable("").extend({required:true,number:true}),
                applyText:ko.observable(""),
                applyTime: ko.observable(""),
                applyType: ko.observable(""),
                applyNum: ko.observable(""),
                vdcUuid: ko.observable("").extend({required:true}),
                azUuid: ko.observable("").extend({required:true}),
                billRuleUuid: ko.observable(""),
                vdcList: ko.observableArray([]),
                azList: ko.observableArray([]),
                applyType: ko.observable(""),
                applyNum: ko.observable(""),
                charge:ko.observable(""),
                price:ko.observable(""),
                billRuleUuid:ko.observable(""),
                billRuleList: ko.observableArray([]),
                unitPrice:ko.observable("")
            });
            this.objectStorageCartInfo().charge.subscribe(function(value){
            	if(value=='true'){
            		self.objectStorageCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}}})
            	}else{
            		self.objectStorageCartInfo().billRuleUuid.extend({required: {params: false, onlyIf:function(){return true}}})
            	}
            });

            this.publicNetworkCartInfo = ko.validatedObservable({
                id: ko.observable(""),
                name: ko.observable("").extend({required:true}),
                serviceUuid:ko.observable(""),
                vdcUuid: ko.observable("").extend({required:true}),
                azUuid: ko.observable("").extend({required:true}),
                vpcUuid: ko.observable("").extend({required:true}),
                netWorkId: ko.observable("").extend({required:true}),
                applyText:ko.observable(""),
                applyTime: ko.observable(""),
                applyType: ko.observable(""),
                applyNum: ko.observable(""),
                billRuleUuid: ko.observable(""),
                vdcList: ko.observableArray([]),
                azList: ko.observableArray([]),
                vpcList: ko.observableArray([]),
                remark:ko.observable(""),
                charge:ko.observable(""),
                billRuleUuid:ko.observable(""),
                price:ko.observable(""),
                networkList: ko.observableArray([]),
                billRuleList: ko.observableArray([])
            });
            
            this.publicNetworkCartInfo().charge.subscribe(function(value){
            	if(value=='true'){
            		self.publicNetworkCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}}})
            	}else{
            		self.publicNetworkCartInfo().billRuleUuid.extend({required: {params: false, onlyIf:function(){return true}}})
            	}
            });

            this.loadbalancerCartInfo = ko.validatedObservable({
                id: ko.observable(),
                name: ko.observable().extend({required:true}),
                vdcUuid: ko.observable().extend({required:true}),
                azUuid: ko.observable().extend({required:true}),
                serviceUuid:ko.observable(),
                applyTime: ko.observable(),
                applyType: ko.observable(),
                applyNum: ko.observable(),
                applyText: ko.observable(),
                remark: ko.observable(),
                billRuleUuid: ko.observable(),
                charge:ko.observable(),
                loadBalanceWay : ko.observable().extend({required:true}),
    			agreement : ko.observable().extend({required:true}),
    			vpcNetworkUuid : ko.observable().extend({required:true}),
    			vpcUuid : ko.observable().extend({required:true}),
                vdcList:ko.observableArray([]),
                azList: ko.observableArray([]),
                billRuleList: ko.observableArray([]),
                networkList : ko.observableArray([]),
    			vpcList : ko.observableArray([])
            });
            
            this.loadbalancerCartInfo().charge.subscribe(function(value){
            	if(value=='true'){
            		self.loadbalancerCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}}})
            	}else{
            		self.loadbalancerCartInfo().billRuleUuid.extend({required: {params: false, onlyIf:function(){return true}}})
            	}
            });

            this.sshKeytCartInfo = ko.validatedObservable({
            	id: ko.observable(),
                name: ko.observable().extend({required:true}),
                vdcUuid: ko.observable().extend({required:true}),
                azUuid: ko.observable().extend({required:true}),
                serviceUuid:ko.observable(),
                applyTime: ko.observable(),
                applyType: ko.observable(),
                applyNum: ko.observable(),
                applyText: ko.observable(),
                remark: ko.observable(),
                billRuleUuid: ko.observable(),
                charge:ko.observable(),
                vdcList: ko.observableArray([]),
                azList: ko.observableArray([]),
                billRuleList: ko.observableArray([])
            });



            this.vmCartInfo = ko.validatedObservable({
                id: ko.observable(""),
                uuid:ko.observable(),
                vmName: ko.observable("").extend({required:true}),
                vdcUuid: ko.observable("").extend({required:true}),
                azUuid: ko.observable("").extend({required:true}),
                applyTime: ko.observable(""),
                applyType: ko.observable(""),
                applyNum: ko.observable(""),
                applyText: ko.observable(""),
                remark: ko.observable(""),
                billRuleUuid: ko.observable(""),

                osType: ko.observable("").extend({required:true}),
                osVersion: ko.observable("").extend({required:true}),
                osVersionText: ko.observable(),

                price: ko.observable(),
                cpu: ko.observable().extend({required:true}),
                memory: ko.observable().extend({required:true}),
                storage: ko.observable().extend({required:true}),
                vpcUuid: ko.observable("").extend({required:true}),
                vpcNetworkUuid: ko.observable("").extend({required:true}),
                ip: ko.observable(""),
                account: ko.observable(""),
                password: ko.observable().extend({minLength:6}),
                repeatPassword: ko.observable(),
                sshIsMount: ko.observable(""),
                remark: ko.observable(""),
                serviceUuid: ko.observable(""),
                sshUuid: ko.observable(""),
                userName: ko.observable(""),
                networkType: ko.observable(""),
                computerName: ko.observable(""),
                projectUuid: ko.observable(""),
                mountDiskNum:ko.observable(),
                softwareNum:ko.observable(),
                charge:ko.observable(),
                
              //镜像大小
                imageSize : ko.pureComputed(function(){
	            	var item = _.findWhere(self.vmCartInfo().osVersionList(), {uuid: self.vmCartInfo().osVersion()});
	            	if(item!=null){
	            		return csc.util.getToFixedNum(csc.util.accDiv(parseInt(item.imageSize ||0),1073741824));
	            	}else{
	            		return 0;
	            	} 
	            }, this),
	          //openstack or cnware
	            cloudPlatform : ko.pureComputed(function(){
	            	var item = _.findWhere(self.vmCartInfo().azList(), {uuid: self.vmCartInfo().azUuid()});
	            	if(item!=null){
	            		return item.cloudPlatform == 'OpenStack' && self.vmCartInfo().osType()!='windows' ?true:false;
	            	}else{
	            		return false;
	            	}
	            }, this),
                //分区
                partitions: ko.observableArray([]),
                //硬盘
                mountDisks : ko.observableArray([]),
                softwares : ko.observableArray([]),
                
                vdcList:ko.observableArray([]),
                azList:ko.observableArray([]),
                osTypeList:ko.observableArray([]),
                osVersionList:ko.observableArray([]),
                cpuList:ko.observableArray([]),
                memoryList:ko.observableArray([]),
                vpcList:ko.observableArray([]),
                networkList:ko.observableArray([]),
                bussyList:ko.observableArray([]),
                sshList:ko.observableArray([]),
                billRuleList:ko.observableArray([]),
                ipList:ko.observableArray([])
            });
            this.vmCartInfo().charge.subscribe(function(value){
            	if(value=='true'){
            		self.vmCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}}})
            	}else{
            		self.vmCartInfo().billRuleUuid.extend({required: {params: false, onlyIf:function(){return true}}})
            	}
            });
            
            this.vmCartInfo().repeatPassword.subscribe(function(value){
            	if(value!=null){
            		self.vmCartInfo().repeatPassword.extend({equal: {params: self.vmCartInfo().password,onlyIf:function(){ return self.vmCartInfo().password}, message:"输入的密码不一致"}})
            	}else if(self.vmCartInfo().password !=null){
            		self.vmCartInfo().repeatPassword.extend({equal: {params: self.vmCartInfo().password,onlyIf:function(){ return self.vmCartInfo().password}, message:"请再次输入密码"}})
            	}
            });
            
            this.vmCartInfo().storage.subscribe(function(value){
            		self.vmCartInfo().billRuleUuid.extend({required: {params: true, onlyIf:function(){return true}},min:{params:self.vmCartInfo().imageSize,onlyIf: 
        				 function(){return  self.vmCartInfo().imageSize()}} })
            });
            
            this.isViewPartition = ko.observable(false);//显示系统盘分区
            /************************************ 购物车VO定义  ************************************/
            
            /************************************ 云主机订阅事件  ************************************/
            this.vmCartInfo().applyType.subscribe(function(){
            	var v="";
                if("1"==self.vmCartInfo().applyType()){
                    v="永久";
                }else if("2"==self.vmCartInfo().applyType()){
                    v=self.vmCartInfo().applyNum()+"个月";
                }else if("3"==self.vmCartInfo().applyType()){
                    v= "有效期至:"+self.vmCartInfo().applyTime().substr(0,10); 
                }
                self.vmCartInfo().applyText(v);
    	    });
            this.vmCartInfo().applyTime.subscribe(function(){
            	var v="";
                if("1"==self.vmCartInfo().applyType()){
                    v="永久";
                }else if("2"==self.vmCartInfo().applyType()){
                    v=self.vmCartInfo().applyNum()+"个月";
                }else if("3"==self.vmCartInfo().applyType()){
                    v= "有效期至:"+self.vmCartInfo().applyTime().substr(0,10); 
                }
                self.vmCartInfo().applyText(v);
    	    });
            this.vmCartInfo().applyNum.subscribe(function(){
            	var v="";
                if("1"==self.vmCartInfo().applyType()){
                    v="永久";
                }else if("2"==self.vmCartInfo().applyType()){
                    v=self.vmCartInfo().applyNum()+"个月";
                }else if("3"==self.vmCartInfo().applyType()){
                    v= "有效期至:"+self.vmCartInfo().applyTime().substr(0,10); 
                }
                self.vmCartInfo().applyText(v);
    	    });
            /************************************ 云主机订阅事件  ************************************/
            
            /************************************ 查看、修改购物车信息  ************************************/
            this.isEdit_Vdisk = ko.observable(false);
            this.isEdit_ObjectStorage = ko.observable(false);
            this.isEdit_PublicNetwork = ko.observable(false);
            this.isEdit_loadbalancer = ko.observable(false);
            this.isEdit_sshKeyt = ko.observable(false);
            this.isEdit_vm = ko.observable(false);
            var editObject;
            var vmChargeType;
            
            this.viewOrEdit = ko.observable();
            this.editElement = function(viewOrEdit,arg,object, event){
                self.vmCartInfo().mountDisks([]);
                self.vmCartInfo().partitions([]);
                self.step1(true);
		    	self.step2(false);
		    	self.step3(false);
		    	self.step4(false);
		    	self.step5(false);
                
                csc.rest.get('api/v5.0.0/cart/query/'+arg+'/'+object.uuid(),function(data){
                        if(arg=='vdiskCartInfo'){
                            var serviceUuid=data.serviceUuid;
                            var vdcUuid=data.vdcUuid;
                            var azUuid=data.azUuid;
                            var vpcUuid=data.vpcUuid;
                            var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid;
                            csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                                self.vdiskCartInfo().vdcList(result.vdcList);
                                self.vdiskCartInfo().azList(result.azList);
                                self.vdiskCartInfo().billRuleList(setArrayCharge(result.chargeList));
                                csc.rest.get("api/v5.0.0/vms?vdcUuid=" + vdcUuid + "&azUuid=" + azUuid, function(result1) {
                                    self.vdiskCartInfo().vmList(result1.results);
                                    self.vdiskCartInfo.fromJSON(data);
                                    
                                    self.viewOrEdit(viewOrEdit);
                                    self.vdiskCartInfo().id = object.id();
                                    self.isEdit_Vdisk(true);    
                                    editObject = object;
                                });
                                

                            });
                      }else if(arg=='objectStorageCartInfo'){
                          var serviceUuid=data.serviceUuid;
                          var vdcUuid=data.vdcUuid;
                          var azUuid=data.azUuid;
                          var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid;
                          csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                        	  self.objectStorageCartInfo().vdcList(result.vdcList);
                        	  self.objectStorageCartInfo().azList(result.azList);
                        	  self.objectStorageCartInfo().billRuleList(setArrayCharge(result.chargeList));
                        	  self.objectStorageCartInfo.fromJSON(data);
                        	  
                        	  self.viewOrEdit(viewOrEdit);
                              self.objectStorageCartInfo().id = object.id();
                              self.isEdit_ObjectStorage(true);
                              editObject = object;
                          });                    	  
                      }else if(arg=="publicNetworkCartInfo"){
                            var serviceUuid=data.serviceUuid;
                            var vdcUuid=data.vdcUuid;
                            var azUuid=data.azUuid;
                            var vpcUuid=data.vpcUuid;
                            var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid+"&vpcUuid="+vpcUuid;
                            csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                                self.publicNetworkCartInfo().vdcList(result.vdcList);
                                self.publicNetworkCartInfo().azList(result.azList);
                                self.publicNetworkCartInfo().vpcList(result.vpcList);
                                self.publicNetworkCartInfo().networkList(result.networkListByPublic);
                                self.publicNetworkCartInfo().billRuleList(setArrayCharge(result.chargeList));
                                self.publicNetworkCartInfo.fromJSON(data);
                                
                                self.viewOrEdit(viewOrEdit);
                                self.publicNetworkCartInfo().id = object.id();
                                self.isEdit_PublicNetwork(true);
                                editObject = object;
                            });
                      }else if(arg=="loadbalancerCartInfo"){ 
                    	  var serviceUuid=data.serviceUuid;
                          var vdcUuid=data.vdcUuid;
                          var azUuid=data.azUuid;
                          var vpcUuid=data.vpcUuid;
                          var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid+"&vpcUuid="+vpcUuid;
                          csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                        	 self.loadbalancerCartInfo().vdcList(result.vdcList);
                        	 self.loadbalancerCartInfo().azList(result.azList);
                        	 self.loadbalancerCartInfo().vpcList(result.vpcList);
                             self.loadbalancerCartInfo().networkList(result.networkList);
                        	 self.loadbalancerCartInfo().billRuleList(setArrayCharge(result.chargeList));
                             self.loadbalancerCartInfo.fromJSON(data);
                             
                             self.viewOrEdit(viewOrEdit);
                             self.isEdit_loadbalancer(true); 
                             editObject = object;
                          });
                    	  
                      }else if(arg=="sshKeytCartInfo"){
                    	  var serviceUuid=data.serviceUuid;
                          var vdcUuid=data.vdcUuid;
                          var azUuid=data.azUuid;
                          var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid;
                          csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                        	 self.sshKeytCartInfo().vdcList(result.vdcList);
                        	 self.sshKeytCartInfo().azList(result.azList);
                        	 self.sshKeytCartInfo().billRuleList(setArrayCharge(result.chargeList));
                             self.sshKeytCartInfo.fromJSON(data);
                             
                             self.viewOrEdit(viewOrEdit);
                             self.sshKeytCartInfo().id = object.id();
                             self.isEdit_sshKeyt(true);  
                             editObject = object;
                          });
                    	  
                      }else if(arg=="vmCartInfo"){
                          var serviceUuid=data.serviceUuid;
                          var vdcUuid=data.vdcUuid;
                          var azUuid=data.azUuid;
                          var vpcUuid=data.vpcUuid;
                          var osType=data.osType;
                          var vpcNetworkUuid=data.vpcNetworkUuid;
                          var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid+"&vpcUuid="+vpcUuid+"&osType="+osType;
                         csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){
                             csc.rest.get("api/v5.0.0/bussys?vdcuuid="+vdcUuid,function(result2){
                            	 //+"&userUuid="
                                 csc.rest.get("api/v5.0.0/sshKeys?getList=true&azUuid="+azUuid+"&vcdUuid="+vdcUuid,function(result3){
                                	 csc.rest.get("api/v5.0.0/vpcNetworks/"+vpcNetworkUuid+"/availableIp", function(result4){
                                		 csc.rest.get("api/v5.0.0/service/getServiceInfo/"+serviceUuid, function(result5){
                     		            	if(result5.serviceVm.virtualName=="PowerVM"){
                     		            		self.isViewPartition(true);
                     		            	}else{
                     		            		self.isViewPartition(false);
                     		            	}
                     		             }); 
                                		 
                                		 
	                                	self.vmCartInfo().ipList(result4);
	                                    self.vmCartInfo().sshList(result3.results);
	                                    self.vmCartInfo().bussyList(result2.results); 
	                                    self.vmCartInfo().vdcList(result.vdcList);
	                                    self.vmCartInfo().vpcList(result.vpcList);
	                                    self.vmCartInfo().networkList(result.networkList);
	                                    self.vmCartInfo().azList(result.azList);
	                                    self.vmCartInfo().osTypeList(result.osTypeList);
	                                    self.vmCartInfo().cpuList(result.cpuList);
	                                    self.vmCartInfo().memoryList(result.memoryList);
	                                    self.vmCartInfo().osVersionList(result.osVersionList);
	                                    
	                                    self.vmCartInfo().id(data.id);
	                                   	self.vmCartInfo().vmName(data.vmName);
	                                   	self.vmCartInfo().vdcUuid(data.vdcUuid);
	                                   	self.vmCartInfo().azUuid(data.azUuid);
	                                   	self.vmCartInfo().applyTime(data.applyTime);
	                                   	self.vmCartInfo().applyType(data.applyType);
	                                   	self.vmCartInfo().applyNum(data.applyNum);
	                                   	self.vmCartInfo().remark(data.remark);
	                                   	self.vmCartInfo().billRuleUuid(data.billRuleUuid);
	                                       
	                                   	self.vmCartInfo().osType(data.osType);
	                                   	self.vmCartInfo().osVersion(data.osVersion);
	                                   	self.vmCartInfo().cpu(data.cpu);
	                                   	self.vmCartInfo().memory(data.memory);
	                                   	self.vmCartInfo().storage(data.storage);
	                                   	self.vmCartInfo().vpcUuid(data.vpcUuid);
	                                   	self.vmCartInfo().vpcNetworkUuid(data.vpcNetworkUuid);
	                                   	self.vmCartInfo().ip(data.ip);
	                                   	self.vmCartInfo().account(data.account);
	                                   	self.vmCartInfo().password(data.password);
	                                   	self.vmCartInfo().repeatPassword(data.repeatPassword);
	                                   	self.vmCartInfo().sshIsMount(data.sshIsMount);
	                                   	self.vmCartInfo().projectUuid(data.projectUuid);
	                                   	self.vmCartInfo().uuid(data.uuid);
	                                   	self.vmCartInfo().serviceUuid(data.serviceUuid);
	                                   	self.vmCartInfo().sshUuid(data.sshUuid);
	                                   	self.vmCartInfo().networkType(data.networkType);
	                                   	
	                                    self.vmCartInfo().price(data.price);    
	                                    self.vmCartInfo().charge(data.charge);
	                                    
	                                    self.vmCartInfo().mountDisks([]);
	                                    data.mountDisks.forEach(function(e){
	                                        csc.rest.get("api/v5.0.0/cart/getCartSelectList?serviceUuid="+e.serviceUuid, function(res){
	                                        	var vo=new MountDiskVO();
	                                        	vo.name(e.name);
	                                            vo.size(e.size);
	                                            vo.serviceUuid(e.serviceUuid);
	                                            vo.serviceName(e.serviceName);
	                                            vo.billRuleUuid(e.billRuleUuid);
	                                            vo.billRuleList(setArrayCharge(res.chargeList));
	                                            vo.price(e.price);
	                                            self.vmCartInfo().mountDisks.push(new ko.validatedObservable(vo));
	                                        });
	                                    });
	                                   self.vmCartInfo().partitions([]);
	                                   data.partitions.forEach(function(e){
	                                        var vo=new PartitionVO();
	                                        vo.name(e.name);
	                                        vo.size(e.size);
	                                        self.vmCartInfo().partitions.push(new ko.validatedObservable(vo));
	                                    });
	                                   self.vmCartInfo().softwares([]);
	                                    data.softwares.forEach(function(e){
	                                	   var vo=new SoftwareVO();
	                                	   vo.softwareUuid(e.softwareUuid);
	                                	   vo.scriptUuid(e.scriptUuid);
	                                	   vo.softwareName(e.softwareName);
	                                	   vo.softwareType(e.softwareType);
	                                	   vo.softwareSorts(e.softwareSorts);
	                                	   vo.softwareVersion(e.softwareVersion);
	                                	   
	                                	   e.softwareParams.forEach(function (p){
	                                		   var paramVo=new SoftwareAttrVO();
	                                		   paramVo.softwareUuid(e.softwareUuid);
	                                		   paramVo.scriptUuid(e.scriptUuid);
	                                		   paramVo.paramsUuid(p.paramsUuid);
	                                		   paramVo.paramsKey(p.paramsKey);
	                                		   paramVo.paramsValue(p.paramsValue);
	                                		   paramVo.paramsName(p.paramsName);
	                                		   paramVo.defaultValue(p.defaultValue);
	                                		   vo.softwareParams.push(paramVo);
	                                	   });
	                           		    	self.vmCartInfo().softwares.push(vo);
	                           		    }); 
	                                   var v="";
	                                   if("1"==data.applyType){
	                                       v="永久";
	                                   }else if("2"==data.applyType){
	                                       v=data.applyNum+"个月";
	                                   }else if("3"==data.applyType){
	                                       v= "有效期至:"+data.applyTime.substr(0,10); 
	                                   }
	                                   self.vmCartInfo().applyText(v);
	                                   self.vmCartInfo().billRuleList(setArrayCharge(result.chargeList));
	                                   
	                                   self.viewOrEdit(viewOrEdit);
	                                   self.isEdit_vm(true);
	                                   editObject = object;
                                	 });
                                 });                             
                             });
                         });
                      }
                    });             
            }
            /************************************ 查看、修改购物车信息  ************************************/
            function VO(obj){           
                for(var s in obj){
                   var v=obj[s];    
                   this[s] = ko.observable(v);
                }
            } 
            /************************************ 删除购物车信息  ************************************/
            this.deleteElement = function(arg,object,event){
                    var id;
                    var name;
                    if(arg=="vmCartInfo"){
                        id=object.uuid();
                        name=object.vmName();
                    }else{
                        id=object.id();
                        name=object.name();
                    }
                systemMsg.confirm("确定删除"+name+"吗?",function(){
                    
                    csc.rest.del('api/v5.0.0/cart/delete/'+arg+'/'+id,function(data){
                        systemMsg.alert('删除成功！');   
                        if(arg=="vdiskCartInfo"){
                            self.vdiskList.remove(object);
                            self.vdiskNum(self.vdiskNum()-1);
                        }else if(arg=="objectStorageCartInfo"){
                            self.objectStorageList.remove(object);
                            self.objectStorageNum(self.objectStorageNum()-1);
                        }else if(arg=="publicNetworkCartInfo"){
                            self.publicNetworkList.remove(object);
                            self.publicNetworkNum(self.publicNetworkNum()-1);
                        }else if(arg=="loadbalancerCartInfo"){
                            self.loadbalancerList.remove(object);
                            self.lbNum(self.lbNum()-1);
                        }else if(arg=="sshKeytCartInfo"){
                            self.sshKeytList.remove(object);
                            self.sshNum(self.sshNum()-1);
                        }else if(arg=="vmCartInfo"){
                            self.vmList.remove(object);
                            self.vmNum(self.vmNum()-1);
                        }
                        
                    }); 
                });
            }
            /************************************ 删除购物车信息  ************************************/
            
            this.convertApplyText=function(applyType,applyNum,applyTime){
               var v="";
               if("1"==applyType){
                   v="永久";
               }else if("2"==applyType){
                   v=applyNum+"个月";
               }else if("3"==applyType){
                   v= "有效期至:"+applyTime.substr(0,10); 
               }
               editObject.applyText(v);
            }
            /************************************ 名称重复验证  ************************************/
            function nameCheck(name,type,uuid,callback){
			 	csc.rest.get('api/v5.0.0/cart/nameCheck?type='+type+'&name='+name+'&uuid='+uuid,function(result){
			 		 if(result.isExist==true){
			 			  systemMsg.alert("已存在名称为"+result.name+"的购物车申请");
						  callback(false);
					  }else{
						 	csc.rest.get('api/v5.0.0/orders/items/checkName?resourceType='+type+'&instanceName='+name,function(result1){	
						 		 if(result1.isExist==true){
						 			  systemMsg.alert("已存在名称为"+result1.name+"的订单申请");
									  callback(false);
								  }else{
									 	csc.rest.get('api/v5.0.0/resourceInstances/hasSameName?type='+type+'&name='+name,function(result1){	
									 		 if(result1.isExist=="true"){
												  systemMsg.alert("已存在名称为"+result1.name+"的资源实例");
												  callback(false);
											  }else{
												  callback(true);
											  }
									    });
								  }
						    });
					  }
			    });	
            }
            /************************************ 名称重复验证  ************************************/
            
            /************************************ 保存购物车  ************************************/
            this.confirmCommit = function(arg){
                var json;
                var type;
                if(arg=="vdiskCartInfo"){
                	if(!self.vdiskCartInfo.isValid()){
                		return;
                	}
                    json = self.vdiskCartInfo.toJSON();
                    type = "DISK";
                }else if(arg=="objectStorageCartInfo"){
                	if(!self.objectStorageCartInfo.isValid()){
                		return;
                	}
                    json = self.objectStorageCartInfo.toJSON();
                    type = "OBJECT_STORAGE";
                }else if(arg=="publicNetworkCartInfo"){
                	if(!self.publicNetworkCartInfo.isValid()){
                		return;
                	}
                    json = self.publicNetworkCartInfo.toJSON();
                    type = "PUBLICIP";
                }else if(arg=="loadbalancerCartInfo"){
                	if(!self.loadbalancerCartInfo.isValid()){
                		return;
                	}
                    json = self.loadbalancerCartInfo.toJSON();
                    type = "LOAD_BALANCING";
                }else if(arg=="sshKeytCartInfo"){
                	if(!self.sshKeytCartInfo.isValid()){
                		return;
                	}
                    json = self.sshKeytCartInfo.toJSON();
                    type = "SECRET_KEY";
                }else if(arg=="vmCartInfo"){
                	var bool=false;
                	self.vmCartInfo().mountDisks().forEach(function(e){
                		if(!e.isValid()){
                			bool=true;
                			ko.validation.group(e).showAllMessages();
                			return;
                		}
                	});
                	self.vmCartInfo().partitions().forEach(function(e){
                		if(!e.isValid()){
                			bool=true;
                			ko.validation.group(e).showAllMessages();
                			return;
                		}
                	});
                	if(!self.vmCartInfo.isValid() || bool){
                		return;
                	}
                	
                	
                    json = self.vmCartInfo.toJSON();
                    type= "VM";
                }
                nameCheck(json.name,type,json.uuid,function(pass){
						if(pass){
							csc.rest.put('api/v5.0.0/cart/update/'+arg,json,function(data){
			                	systemMsg.alert('修改成功！');
			                     if(arg=="vdiskCartInfo"){
			                        self.isEdit_Vdisk(false);
			                        var vdcItem = _.findWhere(self.vdiskCartInfo().vdcList(), {uuid: data.vdcUuid});
			                        var azItem = _.findWhere(self.vdiskCartInfo().azList(), {uuid: data.azUuid});
			                        var vmItem = _.findWhere(self.vdiskCartInfo().vmList(), {uuid: data.mountVmUuid});
			                        editObject.name(self.vdiskCartInfo().name());
			                        editObject.size(self.vdiskCartInfo().size());
			                        editObject.vdcName(vdcItem.name);
			                        editObject.azName(azItem.name);
			                        editObject.mountVmName(vmItem.name);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime)
			                    }else if(arg=="objectStorageCartInfo"){
			                        self.isEdit_ObjectStorage(false);
			                        var vdcItem = _.findWhere(self.objectStorageCartInfo().vdcList(), {uuid: data.vdcUuid});
			                        var azItem = _.findWhere(self.objectStorageCartInfo().azList(), {uuid: data.azUuid});
			                        editObject.name(self.objectStorageCartInfo().name());
			                        editObject.size(self.objectStorageCartInfo().size());
			                        editObject.vdcName(vdcItem.name);
			                        editObject.azName(azItem.name);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime)
			                    }else if(arg=="publicNetworkCartInfo"){
			                        self.isEdit_PublicNetwork(false);
			                        var vdcItem = _.findWhere(self.publicNetworkCartInfo().vdcList(), {uuid: data.vdcUuid});
			                        var azItem = _.findWhere(self.publicNetworkCartInfo().azList(), {uuid: data.azUuid});
			                        var vpcItem = _.findWhere(self.publicNetworkCartInfo().vpcList(), {uuid: data.vpcUuid});
			                        var networkItem = _.findWhere(self.publicNetworkCartInfo().networkList(), {uuid: data.netWorkId});
			                        editObject.name(self.publicNetworkCartInfo().name());
			                        editObject.vdcName(vdcItem.name);
			                        editObject.azName(azItem.name);
			                        editObject.vpcName(vpcItem.name);
			                        editObject.netWorkName(networkItem.name);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime)
			                        //..
			                    }else if(arg=="loadbalancerCartInfo"){
			                        self.isEdit_loadbalancer(false);
			                        var vdcItem = _.findWhere(self.loadbalancerCartInfo().vdcList(), {uuid: data.vdcUuid});
			                        var azItem = _.findWhere(self.loadbalancerCartInfo().azList(), {uuid: data.azUuid});
			                        editObject.name(data.name);
			                        editObject.vdcName(vdcItem.name);
			                        editObject.azName(azItem.name);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime)
			                    }else if(arg=="sshKeytCartInfo"){
			                        self.isEdit_sshKeyt(false);
			                        var vdcItem = _.findWhere(self.sshKeytCartInfo().vdcList(), {uuid: data.vdcUuid});
			                        var azItem = _.findWhere(self.sshKeytCartInfo().azList(), {uuid: data.azUuid});
			                        editObject.name(data.name);
			                        editObject.vdcName(vdcItem.name);
			                        editObject.azName(azItem.name);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime)
			                    }else if(arg=="vmCartInfo"){
			                        self.isEdit_vm(false);
			                        editObject.vmName(data.vmName);
			                        editObject.osVersionText(data.osVersionText);
			                        editObject.cpu(data.cpu);
			                        editObject.memory(data.memory);
			                        editObject.storage(data.storage);
			                        editObject.mountDiskNum(data.mountDiskNum);
			                        editObject.softwareNum(data.softwareNum);
			                        editObject.vdcName(data.vdcName);
			                        editObject.vpcName(data.vpcName);
			                        editObject.vpcNetworkName(data.vpcNetworkName);
			                        editObject.azName(data.azName);
			                        self.convertApplyText(data.applyType,data.applyNum,data.applyTime);
			                        editObject.id(data.id);
			                        editObject.uuid(data.uuid);
			                    }
			                     
			                });
						}
				}); 
            } 
            /************************************ 保存购物车  ************************************/
            
            
            
            this.step1 = ko.observable(true);
            this.step2 = ko.observable(false);
            this.step3 = ko.observable(false);
            this.step4 = ko.observable(false);
            this.step5 = ko.observable(false);

            function MountDiskVO(){
                this.name = ko.observable().extend({required:true});
                this.size = ko.observable().extend({required:true,number:true});
                this.type = ko.observable();
                this.serviceUuid = ko.observable().extend({required:true});
                this.serviceName = ko.observable().extend({required:true});
                this.billRuleUuid = ko.observable();
                this.applyType = ko.observable();
                this.applyNum = ko.observable();
                this.applyTime = ko.observable();
                this.applyText = ko.observable();
                this.billRuleList=ko.observableArray([]);
                this.price = ko.observable();
            }
            
            function PartitionVO(){
                this.name = ko.observable().extend({required:true});
                this.size = ko.observable().extend({required:true,number:true});
            }
            function SoftwareVO(){
                this.softwareUuid = ko.observable();
		    	this.scriptUuid = ko.observable();
		    	this.softwareName = ko.observable();
		    	this.softwareType = ko.observable();
		    	this.softwareSorts = ko.observable();
		    	this.softwareVersion = ko.observable();
		    	
		    	this.softwareParams=ko.observableArray([]);
		    }
		    
		    function SoftwareAttrVO(){
		    	this.softwareUuid = ko.observable();
		    	this.scriptUuid = ko.observable();
		    	this.paramsUuid = ko.observable();
		    	this.paramsKey = ko.observable();
		    	this.paramsValue = ko.observable();
		    	this.paramsName = ko.observable();
		    	this.defaultValue = ko.observable();
		    }
            this.isAdd_Vdisk = ko.observable(false);
            this.addMountDisks = function(){
                self.vmCartInfo().mountDisks.push(new ko.validatedObservable(new MountDiskVO));
            }
            this.delMountDisks = function (object){
                self.vmCartInfo().mountDisks.remove(object);
            }
            //选择云硬盘服务
            this.selectVdiskService = ko.observable(false);
            this.table_Vdisk_VM = null;
            this.selectVdiskService_VM = function(object){
                self.table_Vdisk_VM = new DataTable([], {path: 'api/v5.0.0/service/getServiceList/DISK?vdcUuid='+self.vmCartInfo().vdcUuid()+"&azUuid="+self.vmCartInfo().azUuid(),perPage:6});
                self.selectVdiskService(true);
                editObject = object;
            }
            this.submitVdiskService = function(){
                editObject.serviceName(self.table_Vdisk_VM.chosenItems().serviceName);
                editObject.serviceUuid(self.table_Vdisk_VM.chosenItems().serviceUuid);
                var attr;
                if(self.table_Vdisk_VM.chosenItems().feeType !=null && self.table_Vdisk_VM.chosenItems().feeType!=""){
                	attr=self.table_Vdisk_VM.chosenItems().feeType.split(",")
                }
                editObject.billRuleList(setArrayCharge(attr));
                self.selectVdiskService(false);
            }
            
            this.addPartitions = function(){
                self.vmCartInfo().partitions.push(new ko.validatedObservable(new PartitionVO()));
            }
            this.delPartitions = function (object){
                self.vmCartInfo().partitions.remove(object);
            }
            
            
            function setArrayCharge(attr){
    	    	var arrayCharge = [];
    	    	if(attr !=null){
    	    		for(var i=0;i<attr.length;i++){
        	    		if(attr[i]=="DAY"){
        	    			arrayCharge.push({name:"按天",value:"DAY"});
        	    		}else if(attr[i]=="MONTH"){
        	    			arrayCharge.push({name:"按月",value:"MONTH"});
        	    		}else if(attr[i]=="QUARTER"){
        	    			arrayCharge.push({name:"按季度",value:"QUARTER"});
        	    		}else{
        	    			arrayCharge.push({name:"按年",value:"YEAR"});
        	    		}
        	    	}
    	    	}
    	    	return arrayCharge;
    	    }
            
    	    this.sizeChange = function(arg,data,event){
    	    	var size;
    	    	var unitPrice;
    	    	var type;
    	    	if(arg=='DISK'){
    	    		size=data.vdiskCartInfo().size();
    	    		unitPrice=data.vdiskCartInfo().unitPrice();
    	    		type=data.vdiskCartInfo().billRuleUuid();
    	    	}else if(arg=='OBJECT_STORAGE'){
    	    		size=data.objectStorageCartInfo().size();
    	    		unitPrice=data.objectStorageCartInfo().unitPrice();
    	    		type=data.objectStorageCartInfo().billRuleUuid();
    	    	}
    	    	
    	    	if(typeof(type)=="undefined"||typeof(unitPrice)=="undefined"){
    	    		return;
    	    	}
    	    	var price = size*unitPrice;
        		if(type=="DAY"){
        			price+="元/天";
        		}else if(type=="MONTH"){
        			price+="元/月";
        		}else if(type=="QUARTER"){
        			price+="元/季度";
        		}else{
        			price+="元/年";
        		}
    	    	if(arg=='DISK'){
    	    		data.vdiskCartInfo().price(price);
    	    	}else if(arg=='OBJECT_STORAGE'){
    	    		data.objectStorageCartInfo().price(price);
    	    	}
    	    }
            
            this.chargeChangeCart = function(arg,data,event){//vm
               var serviceUuid;
               var cycle;
               if(arg=='VM'){
            	   serviceUuid=data.vmCartInfo().serviceUuid();
            	   cycle=data.vmCartInfo().billRuleUuid();
               }else if(arg=='vdisk_VM'){
            	   serviceUuid=data.serviceUuid();
            	   cycle=data.billRuleUuid();
               }else if(arg=="PUBLICIP"){
            	   serviceUuid=data.publicNetworkCartInfo().serviceUuid();
            	   cycle=data.publicNetworkCartInfo().billRuleUuid();   
               }else if(arg=="OBJECT_STORAGE"){
            	   serviceUuid=data.objectStorageCartInfo().serviceUuid();
            	   cycle=data.objectStorageCartInfo().billRuleUuid();
               }else if(arg=='DISK'){
            	   serviceUuid=data.vdiskCartInfo().serviceUuid();
            	   cycle=data.vdiskCartInfo().billRuleUuid(); 
               }else if(arg=="SSH"){
            	   serviceUuid=data.sshKeytCartInfo().serviceUuid();
            	   cycle=data.sshKeytCartInfo().billRuleUuid(); 
               }else if(arg=="LB"){
            	   serviceUuid=data.loadbalancerCartInfo().serviceUuid();
            	   cycle=data.loadbalancerCartInfo().billRuleUuid(); 
               }
               
    	    	csc.rest.get("api/v5.0.0/billing/rules/calculate?serviceUuid="+serviceUuid+"&cycle="+cycle, function(result){
    	    		var price = 0;
    	    		var cpu=0;
    	    		var memory=0;
    	    		var storage=0;
    	    		var size=0;
    	    		var type;
    	    	   if(arg=='VM'){
    	    		   cpu=data.vmCartInfo().cpu();
    	               memory=data.vmCartInfo().memory();
    	               storage=data.vmCartInfo().storage();
    	               type = data.vmCartInfo().billRuleUuid();
    	               if(typeof(type)=="undefined"  || typeof(cpu)=="undefined" || typeof(memory)=="undefined" || typeof(storage)=="undefined"){
    	            	   data.vmCartInfo().price("");
    	   	    			return;
    	               }
   	               }else if(arg=='vdisk_VM'){
 	                   size=data.size();
   	            	   type = data.billRuleUuid();
	   	               if(typeof(type)=="undefined" || typeof(size)=="undefined"){
	 	            	   data.price("");
	 	   	    			return;
	 	               }
   	               }else if(arg=='PUBLICIP'){
   	            		type=data.publicNetworkCartInfo().billRuleUuid();
	   	               if(typeof(type)=="undefined"){
	 	            	   data.publicNetworkCartInfo().price("");
	 	   	    			return;
	 	               }
   	               }else if(arg=='OBJECT_STORAGE'){
   	            	   size=data.objectStorageCartInfo().size();
  	            	   type=data.objectStorageCartInfo().billRuleUuid();
 	   	               if(typeof(type)=="undefined"){
 	 	            	   data.objectStorageCartInfo().price("");
 	 	   	    			return;
 	 	               }
   	               }else if(arg=='DISK'){
 	                   size=data.vdiskCartInfo().size();
   	            	   type = data.vdiskCartInfo().billRuleUuid();
	   	               if(typeof(type)=="undefined" || typeof(size)=="undefined"){
	 	            	   data.vdiskCartInfo().price("");
	 	   	    			return;
	 	               }
   	               }else if(arg=='SSH'){
   	            	   type = data.sshKeytCartInfo().billRuleUuid();
	   	               if(typeof(type)=="undefined"){
	 	            	   data.sshKeytCartInfo().price("");
	 	   	    			return;
	 	               }
   	               }else if(arg=='LB'){
   	            	   type = data.loadbalancerCartInfo().billRuleUuid();
	   	               if(typeof(type)=="undefined"){
	 	            	   data.loadbalancerCartInfo().price("");
	 	   	    			return;
	 	               }
   	               }
    	    	   
    	    	   
    	    		result.ruleList.forEach(function(e){
    	    			if(e.attrType=='CPU'){
    	    				price += cpu * e.unitPrice;
    	    			}else if(e.attrType=='MEMORY'){
    	    				price += memory * e.unitPrice;
    	    			}else if(e.attrType=='STORAGE'){
    	    				price += storage * e.unitPrice;
    	    			}else if(e.attrType=='DISK'){
    	    				price += size * e.unitPrice;
    	    				if(arg=='DISK'){
    	    					data.vdiskCartInfo().unitPrice(e.unitPrice);
    	    				}
    	    			}else if(e.attrType=='PUBLICIP'){
    	    				price += e.unitPrice;
    	    			}else if(e.attrType=='OBJECT_STORAGE'){
    	    				data.objectStorageCartInfo().unitPrice(e.unitPrice);
    	    				price += size * e.unitPrice;
    	    			}else if(e.attrType=='LOAD_BALANCING'){
     	    				price +=e.unitPrice;
     	    			}else if(e.attrType=='SECRET_KEY'){
     	    				price +=e.unitPrice;
     	    			}
    	    		});
	 	    		if(parseInt(price)!=price){
	 	    			price = price.toFixed(2);
	 	    		}
    	    		if(type=="DAY"){
    	    			price+="元/天";
    	    		}else if(type=="MONTH"){
    	    			price+="元/月";
    	    		}else if(type=="QUARTER"){
    	    			price+="元/季度";
    	    		}else{
    	    			price+="元/年";
    	    		}
    	    		
    	    		if(arg=='VM'){
    	    			data.vmCartInfo().price(price);
   	               }else if(arg=='vdisk_VM'){
   	            	    data.price(price);
   	               }else if(arg=='PUBLICIP'){
   	            		data.publicNetworkCartInfo().price(price);
   	               }else if(arg=='OBJECT_STORAGE'){
   	            		data.objectStorageCartInfo().price(price);
   	               }else if(arg=='DISK'){
   	            		data.vdiskCartInfo().price(price);
   	               }else if(arg=='SSH'){
   	            	    data.sshKeytCartInfo().price(price);
   	               }else if(arg=='LB'){
   	            	    data.loadbalancerCartInfo().price(price);
   	               }
    	    		
    	    	});	    	
    	    }
            
            /************************************ 云主机 软件添加  ************************************/
            var objectSoft;
	        this.selectSoftware = ko.observable(false);
		    this.table_Software_VM = null;
		    this.selectSoftware_VM = function(object){
		    	self.table_Software_VM = new DataTable([], {path: 'api/v5.0.0/soft/softwares?status=1&osType='+object.vmCartInfo().osType(),perPage:10});
		    	self.selectSoftware(true);
		    	objectSoft = object;
		    }
		    this.submitSoftwareService = function(){
		    	self.table_Software_VM.chosenItems().forEach(function(e){
		    		var vo=new SoftwareVO();
			    	vo.softwareUuid(e.uuid);
			    	vo.scriptUuid(e.scriptUuid);
			    	vo.softwareName(e.name);
			    	vo.softwareType(e.softTypeName);
			    	vo.softwareSorts(e.softType);
			    	vo.softwareVersion(e.version);
	                csc.rest.get("api/v5.0.0/script/defaultAttrs?scriptUuid="+e.scriptUuid, function(attrList) {
	                	var attrArray = attrList.results;
	                	console.log(attrArray);
	                	attrArray.forEach(function (f){
	                		var attrVo = new SoftwareAttrVO();
	                		attrVo.softwareUuid(e.softwareUuid);
	                		attrVo.scriptUuid(e.scriptUuid);
	                		attrVo.paramsUuid(f.uuid);
	                		attrVo.paramsKey(f.code);
	                		attrVo.defaultValue(f.value);
	                		attrVo.paramsName(f.name);
	                		vo.softwareParams.push(attrVo);
	                	});
	                	objectSoft.vmCartInfo().softwares.push(vo);
	                });
	                
		    		
		    	});
	            self.selectSoftware(false);
		    }
		    
		    this.delSoftwart_VM = function(obj,data,event){
		    	obj.vmCartInfo().softwares.remove(data);
		    }
	        /************************************ 云主机 软件添加  ************************************/
	        
	        /************************************ 云主机 软件静默安装属性  ************************************/
	        this.showSoftwareAttr = ko.observable(false);
	        this.disableAttr_VM = ko.observable();
	        
	        this.attrList_VM = ko.observableArray([]);
	        this.showAttr_VM = function(viewOrEdit,data,event){
	        	self.attrList_VM([]);
	            data.softwareParams().forEach(function (e){
	            	var parames = new SoftwareAttrVO();
	            	parames.defaultValue(e.defaultValue());
	            	parames.paramsKey(e.paramsKey());
	            	parames.paramsName(e.paramsName());
	            	parames.paramsUuid(e.paramsUuid());
	            	parames.paramsValue(e.paramsValue());
	            	parames.scriptUuid(e.scriptUuid());
	            	parames.softwareUuid(e.softwareUuid());
	            	self.attrList_VM.push(parames);
	            });
	        	self.disableAttr_VM(viewOrEdit);
	        	self.showSoftwareAttr(true);
	        	objectSoft = data;
	        }
	        
	        this.saveSoftwareAttr = function(){
	        	var item = this;
	        	objectSoft.softwareParams(self.attrList_VM());
	        	self.showSoftwareAttr(false);
	        	systemMsg.alert('保存成功');
	        }
	        /************************************ 云主机 软件静默安装属性  ************************************/
	        
	        /************************************ 云主机软件查询  ************************************/
	      	this.searchSoftwareParam = ko.observable({
	      		softwareName : "",
	      		softType:"",
	      		softTypeName:""
	      	})
	      	this.searchSoftware = function(){
	        	self.table_Software_VM.params(self.searchSoftwareParam());
	      	}
	      	/************************************ 云主机 软件查询  ************************************/
	      	
        }
        ko.applyBindings(new ViewModel, $('#page-content')[0]);
    });
    </script>

    <!-- 云硬盘查看\修改 -->
    <div role="dialog" aria-hidden="true" class="simple_form form-horizontal modal fade applyModeShow" data-bind="modal: { show: isEdit_Vdisk , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>申请云硬盘服务</h3>
                </div>
                <div class='modal-body form-horizontal row'>
                    <div class="form-inline clearfix" style="padding:0 15px 15px 0">
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">云硬盘名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value:vdiskCartInfo().name , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">存储大小(GB)<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value:vdiskCartInfo().size,event:{change:function(data, event){ $root.sizeChange('DISK',data,event) } , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:vdiskCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value:vdiskCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('vdiskCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:vdiskCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:vdiskCartInfo().azUuid,event:{change:function(data, event){ $root.azChangeGetVm('vdiskCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">挂载云主机<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:vdiskCartInfo().vmList,optionsText:'name',optionsValue:'uuid',value:vdiskCartInfo().mountVmUuid,event:{change:$root.vmChangeGetDate},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">备注</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" cols="30" rows="5" data-bind="value:vdiskCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">申请时长<i style="color:red">*</i></label>
                            <label class="col-xs-3 control-label">有效期至 </label>
                            <div class="col-xs-5">
                                <input type="text" style="width:126px" class="form-control applyDateFormat" data-bind="value:vdiskCartInfo().applyTime" disabled>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6" data-bind="visible:vdiskCartInfo().charge()=='true'">
                        <div class="row">
                            <label class="col-sm-4 control-label">套餐<i style="color:red">*</i></label>
                            <div class="col-sm-3">
								<select class="form-control w-xs" data-bind="options:vdiskCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value:vdiskCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('DISK',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                            <span class="control-label col-sm-5 text-left" style="height:34px;"  data-bind="text:vdiskCartInfo().price"></span>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('vdiskCartInfo') } , visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 云硬盘查看\修改 -->

    <!-- 对象存储查看\修改 -->
    <div role="dialog" aria-hidden="true" class="simple_form form-horizontal modal fade applyModeShow" data-bind="modal: { show: isEdit_ObjectStorage , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>申请对象存储服务</h3>
                </div>
                <div class='modal-body form-horizontal row'>
                    <div class="form-inline clearfix" style="padding:0 15px 15px 0">
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">对象存储名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value:objectStorageCartInfo().name , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">存储大小(GB)<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value:objectStorageCartInfo().size,event:{change:function(data, event){ $root.sizeChange('OBJECT_STORAGE',data,event) }} , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:objectStorageCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value:objectStorageCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('objectStorageCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:objectStorageCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:objectStorageCartInfo().azUuid,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">备注</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" cols="30" rows="5" data-bind="value: objectStorageCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">申请时长<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" value="1" data-bind="checked:objectStorageCartInfo().applyType,name:objectSingle , disable:$root.viewOrEdit"> 永久
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top:2px;" value="2" data-bind="checked:objectStorageCartInfo().applyType,name:objectSingle , disable:$root.viewOrEdit">
                                        <select class="form-control" data-bind="options:$root.MonthsList,optionsText:'name',optionsValue:'value',value:objectStorageCartInfo().applyNum , disable:$root.viewOrEdit"></select> 个月
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top: 2px;" value="3" data-bind="checked:objectStorageCartInfo().applyType,name:objectSingle , disable:$root.viewOrEdit">
                                        <span class="">有效期至 </span>
                                        <input type="text" style="width:126px" data-bind="value:objectStorageCartInfo().applyTime , disable:$root.viewOrEdit" class="form-control applyDateFormat">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6" data-bind="visible:objectStorageCartInfo().charge()=='true'">
                        <div class="row">
                            <label class="col-sm-4 control-label">套餐<i style="color:red">*</i></label>
                            <div class="col-sm-3">
								<select class="form-control w-xs" data-bind="options:objectStorageCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value:objectStorageCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('OBJECT_STORAGE',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                            <span class="control-label col-sm-5 text-left" style="height:34px;" data-bind="text:objectStorageCartInfo().price"></span>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('objectStorageCartInfo') } , visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 对象存储查看\修改 -->
    <!-- 公网IP查看\修改 -->
    <div role="dialog" aria-hidden="true" class="simple_form form-horizontal modal fade applyModeShow" data-bind="modal: { show: isEdit_PublicNetwork , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>公网IP服务修改</h3>
                </div>
                <div class='modal-body form-horizontal row'>
                    <div class="form-inline clearfix" style="padding:0 15px 15px 0">
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">公网IP名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value:publicNetworkCartInfo().name , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:publicNetworkCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value:publicNetworkCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('publicNetworkCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:publicNetworkCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:publicNetworkCartInfo().azUuid,event:{change:function(data, event){ $root.azChangeGetVpc('publicNetworkCartInfo',data,event)}},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VPC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:publicNetworkCartInfo().vpcList,optionsText:'name',optionsValue:'uuid',value:publicNetworkCartInfo().vpcUuid,event:{change:$root.vpcChangeByPublic},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">网络名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control input-sm" data-bind="options:publicNetworkCartInfo().networkList,optionsText:'name',optionsValue:'uuid',value:publicNetworkCartInfo().netWorkId,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">备注</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" cols="30" rows="5" data-bind="value: publicNetworkCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">申请时长<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" value="1" data-bind="checked: publicNetworkCartInfo().applyType,name:publicNetworkSingle , disable:$root.viewOrEdit"> 永久
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top: 2px;" value="2" data-bind="checked: publicNetworkCartInfo().applyType,name:publicNetworkSingle , disable:$root.viewOrEdit">
                                        <select class="form-control" data-bind="options:$root.MonthsList,optionsText:'name',optionsValue:'value',value:publicNetworkCartInfo().applyNum , disable:$root.viewOrEdit"></select> 个月
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top: 2px;" value="3" data-bind="checked: publicNetworkCartInfo().applyType,name:publicNetworkSingle">
                                        <span class="">有效期至 </span>
                                        <input type="text" style="width:126px" class="form-control applyDateFormat" data-bind="value: publicNetworkCartInfo().applyTime , disable:$root.viewOrEdit">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6" data-bind="visible:publicNetworkCartInfo().charge()=='true'">
                        <div class="row">
                            <label class="col-sm-4 control-label">套餐<i style="color:red">*</i></label>
                            <div class="col-sm-3">
								<select class="form-control w-xs" data-bind="options:publicNetworkCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value:publicNetworkCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('PUBLICIP',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                            <span class="control-label col-sm-5 text-left" style="height:34px;" data-bind="text: publicNetworkCartInfo().price"></span>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('publicNetworkCartInfo') }  , visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 公网IP查看\修改 -->
 
    <!-- 负载均衡 查看\修改-->
    <div role="dialog" aria-hidden="true" class="modal fade applyModeShow" data-bind="modal: { show: isEdit_loadbalancer , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>负载均衡器服务</h3>
                </div>
                <div class='modal-body form-horizontal row' style="max-width: 910px;">
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">负载均衡器名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value: loadbalancerCartInfo().name , disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control" data-bind="options:loadbalancerCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value:loadbalancerCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('loadbalancerCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control" data-bind="options:loadbalancerCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:loadbalancerCartInfo().azUuid,event:{change:function(data, event){ $root.azChangeGetVpc('loadbalancerCartInfo',data,event)}},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group col-md-6">
		              <div class="row">
		                <label class="col-sm-4 control-label">VPC<i style="color:red">*</i></label>
		                <div class="col-sm-8">
		                  <select class="form-control" data-bind="options: loadbalancerCartInfo().vpcList,optionsText:'name',optionsValue:'uuid',value: loadbalancerCartInfo().vpcUuid,event:{change:function(data, event){ $root.vpcChange('loadbalancerCartInfo',data,event)}},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
		                </div>
		              </div>
		            </div>
		            <div class="form-group col-md-6">
		              <div class="row">
		                <label class="col-sm-4 control-label">网络名称<i style="color:red">*</i></label>
		                <div class="col-sm-8">
		                  <select class="form-control" data-bind="options: loadbalancerCartInfo().networkList,optionsText:'name',optionsValue:'uuid',value:loadbalancerCartInfo().vpcNetworkUuid,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
		                </div>
		              </div>
		            </div>
		            <div class="form-group col-md-6">
		              <div class="row">
		                <label class="col-sm-4 control-label">协议<i style="color:red">*</i></label>
		                <div class="col-sm-8">
		                  <select class="form-control" data-bind="options: $root.ProtocolList,optionsText:'name',optionsValue:'value',value: loadbalancerCartInfo().agreement,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
		                </div>
		              </div>
		            </div>
		            <div class="form-group col-md-6">
		              <div class="row">
		                <label class="col-xs-4 control-label">负载均衡方式<i style="color:red">*</i></label>
		                <div class="col-sm-8">
		                  <select class="form-control" data-bind="options: $root.LBMothedList,optionsText:'name',optionsValue:'value',value: loadbalancerCartInfo().loadBalanceWay,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
		                </div>
		              </div>
		            </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">备注</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" cols="30" rows="5" data-bind="value: loadbalancerCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">申请时长<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" name="optionsRadiosi" value="1" data-bind="checked: loadbalancerCartInfo().applyType , disable:$root.viewOrEdit"> 永久
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="2" data-bind="checked: loadbalancerCartInfo().applyType , disable:$root.viewOrEdit">
                                        <select class="form-control" data-bind="options:MonthsList,optionsText:'name',optionsValue:'value',value: loadbalancerCartInfo().applyNum , disable:$root.viewOrEdit"></select> 个月
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="3" data-bind="checked: loadbalancerCartInfo().applyType , disable:$root.viewOrEdit">
                                        <span class="">有效期至 </span>
                                        <input type="text" style="width:126px" class="form-control applyDateFormat" data-bind="value: loadbalancerCartInfo().applyTime , disable:$root.viewOrEdit">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6" data-bind="visible: loadbalancerCartInfo().charge()=='true'">
                        <div class="row">
                            <label class="col-sm-4 control-label">套餐<i style="color:red">*</i></label>
                            <div class="col-sm-3">
                                 <select class="form-control w-xs" data-bind="options: loadbalancerCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value: loadbalancerCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('LB',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                            <span class="control-label col-sm-5 text-left" style="height:34px;"  data-bind="text:loadbalancerCartInfo().price"></span>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('loadbalancerCartInfo') } , visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                </div>
            </div>
        </div>
    </div>
    <!-- 负载均衡 查看\修改-->

    <!-- ssh密钥  查看 \修改-->
    <div role="dialog" aria-hidden="true" class="modal fade applyModeShow" data-bind="modal: { show: isEdit_sshKeyt , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>SSH密钥服务</h3>
                </div>
                <div class='modal-body form-horizontal row'>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">SSH密钥名称<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" data-bind="value: sshKeytCartInfo().name,disable:$root.viewOrEdit">
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control" data-bind="options:sshKeytCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value: sshKeytCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('sshKeytCartInfo',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <select class="form-control" data-bind="options: sshKeytCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:sshKeytCartInfo().azUuid,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">备注</label>
                            <div class="col-sm-8">
                                <textarea class="form-control" cols="30" rows="5" data-bind="value: sshKeytCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6">
                        <div class="row">
                            <label class="col-sm-4 control-label">申请时长<i style="color:red">*</i></label>
                            <div class="col-sm-8">
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" name="optionsRadiosi" value="1" data-bind="checked: sshKeytCartInfo().applyType , disable:$root.viewOrEdit"> 永久
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="2" data-bind="checked: sshKeytCartInfo().applyType , disable:$root.viewOrEdit">
                                        <select class="form-control" data-bind="options:MonthsList,optionsText:'name',optionsValue:'value',value: sshKeytCartInfo().applyNum , disable:$root.viewOrEdit"></select> 个月
                                    </label>
                                </div>
                                <div class="radio">
                                    <label class="form-inline">
                                        <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="3" data-bind="checked: sshKeytCartInfo().applyType , disable:$root.viewOrEdit">
                                        <span class="">有效期至 </span>
                                        <input type="text" style="width:126px" class="form-control applyDateFormat" data-bind="value: sshKeytCartInfo().applyTime , disable:$root.viewOrEdit">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group col-md-6" data-bind="visible: sshKeytCartInfo().charge()=='true'">
                        <div class="row">
                            <label class="col-sm-4 control-label" >套餐<i style="color:red">*</i></label>
                            <div class="col-sm-3">
                                 <select class="form-control w-xs" data-bind="options: sshKeytCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value: sshKeytCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('SSH',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                            </div>
                            <span class="control-label col-sm-5 text-left" style="height:34px;"  data-bind="text:sshKeytCartInfo().price"></span>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('sshKeytCartInfo') } , visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                </div>
            </div>
        </div>
    </div>
    <!-- ssh密钥 查看 \修改 -->
   
    <!-- 云主机 查看\修改 -->
    <div role="dialog" aria-hidden="true" class="modal fade applyModeShow" data-bind="modal: { show: isEdit_vm , backdrop: 'static'}">
        <div class='modal-dialog modal-lg'>
            <div class='modal-content'>
                <div class='modal-header'>
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                    <h3 class='modal-title'>云主机服务</h3>
                </div>
                <div class='modal-body form-horizontal row' style="max-width: 910px;">
                    <div class="panel panel-default no-height" style="margin:0;border:none">
                        <div class="panel-heading">基本信息 <span style="cursor:pointer;" class="glyphicon pull-right" data-bind="click:function(){ step1(!step1())},css:{'glyphicon-chevron-up': step1(), 'glyphicon-chevron-down': !step1()}"></span></div>
                        <div class="panel-body" data-bind="visible: step1">
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">云主机名称<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control w" data-bind="value:vmCartInfo().vmName,disable:$root.viewOrEdit">
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">所属VDC<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <select class="form-control w" data-bind="options:vmCartInfo().vdcList,optionsText:'name',optionsValue:'uuid',value: vmCartInfo().vdcUuid,event:{change:function(data, event){ $root.vdcChange('vmCartInfo',data,event) }},optionsCaption:'请选择',disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">可用分区<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <select class="form-control w" data-bind="options: vmCartInfo().azList,optionsText:'name',optionsValue:'uuid',value:vmCartInfo().azUuid,event:{change:function(data, event){ $root.azChangeGetVpc('vmCartInfo',data,event)}},optionsCaption:'请选择',disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">操作系统类型<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <select class="form-control w" data-bind="options: vmCartInfo().osTypeList,optionsText:$data,optionsValue:$data,value:vmCartInfo().osType,event:{change:function(data, event){ $root.osTypeChangeGetOsVersion('vmCartInfo',data,event)}},optionsCaption:'请选择',disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">操作系统版本<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <select class="form-control w" data-bind="options: vmCartInfo().osVersionList,optionsText:'opSysVersion',optionsValue:'uuid',value:vmCartInfo().osVersion,optionsCaption:'请选择',disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3">
                                <div class="row">
                                    <label class="col-xs-5 control-label">CPU(个)<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-xs" data-bind="options: vmCartInfo().cpuList,optionsText:$data,optionsValue:$data,value:vmCartInfo().cpu,optionsCaption:'请选择',disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">内存(GB)<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-xs" data-bind="options: vmCartInfo().memoryList,optionsText:$data,optionsValue:$data,value:vmCartInfo().memory,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">存储(GB)<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <input type="text" class="form-control" data-bind="value: vmCartInfo().storage , disable:$root.viewOrEdit">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3">
                                <div class="row">
                                    <label class="col-xs-5 control-label">VPC/IP池<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-x" data-bind="options:vmCartInfo().vpcList,optionsText:'name',optionsValue:'uuid',value:vmCartInfo().vpcUuid,event:{change:function(data, event){ $root.vpcChange('vmCartInfo',data,event)}},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">网络名称<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-x" data-bind="options:vmCartInfo().networkList,optionsText:'name',optionsValue:'uuid',value:vmCartInfo().vpcNetworkUuid,event:{change:function(data, event){ $root.networkChangeGetIp('vmCartInfo',data,event)}},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">指定IP</label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-x" data-bind="options:vmCartInfo().ipList,optionsText:'ip',optionsValue:'ip',value:vmCartInfo().ip,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">密码</label>
                                    <div class="col-xs-7">
                                        <input type="password" class="form-control" data-bind="value: vmCartInfo().password , disable:$root.viewOrEdit">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-4">
                                <div class="row">
                                    <label class="col-xs-5 control-label">重复密码</label>
                                    <div class="col-xs-7">
                                        <input type="password" class="form-control" data-bind="value: vmCartInfo().repeatPassword , disable:$root.viewOrEdit">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3" data-bind="visible:vmCartInfo().cloudPlatform">
                                <div class="row">
                                    <label class="col-xs-5 control-label">选择密钥</label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-xs" data-bind="options:vmCartInfo().sshList,optionsText:'name',optionsValue:'uuid',value:vmCartInfo().sshUuid,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="form-group col-md-5">
                                <div class="row">
                                    <label class="col-xs-4 control-label">申请时长<i style="color:red">*</i></label>
                                    <div class="col-sm-8">
                                        <div class="radio">
                                            <label class="form-inline">
                                                <input type="radio" name="optionsRadiosi" value="1" data-bind="checked: vmCartInfo().applyType , disable:$root.viewOrEdit"> 永久
                                            </label>
                                        </div>
                                        <div class="radio">
                                            <label class="form-inline">
                                                <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="2" data-bind="checked: vmCartInfo().applyType , disable:$root.viewOrEdit">
                                                <select class="form-control" data-bind="options:MonthsList,optionsText:'name',optionsValue:'value',value: vmCartInfo().applyNum , disable:$root.viewOrEdit"></select> 个月
                                            </label>
                                        </div>
                                        <div class="radio">
                                            <label class="form-inline">
                                                <input type="radio" class="form-control" style="top:2px;" name="optionsRadiosi" value="3" data-bind="checked: vmCartInfo().applyType , disable:$root.viewOrEdit">
                                                <span class="">有效期至 </span>
                                                <input type="text" style="width:126px" class="form-control applyDateFormat" data-bind="value: vmCartInfo().applyTime , disable:$root.viewOrEdit">
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="form-group col-md-3"  data-bind="visible:vmCartInfo().charge()=='true'">
                                <div class="row">
                                    <label class="col-xs-5 control-label">套餐<i style="color:red">*</i></label>
                                    <div class="col-xs-7">
                                        <select class="form-control w-xs" data-bind="options: vmCartInfo().billRuleList,optionsText:'name',optionsValue:'value',value:vmCartInfo().billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('VM',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <span class="control-label col-md-3 text-left" style="height:34px;" data-bind="text: vmCartInfo().price"></span>
                        </div>
                    </div>
                    <div class="panel panel-default no-height" style="margin:0;border:none">
                      <div class="panel-heading">挂载云硬盘 <span style="cursor:pointer;" class="glyphicon pull-right" data-bind="click: function(){step2(!step2())},css:{'glyphicon-chevron-up': step2(), 'glyphicon-chevron-down': !step2()}"></span></div>
                      <div class="panel-body" data-bind="visible: step2">
                        <div style="margin:0;">
                          <a class="btn btn-info btn-sm pull-right" data-bind="click: addMountDisks ,visible:!$root.viewOrEdit()">添加硬盘</a>
                          <div class="clearfix" style="height:10px;clear:both;"></div>
                          <div class="panel panel-default table-responsive no-height">
                            <table class="table table-striped">
                              <thead>
                                <th>序号</th>
                                <th>云硬盘名称<i style="color:red">*</i></th>
                                <th>存储大小<i style="color:red">*</i></th>
                                <th>所属服务<i style="color:red">*</i></th>
                                <th>申请时长</th>
                                <th>套餐</th>
                                <th>收费标准</th>
                                <th data-bind="visible:!$root.viewOrEdit()">操作</th>
                              </thead>
                              <tbody data-bind="foreach:vmCartInfo().mountDisks">
                                <tr>
                                    <td><span data-bind="text: ($index()+1)"></span></td>
                                    <td><input type="text" class="form-control" data-bind="value:name"/></td>
                                    <td><input type="text" class="form-control" data-bind="value:size"/></td>
                                    <td><input type="text" class="form-control" data-bind="value:serviceName" disabled/> <a class="btn btn-xs btn-default" data-bind="click:$root.selectVdiskService_VM ,visible:!$root.viewOrEdit()">选择</a></td>
                                    <td><span data-bind="text: $root.vmCartInfo().applyText"></span></td>
                                    <td><select class="form-control w-xs" data-bind="options: billRuleList,optionsText:'name',optionsValue:'value',value:billRuleUuid,event:{change:function(data, event){ $root.chargeChangeCart('vdisk_VM',data,event) }},optionsCaption:'请选择' , disable:$root.viewOrEdit"></select></td>
                                    <td><span data-bind="text: price"></span></td>
                                    <td data-bind="visible:!$root.viewOrEdit()"><a class="btn btn-xs btn-danger" data-bind="click:$root.delMountDisks">删除</a></td>
                                </tr>
                                
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="panel panel-default no-height" style="margin:0;border:none">
                        <div class="panel-heading">安装软件 <span style="cursor:pointer;" class="glyphicon pull-right" data-bind="click: function(){step3(!step3())},css:{'glyphicon-chevron-up': step3(), 'glyphicon-chevron-down': !step3()}"></span></div>
                        <div class="panel-body" data-bind="visible: step3">
                            <div style="margin:0;">
                                <a class="btn btn-info btn-sm pull-right"  data-bind="click: $root.selectSoftware_VM ,visible:!$root.viewOrEdit()">添加软件</a>
                                <div class="clearfix" style="height:10px;clear:both;"></div>
                                <div class="panel panel-default table-responsive no-height">
                                    <table class="table table-striped">
                                        <thead>
                                            <th>软件名称</th>
                                            <th>软件分类</th>
                                            <th>软件类型</th>
                                            <th>软件版本</th>
                                            <th>静默安装属性</th>
                                            <th data-bind="visible:!$root.viewOrEdit()">操作</th>
                                        </thead>
                                        <tbody data-bind="foreach: vmCartInfo().softwares">
						                    <tr>
						                      <td data-bind="text:softwareName"></td>
						                      <td data-bind="text:softwareSorts"></td>
						                      <td data-bind="text:softwareType"></td>
						                      <td data-bind="text:softwareVersion"></td>
						                      <td><a class="btn btn-xs btn-default" data-bind="click:function(data,event){$root.showAttr_VM(true,data,event)}">查看</a> <a class="btn btn-xs btn-default" data-bind="click:function(data,event){$root.showAttr_VM(false,data,event)} ,visible:!$root.viewOrEdit()">修改</a></td>
						                      <td data-bind="visible:!$root.viewOrEdit()"><a class="btn btn-xs btn-danger" data-bind="event:{click:function(data, event){ $root.delSoftwart_VM($parent,data,event) }}">删除</a></td>
						                    </tr>
						                  </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default no-height" style="margin:0;border:none">
                      <div class="panel-heading">系统盘分区 <span style="cursor:pointer;" class="glyphicon pull-right" data-bind="click: function(){step4(!step4())},css:{'glyphicon-chevron-up': step4(), 'glyphicon-chevron-down': !step4()}"></span></div>
                      <div class="panel-body" data-bind="visible: step4">
                        <div style="margin:0;">
                          <a class="btn btn-info btn-sm pull-right" data-bind="click: addPartitions ,visible:!$root.viewOrEdit() && $root.isViewPartition">添加分区</a>
                          <div class="clearfix" style="height:10px;clear:both;"></div>
                          <div class="panel panel-default table-responsive no-height">
                            <table class="table table-striped">
                              <thead>
                                <th>分区名称<i style="color:red">*</i></th>
                                <th>分区大小<i style="color:red">*</i></th>
                                <th data-bind="visible:!$root.viewOrEdit()">操作</th>
                              </thead>
                              <tbody data-bind="foreach:vmCartInfo().partitions">
                                <tr>
                                  <td><input type="text" class="form-control" data-bind="value:name , disable:$root.viewOrEdit"/></td>
                                  <td><input type="text" class="form-control" data-bind="value:size , disable:$root.viewOrEdit"/></td>
                                  <td data-bind="visible:!$root.viewOrEdit()"><a class="btn btn-xs btn-danger" data-bind="click:$root.delPartitions">删除</a></td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="panel panel-default no-height" style="margin:0;border:none">
                        <div class="panel-heading">高级选项 <span style="cursor:pointer;" class="glyphicon pull-right" data-bind="click: function(){step5(!step5())},css:{'glyphicon-chevron-up': step5(), 'glyphicon-chevron-down': !step5()}"></span></div>
                        <div class="panel-body" data-bind="visible: step5">
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">所属业务系统</label>
                                    <div class="col-sm-8">
                                        <select class="form-control w-xs" data-bind="options: vmCartInfo().bussyList,optionsText:'name',optionsValue:'uuid',value:vmCartInfo().projectUuid,optionsCaption:'请选择' , disable:$root.viewOrEdit"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="form-group col-md-6">
                                <div class="row">
                                    <label class="col-sm-4 control-label">备注</label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" cols="30" rows="5" data-bind="value: vmCartInfo().remark , disable:$root.viewOrEdit"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='modal-footer' style="text-align:center;">
                    <a class="btn btn-default btn-info" data-bind="click: function(data, event){ $root.confirmCommit('vmCartInfo') } ,visible:!$root.viewOrEdit()">确定</a>
                    <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
                  </div>
            </div>
        </div>
    </div>
    <!-- 云主机 查看\修改 -->
    <!-- 选择云服务页面 -->
    <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: selectVdiskService , backdrop: 'static'}">
      <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
          <div class='modal-header'>
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择云硬盘服务</h3>
          </div>
          <div class='modal-body form-horizontal'>
            <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: $root.table_Vdisk_VM">
             <table class="table table-striped">
               <thead>
                 <th></th>
                 <th>云硬盘服务名称<i style="color:red">*</i></th>
                 <th>类型<i style="color:red">*</i></th>
                 <th>是否收费<i style="color:red">*</i></th>
               </thead>
               <tbody>
               <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                 <tr>
                   <td><input type="radio" style="top:-2px;" name="optionsRadios0"  data-bind="checkedValue: $data, checked: $parent.chosenItems"></td>
                   <td data-bind="text:serviceName"></td>
                   <td data-bind="text:diskType">类型</td>
                   <td data-bind="text:isFee">是/否</td>
                 </tr>
                 <!-- /ko -->
               </tbody>
             </table>
             <footer class="panel-footer" data-bind="with: $root.table_Vdisk_VM">
        <ul class="pagination">
            <li data-bind="css: leftPagerClass, click: prevPage">
              <a href="#">&laquo;</a>
            </li>
            <!-- ko foreach: {data: (new Array(pages()))} -->
            <li data-bind="css: $parent.pageClass($index() + 1)">
              <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
            </li>
            <!-- /ko -->
            <li data-bind="css: rightPagerClass, click: nextPage">
              <a href="#">&raquo;</a>
            </li>
        </ul>
        </footer>
           </div>
           
         </div>
         <div class='modal-footer' style="text-align:center;">
            <a class="btn btn-default btn-info" data-bind="click: submitVdiskService">确定添加</a>
            <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
          </div>
        </div>
      </div>
    </div>
    <!-- 选择云服务页面 -->

    <!-- 添加软件 -->
    <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: selectSoftware , backdrop: 'static'}">
      <div class='modal-dialog modal-lg' role='document'>
        <div class='modal-content'>
          <div class='modal-header'>
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择软件</h3>
          </div>
          <div class='modal-body form-horizontal'>
             <div class="form-inline" style="margin-bottom: 10px;">
				<div class="input-group">
					<span class="input-group-addon">软件名称</span> <input class="form-control input-sm" data-bind="value:searchSoftwareParam().softwareName"/>
				</div>
				<div class="input-group">
					<span class="input-group-addon">软件分类</span> <select name=""
						id="" class="form-control input-sm" data-bind="options:$root.AllSoftTypeList,optionsText:'name',optionsValue:'name',value:searchSoftwareParam().softType ,optionsCaption:'请选择'" ></select>
				</div>
				<div class="input-group">
					<span class="input-group-addon">软件类型</span> <select name=""
						id="" class="form-control input-sm" data-bind="options:$root.AllSoftTypeNameList,optionsText:'name',optionsValue:'name',value:searchSoftwareParam().softTypeName ,optionsCaption:'请选择'"></select>
				</div>
				<a class="btn btn-default btn-sm" data-bind="click: searchSoftware">搜索</a>
			</div>
          
            <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: $root.table_Software_VM">
             <table class="table table-striped">
               <thead>
                 <th></th>
                 <th>软件名称</th>
                 <th>软件类型</th>
                 <th>软件版本</th>
               </thead>
               <tbody>
                 <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                 <tr>
                   <td><input type="checkbox" style="top:-2px;" name="optionsRadios0"  data-bind="checkedValue: $data, checked: $parent.chosenItems"></td>
                   <td data-bind="text:name"></td>
                   <td data-bind="text:softType"></td>
                   <td data-bind="text:version"></td>
                 </tr>
                 <!-- /ko -->
               </tbody>
             </table>
           </div>
           <footer class="panel-footer" data-bind="with: $root.table_Software_VM">
		        <ul class="pagination">
		            <li data-bind="css: leftPagerClass, click: prevPage">
		              <a href="#">&laquo;</a>
		            </li>
		            <!-- ko foreach: {data: (new Array(pages()))} -->
		            <li data-bind="css: $parent.pageClass($index() + 1)">
		              <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
		            </li>
		            <!-- /ko -->
		            <li data-bind="css: rightPagerClass, click: nextPage">
		              <a href="#">&raquo;</a>
		            </li>
		        </ul>
        	  </footer>
         </div>
         <div class='modal-footer' style="text-align:center;">
            <a class="btn btn-default btn-info" data-bind="click: submitSoftwareService">确定选择</a>
            <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
          </div>
        </div>
      </div>
    </div>
    <!-- 添加软件 -->
       <!-- 查看/修改软件参数 --> 
   <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: showSoftwareAttr , backdrop: 'static'}"> 
     <div class='modal-dialog modal-lg' role='document'> 
       <div class='modal-content'> 
         <div class='modal-header'> 
           <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>静默安装属性</h3> 
         </div> 
         <div class='modal-body form-horizontal'> 
           <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px"> 
            <table class="table table-striped"> 
              <thead> 
                <th>参数名称<i style="color:red">*</i></th> 
                <th>参数代码<i style="color:red">*</i></th> 
                <th>默认值<i style="color:red">*</i></th> 
				<th>修改值</th> 
              </thead> 
              <tbody  data-bind="foreach: $root.attrList_VM"> 
                <tr>
                <td data-bind="text:paramsName"></td>
                <td data-bind="text:paramsKey"></td>
                <td data-bind="text:defaultValue"></td>
                <td><input type="text" class="form-control" data-bind="value:paramsValue,disable:$root.disableAttr_VM" /></td>
                </tr> 
              </tbody> 
            </table> 
          </div> 
        </div> 
        <div class='modal-footer' style="text-align:center;"> 
           <a class="btn btn-default btn-info" data-bind="click:saveSoftwareAttr ,visible:!$root.disableAttr_VM()">保存</a> 
           <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a> 
         </div> 
       </div> 
     </div> 
   </div> 
   <!-- 查看/修改软件参数 -->
