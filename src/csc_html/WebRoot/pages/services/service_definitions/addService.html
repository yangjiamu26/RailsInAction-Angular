<style>
.service-img-box {
	position: relative;
	width: 60px;
	height: 60px;
}

.service-img-box a {
	font-size: 12px;
	text-align: center;
	position: absolute;
	bottom: 0;
	width: 100%;
	color: #fff;
	height: 16px;
	line-height: 16px;
	background: rgba(0, 0, 0, .2)
}

.ztree.release li a.curSelectedNode {
	background: none;
	color: #82939E;
}

.ztree.release li a:hover {
	border-color: #fff;
	background-color: #fff;
}

.jifei-heading {
	overflow: hidden;
	height: 60px;
}

.jifei-btn {
	position: relative;
	right: 0;
	top: -34px;
	float: right;
}

.jifei-panel {
	margin: 0;
	margin-top: 20px;
}
</style>
<div class="simple_form form-horizontal">
	<div class='modal-dialog modal-lg' style="width: 800px;">
		<div class='modal-content' id="serviceInfoPage">
			<div class='modal-header'>
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span>
				</button>
				<h3 class='modal-title'>创建服务</h3>
			</div>
			<div class='modal-body no-padder'>
				<ul class="nav nav-tabs service-step-select">
					<li class="active"><a>1基本信息</a></li>
					<li class=""><a>2服务资源</a></li>
					<li class=""><a>3服务计费</a></li>
					<li class=""><a>4发布范围</a></li>
				</ul>
				<div class="tab-content service-step-box m-t">
					<div class="tab-pane active" >
						<div class='form-horizontal row'>
							<div class="form-group">
								<label class="col-xs-3 control-label">服务名称：</label>
								<div class="col-xs-7">
									<input type="text" class="form-control" placeholder="请输入名称"
										data-bind="value: serviceVO().name">
								</div>
								<div class="col-xs-1">
									<span class="text-danger inline m-l-n m-t-sm">*</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-3 control-label">服务目录：</label>
								<div class="col-xs-7">
									<input type="text" id="selectDir" class="form-control"
										placeholder="请选择服务目录" data-bind="value: serviceVO().dirName">
									<input type="hidden" id="dirUuid"
										data-bind="value: serviceVO().dirUUID" />
								</div>
								<div class="col-xs-1">
									<span class="text-danger inline m-l-n m-t-sm">*</span>
								</div>
							</div>
							<div id="dirContent"
								style="display: none; position: absolute; z-index: 10000; background-color: white; border-left: 1px #DDDDDD solid; border-bottom: 1px #DDDDDD solid; border-right: 1px #DDDDDD solid; width: 420px; height: 198px; overflow: scroll;">
								<div style="width: 700px">
									<ul id="dirTree" class="ztree" style="z-index: 1000;"></ul>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-3 control-label">产品：</label>
								<div class="col-xs-7">
									<select class="form-control"
										data-bind="value: serviceVO().productId">
										<option value="1">VDC</option>
										<option value="2">云主机</option>
										<option value="3">云盘</option>
										<option value="4">负载均衡</option>
										<option value="5">IP</option>
										<option value="6">对象存储</option>
										<option value="7">SSH密钥</option>
									</select>
								</div>
								<div class="col-xs-1">
									<span class="text-danger inline m-l-n m-t-sm">*</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-3 control-label">服务图标：</label>
								<div class="col-xs-7">
									<div class="service-img-box">
										<img src="" alt="" width="60" height="60"
											data-bind="value: serviceVO().imageUrl"> <a
											onclick="showModal('pages/service/product_definitions_uploadimg.html')">更改图标</a>
									</div>
								</div>								
							</div>
							<div class="form-group">
								<label class="col-xs-3 control-label">服务介绍：</label>
								<div class="col-xs-7">
									<textarea class="form-control" cols="30" rows="3"
										data-bind="value: serviceVO().desc"></textarea>
								</div>
								<div class="col-xs-1">
									<span class="text-danger inline m-l-n m-t-sm">*</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-3 control-label">有效期：</label>
								<div class="col-xs-7">
									<div class="radio">
										<label class="form-inline"> 
											<input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked> 永久
										</label>
									</div>
									<div class="radio">
										<label class="form-inline"> 
											<input type="radio" class="form-control" style="top: 2px;" name="optionsRadios" id="optionsRadios2" value="option2">
											<select class="form-control" data-bind="value: serviceVO().validTimeNum">
												<option value="1">1</option>
												<option value="1">2</option>
											</select> 个月
										</label>
									</div>
									<div class="radio disabled">
										<label class="form-inline"> 
											<input type="radio" class="form-control" style="top: 2px;" name="optionsRadios" id="optionsRadios3" value="option3"> 
											<input type="text" style="width: 206px" class="form-control" id="addServer_daterange">
										</label>
									</div>
								</div>
								<div class="col-xs-1">
									<span class="text-danger inline m-l-n m-t-sm">*</span>
								</div>
							</div>
						</div>
					</div>
 					<div class="tab-pane" id="service_vdc">
						<div class='form-horizontal row'>														
							<div class="form-group">
								<label class="col-xs-2 control-label">操作系统类型：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label>
											<input type="checkbox"> 全选
										</label>
									</div>
									<div class="checkbox" data-bind="foreach: configVO().conditions">
						                <label>
						                  <input type="checkbox" data-bind="checkedValue: $data.id, checked: $parent.fields_selected_ids">
						                  <i></i><a data-bind="text: name"></a>
						                </label>
					              	</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="windows" data-bind="checked: serviceVmVO().osType">windows
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="linux" data-bind="checked: serviceVmVO().osType">linux
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="aix" data-bind="checked: serviceVmVO().osType">aix
										</label>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">操作系统版本：</label>
								<div class="col-xs-9">
									<div class="panel panel-default"
										style="margin: 0; padding-bottom: 10px">
										<table class="table table-striped">
											<thead>
												<th>可用分区</th>
												<th>操作系统类型</th>
												<th>操作系统版本</th>
												<th>关联镜象</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>分区1</td>
													<td>windows</td>
													<td>windows server 2008 64bit</td>
													<td>windows2008</td>
													<td><a class="btn btn-xs btn-default" onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
										<a class="btn btn-sm btn-success" style="margin-left: 10px;">添加</a>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">CPU(核)：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label> <input type="checkbox" value=""> 全选
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="1" data-bind="checked: serviceVmVO().cpu"> 1
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="2" data-bind="checked: serviceVmVO().cpu"> 2
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="4" data-bind="checked: serviceVmVO().cpu"> 4
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="8" data-bind="checked: serviceVmVO().cpu"> 8
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="16" data-bind="checked: serviceVmVO().cpu"> 16
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="32" data-bind="checked: serviceVmVO().cpu"> 32
										</label>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">内存：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label> <input type="checkbox" value=""> 全选
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="1" data-bind="checked: serviceVmVO().memory"> 1
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="2" data-bind="checked: serviceVmVO().memory"> 2
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="4" data-bind="checked: serviceVmVO().memory"> 4
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="8" data-bind="checked: serviceVmVO().memory"> 8
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="16" data-bind="checked: serviceVmVO().memory"> 16
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="32" data-bind="checked: serviceVmVO().memory"> 32
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="64" data-bind="checked: serviceVmVO().memory"> 64
										</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- <div class="tab-pane" id="service_vm">
						<div class='form-horizontal row'>
							<div class="form-group">
								<label class="col-xs-2 control-label">虚拟化：</label>
								<div class="col-xs-9">
									<select class="form-control" data-bind="value: serviceVmVO().virtualName">
										<option value="KVM">KVM</option>
										<option value="CNWARE">CNWARE</option>
										<option value="OPENSTACK">OPENSTACK</option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">可用分区：</label>
								<div class="col-xs-9">
								  <div id="serviceModalTree" class="ztree release" data-bind="value: serviceVmVO().azUuid"></div>
								  <div class="checkbox">
										<label>
											<input type="checkbox"> 全选
										</label>
									</div>
									<div class="checkbox" style="margin-left: 15px">
										<label> <input type="checkbox" value="az1" data-bind="checked: serviceVmVO().azUuid">可用分区1
										</label>
									</div>
									<div class="checkbox" style="margin-left: 15px">
										<label> <input type="checkbox" value="az2" data-bind="checked: serviceVmVO().azUuid">可用分区2
										</label>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">操作系统类型：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label>
											<input type="checkbox"> 全选
										</label>
									</div>
									<div class="checkbox" data-bind="foreach: configVO().conditions">
						                <label>
						                  <input type="checkbox" data-bind="checkedValue: $data.id, checked: $parent.fields_selected_ids">
						                  <i></i><a data-bind="text: name"></a>
						                </label>
					              	</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="windows" data-bind="checked: serviceVmVO().osType">windows
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="linux" data-bind="checked: serviceVmVO().osType">linux
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="aix" data-bind="checked: serviceVmVO().osType">aix
										</label>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">操作系统版本：</label>
								<div class="col-xs-9">
									<div class="panel panel-default"
										style="margin: 0; padding-bottom: 10px">
										<table class="table table-striped">
											<thead>
												<th>可用分区</th>
												<th>操作系统类型</th>
												<th>操作系统版本</th>
												<th>关联镜象</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>分区1</td>
													<td>windows</td>
													<td>windows server 2008 64bit</td>
													<td>windows2008</td>
													<td><a class="btn btn-xs btn-default" onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
										<a class="btn btn-sm btn-success" style="margin-left: 10px;">添加</a>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">CPU(核)：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label> <input type="checkbox" value=""> 全选
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="1" data-bind="checked: serviceVmVO().cpu"> 1
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="2" data-bind="checked: serviceVmVO().cpu"> 2
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="4" data-bind="checked: serviceVmVO().cpu"> 4
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="8" data-bind="checked: serviceVmVO().cpu"> 8
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="16" data-bind="checked: serviceVmVO().cpu"> 16
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="32" data-bind="checked: serviceVmVO().cpu"> 32
										</label>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label class="col-xs-2 control-label">内存：</label>
								<div class="col-xs-9 form-inline">
									<div class="checkbox">
										<label> <input type="checkbox" value=""> 全选
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="1" data-bind="checked: serviceVmVO().memory"> 1
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="2" data-bind="checked: serviceVmVO().memory"> 2
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="4" data-bind="checked: serviceVmVO().memory"> 4
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="8" data-bind="checked: serviceVmVO().memory"> 8
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="16" data-bind="checked: serviceVmVO().memory"> 16
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="32" data-bind="checked: serviceVmVO().memory"> 32
										</label>
									</div>
									<div class="checkbox">
										<label> <input type="checkbox" value="64" data-bind="checked: serviceVmVO().memory"> 64
										</label>
									</div>
								</div>
							</div>
						</div>
					</div> -->

					<div class="tab-pane" id="isFeePage">
						<div class='form-horizontal row'>
							<div class="form-group">
								<label class="col-xs-2 control-label">是否计费：</label>
								<div class="col-xs-9 form-inline">
									<div class="radio">
										<label> <input type="radio" name="optionsRadios2" value="1" data-bind="checked: isFee"> 是
										</label>
									</div>
									<div class="radio">
										<label> <input type="radio" name="optionsRadios2" value="0" data-bind="checked: isFee" checked> 否
										</label>
									</div>
								</div>
							</div>
							<div class="form-group" data-bind="visible:isFee()=='1'">
								<label class="col-xs-2 control-label">包含套餐：</label>
								<div class="col-xs-9">
									<div class="form-inline">
										<div class="checkbox">
											<label> <input type="checkbox" value="DAY" data-bind="checked: feePackage"> 按天
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" value="MONTH" data-bind="checked: feePackage"> 按月
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" value="QUARTER" data-bind="checked: feePackage"> 按季度
											</label>
										</div>
										<div class="checkbox">
											<label> <input type="checkbox" value="YEAR" data-bind="checked: feePackage"> 按年
											</label>
										</div>
									</div>
									<div class="panel panel-default jifei-panel" data-bind="visible: feePackage().indexOf('DAY') != -1">
										<div class="panel-heading jifei-heading">
											<h4>按天</h4>
											<a class="btn btn-sm btn-info jifei-btn">添加计费规则</a>
										</div>
										<table class="table table-striped">
											<thead>
												<th>计费因子</th>
												<th>计费规则</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>CPU</td>
													<td>JF-CPU-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>内存</td>
													<td>JF-Memory-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>存储</td>
													<td>JF-Stroge-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="panel panel-default jifei-panel" data-bind="visible: feePackage().indexOf('MONTH') != -1">
										<div class="panel-heading jifei-heading">
											<h4>按月</h4>
											<a class="btn btn-sm btn-info jifei-btn">添加计费规则</a>
										</div>
										<table class="table table-striped">
											<thead>
												<th>计费因子</th>
												<th>计费规则</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>CPU</td>
													<td>JF-CPU-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>内存</td>
													<td>JF-Memory-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>存储</td>
													<td>JF-Stroge-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="panel panel-default jifei-panel" data-bind="visible: feePackage().indexOf('QUARTER') != -1">
										<div class="panel-heading jifei-heading">
											<h4>按季度</h4>
											<a class="btn btn-sm btn-info jifei-btn">添加计费规则</a>
										</div>
										<table class="table table-striped">
											<thead>
												<th>计费因子</th>
												<th>计费规则</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>CPU</td>
													<td>JF-CPU-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>内存</td>
													<td>JF-Memory-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>存储</td>
													<td>JF-Stroge-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
									</div>
									<div class="panel panel-default jifei-panel" data-bind="visible: feePackage().indexOf('YEAR') != -1">
										<div class="panel-heading jifei-heading">
											<h4>按年</h4>
											<a class="btn btn-sm btn-info jifei-btn">添加计费规则</a>
										</div>
										<table class="table table-striped">
											<thead>
												<th>计费因子</th>
												<th>计费规则</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr>
													<td>CPU</td>
													<td>JF-CPU-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>内存</td>
													<td>JF-Memory-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
												<tr>
													<td>存储</td>
													<td>JF-Stroge-001</td>
													<td><a class="btn btn-xs btn-default"
														onclick="confirm('确定删除吗？')">删除</a></td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="tab-pane">
						<div class='form-horizontal row'>
							<div class="form-group">
								<label class="col-xs-2 control-label">发布范围：</label>
								<div class="col-xs-9">
									<div class="panel panel-default"
										style="margin: 0; padding-bottom: 10px">
										<div id="serviceModalTree" class="ztree release"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
          <!-- <div class="tab-pane">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-2 control-label">发布范围：</label>
                <div class="col-xs-9">
                  <div class="panel panel-default" style="margin:0;padding-bottom:10px">
                    <div id="serviceModalTree" class="ztree release"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div> -->
        
      
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info service-step-btn-pre" style="display:none;">上一步</a>
        <a class="btn btn-default btn-info service-step-btn-next">下一步</a>
        <a class="btn btn-default btn-info service-step-btn-save" style="display:none;" data-bind="click: saveService">保存</a>
        <a class="btn btn-default btn-success service-step-btn-saveAndRelease" style="display:none;">保存并发布</a>
        <!-- <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a> -->
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
	var scripts = [ null, 'assets/lib/zTree/js/jquery.ztree.core.js', 'assets/lib/zTree/js/jquery.ztree.excheck.js',
			"assets/lib/moment/moment.js", "assets/lib/bootstrap-daterangepicker/daterangepicker.js", 
			"assets/lib/bootstrap-daterangepicker/date.js",null ];
	$('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
		var step = 0;
		var activeSteps = [ true, false, false, false ]
		$('.service-step-select li').click(function() {
			if ($(this).hasClass('active'))
				return;
			if (!activeSteps[$(this).index()])
				return;
			step = $(this).index();
			$(this).addClass('active').siblings().removeClass('active');
			$('.service-step-box>div').eq(step).addClass('active').siblings().removeClass('active');
			buildBtns(step);
		})

		function buildBtns(step) {
			$('.service-step-btn-pre,.service-step-btn-next').show();
			$('.service-step-btn-save,.service-step-btn-saveAndRelease').hide();
			if (step == 0) {
				$('.service-step-btn-pre').hide();
			}
			if (step == $('.service-step-select li').length - 1) {
				$('.service-step-btn-next').hide();
				$('.service-step-btn-save,.service-step-btn-saveAndRelease').show();
			}
		}
		$('.service-step-btn-pre').click(function() {
			step = step - 1;
			$('.service-step-select li').eq(step).trigger('click');
			buildBtns(step);
		})
		$('.service-step-btn-next').click(function() {
			step = step + 1;
			activeSteps[step] = true;
			$('.service-step-select li').eq(step).trigger('click');
			buildBtns(step);
		})
		
		$('#addServer_daterange').val(moment().subtract(29 , 'days').format('YYYY/MM/DD')+ ' 至 '+ moment().format('YYYY/MM/DD')).daterangepicker({
			format : 'YYYY/MM/DD',			
			startDate : moment().subtract(29 , 'days'),
			endDate : Date.today().addDays(1),
			minDate: Date.today(),
			separator : '至',
			locale : {
				applyLabel : '确认',
				cancelLabel : '取消',
				fromLabel : '开始日期',
				toLabel : '结束日期',
				weekLabel : '周',
				customRangeLabel : '自定义范围',
				daysOfWeek : [ "日", "一", "二", "三", "四", "五", "六" ],
				monthNames : [ '01月', '02月', '03月', '04月', '05月', '06月', '07月', '08月', '09月', '10月', '11月', '12月', ]
			}
		});
		//服务目录选择
		$("#selectDir").click(function() {
			var cityObj = $("#selectDir");
			var cityOffset = $("#selectDir").offset();
			cityOffset.left = 207;
			$("#dirContent").addClass("csc_menuTree").css({ left : cityOffset.left + "px", top : cityObj.top + "px" }).slideDown("fast");
			$("body").bind("mousedown", onBodyDown2);
		});

		function hideMenu2() {
			$("#dirContent").fadeOut("fast");
			$("body").unbind("mousedown", onBodyDown2);
		}
		function onBodyDown2(event) {
			if (!(event.target.id == "dirUuid" || event.target.id == "dirContent" || $(event.target).parents("#dirContent").length > 0)) {
				hideMenu2();
			}
		}
		//初始化树start
		var setting = {
			check : {
				enable : true
			},
			view : {
				showIcon : false,
				showLine : false
			},
			callback : {
				onCheck : function(srcEvent, treeId, node, clickFlag) {
					debugger
					serviceViewModel.releaseRange.push(node.uuid);
				}
			}
		};

		var zNodes = [ {
			name : "全选",
			open : true,
			children : [ 
			    {name : "VDC1",uuid : "1"}, 
				{name : "VDC2",uuid : "2"},
				{name : "VDC3",uuid : "3"} ]
			} ]
		var setting1 = {
			view : {
				showIcon : false,
				showLine : false
			},
			callback : {
				onClick : function(srcEvent, treeId, node, clickFlag) {
					$("#selectDir").val(node.name);
					$("#dirUuid").val(node.uuid);
					hideMenu2();
					srcEvent.preventDefault();
				}
			}
		};
		function loadServiceTree() {
			csc.rest.get('api/v5.0.0/service/directory', function(data) {
				$.fn.zTree.init($("#dirTree"), setting1, data);
			});
		}
		$(document).ready(function() {
			$.fn.zTree.init($("#serviceModalTree"), setting, zNodes);
			loadServiceTree();
		});
		//初始化树end
		
		//服务基本信息标签页
	    function ServiceViewModel() {
	    	var self = this;
			this.serviceVO = ko.validatedObservable({
				name : ko.observable().extend({required : true}),
				dirName : ko.observable(),
				dirUUID : ko.observable().extend({required : true}),
				productId : ko.observable().extend({required : true}),
				imageUrl : ko.observable(),
				desc : ko.observable(),
				validTimeType : ko.observable().extend({required : true}),
				validTimeNum : ko.observable()
			});
			
			this.configVO = ko.observable({
				//conditions: ko.observableArray(['partitionName','name','ip'])
			});			
			
			this.serviceVmVO = ko.validatedObservable({
				virtualName: ko.observable().extend({required : true}),
				azUuid: ko.observableArray([]),
				osType: ko.observableArray([]),
				osVersion: ko.observableArray([]),
				cpu: ko.observableArray([]),
				memory: ko.observableArray([])
			});
			
			//是否计费
			this.isFee = ko.observable("0");
	        
	        //套餐费用
	        this.feePackage = ko.observableArray();
	        
	        //发布范围
	        this.releaseRange = ko.observableArray([]);	        
	        
	        this.saveService = function(){
	        	var putBody = {
        			name : self.serviceVO.name,
    				dirUUID : self.serviceVO.dirUUID,
    				productId : self.serviceVO.productId,
    				imageUrl : self.serviceVO.imageUrl,
    				desc : self.serviceVO.desc,
    				validTimeType : self.serviceVO.validTimeType,
    				validTimeNum : self.serviceVO.validTimeNum,
    				charge : self.isFee,
    				chargeType : self.feePackage,
    				serviceVm : {
    					virtualName: self.serviceVmVO.virtualName,
    					azUuid: self.serviceVmVO.azUuid,
    					osType: self.serviceVmVO.osType,
    					osVersion: self.serviceVmVO.osVersion,
    					cpu: self.serviceVmVO.cpu,
    					memory: self.serviceVmVO.memory},
    				
	        	}
	        	debugger;
	        	
	        	if(this.serviceVO.uuid){
	        		
	        	}else{
	        		csc.rest.post('api/v5.0.0/service/directory',putBody,function(data){
                	    self.table.refreshData();
                        alert('添加目录成功！');                     
                    });
	        	}
	        }
		} 
		
		var serviceViewModel = new ServiceViewModel();
		
		ko.applyBindings(serviceViewModel,$('#serviceInfoPage')[0]);

	});
</script>