<link href="assets/lib/zTree/css/ibos/ibos.css" rel="stylesheet" type="text/css"/>
<link href="assets/lib/webuploader/webuploader.css" rel="stylesheet" type="text/css"/>

<style>
  .service-img-box{position:relative;width:60px;height:60px;}
  .service-img-box a{font-size:12px;text-align:center;position:absolute;bottom:0;width:100%;color:#fff;height:16px;line-height:16px;background:rgba(0,0,0,.2)}
  .ztree.release li a.curSelectedNode{background:none;color: #82939E;}
  .ztree.release li a:hover{border-color:#fff;background-color:#fff;}
  .jifei-heading{overflow:hidden;height:60px;}
  .jifei-btn{position:relative;right:0;top:-34px;float:right;}
  .jifei-panel{margin:0;margin-top:20px;}
</style>

<div class="app-content-full">
	<div class="bg-light lter b-b wrapper-sm">
		<ol class="breadcrumb">
			<li>当前位置：</li>
			<li>服务</li>
			<li class="active">服务管理</li>
		</ol>
	</div>
	<!-- hbox layout -->
	<div class="hbox hbox-auto-xs bg-light ">
		<!-- column -->
		<div class="col w lter b-r">
			<div class="vbox">
				<div class="wrapper b-b">
					<div class="left-title clearfix">
						<span style="font-size: 16px;">服务目录</span> 
						<span data-bind="click: editDir"
							class="glyphicon glyphicon-pencil pull-right service-edit-btn"
							style="color: #9c9c9c; top: 3px;"></span> 
						<span data-bind="click: delDir"
							class="glyphicon glyphicon-minus pull-right service-delete-btn"
							style="color: #9c9c9c; top: 3px;"></span>
						<span data-bind="click: add"
							class="glyphicon glyphicon-plus pull-right service-add-btn"
							style="color: #2aabd2; top: 3px; margin-right: 10px;"></span>
					</div>
				</div>
				<div class="row-row">
					<div class="cell scrollable hover">
						<div class="cell-inner">
							<div id="serverDefinitionsTree" class="ztree"
								style="margin-left: 8px;overflow-x: scroll;height: 655px"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /column -->

		<!-- column -->
		<div class="col">
			<div class="vbox">
				<div class="row-row">
					<div class="cell">
						<div class="cell-inner">
							<div class="wrapper-md">
								<div class="panel panel-default b-blue">
									<div class="row wrapper">
										<div class="col-xs-1">
											<a class="btn btn-sm btn-info" data-bind="click: createService" >创建服务</a>
												<!--  -->
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">服务状态</span> 
												<select class="form-control input-sm" data-bind="value: searchParam().state">
													<option value="">全部</option>
													<option value="0">未发布</option>
													<option value="1">已发布</option>
													<option value="2">已下线</option>
													<option value="3">已销毁</option>
													<option value="4">无效</option>
												</select>
											</div>
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">所属产品</span> 
												<select class="form-control input-sm"
													data-bind="value: searchParam().productName, options:productList,optionsText:'name',optionsValue:'codeName', optionsCaption: '全部'">
													<option value="">全部</option>
												</select>
											</div>
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">服务名称</span> <input
													type="text" class="input-sm form-control"
													placeholder="请输入服务名称"
													data-bind="value: searchParam().serviceName">
											</div>
										</div>
										<div class="col-xs-2">
											<button class="btn btn-sm" type="button" data-bind="click: reset">重置</button>
											<button class="btn btn-sm btn-default" type="button" data-bind="click: search">搜索</button>
										</div>
									</div>

									<div class="table-responsive" data-bind="with : table">
										<table class="table table-striped">
											<thead>
												<th>服务名称</th>
												<th>所属产品</th>
												<th>服务状态</th>
												<th>服务目录</th>
												<th>创建人</th>
												<th>生效时间</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr data-bind="visible: showNoData">
													<td colspan="7" class="aligncenter">暂无数据.</td>
												</tr>
												<!-- ko foreach: {data: pagedRows, as: '$row'} -->
												<tr>
													<td ><a data-bind="text: $row.name,click: $root.showDetail"></a></td>
													<td data-bind="text: $row.productName"></td>
													<td>
														<span class="label label-success" data-bind="visible: $row.stateDesc=='已发布',text: $row.stateDesc"></span>
										                <span class="label label-default" data-bind="visible: $row.stateDesc=='未发布',text: $row.stateDesc"></span>
										                <span class="label label-danger" data-bind="visible: $row.stateDesc=='已下线'||$row.stateDesc=='已销毁'||$row.stateDesc=='无效',text: $row.stateDesc"></span>
													</td>
													<td data-bind="text: $row.dirName"></td>
													<td data-bind="text: $row.createUserName"></td>
													<td data-bind="text: $row.effectTime"></td>
													<td><a data-bind="if: $row.state == 0 || $row.state == 2,click: $root.release">发布&nbsp;&nbsp;</a> 
													 <a data-bind="if: $row.state == 0 || $row.state == 2,click: $root.editService">修改&nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 0,click: $root.deleteService">删除 &nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 1,click: $root.offline">下线&nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 2,click: $root.destory">销毁 </a>													
													</td>													
												</tr>
												<!-- /ko -->
											</tbody>
										</table>
									</div>
									<footer class="panel-footer" data-bind="with: table, visible: table.pages() > 0">
									    <ul class="pagination">
								        <li data-bind="css: leftPagerClass, click: gotoPage(1)">
								          <a href="#">首页</a>
								        </li>
								        <li data-bind="css: leftPagerClass, click: prevPage">
								          <a href="#">&laquo;</a>
								        </li>
								        <li >
								          <a href="#"  data-bind="text: currentPage"></a>
								        </li>
								        <li data-bind="css: rightPagerClass, click: nextPage">
								          <a href="#">&raquo;</a>
								        </li>
								        <li data-bind="css: rightPagerClass, click: gotoPage(pages())">
								          <a href="#">末页</a>
								        </li>
								        <li class="page-control-li">
								          <div class="input-group form-group-sm">
								           <input type="text" class="form-control" data-bind="value: targetPage"  />
								           <div class="input-group-btn">
								             <a href="#" class="btn btn-sm btn-default" data-bind="click: gotoTargetPage()">跳转</a>
								           </div>
								          </div>
								          <div class="page-info-div" data-bind="text: recordsText"></div>
								       </li>
								     </ul>
								   </footer>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>	
</div>
<!-- 服务目录弹窗 -->
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd }">
	<div class='modal-dialog modal-lg' style="width: 600px;">
		<div class='modal-content'>
			<div class='modal-header'>
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span>
				</button>
				<h3 class='modal-title' data-bind="ifnot: directoryVO().uuid">创建服务目录</h3>
				<h3 class='modal-title' data-bind="if: directoryVO().uuid">修改服务目录</h3>
			</div>
			<div class='modal-body form-horizontal row'>
				<div class="form-group">
					<label class="col-xs-3 control-label">服务目录名称</label>
					<div class="col-xs-8">
						<input type="text" class="form-control" placeholder="请输入名称" maxlength="32"
							data-bind="value: directoryVO().name">
					</div>
					<div class="col-xs-1">
						<span class="text-danger inline m-l-n m-t-sm">*</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-3 control-label">上级服务目录</label>
					<div class="col-xs-8">
						<input type="text" class="form-control" placeholder="请输入名称" disabled="disabled"
							data-bind="value: directoryVO().parentName">
					</div>
					<div class="col-xs-1">
						<span class="text-danger inline m-l-n m-t-sm">*</span>
					</div>
				</div>
			</div>
			<div class='modal-footer' style="text-align: center;">
				<a class="btn btn-default btn-info" data-bind="click: save">确定</a> 
				<a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
			</div>
		</div>
	</div>
</div>
<!-- page specific plugin scripts -->
<script type="text/javascript">
var scripts = [null, 'assets/lib/zTree/js/jquery.ztree.core.js', 'assets/lib/zTree/js/jquery.ztree.excheck.js', 
               "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js",
               "assets/lib/bootstrap-daterangepicker/date.js", "assets/lib/webuploader/webuploader.js",null];               
	//弹窗服务目录下拉框树start	
	function selectDirClick(){ 	
		var cityObj = $("#selectDir");
	    var cityOffset = $("#selectDir").offset();
	    cityOffset.left = 207;
	    $("#dirContent").addClass("csc_menuTree").css({
	        left : cityOffset.left + "px",
	        top : cityObj.top + "px"
	    }).slideDown("fast");
	    $("#body").bind("mousedown", onBodyDown2);
	}
	
	function hideMenu2() {
	    $("#dirContent").fadeOut("fast");
	    $("body").unbind("mousedown", onBodyDown2);
	}
	function onBodyDown2(event) {
	    if (!(event.target.id == "dirUuid"
	            || event.target.id == "dirContent" || $(event.target)
	            .parents("#dirContent").length > 0)) {
	        hideMenu2();
	    }
	}
	//弹窗服务目录下拉框树end
	
 	/* function preViewImage() {
		$("#up").uploadPreview({ Img: "ImgPr", Width: 120, Height: 120, ImgType: ["gif", "jpg", "bmp", "png"] });
	} */ 

  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    //inline scripts related to this page
	    
	var product = 'VDC';//默认选中VDC  	
        
    var dirUuid = 0;//目录UUID
    var dirName = "服务目录";//目录名称
    //目录树start
    var setting = {
      view:{
        showIcon:false,
        showLine:false
      },
      callback : {
        onClick : function(srcEvent, treeId, node, clickFlag) {
            srcEvent.preventDefault();
            dirUuid = node.uuid;
            dirName = node.name;
            viewModel.search(node.uuid)
        }
      }
    };    
    
    function loadTree(){
    	csc.rest.get('api/v5.0.0/service/directory',function(data){    		
            $.fn.zTree.init($("#serverDefinitionsTree"), setting, data);
        });
    }
  	//目录树end
  
  	//初始化产品列表下拉框
    function loadProduct(){
    	csc.rest.get('api/v5.0.0/products',function(data){    		
    		viewModel.productList(data);
        });
    }    


    var setting2 = {
      check: {
        enable: true
      },
      view:{
        showIcon:false,
        showLine:false
      }
    };

    var setting1 = {
    		view:{
    	        showIcon:false,
    	        showLine:false
    	    },
            callback : {
                onClick : function(srcEvent, treeId, node, clickFlag) {
                    $("#selectDir").val(node.name);
                    $("#dirUuid").val(node.uuid);
                    //给model的服务目录传值
                    viewModel.serviceVO().dirUUID(node.uuid);
                    hideMenu2();
                    srcEvent.preventDefault();
                }
            }
        };
    
    
    //服务目录树
    function loadServiceTree(){
       csc.rest.get('api/v5.0.0/service/directory',function(data){    	
           $.fn.zTree.init($("#dirTree"), setting1, data);
       });
    }
	<!-- vdc -->
    //初始化操作系统类型下拉框
    function loadVdcOsType(bool){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VDC&configCodeName=osType&urlType=getSource',function(data){      		
      		viewModel.osList(data);
      		if(bool){
      			if(data.length > 0){   	      			
       	      		for(var i = 0;i < data.length;i++){
              			viewModel.osTypeList.push(data[i].value);
                	}
    	      	}
      		}      		
         });
    }
    <!-- 云主机   -->
    //初始化虚拟化类型下拉框数据
    function loadVirtualPlatform(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=virtualPlatform&urlType=getSource',function(data){
      		viewModel.virtualPlatformList(data);
         });
    }
      
	 //初始化虚拟机操作系统类型数据  
	 function loadVmOsType(bool){
		 csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=virtualPlatform&urlType=getTarget&sourceValue='+viewModel.serviceVO().serviceVm.virtualName(),function(data){   	      		 
	   		viewModel.vmOsTypeList(data);
	   		if(bool){
	   			if(data.length > 0){   	      			
			      	for(var i = 0;i < data.length;i++){
		    			viewModel.osTypeCheckList.push(data[i].value);
		      		}
		   		}
	   		}
	     });
	 }
	   
	 //初始化可用分区数据
	 function loadVmAzs(bool){
		 csc.rest.get('api/v5.0.0/azs?virtualHypervisor='+viewModel.serviceVO().serviceVm.virtualName(),function(data1){
			viewModel.azList(data1.results);
			if(bool){
				if(data1.results.length > 0){          			
					for(var i = 0;i < data1.results.length;i++){
			    		viewModel.azUuidList.push(data1.results[i].uuid);
			        }
				}
			}
		 }); 
	 }
	 
    //初始化云主机CPU
    function loadVmCpu(bool){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=cpu&urlType=getSource',function(data){
      		viewModel.cpuList(data);
      		if(bool){
      			if(data.length > 0){   	      			
       	      		for(var i = 0;i < data.length;i++){
              			viewModel.cpuCheckList.push(data[i].value);
                	}
    	      	}
      		}      		
         });
    }
    //初始化云主机内存
    function loadVmMemory(bool){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=memory&urlType=getSource',function(data){
      		viewModel.memoryList(data);
      		if(bool){
      			if(data.length > 0){   	      			
       	      		for(var i = 0;i < data.length;i++){
              			viewModel.memoryCheckList.push(data[i].value);
                	}
    	      	}
      		}
         });
    }
    //初始化发布范围VDC
    function loadReleaseVdc(azUuids, bool){
      	csc.rest.get('api/v5.0.0/service/getReleaseVdcByAzs?azUuids='+ azUuids,function(data){
      		viewModel.vdcList(data);
      		if(bool && !viewModel.serviceVO().uuid()){
      			if(data.length > 0){
          			for(var i = 0;i < data.length;i++){
              			viewModel.releaseRange.push(data[i].uuid);
                	}
          		}
      		}
        });
    } 
    <!-- 云盘  -->
  	//初始化云盘类型
    function loadDiskType(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=DISK&configCodeName=diskType&urlType=getSource',function(data){
      		viewModel.diskTypeList(data);
         });
    }
    
  	function loadInit(){
  		var $ = jQuery,
        $list = $('#fileList'),
         // 优化retina, 在retina下这个值是2
        ratio = window.devicePixelRatio || 1,

         // 缩略图大小
        thumbnailWidth = 100 * ratio,
        thumbnailHeight = 100 * ratio,
         // Web Uploader实例
 	    // 初始化Web Uploader
 	    uploader = new WebUploader.create({
 	        // 自动上传。
 	        auto: true,
 	        // swf文件路径
 	        swf: '/assets/lib/webuploader/Uploader.swf',
 	        // 文件接收服务端。
 	        server: '/csc/api/file/uploadServlet?handler=cscPicture&actionKey=&dataKey=',
 	        // 选择文件的按钮。可选。
 	        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
 	        pick: '#filePicker',
 	        fileSingleSizeLimit: 2*1024*1024,   //设定单个文件大小
 	        // 只允许选择文件，可选。
 	        accept: {
 	            title: 'Images',
 	            extensions: 'gif,jpg,bmp,png',
 	            mimeTypes: 'image/*'
 	        }
 	    });
 		uploader.on('beforeFileQueued', function(file) {
 			//重置上传队列
 			uploader.reset();
 		}); 
 		uploader.on("error",function (type){
 	        if (type=="Q_TYPE_DENIED"){
 	            alert("请上传gif、jpg、bmp、png格式文件！");
 	        }else if(type=="F_EXCEED_SIZE"){
 	            alert("文件大小不能超过2M！");
 	        }
 	    });
 	    
 	 // 当有文件添加进来的时候
 	    uploader.on( 'fileQueued', function( file ) {
 	    	
   	        var $li = $(
 	                '<div id="' + file.id + '" class="file-item thumbnail">' +
 	                    '<img>' +
 	                    '<div class="info">' + file.name + '</div>' +
 	                '</div>'
 	                ), 
 	            $img = $("#ImgPr");
 	    	//	        $img = $li.find('img');

// 	        $list.append( $li ); 

 	        // 创建缩略图
 	        uploader.makeThumb( file, function( error, src ) {
 	            if ( error ) {
 	                $img.replaceWith('<span>不能预览</span>');
 	                return;
 	            }
 	            $img.attr( 'src', src );
 	        }, 100, 100 );
 	    });

 	    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
 	    uploader.on( 'uploadSuccess', function( file, result) {
 	    	viewModel.serviceVO().imageUrl("/csc/api/img/imgServlet?path="+result.path);
 	        $( '#'+file.id ).addClass('upload-state-done');
 	    });

 	    // 文件上传失败，现实上传出错。
 	    uploader.on( 'uploadError', function( file ) {
 	        alert('上传失败');
 	    });
 	   uploader.addButton({
		    id: '#filePicker',
		    innerHTML: '选择图片'
		});
 	     
  	}
  	
    $(document).ready(function(){
    	loadTree();		    //服务目录树
        loadProduct();	   //获取产品下拉框数据
        
    });         	
  	
    function ViewModel(){
      <!--服务目录start-->
      var self = this;
      this.isAdd = ko.observable(false);

      this.directoryVO = ko.validatedObservable({    	  
          name: ko.observable("").extend({required: true,cscNameRule:true}),          
          parentName: ko.observable("服务目录")
      });            
      //新增           
      this.add = function(){
    	var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
    	var nodes = treeObj.getSelectedNodes();
    	if(nodes.length > 0){
    	   this.isAdd(true);    	   
           this.directoryVO.fromJSON({
               uuid: null,
               name: "",
               parentName: nodes[0].name,
               parentUuid: nodes[0].uuid
           });	
    	}else{
    		alert('请选择根目录！');
    	}
        
      }
      //保存
      this.save = function(){
          ko.validation.group(this.directoryVO).showAllMessages();          
          if(this.directoryVO.isValid()){       	  
              if(this.directoryVO().uuid){
                  csc.rest.put('api/v5.0.0/service/directory/'+this.directoryVO().uuid,this.directoryVO.toJSON(),function(data){
                	  self.isAdd(false);
                	  self.table.refreshData();
                	  loadTree();
                      alert('修改目录成功！');                
                  }); 
              }else{
                  csc.rest.post('api/v5.0.0/service/directory',this.directoryVO.toJSON(),function(data){
                	  self.isAdd(false);
                	  self.table.refreshData();
                	  loadTree();
                      alert('添加目录成功！');                     
                  }); 
              }
          }
      }
      //删除      
      this.delDir = function(object, event){
    	  var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
          var nodes = treeObj.getSelectedNodes();          
          if(nodes.length > 0){
              if(nodes[0].uuid == 0){
                  systemMsg.alert('根目录不能删除！');
              }else{
            	  confirm("确定要删除目录 "+nodes[0].name+" ?",function(){
                      csc.rest.del('api/v5.0.0/service/directory/'+nodes[0].uuid, function(data){
                    	  loadTree();
                          self.table.refreshData();
                          alert('删除目录成功！');                          
                      });
                  }); 
              }                
           }else{
               alert('请选择要删除的目录！');
           }    	  
      }
      //修改
      this.editDir = function(object, event){
    	  var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
          var nodes = treeObj.getSelectedNodes();          
          if(nodes.length > 0){
        	  if(nodes[0].uuid == 0){
        		  alert('根目录不能修改！');
        	  }else{
        		  this.isAdd(true);           
                  this.directoryVO.fromJSON({
                      uuid: nodes[0].uuid,
                      name: nodes[0].name,
                      parentName: nodes[0].parentName,
                      parentUuid: nodes[0].uuid
                  }); 
        	  }                
           }else{
               alert('请选择要修改的目录！');
           }
      }
      <!--服务目录end-->
      
      <!--服务状态修改start-->
      this.serviceStateVO = ko.observable({    	  
          uuid: "",          
          state: ""
      })
      //发布
      this.release = function(object, event){    	  
    	  object.state = "1";
    	  self.changeState(object, "发布");
      }
      //下线
      this.offline = function(object,event){    	  
    	  object.state = "2";
    	  self.changeState(object, "下线");
      }
      //销毁
      this.destory = function(object,event){    	  
    	  object.state = "3";
    	  self.changeState(object, "销毁");
      }
      //删除服务
      this.deleteService = function(object,event){
    	  confirm("确定要删除服务 "+object.name+" ?",function(){
              csc.rest.del('api/v5.0.0/service/'+object.uuid, function(data){
                  self.table.refreshData();
                  alert('删除服务成功！');                          
              });
          });
      }
      //修改状态接口
      this.changeState = function(object,stateDesc){    	  
    	  csc.rest.put('api/v5.0.0/service/changeState/'+object.uuid,object,function(data){
        	  self.isAdd(false);
        	  self.table.refreshData();
              alert('服务' + stateDesc + '成功！');
          });
      }
      <!--服务状态修改end-->      
      
      <!--服务信息列表start-->
      //查询条件参数
      this.searchParam = ko.observable({
    	  dirUUID: dirUuid,
          state: "",
          productName: "",
          serviceName: ""
      })
      //重置
      this.reset = function(){
			this.searchParam({
				state: "",
				productName: "",
				serviceName: ""
			})
      }
      //搜索查询
      this.search = function(dirUuid){    	  
    	  if(typeof(dirUuid) != "object"){
    	     this.searchParam().dirUUID = dirUuid;
    	  }
          this.table.params(this.searchParam());
      }
      //服务信息列表数据
      this.table = new DataTable([], {path: 'api/v5.0.0/service'});      
      //产品列表
      this.productList = ko.observableArray();            
      <!--服务信息列表end-->
      
//############################################################### 弹窗     ################################################
     //服务信息
	  this.serviceVO = ko.observable();
      //服务信息主实体VO
      function entityVO(){
    	  this.uuid = ko.observable();
    	  this.name = ko.observable("").extend({required : true,cscNameRule:true});
    	  this.dirName = ko.observable(dirName);
    	  this.dirUUID = ko.observable(dirUuid);
    	  this.productId = ko.observable();
    	  this.imageUrl = ko.observable();
    	  this.desc = ko.observable();
    	  this.validTimeType = ko.observable("1").extend({required : true});
    	  this.validTimeNum = ko.observable();
    	  this.rangeTime = ko.observable();
    	  this.charge = ko.observable();
    	  this.serviceVDC = new vdcVO();
    	  this.chargeType = ko.observable();
  		  this.rules = ko.observable();
  		  this.servicePartitions = ko.observable();
		  this.azUuids = ko.observable();
		  this.serviceVm = new vmVO();
		  this.serviceDisk = new diskVO();
		  this.serviceIp = new ipVO();
      }
      //VDC的VO
      this.osTypeList = ko.observableArray();//vdc操作系统列表
      function vdcVO(){
    	  this.isLimit = ko.observable();
    	  this.osType = ko.observable();
    	  this.maxCpu = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxVmNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxMemory = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxDiskNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxStorager = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxIpNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxVPC = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxRouterNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxObjStorageNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxFireWallNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxSSHNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxLoadBalanceNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxSecurityGroupNum = ko.observable().extend({positiveIntegerRule : true});
    	  this.maxVpnNum = ko.observable().extend({positiveIntegerRule : true});
      }
      //云主机VO
      function vmVO(){
    	  this.virtualName = ko.observable();
		  this.azUuid = ko.observable();
		  this.osType = ko.observable();
		  this.osVersion = ko.observable();
		  this.cpu = ko.observable();
		  this.memory = ko.observable();
      }
      //云盘VO
      function diskVO(){
    	  this.diskType = ko.observable();
		  this.azUuid = ko.observable();
      }
      //公网IPVO
      function ipVO(){
    	  this.ipUuid = ko.observable();
      }

      
      <!-- 云主机start -->
      //虚拟化类型选择事件
      this.changeVirtualValue = function(viewModel, event){      	  
         if(viewModel.selected_product()=='VM'){
			 if(event.bubbles){
				  //当选择不同的虚拟化时得清空初始化数据，重新加载
				  if(viewModel.azUuidList().length > 0){
				  	viewModel.azUuidList.removeAll();
			  	  }
			  	  if(viewModel.osTypeCheckList().length > 0){
					  viewModel.osTypeCheckList.removeAll();
				  }
			 	  if(viewModel.osType_chosen().length > 0){
						  viewModel.osType_chosen.removeAll();
				  }
			 	 
			 }
			//初始化虚拟机操作系统类型数据        	 
		 	 loadVmOsType(true);
		 	 //初始化可用分区数据
		 	 loadVmAzs(true);
         }else if(viewModel.selected_product()=='VDC'){
            
         }else{
      	   
         }
      } 
      
    //云主机可用分区和操作系统类型change事件
      this.changeCheckBoxValue = function(data, event){
         if(viewModel.selected_product()=='VM'){
			 if(event.bubbles){
			 	  if(viewModel.osType_chosen().length > 0){
					  viewModel.osType_chosen.removeAll();
				  }
			 }
         }
      }
      
      //添加操作系统版本start
     // this.packages = ko.observableArray();
      this.osType_chosen = ko.observableArray();
      this.osType_current = null;
      
      this.isAdd_osType = ko.observable(false);

	  this.osVersionList = new DataTable([], {path: "api/v5.0.0/service/getServiceImageRef"});
      //添加操作系统版本按钮
      this.addOsType = function(package,event){
        if(self.azUuidList().length <= 0){
      	  alert("请选择可用分区！");
      	  return;
        }
        if(self.osTypeCheckList().length <= 0){
      	  alert("请选择操作系统类型！");
      	  return;
        }
    	  self.osType_current = package;
    	  self.osVersionList.params({
    		  azUuid: getAzUuids(self.azUuidList()),
    		  osTypes: getAzUuids(self.osTypeCheckList())
    	  })
   	  self.isAdd_osType(true);              
      }
      this.addOsVersionToList = function(){
    	  this.osType_chosen(this.osVersionList.chosenItems());
    	  self.isAdd_osType(false);
      }
      //获取操作系统版本
      function getOsVersion(obj){
      	var osVersion = "";
      	for(var i = 0;i < obj.length;i++){
      		osVersion += obj[i].imageUuid + ",";
      	}
      	if(osVersion != ""){
      		osVersion = osVersion.substring(0,osVersion.length-1);
      	}
      	return osVersion;
      }
      //删除操作系统版本
      this.deleteOsType = function(obj){
      	self.osType_chosen.remove(obj);
      }
      //添加操作系统版本end
      
	  //虚拟化平台数据
	  this.virtualPlatformList = ko.observableArray();
      //云主机操作系统类型
      this.vmOsTypeList = ko.observableArray();
      //可用分区数据
      this.azList = ko.observableArray();
      //云主机CPU
      this.cpuList = ko.observableArray();
      //云主机内存
      this.memoryList = ko.observableArray();
      <!-- 云主机 end  -->
      
      <!-- 修改服务弹窗-->
      this.editService = function(object, event){
    	  var vo = new entityVO();
	  	  self.serviceVO = new ko.validatedObservable(vo);
	  	  
	  	  var startDate = "";
	  	  var endDate = "";
	  	  
    	  self.step(1);
    	  
    	  csc.rest.get('api/v5.0.0/service/getServiceInfo/'+object.uuid, function(data){
    		  loadServiceTree();//加载服务目录树
    		 
    		  /**初始化费用数据**/
    		  var isfee = data.charge;    		  
    		  self.isFee(isfee+"");
    		  if(isfee == 0){
    			  var feeType = data.chargeType;
    			  var feeTypeList = new Array();
    			  if(feeType.indexOf(",") != -1){
    				  feeTypeList = feeType.split(",");
        		  }else{
        			  feeTypeList.push(feeType);
        		  }
    			  var billRuleList = data.billRules;
    			  if(feeTypeList.length > 0){
    				  if(self.packages_chosen().length > 0){
    					  self.packages_chosen.removeAll();
    				  }
    				  for(var i = 0;i < feeTypeList.length;i++){
    					  var feeList1 = new Array();
    					  var package1;
    					  if(feeTypeList[i] == "DAY"){
    						  package1 = self.packages()[0];
        				  }else if(feeTypeList[i] == "MONTH"){
        					  package1 = self.packages()[1];
        				  }else if(feeTypeList[i] == "QUARTER"){
        					  package1 = self.packages()[2];
        				  }else if(feeTypeList[i] == "YEAR"){
        					  package1 = self.packages()[3];
        				  }
    					  if(billRuleList.length > 0){
    						  for(var j = 0;j < billRuleList.length; j++){
    							  if(feeTypeList[i] == billRuleList[j].cycle){
    								  feeList1.push(billRuleList[j]);
    							  }
    						  }
    					  }
    					  package1.feeList(feeList1);
    					  self.packages_chosen.push(package1);
    				  }
    			  }
    		  }
    		  self.selected_product(data.productId);
    		  //初始化服务基本信息
    		  self.serviceVO.fromJSON({
     			 uuid : data.uuid,
   	     		 name : data.name,
   	   	  		 dirName : data.dirName,
   	   	  		 dirUUID : data.dirUUID,
   	   	  		 productId : data.productId,
   	   	  		 imageUrl : data.imageUrl,
   	   	  		 desc : data.desc,
   	   	  		 validTimeType : data.validTimeType+"",
   	   	  		 charge : data.charge+""
   	     	  });
    		  
    		  if(data.validTimeType == 2){
    			  self.serviceVO().validTimeNum(data.validTimeNum);
    		  }else if(data.validTimeType == 3){
    			  startDate = data.effectTime;
    			  endDate = data.expireTime;
    		  }
    		  
    		  //不同产品初始化不同的数据
    		  if(data.productId == "VDC"){//VDC 产品
    			  loadVdcOsType(false);
    			  var limit = data.serviceVDC.isLimit;
    			  self.showItems(limit);
    			  self.serviceVO().serviceVDC.isLimit(limit);
    			  var vdcOsType = data.serviceVDC.osType;
    			  if(vdcOsType.indexOf(",") != -1){
    				  self.osTypeList(vdcOsType.split(","));
        		  }else{
        			  self.osTypeList.push(vdcOsType);
        		  }
    			  //if(limit == "yes"){
    				  self.serviceVO().serviceVDC.maxCpu(data.serviceVDC.maxCpu);
    				  self.serviceVO().serviceVDC.maxVmNum(data.serviceVDC.maxVmNum);
    				  self.serviceVO().serviceVDC.maxMemory(data.serviceVDC.maxMemory);
    				  self.serviceVO().serviceVDC.maxDiskNum(data.serviceVDC.maxDiskNum);
    				  self.serviceVO().serviceVDC.maxStorager(data.serviceVDC.maxStorager);
    				  self.serviceVO().serviceVDC.maxIpNum(data.serviceVDC.maxIpNum);
    				  self.serviceVO().serviceVDC.maxVPC(data.serviceVDC.maxVPC);
    				  self.serviceVO().serviceVDC.maxRouterNum(data.serviceVDC.maxRouterNum);
    				  self.serviceVO().serviceVDC.maxObjStorageNum(data.serviceVDC.maxObjStorageNum);
    				  self.serviceVO().serviceVDC.maxFireWallNum(data.serviceVDC.maxFireWallNum);
    				  self.serviceVO().serviceVDC.maxSSHNum(data.serviceVDC.maxSSHNum);
    				  self.serviceVO().serviceVDC.maxLoadBalanceNum(data.serviceVDC.maxLoadBalanceNum);
    				  self.serviceVO().serviceVDC.maxSecurityGroupNum(data.serviceVDC.maxSecurityGroupNum);
    				  self.serviceVO().serviceVDC.maxVpnNum(data.serviceVDC.maxVpnNum);
    			 // }
    		  }else{
    			  //初始化AZ数据
    			  getAzsByUser(viewModel,false);
        		  var vdcUuid = data.servicePartition[0].vdcUuid;//初始化已选择的范围
        		  var azUuid = data.servicePartition[0].azUuid;//初始化可用分区
        		  loadReleaseVdc(azUuid,false);//加载发布范围列表
        		  //发布范围赋值
        		  if(vdcUuid.indexOf(",") != -1){
        			  self.releaseRange(vdcUuid.split(","));
        		  }else{
        			  self.releaseRange.push(vdcUuid);
        		  }
        		  //az分区赋值
        		  if(azUuid.indexOf(",") != -1){
        			  self.azUuidList(azUuid.split(","));
        		  }else{
        			  self.azUuidList.push(azUuid);
        		  }
        		  if(data.productId == "DISK"){//云盘
        			  loadDiskType();
        			  self.diskTypeCheck(data.serviceDisk.diskType);
        		  }else if(data.productId == "VM"){//虚拟机
        			  loadVirtualPlatform();//获取虚拟化平台数据
                	  loadVmCpu(false);//获取虚拟机CPU
                	  loadVmMemory(false);//获取虚拟机内存
                	  
                	  self.serviceVO().serviceVm.virtualName(data.serviceVm.virtualName);//虚拟化赋值
                	  
                	  //初始化虚拟机操作系统类型数据        	 
         		 	  loadVmOsType(false);
         		 	  //初始化可用分区数据
         		 	  loadVmAzs(false);
                	  
                	  //CPU赋值
                	  var vmCpu = data.serviceVm.cpu;
                	  if(vmCpu.indexOf(",") != -1){
            			  self.cpuCheckList(vmCpu.split(","));
            		  }else{
            			  self.cpuCheckList.push(vmCpu);
            		  }
                	  //memory赋值
                	  var vmMemory = data.serviceVm.memory;
                	  if(vmMemory.indexOf(",") != -1){
            			  self.memoryCheckList(vmMemory.split(","));
            		  }else{
            			  self.memoryCheckList.push(vmMemory);
            		  }
                	 /*  //当修改时清除已选择的可用分区和操作系统类型数据
                	  if(viewModel.azUuidList().length > 0){
             			 viewModel.azUuidList.removeAll();
             		  }
                	  if(viewModel.osTypeCheckList().length > 0){
               			 viewModel.osTypeCheckList.removeAll();
               		  }*/
                	  //操作系统类型赋值
                	  var vmOsType = data.serviceVm.osType;
                	  if(vmOsType.indexOf(",") != -1){
            			  self.osTypeCheckList(vmOsType.split(","));
            		  }else{
            			  self.osTypeCheckList.push(vmOsType);
            		  }
                	  //可用分区赋值
                	  var vmAz = data.serviceVm.azUuid;
                	  if(vmAz.indexOf(",") != -1){
            			  self.azUuidList(vmAz.split(","));
            		  }else{
            			  self.azUuidList.push(vmAz);
            		  }
            		  //操作系统版本列表赋值
            		  self.osVersionList.params({
                  		  azUuid: vmAz,
                  		  osTypes: vmOsType
                  	  });
                  	  var vmOsVersion = data.serviceVm.osVersion;
                  	  var vmOsVersionList = new Array();
	                  if(vmOsVersion.indexOf(",") != -1){
	                	  vmOsVersionList(vmOsVersion.split(","));
	          		  }else{
	          			  vmOsVersionList.push(vmOsVersion);
	          		  }
	                  //清除已加载的数据，防止多次点击修改时数据无限叠加
	                  if(self.osType_chosen().length > 0){
	                	  self.osType_chosen.removeAll();
	                  }
                  	  if(self.osVersionList.pagedRows().length > 0 && vmOsVersionList.length > 0){
                  		  for(var m = 0; m < self.osVersionList.pagedRows().length; m++){
                  			  for(var n = 0; n < vmOsVersionList.length; n++){
                  				  if(self.osVersionList.pagedRows()[m].imageUuid == vmOsVersionList[n]){
                  					  self.osType_chosen.push(self.osVersionList.pagedRows()[m]);
                  				  }
                  			  }
                  		  }
                  	  }
        		  }else if(data.productId == "PUBLICIP"){//公网IP
        			  //公网IP列表赋值
        			  self.ip_chosen(data.serviceIpRef);
        		  }
    		  }
    		  
    		  self.isCreateService(true);
    		  $('#addServer_daterange').val(moment().subtract( 29, 'days').format('YYYY-MM-DD') + ' 至 ' + moment().format('YYYY-MM-DD')).daterangepicker({
    		        format:'YYYY-MM-DD',
//    		        startDate: moment().subtract( 29, 'days'),
//    		        endDate: Date.today().addDays(1),
    		        minDate: Date.today(),
    		        separator:'至',
    		        timePicker:true,
    		        timePicker24Hour: true
    		  });
    		  $("#selectServiceName").attr("disabled",true);//修改时产品不让修改
    		  if(startDate != "" && endDate != ""){
    			  $('#addServer_daterange').data('daterangepicker').setStartDate(startDate);
    			  $('#addServer_daterange').data('daterangepicker').setEndDate(endDate);
    		  }        	  
          });
      }
      
      <!-- 创建服务弹窗 -->
      //创建服务弹窗
      this.isCreateService = ko.observable(false);
      this.createService = function(){ 	
    	  var vo = new entityVO();
	  	  this.serviceVO = new ko.validatedObservable(vo);
	  	  this.isCreateService(true);
    	  //初始化数据start
          this.step(1);
    	  this.selected_product("VDC");

    	  if(self.releaseRange().length > 0){
			  self.releaseRange.removeAll();
		  }
    	  if(self.packages_chosen().length > 0){
			  self.packages_chosen.removeAll();
		  }
    	  
/*     	  this.showItems("no");
    	  this.showItems.subscribe(function(value){
    	         if(value=='yes'){
    	       		self.serviceVO().serviceVDC.maxCpu.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxVmNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxMemory.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxDiskNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxStorager.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxIpNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxVPC.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxRouterNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxObjStorageNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxFireWallNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxSSHNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxLoadBalanceNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxSecurityGroupNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxVpnNum.extend({required: {params: true, onlyIf:function(){return true}}});
    	       	  }else{
    	       		self.serviceVO().serviceVDC.maxCpu.extend({required: {params: false, onlyIf:function(){return true}}})
    	       		self.serviceVO().serviceVDC.maxVmNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxMemory.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxDiskNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxStorager.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxIpNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxVPC.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxRouterNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxObjStorageNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxFireWallNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxSSHNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxLoadBalanceNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxSecurityGroupNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       		self.serviceVO().serviceVDC.maxVpnNum.extend({required: {params: false, onlyIf:function(){return true}}});
    	       	  }
    	  }) */
    	  this.isFee("1");
    	  //初始化数据end
    	  loadServiceTree();//加载服务目录树
    	  loadVdcOsType(true);  //获取VDC操作系统数据
    	  $('#addServer_daterange').val(moment().subtract( 29, 'days').format('YYYY-MM-DD') + ' 至 ' + moment().format('YYYY-MM-DD')).daterangepicker({
	        format:'YYYY-MM-DD',
	        startDate: moment().subtract( 29, 'days'),
	        endDate: Date.today().addDays(1),
	        minDate: Date.today(),
	        separator:'至',
	        timePicker:true,
	        timePicker24Hour: true
	      });
    	  
      }      
      //获取公网IP列表的azuuid
      function getIpAzUuids(obj){
    	  var azs = "";    	  
    	  if(obj.length > 0){
 			  for(var i = 0; i < obj.length; i++){
 				 azs += obj[i].azUuid + ","; 
 			  }
 		  }
    	  if(azs != ""){
    		  azs = azs.substring(0, azs.length - 1);
    	  }    	  
    	  return azs;
      }
      
      //上一步  下一步 start
      this.step = ko.observable(1);
         
      this.nextStep = function(){
    	  if(this.step() == 1){
    		  ko.validation.group(this.serviceVO).showAllMessages();
    		  if(this.serviceVO().name() == ""){
    			  //alert("服务名称是必填项！")
    			  return;
    		  }
    	  }
    	  //debugger
    	  if(this.step() == 2 && this.selected_product()!='VDC'){
    		  if(this.selected_product()=='PUBLICIP'){
    			  if(this.ip_chosen().length <= 0){
                   	  alert("请至少选择一个公网IP！");
                   	  return;
                  }
       			  //公网IP的发布范围根据所选择的IP列表获取
       			  var azStrs = getIpAzUuids(this.ip_chosen());
    	  		  if(azStrs == ""){
    	  			  alert("请选择可用分区！");
    	  			  return;
    	  		  }
    	  		  loadReleaseVdc(azStrs,true);
    		  }else{
    			  //根据azUuid获取发布范围接口数据调用
        		  var azStrs = getAzUuids(this.azUuidList());
        		  if(azStrs == ""){
        			  alert("请选择可用分区！");
        			  return;
        		  }
        		  loadReleaseVdc(azStrs,true);
        		  
        		  if(this.selected_product() == 'VM'){
        			  if(this.osType_chosen().length <= 0){
                    	  alert("请至少选择一个操作系统版本！");
                    	  return;
                      }
        			  if(this.cpuCheckList().length <= 0){
                    	  alert("请至少勾选一个CPU(核)！");
                    	  return;
                      }
        			  if(this.memoryCheckList().length <= 0){
                    	  alert("请至少勾选一个内存！");
                    	  return;
                      }
        		  }
    		  }
   			  
    	  }else if(this.step() == 2 && this.selected_product()=='VDC'){
    		  if(this.osTypeList().length <= 0){
    			  alert("请至少选择一个支持操作系统！");
    			  return;
    		  }
    		 /*  var isLimit = this.showItems();
    		  if(isLimit == "yes"){
    			  ko.validation.group(this.serviceVO).showAllMessages();
    			  var isMandatory = true;
    			  var obj = this.serviceVO().serviceVDC;
    	    	  var maxCpu = obj.maxCpu();
    	    	  if(typeof(maxCpu) == "undefined" || maxCpu == ""){
//    	    		  alert("【最大CPU(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxVmNum = obj.maxVmNum(); 
    	    	  if(typeof(maxVmNum) == "undefined" || maxVmNum == ""){
//    	    		  alert("【最大云主机数(台)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxMemory = obj.maxMemory(); 
    	    	  if(typeof(maxMemory) == "undefined" || maxMemory == ""){
//    	    		  alert("【最大内存(GB)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxDiskNum = obj.maxDiskNum(); 
    	    	  if(typeof(maxDiskNum) == "undefined" || maxDiskNum == ""){
//    	    		  alert("【最大云硬盘数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxStorager = obj.maxStorager(); 
    	    	  if(typeof(maxStorager) == "undefined" || maxStorager == ""){
//    	    		  alert("【最大存储(GB)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxIpNum = obj.maxIpNum(); 
    	    	  if(typeof(maxIpNum) == "undefined" || maxIpNum == ""){
//    	    		  alert("【最大公网IP数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxVPC = obj.maxVPC(); 
    	    	  if(typeof(maxVPC) == "undefined" || maxVPC == ""){
//    	    		  alert("【最大VPC(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxRouterNum = obj.maxRouterNum(); 
    	    	  if(typeof(maxRouterNum) == "undefined" || maxRouterNum == ""){
//    	    		  alert("【最大路由器数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxObjStorageNum = obj.maxObjStorageNum(); 
    	    	  if(typeof(maxObjStorageNum) == "undefined" || maxObjStorageNum == ""){
//    	    		  alert("【最大对象存储(GB)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxFireWallNum = obj.maxFireWallNum(); 
    	    	  if(typeof(maxFireWallNum) == "undefined" || maxFireWallNum == ""){
//    	    		  alert("【最大防火墙数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxSSHNum = obj.maxSSHNum(); 
    	    	  if(typeof(maxSSHNum) == "undefined" || maxSSHNum == ""){
//    	    		  alert("【最大SSH密钥数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxLoadBalanceNum = obj.maxLoadBalanceNum(); 
    	    	  if(typeof(maxLoadBalanceNum) == "undefined" || maxLoadBalanceNum == ""){
//    	    		  alert("【最大负载均衡数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxSecurityGroupNum = obj.maxSecurityGroupNum(); 
    	    	  if(typeof(maxSecurityGroupNum) == "undefined" || maxSecurityGroupNum == ""){
//    	    		  alert("【最大负载均衡数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  var maxVpnNum = obj.maxVpnNum(); 
    	    	  if(typeof(maxVpnNum) == "undefined" || maxVpnNum == ""){
//    	    		  alert("【最大负载均衡数(个)】为必填，并且只能为正整数！")
					  isMandatory = false;
//    	    		  return;
    	    	  }
    	    	  if(!isMandatory){
          			  alert("请输入限制的配额的值！");
          			  return;
          		  }
    		  } */
    	  }

    	  this.step(this.step()+1);
      }
      this.prevStep = function(){
    	  this.step(this.step()-1);
      }
      //上一步  下一步 end
      
		//修改图标start
        this.isChangeImg = ko.observable(false);
        this.changeImg = function(){
	        this.isChangeImg(true);
	        $("#picModal").on("shown.bs.modal",function(){
					$(this).find('.modal-dialog').draggable({ handle:'.modal-header'});
					loadInit();
			});
        }
        this.setImg = function(){
          this.isChangeImg(false);
        }
        //修改图标end
        
        <!--选择产品start-->
        this.selected_product = ko.observable();
        this.selected_product(product);
        this.showItems = ko.observable('no');
        
        
     	//选择产品时的change事件
        this.changeValue = function(viewModel, event){
        	//选择VDC
          if(viewModel.selected_product()=='VDC'){        	  
        	  
          }else if(viewModel.selected_product()=='VM'){//选择云主机
        	  loadVirtualPlatform();//获取虚拟化平台数据
        	  loadVmCpu(true);//获取虚拟机CPU
        	  loadVmMemory(true);//获取虚拟机内存
          }else if(viewModel.selected_product()=='DISK'){//选择云盘
        	  loadDiskType();//初始化云盘类型
        	  getAzsByUser(viewModel,true);
          }else{
        	  getAzsByUser(viewModel,true);
          }
        }
        //
     	function getAzsByUser(viewModel,bool){
    	   if(viewModel.azUuidList().length > 0){
     		   viewModel.azUuidList.removeAll();
     	   }
       	   //根据当前用户获取可用分区
       	   csc.rest.get('api/v5.0.0/azs',function(data1){
         		viewModel.azList(data1.results);
         		if(bool){
         			if(data1.results.length > 0){          			
             			for(var i = 0;i < data1.results.length;i++){
                 			viewModel.azUuidList.push(data1.results[i].uuid);
                   		}
             		}
         		}         		
            });
     	}
     	
        <!--选择产品end-->  	    
        
        <!--  添加计费规则start -->
        function Package(type,value){
      	  this.type = ko.observable(type);
      	  this.value = ko.observable(value);
      	  this.feeList = ko.observableArray();
        }
        this.packages = ko.observableArray([
      		  new Package("按天","DAY"),
      		  new Package("按月","MONTH"),
      		  new Package("按季度","QUARTER"),
      		  new Package("按年","YEAR")
        ]); 

        this.packages_chosen = ko.observableArray();
        this.package_current = null;
        
        this.isAdd_Fee = ko.observable(false);
        //费用规则列表
        this.feeList = new DataTable([], {path: "api/v5.0.0/billing/rules"});
        
        this.addFeeDay = function(package,event){
      	  self.package_current = package;
      	  self.feeList.params({
      		  attrType: self.selected_product(),
      		  cycle: package.value()
      	  })
     	  self.isAdd_Fee(true);              
        }
        this.addFeeToList = function(){
        	//计费因子相同时的校验
            for (var i = 0; i < this.feeList.chosenItems().length; i++){  //外循环是循环的次数
                for (var j = this.feeList.chosenItems().length - 1 ; j > i; j--){  //内循环是 外循环一次比较的次数
                    if (this.feeList.chosenItems()[i].attrType == this.feeList.chosenItems()[j].attrType){
                        alert("相同的计费因子只能选择一个！");
                        return;
                    }
                }
            }
        	
      	    this.package_current.feeList(this.feeList.chosenItems());
      	    self.isAdd_Fee(false);
        }
        
        this.deleteRuleFee = function(feeList,data,event){
        	feeList.remove(data);
        }
        <!-- 添加计费规则end -->
        
  	   //虚拟机的cpu
  	   this.cpuCheckList = ko.observableArray();
       //虚拟机的操作系统类型
  	   this.osTypeCheckList = ko.observableArray();
       //虚拟机的内存
  	   this.memoryCheckList = ko.observableArray();
  	   //获取az
  	   this.azUuidList = ko.observableArray();
       function getAzUuids(obj){
    	  var azs = "";    	  
    	  if(obj.length > 0){
 			  for(var i = 0; i < obj.length; i++){
 				 azs += obj[i]+","; 
 			  }
 		  }
    	  if(azs != ""){
    		  azs = azs.substring(0, azs.length - 1);
    	  }    	  
    	  return azs;
       }
  	   //获取所选择的发布范围以","分隔
  	   this.releaseRange = ko.observableArray();
  	   function getReleaseRanges(obj){  		   
  		  var range = "";
     	  for(var i = 0;i < obj.length;i++){
     		 range += obj[i] + ",";
     	  }
     	  if(range != ""){
     		 range = range.substring(0,range.length-1);
     	  }
     	  return range;
        }
  	    
  	   
  	   //是否计费
  	   this.isFee = ko.observable("1");   
  	   //获取套餐值
  	   function getPackages(obj){   	  
      	  var feeType = "";
      	  for(var i = 0;i < obj.length;i++){
      		  feeType += obj[i].value()+",";
      	  }
      	  if(feeType != ""){
      		  feeType = feeType.substring(0,feeType.length-1);
      	  }
      	  return feeType;
        }
  	   	//获取计费规则以“，”分隔
	  	 function getRules(obj){   	  
	     	  var rule = "";	     	  
	     	  for(var i = 0;i < obj.length;i++){
	     		  var feeList = obj[i].feeList();
	     		  if(feeList.length > 0){
	     			  for(var j = 0; j < feeList.length; j++){
	     				 rule += feeList[j].uuid+",";
	     			  }
	     		  }	     		 
	     	  }
	     	  if(rule != ""){
	     		 rule = rule.substring(0,rule.length-1);
	     	  }
	     	  return rule;
	     }
  	   	
  	   	this.buttonEnable = ko.observable(true);
  	   	
  	   	//根据vdc操作系统列表转成对应的String，以","分隔
  	   	function getVdcOsType(obj){
  	   		var vdcOsTypes = "";
  	   		for(var i = 0;i < obj.length; i++){
	  	   		if (vdcOsTypes == "") {
	  	   			vdcOsTypes = obj[i];
	            }else {
	            	vdcOsTypes = vdcOsTypes + "," + obj[i];
	            }
  	   		}
  	   		return vdcOsTypes;
  	   	}
  	   	
        //保存方法
  	    this.saveService = function(){
  	      this.buttonEnable(false);
  	      this.serviceVO().charge(this.isFee());//是否计费
  	      if(this.isFee() == 0){
  	    	  this.serviceVO().chargeType(getPackages(this.packages_chosen()));//套餐
    		  this.serviceVO().rules(getRules(this.packages_chosen()));//计费规则
  	      }
  		  this.serviceVO().productId(this.selected_product());
  		  
  		  if(this.selected_product()=='VDC'){//VDC保存时的数据
  			  this.serviceVO().serviceVm = null;
  			  this.serviceVO().serviceDisk = null;
  			  this.serviceVO().serviceIP = null;
  			  this.serviceVO().serviceVDC.isLimit(this.showItems());
  			  this.serviceVO().serviceVDC.osType(getVdcOsType(this.osTypeList()));
  			  
  	      }else {
  	    	  //当修改时根据选择的可用分区联动过滤已选择的发布范围
  	    	  var range = "";
  	    	  if(this.serviceVO().uuid()){
  	    		  var rangeList = new Array();
  	    		  if(this.releaseRange().length > 0 && this.vdcList().length > 0){
    	    		  for(var i = 0; i < this.vdcList().length; i++){
    	    			  for(var j = 0; j < this.releaseRange().length; j++){
    	    				  if(this.vdcList()[i].uuid == this.releaseRange()[j]){
    	    					  rangeList.push(this.releaseRange()[j])
    	    				  }
    	    			  }
    	    		  }
    	    	  }
  	    		  range = getReleaseRanges(rangeList);
  	    	  }else{
  	    		  range = getReleaseRanges(this.releaseRange());
  	    	  }
  	    	  if(range == ""){
	      		  alert("请选择发布范围！");
	      		  return;
	  	      }
	  	  	  this.serviceVO().servicePartitions(range);//发布范围  	    	    	    	  
	  	      this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区	    	  
	    	  
  	    	  if(this.selected_product()=='VM'){//云主机保存时的数据
  	  	      	
    	    	  this.serviceVO().serviceVDC = null;
    	    	  this.serviceVO().serviceDisk = null;
    	    	  this.serviceVO().serviceIP = null;
    	    	  this.serviceVO().serviceVm.osVersion(getOsVersion(this.osType_chosen()));//操作系统版本
    	    	  this.serviceVO().serviceVm.osType(getAzUuids(this.osTypeCheckList()));//操作系统类型
    	    	  this.serviceVO().serviceVm.cpu(getAzUuids(this.cpuCheckList()));//cpu
    	    	  this.serviceVO().serviceVm.memory(getAzUuids(this.memoryCheckList()));//内存
    	    	  
    	      }else if(this.selected_product()=='DISK'){//云盘保存时的数据
    	    	
    	    	this.serviceVO().serviceVm = null;
    	    	this.serviceVO().serviceVDC = null;
    	    	this.serviceVO().serviceIP = null;
    	    	this.serviceVO().serviceDisk.diskType(this.diskTypeCheck());//云盘类型
    	      }else if(this.selected_product()=="PUBLICIP"){//公网IP
    	    	this.serviceVO().serviceIp.ipUuid(getIpUuids(this.ip_chosen()));//ip列表
    	      }else{
    	    	this.serviceVO().serviceVm = null;
      	    	this.serviceVO().serviceVDC = null;
      	    	this.serviceVO().serviceIP = null;
      	    	this.serviceVO().serviceDisk = null;
    	      }
  	      }
  		  ko.validation.group(this.serviceVO).showAllMessages();
  		  if(this.serviceVO.isValid()){	  
	  		  if(this.serviceVO().uuid()){
	  			csc.rest.put('api/v5.0.0/service/updateService/'+this.serviceVO().uuid(),this.serviceVO.toJSON(),function(data){
	  				self.buttonEnable(true);
	  				self.table.refreshData();
	  				self.isCreateService(false);
	                alert('修改成功！');
	            });
	  		  }else{
	  			csc.rest.post('api/v5.0.0/service',this.serviceVO.toJSON(),function(data){
	  				self.buttonEnable(true);
	  				self.table.refreshData();
	  				self.isCreateService(false);
	                alert('创建成功！');
	            });  
	  		  }
  		  }else{
  			  alert("请检查必填项！");
  		  }
  	    }
        //保存并发布
  	    this.saveServiceAndRelease = function(){
  	    	  this.buttonEnable(false);
  	    	  this.serviceVO().charge(this.isFee());//是否计费
  	    	  if(this.isFee() == 0){
    	    	  this.serviceVO().chargeType(getPackages(this.packages_chosen()));//套餐
      		  	  this.serviceVO().rules(getRules(this.packages_chosen()));//计费规则
    	      }
    		  this.serviceVO().productId(this.selected_product());
    		  
    		  if(this.selected_product()=='VDC'){//VDC保存时的数据
    			  this.serviceVO().serviceVm = null;
    			  this.serviceVO().serviceDisk = null;
    			  this.serviceVO().serviceIP = null;
    			  this.serviceVO().serviceVDC.osType(getVdcOsType(this.osTypeList()));
    			  this.serviceVO().serviceVDC.isLimit(this.showItems());
    	      }else {
    	    	  //当修改时根据选择的可用分区联动过滤已选择的发布范围
    	    	  var range = "";
    	    	  if(this.serviceVO().uuid()){
    	    		  var rangeList = new Array();
    	    		  if(this.releaseRange().length > 0 && this.vdcList().length > 0){
      	    		  for(var i = 0; i < this.vdcList().length; i++){
      	    			  for(var j = 0; j < this.releaseRange().length; j++){
      	    				  if(this.vdcList()[i].uuid == this.releaseRange()[j]){
      	    					  rangeList.push(this.releaseRange()[j])
      	    				  }
      	    			  }
      	    		  }
      	    	  }
    	    		  range = getReleaseRanges(rangeList);
    	    	  }else{
    	    		  range = getReleaseRanges(this.releaseRange());
    	    	  }
    	    	  if(range == ""){
  	      		  alert("请选择发布范围！");
  	      		  return;
  	  	      }
  	  	  	  this.serviceVO().servicePartitions(range);//发布范围  	    	    	    	  
  	  	      this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区	    	  
  	    	  
    	      if(this.selected_product()=='VM'){//云主机保存时的数据
    	  	      	
      	    	  this.serviceVO().serviceVDC = null;
      	    	  this.serviceVO().serviceDisk = null;
      	    	  this.serviceVO().serviceIP = null;
      	    	  this.serviceVO().serviceVm.osVersion(getOsVersion(this.osType_chosen()));//操作系统版本
      	    	  this.serviceVO().serviceVm.osType(getAzUuids(this.osTypeCheckList()));//操作系统类型
      	    	  this.serviceVO().serviceVm.cpu(getAzUuids(this.cpuCheckList()));//cpu
      	    	  this.serviceVO().serviceVm.memory(getAzUuids(this.memoryCheckList()));//内存
      	    	  
      	      }else if(this.selected_product()=='DISK'){//云盘保存时的数据
      	    	
      	    	this.serviceVO().serviceVm = null;
      	    	this.serviceVO().serviceVDC = null;
      	    	this.serviceVO().serviceIP = null;
      	    	this.serviceVO().serviceDisk.diskType(this.diskTypeCheck());//云盘类型
      	      }else if(this.selected_product()=="PUBLICIP"){//公网IP
      	    	this.serviceVO().serviceIp.ipUuid(getIpUuids(this.ip_chosen()));//ip列表
      	      }else{
      	    	this.serviceVO().serviceVm = null;
        	    	this.serviceVO().serviceVDC = null;
        	    	this.serviceVO().serviceIP = null;
        	    	this.serviceVO().serviceDisk = null;
      	      }
    	      }
    		  ko.validation.group(this.serviceVO).showAllMessages();
      		  if(this.serviceVO.isValid()){	  
	    		  if(this.serviceVO().uuid()){
	    			csc.rest.put('api/v5.0.0/service/updateService/'+this.serviceVO().uuid(),this.serviceVO.toJSON(),function(data){
	    				data.state = "1";
	    				csc.rest.put('api/v5.0.0/service/changeState/'+data.uuid,data,function(data1){
	    					self.buttonEnable(true);
	    					self.table.refreshData();
	        				self.isCreateService(false);
	                      	alert('保存并发布成功！');
	    		        });
	                });
	    		  }else{
	    			csc.rest.post('api/v5.0.0/service',this.serviceVO.toJSON(),function(data){
	    				data.state = "1";
	    				csc.rest.put('api/v5.0.0/service/changeState/'+data.uuid,data,function(data1){
	    					self.buttonEnable(true);
	    					self.table.refreshData();
	        				self.isCreateService(false);
	                      	alert('保存并发布成功！');
	    		        });
	                });  
	    		  }
      		  }else{
      			  alert("请检查必填项！");
      		  }
  	    }
        //产品列表
        this.productList = ko.observableArray();
        //操作系统类型
        this.osList = ko.observableArray();
        
        <!-- 云盘start  -->
        this.diskTypeList = ko.observableArray();
        this.diskTypeCheck = ko.observable("SSD");
        <!-- 云盘end  -->
        
        <!-- 公网IP   start-->
      	//添加IP start
        this.isAdd_Ip = ko.observable(false);
        this.addIp = function(){
          this.isAdd_Ip(true);
        }
        this.addIpToList = function(package,event){
          if(self.azUuidList().length <= 0){
          	 alert("请选择可用分区！");
          	 return;
          }
          self.ip_current = package;
      	  self.ipList.params({
      	  })
          this.ip_chosen(this.ipList.chosenItems());
          this.isAdd_Ip(false);
        }
        
        this.ip_chosen = ko.observableArray()
        this.ip_current = null;

		this.ipList = new DataTable([], {path: "api/v5.0.0/service/getServiceIpList"});
        //获取ip的uuid以","分隔
		function getIpUuids(obj){
			var ipUuid = "";
        	for(var i = 0;i < obj.length;i++){
        		ipUuid += obj[i].uuid + ",";
        	}
        	if(ipUuid != ""){
        		ipUuid = ipUuid.substring(0,ipUuid.length-1);
        	}
        	return ipUuid;
		}
        //删除所选择的公网IP
		this.deleteIp = function(obj){
			self.ip_chosen.remove(obj);
		}
        //添加IP  end
        
         <!-- 公网IP   end-->
      	//###########    列表、全选     ###############
      	/**发布范围全选按钮**/
	    this.isSelectedReleaseAll = ko.pureComputed({
	        read: function () {
	            return this.vdcList().length > 0 && this.vdcList().length === this.releaseRange().length;
	        },
	        write: function (value) {
	        	this.releaseRange(value ? _.pluck(this.vdcList(), 'uuid') : []);
	        },
	        owner: this
	      }); 
      	/** 可用分区全选按钮 ***/
	    this.isSelectedAzAll = ko.pureComputed({
	        read: function () {
	            return this.azList().length >0 && this.azList().length === this.azUuidList().length;
	        },
	        write: function (value) {
	        	this.azUuidList(value ? _.pluck(this.azList(), 'uuid') : []);
	        },
	        owner: this
	      });
	    /** 云主机操作系统类型全选按钮 ***/
	    this.isSelectedOsTypeAll = ko.pureComputed({
	        read: function () {
	            return this.vmOsTypeList().length >0 && this.vmOsTypeList().length === this.osTypeCheckList().length;
	        },
	        write: function (value) {
	        	this.osTypeCheckList(value ? _.pluck(this.vmOsTypeList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** 云主机CPU全选按钮 ***/
	    this.isSelectedCpuAll = ko.pureComputed({
	        read: function () {
	            return this.cpuList().length >0 && this.cpuList().length === this.cpuCheckList().length;
	        },
	        write: function (value) {	        	
	        	this.cpuCheckList(value ? _.pluck(this.cpuList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** 云主机内存全选按钮 ***/
	    this.isSelectedMemoryAll = ko.pureComputed({
	        read: function () {
	            return this.memoryList().length >0 && this.memoryList().length === this.memoryCheckList().length;
	        },
	        write: function (value) {
	        	this.memoryCheckList(value ? _.pluck(this.memoryList(), 'value') : []);
	        },
	        owner: this
	      });	    
	    /** 云主机内存全选按钮 ***/
	    this.isSelectedMemoryAll = ko.pureComputed({
	        read: function () {
	            return this.memoryList().length >0 && this.memoryList().length === this.memoryCheckList().length;
	        },
	        write: function (value) {
	        	this.memoryCheckList(value ? _.pluck(this.memoryList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** VDC操作系统类型全选按钮 ***/
	    this.isSelectedVdcOsAll = ko.pureComputed({
	        read: function () {
	            return this.osList().length >0 && this.osList().length === this.osTypeList().length;
	        },
	        write: function (value) {
	        	this.osTypeList(value ? _.pluck(this.osList(), 'value') : []);
	        },
	        owner: this
	      });
	    
        //发布范围
        this.vdcList = ko.observableArray();
        
        //查看详情
        this.showDetail = function(object,event){
      	  showModal("pages/services/service_definitions/showDetail.html?serviceUuid="+object.uuid);
        }
    }
    
    var viewModel = new ViewModel();
    ko.applyBindings(viewModel, $('#page-content')[0]);
  });
</script>


 <!-- 创建 --> 
  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isCreateService }">
  <div class='modal-dialog modal-lg' style="width:800px;">
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        <h3 class='modal-title' data-bind="ifnot: serviceVO().uuid">创建服务</h3>
		<h3 class='modal-title' data-bind="if: serviceVO().uuid">修改服务</h3>
      </div>
      <div class='modal-body no-padder'>
        <ul class="nav nav-tabs service-step-select">
          <li data-bind="css: {'active': step()==1}">
            <a >1基本信息</a>
          </li>
          <li data-bind="css: {'active': step()==2}">
            <a >2服务资源</a>
          </li>
          <li data-bind="css: {'active': step()==3}">
            <a >3服务计费</a>
          </li>
          <!-- ko if: selected_product()!='VDC' -->
          <li data-bind="css: {'active': step()==4}">
            <a >4发布范围</a>
          </li>
          <!-- /ko -->
        </ul>
        <div class="tab-content service-step-box m-t">
          <div class="tab-pane" data-bind="css: {'active': step()==1}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务名称：</label>
                <div class="col-xs-7">
                  <input type="text" class="form-control" placeholder="请输入名称" data-bind="value: serviceVO().name" maxlength="32">
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务目录：</label>
                <div class="col-xs-7">
                  <input type="text" class="form-control" placeholder="请选择服务目录" data-bind="value: serviceVO().dirName" id="selectDir" onclick="selectDirClick(event)">
                  <input type="hidden" id="dirUuid" data-bind="value: serviceVO().dirUUID"/>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div id="dirContent"
                style="display: none; position: absolute; z-index: 10000; background-color: white; border-left: 1px #DDDDDD solid; border-bottom: 1px #DDDDDD solid; border-right: 1px #DDDDDD solid; width: 420px; height: 198px; overflow: scroll;">
	            <div style="width:700px">
	                <ul id="dirTree" class="ztree" style="z-index: 1000;"></ul>
	            </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">产品：</label>
                <div class="col-xs-7">
                  <select class="form-control" id="selectServiceName" data-bind="options:productList,optionsText:'name',optionsValue:'codeName',value: selected_product, event:{'change':changeValue}">
                  </select>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务图标：</label>
                <div class="col-xs-7">
                  <div class="service-img-box" data-bind="click: changeImg">
                  <!-- <div class="service-img-box"  onclick="showModal('pages/services/service_definitions/addService.html')"> -->
                    <img src="" alt="" width="60" height="60" data-bind="attr: {src: serviceVO().imageUrl}">
                    <a >更改图标</a>
                  </div>
                </div>
              </div>              
              <div class="form-group">
                <label class="col-xs-3 control-label">服务介绍：</label>
                <div class="col-xs-7">
                  <textarea class="form-control" cols="30" rows="3" data-bind="value: serviceVO().desc" maxlength="250"></textarea>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">有效期：</label>
                <div class="col-xs-7">
                  <div class="radio">
                    <label class="form-inline">
                      <input type="radio" name="optionsRadios" id="optionsRadios1" value="1" checked data-bind="checked: serviceVO().validTimeType"> 永久
                    </label>
                  </div>
                  <div class="radio">
                    <label class="form-inline">
                      <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios2" value="2" data-bind="checked: serviceVO().validTimeType"> 
                      <select class="form-control" data-bind="value: serviceVO().validTimeNum">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      </select> 个月
                    </label>
                  </div>
                  <div class="radio disabled">
                    <label class="form-inline">
                      <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios3" value="3" data-bind="checked: serviceVO().validTimeType">
                      <input type="text" style="width:206px" class="form-control" id="addServer_daterange" data-bind="value: serviceVO().rangeTime">
                    </label>
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
          </div>

          <div class="tab-pane" data-bind="css: {'active': step()==2}">
            <!-- 云主机 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='VM'">
              <div class="form-group">
                <label class="col-xs-2 control-label">虚拟化：</label>
                <div class="col-xs-9">
                  <select class="form-control" data-bind="options:virtualPlatformList,optionsText:'value',optionsValue:'value',value: serviceVO().serviceVm.virtualName,event:{'change':changeVirtualValue}">                    
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList,event:{'change':$root.changeCheckBoxValue}" checked="checked"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->                    
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">操作系统类型：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedOsTypeAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : vmOsTypeList -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.osTypeCheckList,event:{'change':$root.changeCheckBoxValue}"><span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                 
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">操作系统版本：</label>                
                <div class="col-xs-9">
                  <div class="panel panel-default b-blue" style="margin:0;padding-bottom:10px">
                    <table class="table table-striped">
                      <thead>
                        <th>可用分区</th>
                        <th>操作系统类型</th>
                        <th>操作系统版本</th>
                        <th>关联镜象</th>
                        <th>操作</th>
                      </thead>
                      <tbody data-bind="foreach: osType_chosen">
                        <tr>
                          <td data-bind="text: zaName"></td>
                          <td data-bind="text: osType"></td>
                          <td data-bind="text: osVersion"></td>
                          <td data-bind="text: imageName"></td>
                          <td><a class="btn btn-xs btn-default" data-bind="click: $root.deleteOsType">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                    <a class="btn btn-sm btn-success" style="margin-left: 10px;" data-bind="click: addOsType">添加</a>
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">CPU(核)：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedCpuAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : cpuList  -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.cpuCheckList"><span data-bind="text: value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                  
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">内存：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedMemoryAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : memoryList   -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.memoryCheckList"><span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                  
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
            <!-- 云主机 end -->
            <!-- SSH密钥 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='SECRET_KEY'">
              
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
            <!-- SSH密钥 end -->
            <!-- 云硬盘 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='DISK'">
              <div class="form-group">
                <label class="col-xs-2 control-label">硬盘类型：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                  <!-- ko foreach : diskTypeList   -->
                    <div class="radio">
                      <label>
                         <input type="radio" data-bind="value: value,checked: $root.diskTypeCheck"><span data-bind="text:value"></span>
                      </label>
                    </div>
                  <!-- /ko -->            
                  </div>                  
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
            <!-- 云硬盘 end -->
            <!-- VDC start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='VDC'">
              <div class="form-group">
                <label class="col-xs-2 control-label">支持操作系统：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedVdcOsAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach: osList -->
                  <div class="checkbox" data-bind="">
                    <label>
                      <input type="checkbox" data-bind="value: value,checked: $root.osTypeList"> <span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
             <!--  <div class="form-group">
                <label class="col-xs-2 control-label">是否限制配额：</label>
                <div class="col-xs-9 form-inline">
                  <div class="form-inline">
                    <div class="radio">
                      <label>
                        <input type="radio" name="optionsRadiosi" id="optionsRadiosi1" value="yes" data-bind="checked: showItems"> 限制
                      </label>
                    </div>
                    <div class="radio">
                      <label>
                        <input type="radio" name="optionsRadiosi" id="optionsRadiosi2" value="no" checked="" data-bind="checked: showItems"> 不限制
                      </label>
                    </div>
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div> -->
              <div style="padding-right:50px;" class="form-group row" >
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大CPU(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxCpu" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大云主机数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxVmNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大内存(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxMemory" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大云硬盘数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxDiskNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大存储(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxStorager" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大公网IP数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxIpNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大VPC(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxVPC" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大路由器数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxRouterNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大对象存储(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxObjStorageNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大防火墙数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxFireWallNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大SSH密钥数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxSSHNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大负载均衡数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxLoadBalanceNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大安全组数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxSecurityGroupNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大VPN数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxVpnNum" maxlength="8" placeholder="不限配额">
                    </div>
                  </div>
                </div>

              </div>
            </div>
            <!-- VDC end -->
            <!-- 公网IP start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='PUBLICIP'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group" style="padding:0 50px;">
                <div class="panel panel-default b-blue">
                  <div class="panel-heading clearfix">
                    <strong>公网IP列表</strong>
                    <a class="btn btn-default btn-xs pull-right" style="color:#666;" data-bind="click: addIp">添加</a>
                  </div>
                  <div class="panel-body">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>VPC名称</th>
                          <th>网络名称</th>
                          <th>IP资源</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody data-bind="foreach: ip_chosen">
                        <tr>
                          <td data-bind="text: vpcName"></td>
                          <td data-bind="text: name"></td>
                          <td data-bind="text: cidr"></td>
                          <td><a data-bind="click: $root.deleteIp">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
            </div>            
            <!-- 公网IP end -->
            <!-- 负载均衡 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='LOAD_BALANCING'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
            <!-- 负载均衡 end -->
            <!-- 对象存储 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='OBJECT_STORAGE'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
            <!-- 对象存储 end -->
          </div>

          <div class="tab-pane" data-bind="css: {'active': step()==3}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-2 control-label">是否计费：</label>
                <div class="col-xs-9 form-inline">
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios2" id="optionsRadios21" value="0" checked data-bind="checked: isFee"> 是
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios2" id="optionsRadios22" value="1" checked data-bind="checked: isFee"> 否
                    </label>
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
              <div class="form-group" data-bind="visible:isFee()=='0'">
                <label class="col-xs-2 control-label">包含套餐：</label>
                <div class="col-xs-9">
                  <div class="form-inline" data-bind="foreach: packages">
					<div class="checkbox">
						<label> <input type="checkbox"  data-bind="value: $data, checked: $root.packages_chosen"><span data-bind="text: type"></span>
						</label>
					</div>
				  </div>
				  <div data-bind="foreach: packages_chosen">
	                  <div class="panel panel-default b-blue jifei-panel">
	                    <div class="panel-heading jifei-heading">
	                    <h4 data-bind="text: type"></h4>
	                    <a class="btn btn-sm btn-info jifei-btn" data-bind="click: $root.addFeeDay">添加计费规则</a></div>
	                    <table class="table table-striped">
	                      <thead>
	                        <th>计费因子</th>
	                        <th>计费规则</th>
	                        <th>操作</th>
	                      </thead>
	                      <tbody data-bind="foreach: feeList">
	                        <tr>
	                          <td data-bind="text: attrType"></td>
                              <td data-bind="text: name"></td>
	                          <td><a class="btn btn-xs btn-default" data-bind="click: function(data, event) { $root.deleteRuleFee($parent.feeList, data, event) }">删除</a></td>
	                        </tr>
	                      </tbody>
	                    </table>
	                  </div>
                  </div>
                  
                </div>
              </div>
            </div>                      
          </div>
          
          <div class="tab-pane" data-bind="if: selected_product()!='VDC',  css: {'active': step()==4}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-2 control-label">发布范围：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedReleaseAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : vdcList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.releaseRange"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->                    
                  </div>
                </div>
                <div class="col-xs-1">
					<span class="text-danger inline m-l-n m-t-sm">*</span>
				</div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info service-step-btn-pre" data-bind="visible: step()>1, click: prevStep">上一步</a>
        <a class="btn btn-default btn-info service-step-btn-next" data-bind="visible: (selected_product() !='VDC' && step()<4) || (selected_product() =='VDC' && step()<3), click: nextStep">下一步</a>        
        <a class="btn btn-default btn-info service-step-btn-save" data-bind="visible: step()==4 || (selected_product() =='VDC' &&  step()==3), click: saveService, enable:buttonEnable">保存</a>
        <a class="btn btn-default btn-success service-step-btn-saveAndRelease" data-bind="visible: step()==4 || (selected_product() =='VDC' &&  step()==3), click: saveServiceAndRelease,enable:buttonEnable">保存并发布</a>
        <!-- <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a> -->
      </div>
    </div>
  </div>
</div>


<!-- 选择计费 -->
<div role="dialog" aria-hidden="true" id="addFeeDialog" class="modal fade" data-bind="modal: { show: isAdd_Fee }">
  <div class='modal-dialog modal-lg'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择计费</h3>
      </div>
      <div class='modal-body form-horizontal'>
        <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: feeList">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>
			      <div class="checkbox">
			        <label class="i-checks">
			          <input type="checkbox" data-bind="checked: isSelectedAll">
			          <i></i>
			        </label>
			      </div>                    
			    </th>  
                <th>计费因子</th>
                <th>计费规则</th>
                <th>计费金额(元)</th>
              </tr>
            </thead>
            <tbody>
              <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
              <tr>
                <td>
			      <div class="checkbox">
			        <label class="i-checks">
			          <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			          <i></i>
			        </label>
			      </div> 
			    </td>
                <td data-bind="text: attrType"></td>
                <td data-bind="text: name"></td>
                <td data-bind="text: price"></td>
              </tr>
              <!-- /ko -->
            </tbody>
          </table>
        </div>        
      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info" data-bind="click: addFeeToList">确定添加</a>
        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
      </div>
    </div>
  </div>
</div>
<!-- 添加操作系统版本 --> 
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd_osType }">
   <div class='modal-dialog modal-lg'>
     <div class='modal-content'>
       <div class='modal-header'>
         <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>添加操作系统版本</h3>
       </div>
       <div class='modal-body form-horizontal'>
         <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: osVersionList">
           <table class="table table-striped">
             <thead>
               <tr>
                 <th>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checked: isSelectedAll">
			           <i></i>
			         </label>
			       </div>                    
			     </th>  
                 <th>镜像名称</th>
                 <th>操作系统类型</th>
                 <th>操作系统版本</th>
                 <th>可用分区</th>
               </tr>
             </thead>
             <tbody>
               <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
               <tr>
                 <td>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			           <i></i>
			         </label>
			       </div> 
			     </td>
                 <td data-bind="text: imageName"></td>
                 <td data-bind="text: osType"></td>
                 <td data-bind="text: osVersion"></td>
                 <td data-bind="text: zaName"></td>
               </tr>
               <!-- /ko -->
             </tbody>
           </table>
         </div>
         
       </div>
       <div class='modal-footer' style="text-align:center;">
         <a class="btn btn-default btn-info" data-bind="click: addOsVersionToList">确定添加</a>
         <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
       </div>
     </div>
   </div>
 </div>
 <!-- 选择网络 -->
 <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd_Ip }">
    <div class='modal-dialog modal-lg' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择网络</h3>
        </div>
        <div class='modal-body form-horizontal'>
          <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: ipList">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checked: isSelectedAll">
			           <i></i>
			         </label>
			       </div>
			      </th>
                  <th>VPC名称</th>
                  <th>网络名称</th>
                  <th>IP资源</th>
                  <th>可用分区</th>
                </tr>
              </thead>
              <tbody>
              	<!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                <tr>
                  <td>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			           <i></i>
			         </label>
			       </div> 
			      </td>
                  <td data-bind="text: vpcName"></td>
                  <td data-bind="text: name"></td>
                  <td data-bind="text: cidr"></td>
                  <td data-bind="text: azName"></td>
                </tr>
                <!-- /ko -->
              </tbody>
            </table>
          </div>
          
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: addIpToList">确定添加</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div>
  <!-- 上传图片 -->
  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isChangeImg }" id="picModal">
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>上传图片</h3>
        </div>
        <!-- <form action="/api/v5.0.0/file/upload/rest" enctype="multipart/form-data"> -->
	        <!-- <div class='modal-body row'>
	          <div class="col-xs-6">
	            <img src="" alt="" width="100%" height="150" id="ImgPr">
	          </div>
	          <div class="col-xs-6">
	            <p><a href="javascript:;" class="btn btn-success" style="margin-left: 10px;display: inline-block;width: 80px;height: 34px;overflow: hidden;position:relative;">
					<input id="up" type="file" name="file" style="opacity: 0;position: absolute;left:0;right:0;" 
					 data-bind="" onclick="preViewImage()"/>上传图片</a></p>
	        	   <p>支持JPG、GIF、PNG、BMP格式；图片小于2M。</p>
	          </div>
	        </div> -->
	        
	        <div class='modal-body row'>
	          <div class="col-xs-6">
	            <div id="fileList" class="uploader-list"><div class="file-item thumbnail" style="height: 120px"><img src="" alt="" id="ImgPr" height="100" width="100" data-bind="attr: {src: serviceVO().imageUrl}"></div></div>
	          </div>
	          <div class="col-xs-6">
	            <div id="filePicker">选择图片</div>
	        	   <p>支持JPG、GIF、PNG、BMP格式；图片小于2M。</p>
	          </div>
	        </div>
        <!-- </form> -->
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: setImg">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div> 