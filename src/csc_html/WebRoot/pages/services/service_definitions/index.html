<link href="assets/lib/zTree/css/ibos/ibos.css" rel="stylesheet"
	type="text/css" />

<style>
  .service-img-box{position:relative;width:60px;height:60px;}
  .service-img-box a{font-size:12px;text-align:center;position:absolute;bottom:0;width:100%;color:#fff;height:16px;line-height:16px;background:rgba(0,0,0,.2)}
  .ztree.release li a.curSelectedNode{background:none;color: #82939E;}
  .ztree.release li a:hover{border-color:#fff;background-color:#fff;}
  .jifei-heading{overflow:hidden;height:60px;}
  .jifei-btn{position:relative;right:0;top:-34px;float:right;}
  .jifei-panel{margin:0;margin-top:20px;}
</style>

<div class="app-content-full">
	<div class="bg-light lter b-b wrapper-sm">
		<ol class="breadcrumb">
			<li>当前位置：</li>
			<li>服务</li>
			<li class="active">服务管理</li>
		</ol>
	</div>
	<!-- hbox layout -->
	<div class="hbox hbox-auto-xs bg-light ">
		<!-- column -->
		<div class="col w lter b-r">
			<div class="vbox">
				<div class="wrapper b-b">
					<div class="left-title clearfix">
						<span style="font-size: 16px;">服务目录</span> 
						<span data-bind="click: editDir"
							class="glyphicon glyphicon-pencil pull-right service-edit-btn"
							style="color: #9c9c9c; top: 3px;"></span> 
						<span data-bind="click: delDir"
							class="glyphicon glyphicon-minus pull-right service-delete-btn"
							style="color: #9c9c9c; top: 3px;"></span>
						<span data-bind="click: add"
							class="glyphicon glyphicon-plus pull-right service-add-btn"
							style="color: #2aabd2; top: 3px; margin-right: 10px;"></span>
					</div>
				</div>
				<div class="row-row">
					<div class="cell scrollable hover">
						<div class="cell-inner">
							<div id="serverDefinitionsTree" class="ztree"
								style="margin-left: 8px;overflow-x: scroll;height: 655px"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /column -->

		<!-- column -->
		<div class="col">
			<div class="vbox">
				<div class="row-row">
					<div class="cell">
						<div class="cell-inner">
							<div class="wrapper-md">
								<div class="panel panel-default b-blue">
									<div class="row wrapper">
										<div class="col-xs-1">
											<a class="btn btn-sm btn-info"  data-bind="click: createService" >创建服务</a>
												<!-- -->
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">服务状态</span> 
												<select class="form-control input-sm" data-bind="value: searchParam().state">
													<option value="">全部</option>
													<option value="0">未发布</option>
													<option value="1">已发布</option>
													<option value="2">已下线</option>
													<option value="3">已销毁</option>
													<option value="4">无效</option>
												</select>
											</div>
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">所属产品</span> 
												<select class="form-control input-sm"
													data-bind="value: searchParam().productName, options:productList,optionsText:'name',optionsValue:'codeName', optionsCaption: '全部'">
													<option value="">全部</option>
												</select>
											</div>
										</div>
										<div class="col-xs-3">
											<div class="input-group">
												<span class="input-group-addon">服务名称</span> <input
													type="text" class="input-sm form-control"
													placeholder="请输入服务名称"
													data-bind="value: searchParam().serviceName">
											</div>
										</div>
										<div class="col-xs-2">
											<button class="btn btn-sm" type="button" data-bind="click: reset">重置</button>
											<button class="btn btn-sm btn-default" type="button" data-bind="click: search">搜索</button>
										</div>
									</div>

									<div class="table-responsive" data-bind="with : table">
										<table class="table table-striped">
											<thead>
												<th>服务名称</th>
												<th>所属产品</th>
												<th>服务状态</th>
												<th>服务目录</th>
												<th>创建人</th>
												<th>生效时间</th>
												<th>操作</th>
											</thead>
											<tbody>
												<tr data-bind="visible: showNoData">
													<td colspan="7" class="aligncenter">This table has no data.</td>
												</tr>
												<!-- ko foreach: {data: pagedRows, as: '$row'} -->
												<tr>
													<td data-bind="text: $row.name"></td>
													<td data-bind="text: $row.productName"></td>
													<td>
														<span class="label label-success" data-bind="visible: $row.stateDesc=='已发布',text: $row.stateDesc"></span>
										                <span class="label label-default" data-bind="visible: $row.stateDesc=='未发布',text: $row.stateDesc"></span>
										                <span class="label label-danger" data-bind="visible: $row.stateDesc=='已下线'||$row.stateDesc=='已销毁'||$row.stateDesc=='无效',text: $row.stateDesc"></span>
													</td>
													<td data-bind="text: $row.dirName"></td>
													<td data-bind="text: $row.createUserName"></td>
													<td data-bind="text: $row.effectTime"></td>
													<td><a data-bind="if: $row.state == 0 || $row.state == 2,click: $root.release">发布&nbsp;&nbsp;</a> 
													 <a data-bind="if: $row.state == 0 || $row.state == 2" onclick="showModal('pages/services/service_definitions/addService_pkl.html')">修改&nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 0,click: $root.deleteService">删除 &nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 1,click: $root.offline">下线&nbsp;&nbsp;</a>
													 <a data-bind="if: $row.state == 2,click: $root.destory">销毁 </a>													
													</td>													
												</tr>
												<!-- /ko -->
											</tbody>
										</table>
									</div>
									<footer class="panel-footer" data-bind="with: table">
										<ul class="pagination">
											<li data-bind="css: leftPagerClass, click: prevPage"><a
												href="#">&laquo;</a></li>
											<!-- ko foreach: {data: (new Array(pages()))} -->
											<li data-bind="css: $parent.pageClass($index() + 1)"><a
												href="#"
												data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
											</li>
											<!-- /ko -->
											<li data-bind="css: rightPagerClass, click: nextPage"><a
												href="#">&raquo;</a></li>
										</ul>
									</footer>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>	
</div>
<!-- 服务目录弹窗 -->
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd }">
	<div class='modal-dialog modal-lg' style="width: 600px;">
		<div class='modal-content'>
			<div class='modal-header'>
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span>
				</button>
				<h3 class='modal-title' data-bind="ifnot: directoryVO().uuid">创建服务目录</h3>
				<h3 class='modal-title' data-bind="if: directoryVO().uuid">修改服务目录</h3>
			</div>
			<div class='modal-body form-horizontal row'>
				<div class="form-group">
					<label class="col-xs-3 control-label">服务目录名称</label>
					<div class="col-xs-8">
						<input type="text" class="form-control" placeholder="请输入名称"
							data-bind="value: directoryVO().name">
					</div>
					<div class="col-xs-1">
						<span class="text-danger inline m-l-n m-t-sm">*</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-3 control-label">上级服务目录</label>
					<div class="col-xs-8">
						<input type="text" class="form-control" placeholder="请输入名称" disabled="disabled"
							data-bind="value: directoryVO().parentName">
					</div>
					<div class="col-xs-1">
						<span class="text-danger inline m-l-n m-t-sm">*</span>
					</div>
				</div>
			</div>
			<div class='modal-footer' style="text-align: center;">
				<a class="btn btn-default btn-info" data-bind="click: save">确定</a> 
				<a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
			</div>
		</div>
	</div>
</div>
<!-- page specific plugin scripts -->
<script type="text/javascript">
var scripts = [null, 'assets/lib/zTree/js/jquery.ztree.core.js', 'assets/lib/zTree/js/jquery.ztree.excheck.js', 
               "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js",
               "assets/lib/bootstrap-daterangepicker/date.js", null];               
	//弹窗服务目录下拉框树start
	function selectDirClick(){ 	
		var cityObj = $("#selectDir");
	    var cityOffset = $("#selectDir").offset();
	    cityOffset.left = 207;
	    $("#dirContent").addClass("csc_menuTree").css({
	        left : cityOffset.left + "px",
	        top : cityObj.top + "px"
	    }).slideDown("fast");
	    $("#body").bind("mousedown", onBodyDown2);
	}
	
	function hideMenu2() {
	    $("#dirContent").fadeOut("fast");
	    $("body").unbind("mousedown", onBodyDown2);
	}
	function onBodyDown2(event) {
	    if (!(event.target.id == "dirUuid"
	            || event.target.id == "dirContent" || $(event.target)
	            .parents("#dirContent").length > 0)) {
	        hideMenu2();
	    }
	}
	//弹窗服务目录下拉框树end

  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    //inline scripts related to this page
	    
	var product = 'VDC';//默认选中VDC  	
        
    var dirUuid = 0;//目录UUID
    //目录树start
    var setting = {
      view:{
        showIcon:false,
        showLine:false
      },
      callback : {
        onClick : function(srcEvent, treeId, node, clickFlag) {
            srcEvent.preventDefault();
            dirUuid = node.uuid;
            viewModel.search(node.uuid)
        }
      }
    };    
    
    function loadTree(){
    	csc.rest.get('api/v5.0.0/service/directory',function(data){    		
            $.fn.zTree.init($("#serverDefinitionsTree"), setting, data);
        });
    }
  	//目录树end
  
  	//初始化产品列表下拉框
    function loadProduct(){
    	csc.rest.get('api/v5.0.0/products',function(data){    		
    		viewModel.productList(data);
        });
    }    


    var setting2 = {
      check: {
        enable: true
      },
      view:{
        showIcon:false,
        showLine:false
      }
    };

    var zNodes =[
      { name:"全选", open:true,
        children: [
          {
            name:"Openstack",
            open:true,
            children: [
              { name:"分区1"},
              { name:"分区2"},
              { name:"分区3"}
            ]
          },
          {
            name:"CNware",
            open:true,
            children: [
              { name:"分区4"},
              { name:"分区5"},
              { name:"分区6"}
            ]
          }
        ]
      }
    ];
    var setting1 = {
    		view:{
    	        showIcon:false,
    	        showLine:false
    	    },
            callback : {
                onClick : function(srcEvent, treeId, node, clickFlag) {
                    $("#selectDir").val(node.name);
                    $("#dirUuid").val(node.uuid);
                    //给model的服务目录传值
                    viewModel.serviceVO().dirUUID(node.uuid);
                    hideMenu2();
                    srcEvent.preventDefault();
                }
            }
        };
    
    
    //服务目录树
    function loadServiceTree(){
       csc.rest.get('api/v5.0.0/service/directory',function(data){    	
           $.fn.zTree.init($("#dirTree"), setting1, data);
       });
    }
	<!-- vdc -->
    //初始化操作系统类型下拉框
    function loadVdcOsType(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VDC&configCodeName=osType&urlType=getSource',function(data){      		
      		viewModel.osList(data);
      		if(data.length > 0){   	      			
   	      		for(var i = 0;i < data.length;i++){
          			viewModel.serviceVO().serviceVDC.osTypeList.push(data[i].value);
            	}
	      	}
         });
    }
    <!-- 云主机   -->
    //初始化虚拟化类型下拉框数据
    function loadVirtualPlatform(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=virtualPlatform&urlType=getSource',function(data){
      		viewModel.virtualPlatformList(data);
         });
    }
    //初始化云主机CPU
    function loadVmCpu(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=cpu&urlType=getSource',function(data){
      		viewModel.cpuList(data);
      		if(data.length > 0){   	      			
   	      		for(var i = 0;i < data.length;i++){
          			viewModel.cpuCheckList.push(data[i].value);
            	}
	      	}
         });
    }
    //初始化云主机内存
    function loadVmMemory(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=memory&urlType=getSource',function(data){
      		viewModel.memoryList(data);
      		if(data.length > 0){   	      			
   	      		for(var i = 0;i < data.length;i++){
          			viewModel.memoryCheckList.push(data[i].value);
            	}
	      	}
         });
    }
    //初始化发布范围VDC
    function loadReleaseVdc(azUuids){
      	csc.rest.get('api/v5.0.0/service/getReleaseVdcByAzs?azUuids='+ azUuids,function(data){
      		viewModel.vdcList(data);
      		if(data.length > 0){
      			for(var i = 0;i < data.length;i++){
          			viewModel.releaseRange.push(data[i].uuid);
            	}
      		}
        });
    } 
    <!-- 云盘  -->
  	//初始化云盘类型
    function loadDiskType(){
      	csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=DISK&configCodeName=diskType&urlType=getSource',function(data){
      		viewModel.diskTypeList(data);
         });
    }
    
    $(document).ready(function(){
    	loadTree();		    //服务目录树
        loadProduct();	   //获取产品下拉框数据
        
        //loadServiceTree();//加载弹窗的服务目录树
    });         	
  	
    function ViewModel(){
      <!--服务目录start-->
      var self = this;
      this.isAdd = ko.observable(false);

      this.directoryVO = ko.validatedObservable({    	  
          name: ko.observable("").extend({required: true}),          
          parentName: ko.observable("服务目录")
      });            
      //新增           
      this.add = function(){
    	var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
    	var nodes = treeObj.getSelectedNodes();
    	if(nodes.length > 0){
    	   this.isAdd(true);    	   
           this.directoryVO.fromJSON({
               uuid: null,
               name: "",
               parentName: nodes[0].name,
               parentUuid: nodes[0].uuid
           });	
    	}else{
    		alert('请选择根目录！');
    	}
        
      }
      //保存
      this.save = function(){
          ko.validation.group(this.directoryVO).showAllMessages();          
          if(this.directoryVO.isValid()){       	  
              if(this.directoryVO().uuid){
                  csc.rest.put('api/v5.0.0/service/directory/'+this.directoryVO().uuid,this.directoryVO.toJSON(),function(data){
                	  self.isAdd(false);
                	  self.table.refreshData();
                	  loadTree();
                      alert('修改目录成功！');                
                  }); 
              }else{
                  csc.rest.post('api/v5.0.0/service/directory',this.directoryVO.toJSON(),function(data){
                	  self.isAdd(false);
                	  self.table.refreshData();
                	  loadTree();
                      alert('添加目录成功！');                     
                  }); 
              }
          }
      }
      //删除      
      this.delDir = function(object, event){
    	  var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
          var nodes = treeObj.getSelectedNodes();          
          if(nodes.length > 0){
              if(nodes[0].uuid == 0){
                  systemMsg.alert('根目录不能删除！');
              }else{
            	  confirm("确定要删除目录 "+nodes[0].name+" ?",function(){
                      csc.rest.del('api/v5.0.0/service/directory/'+nodes[0].uuid, function(data){
                    	  loadTree();
                          self.table.refreshData();
                          alert('删除目录成功！');                          
                      });
                  }); 
              }                
           }else{
               alert('请选择要删除的目录！');
           }    	  
      }
      //修改
      this.editDir = function(object, event){
    	  var treeObj = $.fn.zTree.getZTreeObj("serverDefinitionsTree");
          var nodes = treeObj.getSelectedNodes();          
          if(nodes.length > 0){
        	  if(nodes[0].uuid == 0){
        		  alert('根目录不能修改！');
        	  }else{
        		  this.isAdd(true);           
                  this.directoryVO.fromJSON({
                      uuid: nodes[0].uuid,
                      name: nodes[0].name,
                      parentName: nodes[0].parentName,
                      parentUuid: nodes[0].uuid
                  }); 
        	  }                
           }else{
               alert('请选择要修改的目录！');
           }
      }
      <!--服务目录end-->
      
      <!--服务状态修改start-->
      this.serviceStateVO = ko.observable({    	  
          uuid: "",          
          state: ""
      })
      //发布
      this.release = function(object, event){    	  
    	  object.state = "1";
    	  self.changeState(object, "发布");
      }
      //下线
      this.offline = function(object,event){    	  
    	  object.state = "2";
    	  self.changeState(object, "下线");
      }
      //销毁
      this.destory = function(object,event){    	  
    	  object.state = "3";
    	  self.changeState(object, "销毁");
      }
      //删除服务
      this.deleteService = function(object,event){
    	  confirm("确定要删除服务 "+object.name+" ?",function(){
              csc.rest.del('api/v5.0.0/service/'+object.uuid, function(data){
                  self.table.refreshData();
                  alert('删除服务成功！');                          
              });
          });
      }
      //修改状态接口
      this.changeState = function(object,stateDesc){    	  
    	  csc.rest.put('api/v5.0.0/service/changeState/'+object.uuid,object,function(data){
        	  self.isAdd(false);
        	  self.table.refreshData();
              alert('服务' + stateDesc + '成功！');
          });
      }
      <!--服务状态修改end-->      
      
      <!--服务信息列表start-->
      //查询条件参数
      this.searchParam = ko.observable({
    	  dirUUID: dirUuid,
          state: "",
          productName: "",
          serviceName: ""
      })
      //重置
      this.reset = function(){
			this.searchParam({
				state: "",
				productName: "",
				serviceName: ""
			})
      }
      //搜索查询
      this.search = function(dirUuid){    	  
    	  if(typeof(dirUuid) != "object"){
    	     this.searchParam().dirUUID = dirUuid;
    	  }
          this.table.params(this.searchParam());
      }
      //服务信息列表数据
      this.table = new DataTable([], {path: 'api/v5.0.0/service'});      
      //产品列表
      this.productList = ko.observableArray();            
      <!--服务信息列表end-->
      
      
      <!-- 创建服务弹窗 -->
      //创建服务弹窗
      this.isCreateService = ko.observable(false);
      this.createService = function(){    	      	   
    	  this.isCreateService(true);
    	  //初始化数据start
          this.step(1);
    	  this.serviceVO.fromJSON({
     		 name : "",
   	  		 dirName : "",
   	  		 dirUUID : "",
   	  		 productId : "VDC",
   	  		 imageUrl : "",
   	  		 desc : "",
   	  		 validTimeType : "1",
   	  		 charge : "1",
   	  		 serviceVDC : {
   	  			 isLimit : 'no',
   	  			 osTypeList : ko.observableArray()
   	  		 }   	  		 
     	  });
    	  //初始化数据end
    	  loadServiceTree();//加载服务目录树
    	  loadVdcOsType();  //获取VDC操作系统数据
    	  $('#addServer_daterange').val(moment().subtract( 29, 'days').format('YYYY-MM-DD') + ' 至 ' + moment().format('YYYY-MM-DD')).daterangepicker({
	        format:'YYYY-MM-DD',
	        startDate: moment().subtract( 29, 'days'),
	        endDate: Date.today().addDays(1),
	        minDate: Date.today(),
	        separator:'至'
	      });
    	  
      }  
      //上一步  下一步 start
      this.step = ko.observable(1);
         
      this.nextStep = function(){
    	  //debugger
    	  if(this.step() == 2 && this.selected_product()!='VDC'){
    		  //根据azUuid获取发布范围接口数据调用
    		  var azStrs = getAzUuids(this.azUuidList());
    		  if(azStrs == ""){
    			  alert("请选择可用分区！");
    			  return;
    		  }
    		  //debugger
    		  loadReleaseVdc(azStrs);
    		  console.log(azStrs);
    	  }
    	  this.step(this.step()+1);
      }
      this.prevStep = function(){
    	  this.step(this.step()-1);
      }
      //上一步  下一步 end
      
		//修改图标start
        this.isChangeImg = ko.observable(false);
        this.changeImg = function(){
          this.isChangeImg(true);
        }
        this.setImg = function(){
          this.isChangeImg(false);
        }
        //修改图标end
        
        <!--选择产品start-->
        this.selected_product = ko.observable();
        this.selected_product(product);
        this.showItems = ko.observable('no');
     	//选择产品时的change事件
        this.changeValue = function(viewModel, event){
        	//选择VDC
          if(viewModel.selected_product()=='VDC'){        	  
        	  
          }else if(viewModel.selected_product()=='VM'){//选择云主机
        	  loadVirtualPlatform();//获取虚拟化平台数据
        	  loadVmCpu();//获取虚拟机CPU
        	  loadVmMemory();//获取虚拟机内存
          }else if(viewModel.selected_product()=='DISK'){//选择云盘
        	  loadDiskType();//初始化云盘类型
        	  getAzsByUser(viewModel);
          }else{
        	  getAzsByUser(viewModel);
          }
        }
        //
     	function getAzsByUser(viewModel){
    	   if(viewModel.azUuidList().length > 0){
     		   viewModel.azUuidList.removeAll();
     	   }
       	   //根据当前用户获取可用分区
       	   csc.rest.get('api/v5.0.0/azs',function(data1){
         		viewModel.azList(data1.results);          		
         		if(data1.results.length > 0){          			
         			for(var i = 0;i < data1.results.length;i++){
             			viewModel.azUuidList.push(data1.results[i].uuid);
               		}
         		}
            });
     	}
     	
        <!--选择产品end-->  	    
        
        <!--  添加计费规则start -->
        function Package(type,value){
      	  this.type = ko.observable(type);
      	  this.value = ko.observable(value);
      	  this.feeList = ko.observableArray();
        }
        this.packages = ko.observableArray([
      		  new Package("按天","DAY"),
      		  new Package("按月","MONTH"),
      		  new Package("按季度","QUARTER"),
      		  new Package("按年","YEAR")
        ]);
        this.packages_chosen = ko.observableArray()
        this.package_current = null;
        
        this.isAdd_Fee = ko.observable(false);
        //费用规则列表
        this.feeList = new DataTable([], {path: "api/v5.0.0/billing/rules"});
        
        this.addFeeDay = function(package,event){    	  
      	  self.package_current = package;
      	  self.feeList.params({
      		  attrType: self.selected_product(),
      		  cycle: package.value()
      	  })
     	  self.isAdd_Fee(true);              
        }
        this.addFeeToList = function(){
      	  this.package_current.feeList(this.feeList.chosenItems());
      	  self.isAdd_Fee(false);
        }
        <!-- 添加计费规则end -->
        //服务信息
  	   this.serviceVO = ko.validatedObservable({
  		 name : ko.observable().extend({required : true}),
  		 dirName : ko.observable(),
  		 dirUUID : ko.observable(),
  		 productId : this.selected_product,
  		 imageUrl : ko.observable(),
  		 desc : ko.observable(),
  		 validTimeType : ko.observable("1").extend({required : true}),
  		 validTimeNum : ko.observable(),
  		 rangeTime : ko.observable(),
  		 charge : ko.observable(),
  		 serviceVDC : {
  			 isLimit : this.showItems,
  			 osTypeList : ko.observableArray(),
  			 maxCpu : ko.observable(),
  			 maxVmNum : ko.observable(),
  			 maxMemory : ko.observable(),
  			 maxDiskNum : ko.observable(),
  			 maxStorager : ko.observable(),
  			 maxIpNum : ko.observable(),
  			 maxVPC : ko.observable(),
  			 maxRouterNum : ko.observable(),
  			 maxObjStorageNum : ko.observable(),
  			 maxFireWallNum : ko.observable(),
  			 maxSSHNum : ko.observable(),
  			 maxLoadBalanceNum : ko.observable()
  		 },
  		 chargeType : ko.observable(),
  		 rules : ko.observable(),
  		 serviceVm : {
  			 virtualName: ko.observable().extend({required : true}),
  			 azUuid: ko.observable(),
  			 osType: ko.observable(),
  			 osVersion: ko.observable(),
  			 cpu: ko.observable(),
  			 memory: ko.observable()
  		 },
  		 servicePartitions : ko.observable(),
  		 azUuids : ko.observable(),
  		 serviceDisk : {
  			diskType: ko.observable(),
  			azUuid: ko.observable()
  		 },
  		serviceIp : {
  			ipUuid: ko.observable()
  		}
  	   })
  	   //虚拟机的cpu
  	   this.cpuCheckList = ko.observableArray();
       //虚拟机的操作系统类型
  	   this.osTypeCheckList = ko.observableArray();
       //虚拟机的内存
  	   this.memoryCheckList = ko.observableArray();
  	   //获取az
  	   this.azUuidList = ko.observableArray();
       function getAzUuids(obj){
    	  var azs = "";    	  
    	  if(obj.length > 0){
 			  for(var i = 0; i < obj.length; i++){
 				 azs += obj[i]+","; 
 			  }
 		  }
    	  if(azs != ""){
    		  azs = azs.substring(0, azs.length - 1);
    	  }    	  
    	  return azs;
       }
  	   //获取所选择的发布范围以","分隔
  	   this.releaseRange = ko.observableArray();
  	   function getReleaseRanges(obj){  		   
  		  var range = "";
     	  for(var i = 0;i < obj.length;i++){
     		 range += obj[i] + ",";
     	  }
     	  if(range != ""){
     		 range = range.substring(0,range.length-1);
     	  }
     	  return range;
        }
  	    
  	   
  	   //是否计费
  	   this.isFee = ko.observable("1");   
  	   //获取套餐值
  	   function getPackages(obj){   	  
      	  var feeType = "";
      	  for(var i = 0;i < obj.length;i++){
      		  feeType += obj[i].value()+",";
      	  }
      	  if(feeType != ""){
      		  feeType = feeType.substring(0,feeType.length-1);
      	  }
      	  return feeType;
        }
  	   	//获取计费规则以“，”分隔
	  	 function getRules(obj){   	  
	     	  var rule = "";	     	  
	     	  for(var i = 0;i < obj.length;i++){
	     		  var feeList = obj[i].feeList();
	     		  if(feeList.length > 0){
	     			  for(var j = 0; j < feeList.length; j++){
	     				 rule += feeList[j].uuid+",";
	     			  }
	     		  }	     		 
	     	  }
	     	  if(rule != ""){
	     		 rule = rule.substring(0,rule.length-1);
	     	  }
	     	  return rule;
	     }
  	   	
        //保存方法
  	    this.saveService = function(){
  	      this.serviceVO().charge(this.isFee());//是否计费
  		  this.serviceVO().chargeType(getPackages(this.packages_chosen()));//套餐
  		  this.serviceVO().rules(getRules(this.packages_chosen()));//计费规则 	  
  		
  		  if(this.selected_product()=='VDC'){//VDC保存时的数据
  			  this.serviceVO().serviceVm = null;
  			  this.serviceVO().serviceDisk = null;
  			  this.serviceVO().serviceIP = null;
  	      }else if(this.selected_product()=='VM'){//云主机保存时的数据
	  	      var releaseRange = getReleaseRanges(this.releaseRange());
	  	      if(releaseRange == ""){
	  	      	alert("请选择发布范围！");
	  	      	return;
	  	      }
  	    	  this.serviceVO().serviceVDC = null;
  	    	  this.serviceVO().serviceDisk = null;
  	    	  this.serviceVO().serviceIP = null;
  	    	  this.serviceVO().serviceVm.osVersion(getOsVersion(this.osType_chosen()));//操作系统版本
  	    	  this.serviceVO().serviceVm.osType(getAzUuids(this.osTypeCheckList()));//操作系统类型
  	    	  this.serviceVO().serviceVm.cpu(getAzUuids(this.cpuCheckList()));//cpu
  	    	  this.serviceVO().serviceVm.memory(getAzUuids(this.memoryCheckList()));//内存
//  	    	  this.serviceVO().serviceVm.azUuid(getAzUuids(this.azUuidList()));//虚拟机可用分区
  	    	  this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区
  	    	  this.serviceVO().servicePartitions(releaseRange);//发布范围
  	      }else if(this.selected_product()=='DISK'){//云盘保存时的数据
  	    	var releaseRange = getReleaseRanges(this.releaseRange());
  	      	if(releaseRange == ""){
  	      		alert("请选择发布范围！");
  	      		return;
  	      	}
  	    	this.serviceVO().serviceVm = null;
  	    	this.serviceVO().serviceVDC = null;
  	    	this.serviceVO().serviceIP = null;
  	    	this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区
  	    	this.serviceVO().serviceDisk.diskType(this.diskTypeCheck());//云盘类型
  	    	this.serviceVO().servicePartitions(releaseRange);//发布范围
  	      }else if(this.selected_product()=="PUBLICIP"){//公网IP
  	    	this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区
  	    	this.serviceVO().servicePartitions(getReleaseRanges(this.releaseRange()));//发布范围 
  	    	this.serviceVO().serviceIp.ipUuid(getIpUuids(this.ip_chosen()));//ip列表
  	      }else{
  	    	var releaseRange = getReleaseRanges(this.releaseRange());
  	      	if(releaseRange == ""){
  	      		alert("请选择发布范围！");
  	      		return;
  	      	}
  	    	this.serviceVO().azUuids(getAzUuids(this.azUuidList()));//可用分区
  	    	this.serviceVO().servicePartitions(releaseRange);//发布范围
  	      }
  		  //debugger
  		  csc.rest.post('api/v5.0.0/service',this.serviceVO.toJSON(),function(data){
  				self.table.refreshData();
  				self.isCreateService(false);
                alert('创建成功！');
            });
  	    }
  	     
        //产品列表
        this.productList = ko.observableArray();
        //操作系统类型
        this.osList = ko.observableArray();
        
        <!-- 云主机start -->
        //虚拟化类型选择事件
        this.changeVirtualValue = function(viewModel, event){      	  
           if(viewModel.selected_product()=='VM'){
        	  //当选择不同的虚拟化时得清空初始化数据，重新加载
   			  if(viewModel.azUuidList().length > 0){
    			 viewModel.azUuidList.removeAll();
    		  }
       	   	  if(viewModel.osTypeCheckList().length > 0){
      			  viewModel.osTypeCheckList.removeAll();
      		  }
        	 //初始化虚拟机操作系统类型数据        	 
   	      	 csc.rest.get('api/v5.0.0/products/configs/values?productCodeName=VM&configCodeName=virtualPlatform&urlType=getTarget&sourceValue='+this.serviceVO().serviceVm.virtualName(),function(data){   	      		 
   	      		viewModel.vmOsTypeList(data);   	      		
   	      		if(data.length > 0){   	      			
	   	      		for(var i = 0;i < data.length;i++){
	          			viewModel.osTypeCheckList.push(data[i].value);
	            	}
   	      		}
   	         });
        	   
        	 //初始化可用分区数据
          	 csc.rest.get('api/v5.0.0/azs?virtualHypervisor='+this.serviceVO().serviceVm.virtualName(),function(data1){
          		viewModel.azList(data1.results);          		
          		if(data1.results.length > 0){          			
          			for(var i = 0;i < data1.results.length;i++){
              			viewModel.azUuidList.push(data1.results[i].uuid);
                	}
          		}
             });
           }else if(viewModel.selected_product()=='VDC'){
              
           }else{
        	   
           }
         }
        
        //添加操作系统版本start
       // this.packages = ko.observableArray();
        this.osType_chosen = ko.observableArray()
        this.osType_current = null;
        
        this.isAdd_osType = ko.observable(false);

		this.osVersionList = new DataTable([], {path: "api/v5.0.0/service/getServiceImageRef"});
        //添加操作系统版本按钮
        this.addOsType = function(package,event){
          if(self.azUuidList().length <= 0){
        	  alert("请选择可用分区！");
        	  return;
          }
          if(self.osTypeCheckList().length <= 0){
        	  alert("请选择操作系统类型！");
        	  return;
          }
      	  self.osType_current = package;
      	  self.osVersionList.params({
      		  azUuid: getAzUuids(self.azUuidList()),
      		  osTypes: getAzUuids(self.osTypeCheckList())
      	  })
     	  self.isAdd_osType(true);              
        }
        this.addOsVersionToList = function(){
      	  this.osType_chosen(this.osVersionList.chosenItems());
      	  self.isAdd_osType(false);
        }
        //获取操作系统版本
        function getOsVersion(obj){
        	var osVersion = "";
        	for(var i = 0;i < obj.length;i++){
        		osVersion += obj[i].imageUuid + ",";
        	}
        	if(osVersion != ""){
        		osVersion = osVersion.substring(0,osVersion.length-1);
        	}
        	return osVersion;
        }
        //添加操作系统版本end
        
		//虚拟化平台数据
		this.virtualPlatformList = ko.observableArray();
        //云主机操作系统类型
        this.vmOsTypeList = ko.observableArray();
        //可用分区数据
        this.azList = ko.observableArray();
        //云主机CPU
        this.cpuList = ko.observableArray();
        //云主机内存
        this.memoryList = ko.observableArray();
        <!-- 云主机 end  -->
        
        <!-- 云盘start  -->
        this.diskTypeList = ko.observableArray();
        this.diskTypeCheck = ko.observable("HDD");
        <!-- 云盘end  -->
        
        <!-- 公网IP   start-->
      	//添加IP start
        this.isAdd_Ip = ko.observable(false);
        this.addIp = function(){
          this.isAdd_Ip(true);
        }
        this.addIpToList = function(package,event){
          if(self.azUuidList().length <= 0){
          	 alert("请选择可用分区！");
          	 return;
          }
          self.ip_current = package;
      	  self.ipList.params({
      	  })
          this.ip_chosen(this.ipList.chosenItems());
          this.isAdd_Ip(false);
        }
        
        this.ip_chosen = ko.observableArray()
        this.ip_current = null;

		this.ipList = new DataTable([], {path: "api/v5.0.0/service/getServiceIpList"});
        //获取ip的uuid以","分隔
		function getIpUuids(obj){
			var ipUuid = "";
        	for(var i = 0;i < obj.length;i++){
        		ipUuid += obj[i].uuid + ",";
        	}
        	if(ipUuid != ""){
        		ipUuid = ipUuid.substring(0,ipUuid.length-1);
        	}
        	return ipUuid;
		}
        //添加IP  end
        
         <!-- 公网IP   start-->
      	//###########    列表、全选     ###############
      	/**发布范围全选按钮**/
	    this.isSelectedReleaseAll = ko.pureComputed({
	        read: function () {
	            return this.vdcList().length > 0 && this.vdcList().length === this.releaseRange().length;
	        },
	        write: function (value) {
	        	this.releaseRange(value ? _.pluck(this.vdcList(), 'uuid') : []);
	        },
	        owner: this
	      }); 
      	/** 可用分区全选按钮 ***/
	    this.isSelectedAzAll = ko.pureComputed({
	        read: function () {
	            return this.azList().length >0 && this.azList().length === this.azUuidList().length;
	        },
	        write: function (value) {
	        	this.azUuidList(value ? _.pluck(this.azList(), 'uuid') : []);
	        },
	        owner: this
	      });
	    /** 云主机操作系统类型全选按钮 ***/
	    this.isSelectedOsTypeAll = ko.pureComputed({
	        read: function () {
	            return this.vmOsTypeList().length >0 && this.vmOsTypeList().length === this.osTypeCheckList().length;
	        },
	        write: function (value) {
	        	this.osTypeCheckList(value ? _.pluck(this.vmOsTypeList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** 云主机CPU全选按钮 ***/
	    this.isSelectedCpuAll = ko.pureComputed({
	        read: function () {
	            return this.cpuList().length >0 && this.cpuList().length === this.cpuCheckList().length;
	        },
	        write: function (value) {	        	
	        	this.cpuCheckList(value ? _.pluck(this.cpuList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** 云主机内存全选按钮 ***/
	    this.isSelectedMemoryAll = ko.pureComputed({
	        read: function () {
	            return this.memoryList().length >0 && this.memoryList().length === this.memoryCheckList().length;
	        },
	        write: function (value) {
	        	this.memoryCheckList(value ? _.pluck(this.memoryList(), 'value') : []);
	        },
	        owner: this
	      });	    
	    /** 云主机内存全选按钮 ***/
	    this.isSelectedMemoryAll = ko.pureComputed({
	        read: function () {
	            return this.memoryList().length >0 && this.memoryList().length === this.memoryCheckList().length;
	        },
	        write: function (value) {
	        	this.memoryCheckList(value ? _.pluck(this.memoryList(), 'value') : []);
	        },
	        owner: this
	      });
	    /** VDC操作系统类型全选按钮 ***/
	    this.isSelectedVdcOsAll = ko.pureComputed({
	        read: function () {
	            return this.osList().length >0 && this.osList().length === this.serviceVO().serviceVDC.osTypeList().length;
	        },
	        write: function (value) {
	        	this.serviceVO().serviceVDC.osTypeList(value ? _.pluck(this.osList(), 'value') : []);
	        },
	        owner: this
	      });
	    
        //发布范围
        this.vdcList = ko.observableArray();
    }
    
    var viewModel = new ViewModel();
    ko.applyBindings(viewModel, $('#page-content')[0]);
  });
</script>
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isCreateService }">
  <div class='modal-dialog modal-lg' style="width:800px;">
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>创建服务</h3>
      </div>
      <div class='modal-body no-padder'>
        <ul class="nav nav-tabs service-step-select">
          <li data-bind="css: {'active': step()==1}">
            <a >1基本信息</a>
          </li>
          <li data-bind="css: {'active': step()==2}">
            <a >2服务资源</a>
          </li>
          <li data-bind="css: {'active': step()==3}">
            <a >3服务计费</a>
          </li>
          <!-- ko if: selected_product()!='VDC' -->
          <li data-bind="css: {'active': step()==4}">
            <a >4发布范围</a>
          </li>
          <!-- /ko -->
        </ul>
        <div class="tab-content service-step-box m-t">
          <div class="tab-pane" data-bind="css: {'active': step()==1}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务名称：</label>
                <div class="col-xs-7">
                  <input type="text" class="form-control" placeholder="请输入名称" data-bind="value: serviceVO().name">
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务目录：</label>
                <div class="col-xs-7">
                  <input type="text" class="form-control" placeholder="请选择服务目录" data-bind="value: serviceVO().dirName" id="selectDir" onclick="selectDirClick(event)">
                  <input type="hidden" id="dirUuid" data-bind="value: serviceVO().dirUUID" />
                </div>
              </div>
              <div id="dirContent"
                style="display: none; position: absolute; z-index: 10000; background-color: white; border-left: 1px #DDDDDD solid; border-bottom: 1px #DDDDDD solid; border-right: 1px #DDDDDD solid; width: 420px; height: 198px; overflow: scroll;">
	            <div style="width:700px">
	                <ul id="dirTree" class="ztree" style="z-index: 1000;"></ul>
	            </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">产品：</label>
                <div class="col-xs-7">
                  <select class="form-control" data-bind="options:productList,optionsText:'name',optionsValue:'codeName',value: selected_product, event:{'change':changeValue}">
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">服务图标：</label>
                <div class="col-xs-7">
                  <div class="service-img-box" data-bind="click: changeImg">
                    <img src="" alt="" width="60" height="60" >
                    <a data-bind="value: serviceVO().imageUrl">更改图标</a>
                  </div>
                </div>
              </div>              
              <div class="form-group">
                <label class="col-xs-3 control-label">服务介绍：</label>
                <div class="col-xs-7">
                  <textarea class="form-control" cols="30" rows="3" data-bind="value: serviceVO().desc"></textarea>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-3 control-label">有效期：</label>
                <div class="col-xs-7">
                  <div class="radio">
                    <label class="form-inline">
                      <input type="radio" name="optionsRadios" id="optionsRadios1" value="1" checked data-bind="checked: serviceVO().validTimeType"> 永久
                    </label>
                  </div>
                  <div class="radio">
                    <label class="form-inline">
                      <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios2" value="2" data-bind="checked: serviceVO().validTimeType"> 
                      <select class="form-control" data-bind="value: serviceVO().validTimeNum">
                      <option value="1">1</option>
                      <option value="1">2</option>
                      </select> 个月
                    </label>
                  </div>
                  <div class="radio disabled">
                    <label class="form-inline">
                      <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios3" value="3" data-bind="checked: serviceVO().validTimeType">
                      <input type="text" style="width:206px" class="form-control" id="addServer_daterange" data-bind="value: serviceVO().rangeTime">
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" data-bind="css: {'active': step()==2}">
            <!-- 云主机 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='VM'">
              <div class="form-group">
                <label class="col-xs-2 control-label">虚拟化：</label>
                <div class="col-xs-9">
                  <select class="form-control" data-bind="options:virtualPlatformList,optionsText:'value',optionsValue:'value',value: serviceVO().serviceVm.virtualName,event:{'change':changeVirtualValue}">                    
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList" checked="checked"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->                    
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">操作系统类型：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedOsTypeAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : vmOsTypeList -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.osTypeCheckList"><span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                 
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">操作系统版本：</label>                
                <div class="col-xs-9">
                  <div class="panel panel-default b-blue" style="margin:0;padding-bottom:10px">
                    <table class="table table-striped">
                      <thead>
                        <th>可用分区</th>
                        <th>操作系统类型</th>
                        <th>操作系统版本</th>
                        <th>关联镜象</th>
                        <th>操作</th>
                      </thead>
                      <tbody data-bind="foreach: osType_chosen">
                        <tr>
                          <td data-bind="text: zaName"></td>
                          <td data-bind="text: osType"></td>
                          <td data-bind="text: osVersion"></td>
                          <td data-bind="text: imageName"></td>
                          <td><a class="btn btn-xs btn-default" onclick="confirm('确定删除吗？')">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                    <a class="btn btn-sm btn-success" style="margin-left: 10px;" data-bind="click: addOsType">添加</a>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">CPU(核)：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedCpuAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : cpuList  -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.cpuCheckList"><span data-bind="text: value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                  
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">内存：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedMemoryAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach : memoryList   -->
                  <div class="checkbox">
                    <label>
                       <input type="checkbox" data-bind="value: value,checked: $root.memoryCheckList"><span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->                  
                </div>
              </div>
            </div>
            <!-- 云主机 end -->
            <!-- SSH密钥 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='SECRET_KEY'">
              
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
              </div>
            </div>
            <!-- SSH密钥 end -->
            <!-- 云硬盘 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='DISK'">
              <div class="form-group">
                <label class="col-xs-2 control-label">硬盘类型：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                  <!-- ko foreach : diskTypeList   -->
                    <div class="radio">
                      <label>
                         <input type="radio" data-bind="value: value,checked: $root.diskTypeCheck"><span data-bind="text:value"></span>
                      </label>
                    </div>
                  <!-- /ko -->            
                  </div>                  
                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
              </div>
            </div>
            <!-- 云硬盘 end -->
            <!-- VDC start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='VDC'">
              <div class="form-group">
                <label class="col-xs-2 control-label">支持操作系统：</label>
                <div class="col-xs-9 form-inline">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" data-bind="checked: isSelectedVdcOsAll"> 全选
                    </label>
                  </div>
                  <!-- ko foreach: osList -->
                  <div class="checkbox" data-bind="">
                    <label>
                      <input type="checkbox" data-bind="value: value,checked: $root.serviceVO().serviceVDC.osTypeList"> <span data-bind="text:value"></span>
                    </label>
                  </div>
                  <!-- /ko -->

                </div>
              </div>
              <div class="form-group">
                <label class="col-xs-2 control-label">是否限制配额：</label>
                <div class="col-xs-9 form-inline">
                  <div class="form-inline">
                    <div class="radio">
                      <label>
                        <input type="radio" name="optionsRadiosi" id="optionsRadiosi1" value="yes" data-bind="checked: showItems"> 限制
                      </label>
                    </div>
                    <div class="radio">
                      <label>
                        <input type="radio" name="optionsRadiosi" id="optionsRadiosi2" value="no" checked="" data-bind="checked: showItems"> 不限制
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div style="padding-right:50px;" class="form-group row" data-bind="visible: showItems()=='yes'">
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大CPU(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxCpu">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大云主机数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxVmNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大内存(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxMemory">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大云硬盘数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxDiskNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大存储(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxStorager">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大公网IP数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxIpNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大VPC(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxVPC">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大路由器数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxRouterNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大对象存储(GB)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxObjStorageNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大防火墙数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxFireWallNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大SSH密钥数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxSSHNum">
                    </div>
                  </div>
                </div>
                <div class="col-xs-6">
                  <div class="form-group">
                    <label class="col-xs-6 control-label">最大负载均衡数(个)：</label>
                    <div class="col-xs-6">
                      <input class="form-control" data-bind="value: serviceVO().serviceVDC.maxLoadBalanceNum">
                    </div>
                  </div>
                </div>

              </div>
            </div>
            <!-- VDC end -->
            <!-- 公网IP start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='PUBLICIP'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
              </div>
              <div class="form-group" style="padding:0 50px;">
                <div class="panel panel-default b-blue">
                  <div class="panel-heading clearfix">
                    <strong>公网IP列表</strong>
                    <a class="btn btn-default btn-xs pull-right" style="color:#666;" data-bind="click: addIp">添加</a>
                  </div>
                  <div class="panel-body">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>VPC名称</th>
                          <th>网络名称</th>
                          <th>IP资源</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody data-bind="foreach: ip_chosen">
                        <tr>
                          <td data-bind="text: vpcName"></td>
                          <td data-bind="text: name"></td>
                          <td data-bind="text: cidr"></td>
                          <td><a onclick="confirm('确定删除吗？')">删除</a></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
            </div>            
            <!-- 公网IP end -->
            <!-- 负载均衡 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='LOAD_BALANCING'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
              </div>
            </div>
            <!-- 负载均衡 end -->
            <!-- 对象存储 start -->
            <div class='form-horizontal row' data-bind="if: selected_product()=='OBJECT_STORAGE'">
              <div class="form-group">
                <label class="col-xs-2 control-label">可用分区：</label>
                <div class="col-xs-9">
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedAzAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : azList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.azUuidList"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->
                  </div>
                </div>
              </div>
            </div>
            <!-- 对象存储 end -->
          </div>

          <div class="tab-pane" data-bind="css: {'active': step()==3}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-2 control-label">是否计费：</label>
                <div class="col-xs-9 form-inline">
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios2" id="optionsRadios21" value="0" checked data-bind="checked: isFee"> 是
                    </label>
                  </div>
                  <div class="radio">
                    <label>
                      <input type="radio" name="optionsRadios2" id="optionsRadios22" value="1" checked data-bind="checked: isFee"> 否
                    </label>
                  </div>
                </div>
              </div>
              <div class="form-group" data-bind="visible:isFee()=='0'">
                <label class="col-xs-2 control-label">包含套餐：</label>
                <div class="col-xs-9">
                  <div class="form-inline" data-bind="foreach: packages">
					<div class="checkbox">
						<label> <input type="checkbox"  data-bind="value: $data, checked: $root.packages_chosen"><span data-bind="text: type"></span>
						</label>
					</div>
				  </div>
				  <div data-bind="foreach: packages_chosen">
	                  <div class="panel panel-default b-blue jifei-panel">
	                    <div class="panel-heading jifei-heading">
	                    <h4 data-bind="text: type"></h4>
	                    <a class="btn btn-sm btn-info jifei-btn" data-bind="click: $root.addFeeDay">添加计费规则</a></div>
	                    <table class="table table-striped">
	                      <thead>
	                        <th>计费因子</th>
	                        <th>计费规则</th>
	                        <th>操作</th>
	                      </thead>
	                      <tbody data-bind="foreach: feeList">
	                        <tr>
	                          <td data-bind="text: attrType"></td>
                              <td data-bind="text: name"></td>
	                          <td><a class="btn btn-xs btn-default" onclick="confirm('确定删除吗？')">删除</a></td>
	                        </tr>
	                      </tbody>
	                    </table>
	                  </div>
                  </div>
                  
                </div>
              </div>
            </div>                      
          </div>
          
          <div class="tab-pane" data-bind="if: selected_product()!='VDC',  css: {'active': step()==4}">
            <div class='form-horizontal row'>
              <div class="form-group">
                <label class="col-xs-2 control-label">发布范围：</label>
                <div class="col-xs-9">
                  <!-- <div class="panel panel-default b-blue" style="margin:0;padding-bottom:10px">
                    <div id="serviceModalTree" class="ztree release"></div>
                  </div> -->
                  <div class="form-inline">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="checked: isSelectedReleaseAll"> 全选
                      </label>
                    </div>
                  </div>
                  <div style="padding:0 20px;">
                    <!-- ko foreach : vdcList -->
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" data-bind="value: uuid,checked: $root.releaseRange"><span data-bind="text:name"></span>
                      </label>
                    </div>
                    <!-- /ko -->                    
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info service-step-btn-pre" data-bind="visible: step()>1, click: prevStep">上一步</a>
        <a class="btn btn-default btn-info service-step-btn-next" data-bind="visible: (selected_product() !='VDC' && step()<4) || (selected_product() =='VDC' && step()<3), click: nextStep">下一步</a>        
        <a class="btn btn-default btn-info service-step-btn-save" data-bind="visible: step()==4 || (selected_product() =='VDC' &&  step()==3), click: saveService">保存</a>
        <a class="btn btn-default btn-success service-step-btn-saveAndRelease" data-bind="visible: step()==4 || (selected_product() =='VDC' &&  step()==3)">保存并发布</a>
        <!-- <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a> -->
      </div>
    </div>
  </div>
</div>
<!-- 选择计费 -->
<div role="dialog" aria-hidden="true" id="addFeeDialog" class="modal fade" data-bind="modal: { show: isAdd_Fee }">
  <div class='modal-dialog modal-lg'>
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择计费</h3>
      </div>
      <div class='modal-body form-horizontal'>
        <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: feeList">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>
			      <div class="checkbox">
			        <label class="i-checks">
			          <input type="checkbox" data-bind="checked: isSelectedAll">
			          <i></i>
			        </label>
			      </div>                    
			    </th>  
                <th>计费因子</th>
                <th>计费规则</th>
                <th>计费金额(元)</th>
              </tr>
            </thead>
            <tbody>
              <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
              <tr>
                <td>
			      <div class="checkbox">
			        <label class="i-checks">
			          <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			          <i></i>
			        </label>
			      </div> 
			    </td>
                <td data-bind="text: attrType"></td>
                <td data-bind="text: name"></td>
                <td data-bind="text: price"></td>
              </tr>
              <!-- /ko -->
            </tbody>
          </table>
        </div>        
      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info" data-bind="click: addFeeToList">确定添加</a>
        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
      </div>
    </div>
  </div>
</div>
<!-- 添加操作系统版本 --> 
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd_osType }">
   <div class='modal-dialog modal-lg'>
     <div class='modal-content'>
       <div class='modal-header'>
         <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>添加操作系统版本</h3>
       </div>
       <div class='modal-body form-horizontal'>
         <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: osVersionList">
           <table class="table table-striped">
             <thead>
               <tr>
                 <th>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checked: isSelectedAll">
			           <i></i>
			         </label>
			       </div>                    
			     </th>  
                 <th>镜像名称</th>
                 <th>操作系统类型</th>
                 <th>操作系统版本</th>
                 <th>可用分区</th>
               </tr>
             </thead>
             <tbody>
               <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
               <tr>
                 <td>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			           <i></i>
			         </label>
			       </div> 
			     </td>
                 <td data-bind="text: imageName"></td>
                 <td data-bind="text: osType"></td>
                 <td data-bind="text: osVersion"></td>
                 <td data-bind="text: zaName"></td>
               </tr>
               <!-- /ko -->
             </tbody>
           </table>
         </div>
         
       </div>
       <div class='modal-footer' style="text-align:center;">
         <a class="btn btn-default btn-info" data-bind="click: addOsVersionToList">确定添加</a>
         <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
       </div>
     </div>
   </div>
 </div>
 <!-- 选择网络 -->
 <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAdd_Ip }">
    <div class='modal-dialog modal-lg' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择网络</h3>
        </div>
        <div class='modal-body form-horizontal'>
          <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: ipList">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checked: isSelectedAll">
			           <i></i>
			         </label>
			       </div>
			      </th>
                  <th>VPC名称</th>
                  <th>网络名称</th>
                  <th>IP资源</th>
                  <th>可用分区</th>
                </tr>
              </thead>
              <tbody>
              	<!-- ko foreach: {data: pagedRows, as: '$row'}  -->
                <tr>
                  <td>
			       <div class="checkbox">
			         <label class="i-checks">
			           <input type="checkbox" data-bind="checkedValue: $data, checked: $parent.chosenItems">
			           <i></i>
			         </label>
			       </div> 
			      </td>
                  <td data-bind="text: vpcName"></td>
                  <td data-bind="text: name"></td>
                  <td data-bind="text: cidr"></td>
                  <td data-bind="text: azName"></td>
                </tr>
                <!-- /ko -->
              </tbody>
            </table>
          </div>
          
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: addIpToList">确定添加</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div>
  <!-- 上传图片 -->
  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isChangeImg }">
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>上传图片</h3>
        </div>
        <div class='modal-body row'>
          <div class="col-xs-6">
            <img src="" alt="" width="100%" height="150">
          </div>
          <div class="col-xs-6">
            <p><a class="btn btn-success">上传图片</a></p>
        <p>支持JPG、GIF、PNG、BMP格式；图片小于2M。</p>
          </div>
        </div>
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: setImg">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div>