<link href="assets/lib/webuploader/webuploader.css" rel="stylesheet" type="text/css"/>

<style>
.form-item-block .checkbox, .form-item-block .radio{display:block;}
</style>
<div class="app-content-full">
  <div class="bg-light lter b-b wrapper-sm">
    <ol class="breadcrumb">
      <li>当前位置：</li>
      <li>服务</li>
      <li class="active">产品定义</li>
    </ol>
  </div>
  <!-- hbox layout -->
  <div class="hbox hbox-auto-xs bg-light ">
    <!-- column -->
    <div class="col w lter b-r">
      <div class="vbox">
        <div class="wrapper b-b">
          <div class="left-title">
          	<span style="font-size:16px;">产品列表</span>
          	<!-- <span class="glyphicon glyphicon-minus pull-right product-delete-btn" style="color:#9c9c9c;top:3px;"></span> -->
          	<span class="glyphicon glyphicon-plus pull-right product-add-btn" style="color:#2aabd2;top:3px;margin-right:5px;"></span>
          </div>
        </div>
        <div class="row-row">
          <div class="cell scrollable hover">
            <div class="cell-inner">
              <div class='table-responsive'>
                <table id="product-left-list" class='table table-striped table-hover left-list'>
                	<tbody data-bind="foreach: products">
                    	<tr data-bind="css: {'active': $root.currentProduct().name()==name}">
							<td><a data-bind="text: name, click: $root.setCurrent"></a></td>
						</tr> 
			     </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /column -->
	
	<!-- column -->
    <div class="col">
      <div class="vbox">
        <div class="row-row">
          <div class="cell">
            <div class="cell-inner">
              <div class="wrapper-md">
				<div class="service-right-content">
					<form>
						<!-- ko if: (isUserDefinedProduct())  -->
							<a class="btn btn-info btn-sm form-edit">修改</a>
							<a style="display:none;" class="btn btn-success btn-sm form-save">保存</a>
						<!-- /ko -->
						<div class="row">
							<div class="col-xs-6" style="margin-top:10px;">
								<label>产品名称：</label><span class="value-span" data-bind="text:currentProduct().name"></span>
								<span class="input-span" style="display:none;"><input type="text" data-bind="value: currentProduct().name"><i style="color:red">*</i></span>
							</div>
							<div class="col-xs-6">
								<div class="img-box" style="width:100px;text-align:center">
									<img src="" alt="" width="100%" height="80" data-bind="attr:{src: currentProduct().imgUrl}">
									<a class="btn btn-info btn-xs" data-bind="click: changeImg">上传图片</a>
								</div>
							</div>
						</div>
						<div>
							<p>
								<label>产品配置项：</label>
								<!-- ko if: (isUserDefinedProduct())  -->
									<span class="glyphicon glyphicon-plus-sign" style="color:#47b007;top:4px;font-size:18px;
									cursor:pointer;" data-bind="click: addConfig">
									</span>
								<!-- /ko -->
							</p>
							<div class="panel panel-default b-blue" data-bind="with: configsTable">
								<table class="table table-striped">
									<thead>
										<tr>
											<th>配置项名称</th>
											<th>是否必填</th>
											<th>操作</th>
										</tr>
									</thead>
									<tbody>
										<tr data-bind="visible: showNoData">
							           		<td colspan="3" class="aligncenter">
							              		暂无数据
							           		</td>
							            </tr>
							            <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
							            	<tr><td data-bind="text:name"></td><td data-bind="text:requiredDesc"></td><td><a data-bind="click: $root.showConfig">查看</a> | <a data-bind="click: $root.editConfig">修改</a></td></tr>
							            <!-- /ko -->
									</tbody>
								</table>
							</div>
						</div>
						<div>
							<p>
								<label>产品配置项关系：</label>
								<!-- ko if: (isUserDefinedProduct())  -->
									<span class="glyphicon glyphicon-plus-sign" style="color:#47b007;top:4px;font-size:18px;cursor:pointer;" data-bind="click: addConfigRelation"></span>
								<!-- /ko -->
							</p>
							<div class="panel panel-default b-blue" data-bind="with: configRelationsTable">
								<table class="table table-striped">
									<thead>
										<th>配置项名称</th>
										<th>关联关系</th>
										<th>关联配置项</th>
										<th>操作</th>
									</thead>
									<tbody>
										<tr data-bind="visible: showNoData">
							           		<td colspan="4" class="aligncenter">
							              		暂无数据
							           		</td>
							            </tr>
										<!-- ko foreach: {data: pagedRows, as: '$row'}  -->
							            	<tr>
							            		<td data-bind="text:sourceName"></td>
							            		<td data-bind="text:relationTypeDesc"></td>
							            		<td data-bind="text:targetName"></td>
								            	<td>
								            		<a data-bind="click: $root.showConfigRelation">查看</a> | 
								            		<a data-bind="click: $root.editConfigRelation">修改</a>
								            	</td>
							            	</tr>
							            <!-- /ko -->
									</tbody>
								</table>
							</div>
						</div>
					</form>
				</div>
				
				<!-- 自定义产品 -->
				<div class="service-right-content" style="display:none;">
					<form>
						<a class="btn btn-info btn-sm form-edit">修改</a><a style="display:none;" class="btn btn-success btn-sm form-save">保存</a>
						<div class="row">
							<div class="col-xs-6" style="margin-top:10px;">
								<label>产品名称：</label><span class="value-span">自定义产品</span><span class="input-span" style="display:none;"><input type="text" value="自定义产品"><i style="color:red">*</i></span>
							</div>
							<div class="col-xs-6">
								<div class="img-box" style="width:100px;text-align:center">
									<img src="" alt="" width="100%" height="80">
									<a class="btn btn-info btn-xs" onclick="showModal('pages/services/product_definitions/uploadimg.html')">上传图片</a>
								</div>
							</div>
						</div>
						<div>
							<p><label>产品配置项：</label><span class="glyphicon glyphicon-plus-sign" style="color:#47b007;top:4px;font-size:18px;cursor:pointer;" onclick="showModal('pages/services/product_definitions/addSetting.html')"></span></p>
							<div class="panel panel-default b-blue">
								<table class="table table-striped">
									<thead>
										<th>配置项名称</th>
										<th>是否必填</th>
										<th>操作</th>
									</thead>
									<tbody>
										<tr><td>配置项一</td><td>是</td><td><a onclick="showModal('pages/services/product_definitions/addSetting.html')">查看</a> | <a onclick="showModal('pages/services/product_definitions/addSetting.html')">修改</a> | <a onclick="confirm('确定删除吗？')">删除</a></td></tr>
										<tr><td>配置项二</td><td>是</td><td><a onclick="showModal('pages/services/product_definitions/addSetting.html')">查看</a> | <a onclick="showModal('pages/services/product_definitions/addSetting.html')">修改</a> | <a onclick="confirm('确定删除吗？')">删除</a></td></tr>
									</tbody>
								</table>
							</div>
						</div>
						<div>
							<p><label>产品配置项关系：</label><span class="glyphicon glyphicon-plus-sign" style="color:#47b007;top:4px;font-size:18px;cursor:pointer;" onclick="showModal('pages/services/product_definitions/addRelation.html')"></span></p>
							<div class="panel panel-default b-blue">
								<table class="table table-striped">
									<thead>
										<th>配置项名称</th>
										<th>关联关系</th>
										<th>关联配置项</th>
										<th>操作</th>
									</thead>
									<tbody>
										<tr><td>配置项一</td><td>一对多</td><td>配置项二</td><td><a onclick="showModal('pages/services/product_definitions/addRelation.html')">查看</a> | <a onclick="showModal('pages/services/product_definitions/addRelation.html')">修改</a> | <a onclick="confirm('确定删除吗？')">删除</a></td></tr>
									</tbody>
								</table>
							</div>
						</div>
						<div>
							<p><label>产品功能定义：</label><span class="glyphicon glyphicon-plus-sign" style="color:#47b007;top:4px;font-size:18px;cursor:pointer;" onclick="showModal('pages/services/product_definitions/addDefine.html')"></span></p>
							<div class="panel panel-default b-blue">
								<table class="table table-striped">
									<thead>
										<th>功能名称</th>
										<th>功能路径</th>
										<th>脚本</th>
										<th>操作</th>
									</thead>
									<tbody>
										<tr><td>服务发布表单</td><td>/server/boat</td><td>服务发布表单脚本</td><td><a onclick="showModal('pages/services/product_definitions/addDefine.html')">查看</a> | <a onclick="showModal('pages/services/product_definitions/addDefine.html')">修改</a> | <a onclick="confirm('确定删除吗？')">删除</a></td></tr>
										<tr><td>服务申请列表</td><td>/server/applylist</td><td>服务申请列表脚本</td><td><a onclick="showModal('pages/services/product_definitions/addDefine.html')">查看</a> | <a onclick="showModal('pages/services/product_definitions/addDefine.html')">修改</a> | <a onclick="confirm('确定删除吗？')">删除</a></td></tr>
									</tbody>
								</table>
							</div>
						</div>
					</form>
				</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

<!-- 配置项列表  -->
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAddConfig }">
	<div class="simple_form form-horizontal">
	  <div class='modal-dialog modal-lg' style="width:600px;">
	  
	  	<!-- 新增配置项  -->
	    <div class='modal-content' data-bind="visible:	showConfigType() == 'add'">
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
	      	<h3 class='modal-title'>新增产品配置项</h3>
	      </div>
	      <div class='modal-body form-horizontal row'>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项名称</label>
	          <div class="col-xs-8">
	            <input type="email" class="form-control" placeholder="请输入名称" data-bind="value: currentConfig().name">
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">是否必填</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().required">
	              <option value="1">是</option>
	              <option value="0">否</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项规则</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().regulation">
	              <option value="0">枚举选择</option>
	              <option value="1">单项选择</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	       	  <label class="col-xs-3 control-label">配置项可用值</label>
	          <div class="col-xs-8">
	            <textarea class="form-control" cols="30" rows="3" data-bind="value: currentConfig().values"></textarea>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn-info" data-bind="click: saveConfig">确定</a>
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	    
	    <!-- 修改配置项  -->
	    <div class='modal-content' data-bind="visible:	showConfigType() == 'update'">
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
        	<h3 class='modal-title'>修改产品配置项</h3>
	      </div>
	      <div class='modal-body form-horizontal row'>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项名称</label>
	          <div class="col-xs-8">
	            <input type="email" class="form-control" placeholder="请输入名称" data-bind="value: currentConfig().name" disabled="disabled">
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">是否必填</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().required" disabled="disabled">
	              <option value="1">是</option>
	              <option value="0">否</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项规则</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().regulation" disabled="disabled">
	              <option value="0">枚举选择</option>
	              <option value="1">单项选择</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	       	  <label class="col-xs-3 control-label">配置项原有值</label>
	          <div class="col-xs-8">
	            <textarea class="form-control" cols="30" rows="3" data-bind="value: currentConfig().values" disabled="disabled"></textarea>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	       	  <label class="col-xs-3 control-label">配置项新增值</label>
	          <div class="col-xs-8">
	            <textarea class="form-control" cols="30" rows="3" data-bind="value: currentConfig().newValues"></textarea>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn-info" data-bind="click: saveConfig">确定</a>
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	    
	    <!-- 显示配置项  -->
	    <div class='modal-content' data-bind="visible:	showConfigType() == 'show'">
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
	      	<h3 class='modal-title'>查看产品配置项</h3>
	      </div>
	      <div class='modal-body form-horizontal row'>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项名称</label>
	          <div class="col-xs-8">
	            <input type="email" class="form-control" placeholder="请输入名称" data-bind="value: currentConfig().name" disabled="disabled">
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">是否必填</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().required" disabled="disabled">
	              <option value="1">是</option>
	              <option value="0">否</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	          <label class="col-xs-3 control-label">配置项规则</label>
	          <div class="col-xs-8">
	            <select class="form-control" data-bind="value: currentConfig().regulation" disabled="disabled">
	              <option value="0">枚举选择</option>
	              <option value="1">单项选择</option>
	            </select>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	        <div class="form-group">
	       	  <label class="col-xs-3 control-label">配置项可用值</label>
	          <div class="col-xs-8">
	            <textarea class="form-control" cols="30" rows="3" data-bind="value: currentConfig().values" disabled="disabled"></textarea>
	          </div>
	          <div class="col-xs-1">
	            <span class="text-danger inline m-l-n m-t-sm">*</span>
	          </div>           
	        </div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	  </div>
	</div>
</div>
</div>





<!-- 配置项关系列表  -->
<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isAddConfigRelation }">
	<div class="simple_form form-horizontal">
	  <div class='modal-dialog modal-lg' style="width:640px;">
	    <!-- 新增配置项关系  -->
	    <!-- <div class='modal-content' data-bind="visible:	showConfigRelationType() == 'add'"> -->
	    
	    <!-- ko if: (showConfigRelationType() == 'add')  -->
	    <div class='modal-content'>
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>新增产品配置项关系</h3>
	      </div>
	      <div class='modal-body row'>
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">配置项名称</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().configA, options: configRelation().configA_list, optionsText: 'name', optionsValue: 'uuid'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">关系</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().relation, options: configRelation().relation_list, optionsText: 'name', optionsValue: 'type'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">配置项名称</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().configB, options: configRelation().configB_list, optionsText: 'name', optionsValue: 'uuid'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-6 form-item-block">
	          <label class="control-label"><span data-bind="text: configRelation().configA_Name"></span></label>
	          <!-- ko if: (configRelation().relation()=="1TO1" || configRelation().relation()=="1TON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configA_options">
	          	<div class="radio">
	              <label>
	                <input type="radio" name="optionsRadiosA" data-bind="value: value, checked: $root.configRelation().chosenA"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	          <!-- ko if: (configRelation().relation()=="NTO1" || configRelation().relation()=="NTON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configA_options">
	            <div class="checkbox">
	              <label>
	                <input type="checkbox" data-bind="checkedValue: value, checked: $root.configRelation().chosenA"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	        </div>
	        <div class="col-xs-6 form-item-block">
	          <label class="control-label"><span data-bind="text: configRelation().configB_Name"></span></label>
	          <!-- ko if: (configRelation().relation()=="1TO1" || configRelation().relation()=="NTO1")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configB_options">
	          	<div class="radio">
	              <label>
	                <input type="radio" name="optionsRadiosB" data-bind="value: value, checked: $root.configRelation().chosenB"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	          <!-- ko if: (configRelation().relation()=="1TON" || configRelation().relation()=="NTON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configB_options">
	            <div class="checkbox">
	              <label>
	                <input type="checkbox" data-bind="checkedValue: value, checked: $root.configRelation().chosenB"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	        </div>
	        <div class="col-xs-12 form-item-block text-center" style="padding: 10px 0px 10px;">
	        	<a class="btn btn-sm btn-success" data-bind="click: addRelation">添加</a>
	        </div>
	      	<div class="col-xs-12 form-item-block">
	      		<table class="table">
	      			<thead>
	      			<tr>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>关系</th>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>操作</th>
	      			</tr>
	      			</thead>
	      			<tbody data-bind="foreach: configRelation().configList">
	      				<tr>
	      					<td data-bind="text: configA_Name"></td>
	      					<td data-bind="text: chosenA"></td>
	      					<td data-bind="text: relation"></td>
	      					<td data-bind="text: configB_Name"></td>
	      					<td data-bind="text: chosenB"></td>
	      					<td><a data-bind="click: $root.removeRelation">删除</a></td>
	      				</tr>
	      			</tbody>
	      		</table>
	      	</div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn-info" data-bind="click: saveConfigRelation">确定</a>
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	    <!-- /ko -->
	    
	    <!-- 修改配置项关系  -->
	    <!-- ko if: (showConfigRelationType() == 'update')  -->
	    <div class='modal-content'>
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>修改产品配置项关系</h3>
	      </div>
	      <div class='modal-body row'>
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">配置项名称</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().configA, options: configRelation().configA_list, optionsText: 'name', optionsValue: 'uuid'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">关系</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().relation, options: configRelation().relation_list, optionsText: 'name', optionsValue: 'type'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-4">
	          <div class="input-group">
	            <span class="input-group-addon">配置项名称</span>
	            <select class="form-control input-sm" data-bind="value: configRelation().configB, options: configRelation().configB_list, optionsText: 'name', optionsValue: 'uuid'"></select>
	          </div>      
	        </div>      
	        <div class="col-xs-6 form-item-block">
	          <label class="control-label"><span data-bind="text: configRelation().configA_Name"></span></label>
	          <!-- ko if: (configRelation().relation()=="1TO1" || configRelation().relation()=="1TON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configA_options">
	          	<div class="radio">
	              <label>
	                <input type="radio" name="optionsRadiosA" data-bind="value: value, checked: $root.configRelation().chosenA"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	          <!-- ko if: (configRelation().relation()=="NTO1" || configRelation().relation()=="NTON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configA_options">
	            <div class="checkbox">
	              <label>
	                <input type="checkbox" data-bind="checkedValue: value, checked: $root.configRelation().chosenA"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	        </div>
	        <div class="col-xs-6 form-item-block">
	          <label class="control-label"><span data-bind="text: configRelation().configB_Name"></span></label>
	          <!-- ko if: (configRelation().relation()=="1TO1" || configRelation().relation()=="NTO1")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configB_options">
	          	<div class="radio">
	              <label>
	                <input type="radio" name="optionsRadiosB" data-bind="value: value, checked: $root.configRelation().chosenB"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	          <!-- ko if: (configRelation().relation()=="1TON" || configRelation().relation()=="NTON")  -->
	          <div style="border:1px solid #eee;padding:10px;" data-bind="foreach: configRelation().configB_options">
	            <div class="checkbox">
	              <label>
	                <input type="checkbox" data-bind="checkedValue: value, checked: $root.configRelation().chosenB"><span data-bind="text: value"></span>
	              </label>
	            </div>
	          </div>
	          <!-- /ko -->
	        </div>
	        
	        <div class="col-xs-12 form-item-block text-center" style="padding: 10px 0px 10px;">
	        	<label class="btn btn-sm btn-success">原有项</label>
	        </div>
	      	<div class="col-xs-12 form-item-block">
	      		<table class="table">
	      			<thead>
	      			<tr>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>关系</th>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			</tr>
	      			</thead>
	      			<tbody data-bind="foreach: oldConfigRelation().configList">
	      				<tr>
	      					<td data-bind="text: $root.oldConfigRelation().configA_Name"></td>
	      					<td data-bind="text: chosenA"></td>
	      					<td data-bind="text: $root.oldConfigRelation().relation"></td>
	      					<td data-bind="text: $root.oldConfigRelation().configB_Name"></td>
	      					<td data-bind="text: chosenB"></td>
	      				</tr>
	      			</tbody>
	      		</table>
	      	</div>
	        
	        <div class="col-xs-12 form-item-block text-center" style="padding: 10px 0px 10px;">
	        	<a class="btn btn-sm btn-success" data-bind="click: addRelation">添加</a>
	        </div>
	      	<div class="col-xs-12 form-item-block">
	      		<table class="table">
	      			<thead>
	      			<tr>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>关系</th>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>操作</th>
	      			</tr>
	      			</thead>
	      			<tbody data-bind="foreach: configRelation().configList">
	      				<tr>
	      					<td data-bind="text: configA_Name"></td>
	      					<td data-bind="text: chosenA"></td>
	      					<td data-bind="text: relation"></td>
	      					<td data-bind="text: configB_Name"></td>
	      					<td data-bind="text: chosenB"></td>
	      					<td><a data-bind="click: $root.removeRelation">删除</a></td>
	      				</tr>
	      			</tbody>
	      		</table>
	      	</div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn-info" data-bind="click: saveConfigRelation">确定</a>
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	    <!-- /ko -->
	    
	    
	    <!-- 查看配置项关系  -->
	    <!-- ko if: (showConfigRelationType() == 'show')  -->
	    <div class='modal-content' data-bind="visible:	showConfigRelationType() == 'show'">
	      <div class='modal-header'>
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>查看产品配置项关系</h3>
	      </div>
	      <div class='modal-body row'>
	        <div class="col-xs-12 form-item-block">
	      		<table class="table">
	      			<thead>
	      			<tr>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			  <th>关系</th>
	      			  <th>配置项名称</th>
	      			  <th>配置项值</th>
	      			</tr>
	      			</thead>
	      			<tbody data-bind="foreach: oldConfigRelation().configList">
	      				<tr>
	      					<td data-bind="text: $root.oldConfigRelation().configA_Name"></td>
	      					<td data-bind="text: chosenA"></td>
	      					<td data-bind="text: $root.oldConfigRelation().relation"></td>
	      					<td data-bind="text: $root.oldConfigRelation().configB_Name"></td>
	      					<td data-bind="text: chosenB"></td>
	      				</tr>
	      			</tbody>
	      		</table>
	      	</div>
	      </div>
	      <div class='modal-footer' style="text-align:center;">
	        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
	      </div>
	    </div>
	    <!-- /ko -->
	    
	  </div>
	</div>
</div>

<!-- 上传图片 -->
  <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isChangeImg }" id="picProductModal">
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>上传图片</h3>
        </div>
        <!-- <form action="/api/v5.0.0/file/upload/rest" enctype="multipart/form-data"> -->
	        <!-- <div class='modal-body row'>
	          <div class="col-xs-6">
	            <img src="" alt="" width="100%" height="150" id="ImgPr">
	          </div>
	          <div class="col-xs-6">
	            <p><a href="javascript:;" class="btn btn-success" style="margin-left: 10px;display: inline-block;width: 80px;height: 34px;overflow: hidden;position:relative;">
					<input id="up" type="file" name="file" style="opacity: 0;position: absolute;left:0;right:0;" 
					 data-bind="" onclick="preViewImage()"/>上传图片</a></p>
	        	   <p>支持JPG、GIF、PNG、BMP格式；图片小于2M。</p>
	          </div>
	        </div> -->
	        
	        <div class='modal-body row'>
	          <div class="col-xs-6">
	            <div id="fileList" class="uploader-list"><div class="file-item thumbnail" style="height: 120px"><img src="" alt="" id="ImgPr" height="100" width="100" data-bind="attr: {src: currentProduct().imgUrl}"></div></div>
	          </div>
	          <div class="col-xs-6">
	            <div id="filePicker">选择图片</div>
	        	   <p>支持JPG、GIF、PNG、BMP格式；图片小于2M。</p>
	          </div>
	        </div>
        <!-- </form> -->
        <div class='modal-footer' style="text-align:center;">
          <a class="btn btn-default btn-info" data-bind="click: setImg">确定</a>
          <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
        </div>
      </div>
    </div>
  </div> 

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null,"assets/lib/webuploader/webuploader.js", null]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    

    $(".form-edit").click(function(){
    	$(this).hide();
    	$(this).siblings('.form-save').show();
    	$(this).siblings('.row').find(".value-span").hide().next('.input-span').show();
    })
    $(".form-save").click(function(){
    	$(this).hide();
    	$(this).siblings('.form-edit').show();
    	$(this).siblings('.row').find('.value-span').show().html($(this).siblings('.row').find('input').val());
    	$(this).siblings('.row').find(".input-span").hide();
    })

    $(".product-add-btn").click(function(){
    	$(".add-praoduct").show().siblings().hide();
    })
    $(".product-delete-btn").click(function(){
    	if(confirm('确认删除吗？')){
    		console.log('执行删除！')
    	}
    })
    
    //产品信息模型
    function ViewModel_Products() {
        var self = this;
        this.isAddConfig = ko.observable(false);
        this.isAddConfigRelation = ko.observable(false);
        this.isUserDefinedProduct = ko.observable(false); //是否是用户自定义产品
        this.showConfigType = ko.observable("add"); //显示配置项类型
        this.showConfigRelationType = ko.observable("add"); //显示配置项类型
        
        //产品基本
        this.products = ko.observableArray([]);
        this.currentProduct = ko.validatedObservable({
        	name: ko.observable(),
        	imgUrl: ko.observable()
        });
        
        
        //配置项
        this.currentConfig = ko.validatedObservable({
        	productId : ko.observable(),
        	uuid : ko.observable(),
        	name : ko.observable().extend({required: true}),
        	required : ko.observable().extend({required: true}),
        	regulation : ko.observable().extend({required: true}),
        	values : ko.observable().extend({required: true}),
        	newValues : ko.observable()
        });
        
        this.configsTable = new DataTable([], {path: ''});

        this.searchConfigs = function(productId){
        	self.configsTable.params({
            	productId : productId
            });
        	
        	self.configsTable.path('api/v5.0.0/products/configs');
      	}
        
        function configRelationVO() {
        	var self = this;
        	
        	//传入后台的属性start
           	this.configA_Name = ko.observable();
           	this.configA = ko.observable();
           	this.configB_Name = ko.observable();
           	this.configB = ko.observable();
           	this.relation = ko.observable();
           	this.chosenA = ko.observableArray().extend({requried: true});
           	this.chosenB = ko.observableArray().extend({requried: true});
          	//传入后台的属性end
           	
           	
           	this.configA_list = ko.observableArray([]);
            this.configB_list = ko.observableArray([]);
            this.relation_list = ko.observableArray([                  
            	{type: '1TON', name: '1对多'},
            	{type: '1TO1', name: '1对1'}
            ]);
            this.configA_options = ko.observableArray();
            this.configB_options = ko.observableArray();
            this.relation.subscribe(function(value){
            	self.chosenA([])
            	self.chosenB([])
            })
            this.configA.subscribe(function(value){
            	/* console.log(self.configA_list()); */
            	var config = _.findWhere(self.configA_list(), {uuid: value});
            	self.configA_options(config.valueInfos)
            	self.chosenA([])
            	self.configA_Name(config.name);
            })
            this.configB.subscribe(function(value){
            	var config = _.findWhere(self.configB_list(), {uuid: value});
            	self.configB_options(config.valueInfos)
            	self.chosenB([])
            	self.configB_Name(config.name);
            })
            this.configList = ko.observableArray();
        }

        this.addRelation = function(){
        	if(self.configRelation.isValid()){
        		if(!(self.configRelation().chosenA().length==0 || self.configRelation().chosenB().length==0)){
        			self.configRelation().configList.push(self.configRelation.toJSON())
        			
        			self.configRelation().chosenA([])
        			self.configRelation().chosenB([])
        		}
        	}
        }
   
        this.removeRelation = function(object,event){
        	self.configRelation().configList.remove(object);
        }
        this.saveConfigRelation = function(){
    		csc.rest.post('api/v5.0.0/products/'+ self.currentConfig().productId +'/configAndValueRelations',ko.toJS(self.configRelation().configList),function(data){
		 		self.isAddConfigRelation(false);
	        	self.configRelationsTable.refreshData();
		 		alert('操作配置项关系成功！');
		    }); 
        }
        this.addConfig = function(){
    		self.isAddConfig(true);
    		self.currentConfig.fromJSON({
    			productId : self.currentProduct().uuid,
    			id : null,
            	uuid : null,
            	name : '',
            	required : '',
            	regulation : '',
            	values : ''
      		});
    		self.showConfigType("add");
  		}
        
        this.saveConfig = function(){
			ko.validation.group(this.currentConfig).showAllMessages();
	        if(self.currentConfig.isValid()){
	        	if(self.currentConfig().uuid()) {
	        		csc.rest.put('api/v5.0.0/products/'+ self.currentConfig().productId +'/configs/'+self.currentConfig().uuid(),self.currentConfig.toJSON(),function(data){
				 		self.isAddConfig(false);
			        	self.configsTable.refreshData();
				 		alert('修改配置项成功！');
				    }); 
	        	}else{
	        		csc.rest.post('api/v5.0.0/products/'+ self.currentConfig().productId +'/configs',self.currentConfig.toJSON(),function(data){
				 		self.isAddConfig(false);
			        	self.configsTable.refreshData();
				 		alert('添加配置项成功！');
				    }); 
	        	}
	        }
  		}
        
      	//修改
      	this.editConfig = function(object, event){
        	self.currentConfig.fromJSON(object);
        	self.isAddConfig(true); 
        	self.showConfigType("update");
      	}
      	
      	//查看配置项
      	this.showConfig = function(object, event){
        	self.currentConfig.fromJSON(object);
        	self.isAddConfig(true); 
        	self.showConfigType("show");
      	}
        
        //配置项关联关系
        this.currentConfigRelations = ko.observable({
        	productId: ""
        });
        this.configRelationsTable = new DataTable([], {path: ''});
        this.searchConfigRelations = function(productId){
        	self.configRelationsTable.path("");
        	self.configRelationsTable.params({
        		productId: productId
        	});
        	self.configRelationsTable.path("api/v5.0.0/products/configRelations")
      	}
        
        this.configRelation = ko.observable();
        
        this.addConfigRelation = function(){
		  	self.configRelation = new ko.validatedObservable(new configRelationVO());
    		self.isAddConfigRelation(true);
    		self.showConfigRelationType("add");
    		
    		csc.rest.get('api/v5.0.0/products/configs?productId=' + self.currentProduct().uuid,function(data){
    			var configList = data.results;
        		self.configRelation().configA_list(configList);
        		self.configRelation().configB_list(configList);
      		});
  		}
        
      	//修改配置项关联关系
      	this.oldConfigRelation = ko.observable();
      	
      	this.editConfigRelation = function(object, event){
      		self.configRelation = new ko.validatedObservable(new configRelationVO());
      		self.oldConfigRelation(new configRelationVO())
      		
      		self.isAddConfigRelation(true);
    		self.showConfigRelationType("update");
			
		    var configAList = new Array();
			configAList.push({name:object.sourceName,uuid:object.sourceId});
			self.configRelation().configA_list(configAList);
			
			var relationList = new Array();
			relationList.push({name:object.relationTypeDesc,type:object.relationType});
			self.configRelation().relation_list(relationList);
			
			var configBList = new Array();
			configBList.push({name:object.targetName,uuid:object.targetId});
			self.configRelation().configB_list(configBList);
			
			self.oldConfigRelation().configA_Name(object.sourceName);
			self.oldConfigRelation().relation(object.relationType);
			self.oldConfigRelation().configB_Name(object.targetName);
			
    		var queryParam = "?sourceId="+ object.sourceId +"&targetId="+ object.targetId;
    		csc.rest.get('api/v5.0.0/products/'+ self.currentConfig().productId +'/configAndValueRelations' + queryParam, function(data) {
    			if(data) {
    				self.configRelation().configA_options(data.sourceConfigValueList);
        			self.configRelation().configB_options(data.targetConfigValueList);
        			self.oldConfigRelation().configList(data.oldConfigList);
    			}
           	});
      	}
      	
      	//查看配置项关联关系
      	this.showConfigRelation = function(object, event){
      		self.configRelation = new ko.validatedObservable(new configRelationVO());
      		self.oldConfigRelation(new configRelationVO())
      		
      		self.isAddConfigRelation(true);
    		self.showConfigRelationType("show");
    		
    		self.oldConfigRelation().configA_Name(object.sourceName);
			self.oldConfigRelation().relation(object.relationType);
			self.oldConfigRelation().configB_Name(object.targetName);
			
			var queryParam = "?sourceId="+ object.sourceId +"&targetId="+ object.targetId;
    		csc.rest.get('api/v5.0.0/products/'+ self.currentConfig().productId +'/configAndValueRelations' + queryParam, function(data) {
    			if(data) {
        			self.oldConfigRelation().configList(data.oldConfigList);
    			}
           	});
      	}
        
        this.loadProducts = function() {
        	csc.rest.get('api/v5.0.0/products',function(data){
        		self.products(data);
        		self.currentProduct.fromJSON(data[0]);
        		self.currentConfig().productId = data[0].uuid;
        		self.currentConfigRelations().productId = data[0].uuid;

    	      	self.searchConfigs(data[0].uuid);
    	      	self.searchConfigRelations(data[0].uuid);
    	      	
    	      	//判断是否为用户自定义产品
    	      	if(data[0].isDefault && data[0].isDefault == 1) {
    	      		self.isUserDefinedProduct(false);
    	      	} else {
    	      		self.isUserDefinedProduct(true);
    	      	}
      		});
        }
        
        //左侧产品列表点击事件
        this.setCurrent = function(object, event) {
        	csc.rest.get('api/v5.0.0/products?uuid=' + object.uuid,function(data){
        		self.currentProduct.fromJSON(data[0]);
        		self.currentConfig().productId = data[0].uuid;
        		self.currentConfigRelations().productId = data[0].uuid;

    	      	self.searchConfigs(data[0].uuid);
    	      	self.searchConfigRelations(data[0].uuid);
    	      	
    	      	//判断是否为用户自定义产品
    	      	if(object.isDefault && object.isDefault == 1) {
    	      		self.isUserDefinedProduct(false);
    	      	} else {
    	      		self.isUserDefinedProduct(true);
    	      	}
      		});
        }
        
        this.loadProducts();
        
        
        //################--------------上传图片--------------#######################
        //初始化上传容器
        function loadInit(){
      		var $ = jQuery,
            $list = $('#fileList'),
             // 优化retina, 在retina下这个值是2
            ratio = window.devicePixelRatio || 1,

             // 缩略图大小
            thumbnailWidth = 100 * ratio,
            thumbnailHeight = 100 * ratio,
             // Web Uploader实例
     	    // 初始化Web Uploader
     	    uploader = new WebUploader.create({
     	        // 自动上传。
     	        auto: true,
     	        // swf文件路径
     	        swf: '/assets/lib/webuploader/Uploader.swf',
     	        // 文件接收服务端。
     	        server: '/csc/api/file/uploadServlet?handler=cscPicture&actionKey=&dataKey=',
     	        // 选择文件的按钮。可选。
     	        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
     	        pick: '#filePicker',
     	        fileSingleSizeLimit: 2*1024*1024,   //设定单个文件大小
     	        // 只允许选择文件，可选。
     	        accept: {
     	            title: 'Images',
     	            extensions: 'gif,jpg,bmp,png',
     	            mimeTypes: 'image/*'
     	        }
     	    });
     		uploader.on('beforeFileQueued', function(file) {
     			//重置上传队列
     			uploader.reset();
     		}); 
     		uploader.on("error",function (type){
     	        if (type=="Q_TYPE_DENIED"){
     	            alert("请上传gif、jpg、bmp、png格式文件！");
     	        }else if(type=="F_EXCEED_SIZE"){
     	            alert("文件大小不能超过2M！");
     	        }
     	    });
     	    
     	 // 当有文件添加进来的时候
     	    uploader.on( 'fileQueued', function( file ) {
     	    	
       	        var $li = $(
     	                '<div id="' + file.id + '" class="file-item thumbnail">' +
     	                    '<img>' +
     	                    '<div class="info">' + file.name + '</div>' +
     	                '</div>'
     	                ), 
     	            $img = $("#ImgPr");
     	    	//	        $img = $li.find('img');

//     	        $list.append( $li ); 

     	        // 创建缩略图
     	        uploader.makeThumb( file, function( error, src ) {
     	            if ( error ) {
     	                $img.replaceWith('<span>不能预览</span>');
     	                return;
     	            }
     	            $img.attr( 'src', src );
     	        }, 100, 100 );
     	    });

     	    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
     	    uploader.on( 'uploadSuccess', function( file, result) {
     	    	self.currentProduct().imgUrl("/csc/api/img/imgServlet?path="+result.path);
     	        $( '#'+file.id ).addClass('upload-state-done');
     	    });

     	    // 文件上传失败，现实上传出错。
     	    uploader.on( 'uploadError', function( file ) {
     	        alert('上传失败');
     	    });
     	   uploader.addButton({
    		    id: '#filePicker',
    		    innerHTML: '选择图片'
    		});
     	     
      	}
        
        this.isChangeImg = ko.observable(false);
        this.changeImg = function(){
	        this.isChangeImg(true);
	        $("#picProductModal").on("shown.bs.modal",function(){
					$(this).find('.modal-dialog').draggable({ handle:'.modal-header'});
					loadInit();
			});
        }
        //确定方法保存
        this.setImg = function(){
        	this.isChangeImg(false);
   			csc.rest.put('api/v5.0.0/products',self.currentProduct.toJSON(),function(data){
         		alert("修改成功!");
       		});	  
        }
      	//################--------------上传图片--------------#######################
   	}

	productModel = new ViewModel_Products();
    ko.applyBindings(productModel, $('#page-content')[0]);
  });
</script>