<div class="panel panel-info resouce-recovery">
    <div class="panel-heading">资源删除</div>
    <div id="orderDetailedList" class="wrapper">
      <div class="row">
        <div class="col-xs-4">资源名称：<span data-bind="text:vmInfoVo().name"></span> <a hidden>查看</a></div>
        <div class="col-xs-4">所属VDC：<span data-bind="text:vmInfoVo().vdcName"></span></div>
        <div class="col-xs-4">资源类型：<span data-bind="text:vmInfoVo().type"></span></div>
      </div>
      <p>&nbsp;</p>
      <div class="row">
          <div class="col-xs-4" style="display:none" id="subsys">所属业务系统：<span data-bind="text:vmInfoVo().busSysName"></span></div>
          <div class="col-xs-4">失效时间：<span data-bind="text:vmInfoVo().expiryDate"></span></div>
          <!-- 
          <div class="col-xs-4">施工状态：<span data-bind="text:vmInfoVo().name"></span></div>
           -->
      </div>
    </div>
</div>


<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
      function ViewModel(){
          var self = this;
          this.vmInfoVo = ko.validatedObservable({
              name:ko.observable(""),
              type:ko.observable(""),
              vdcName:ko.observable(""),
              busSysName:ko.observable(""),
              expiryDate:ko.observable("")
          });
          csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
              var processInstanceId = data.taskInfo[0].processInstanceId;
              csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(data){
                  var resourceType = data.resourceType;
                  var orderItems = data.orderItems;
                  if(orderItems.length==0) return;
                  if(resourceType=="VM"){
                      $("#subsys").css('display', 'block');//显示业务系统
                      //获取订单详情
                      var orderItem = orderItems[0];
                      if(!csc.util.isNotNull(orderItem)) return;
                      //获取订单详情数据
                      var resourceUuid = orderItem.resourceUuid;
                      if(!csc.util.isNotNull(resourceUuid)) return;
                      csc.rest.get('api/v5.0.0/vms/'+itemListData[0].resourceUuid,function(vmData){
                          if(vmData){
                              self.vmInfoVo.fromJSON({
                                  name:vmData.name,
                                  expiryDate:vmData.expiryDate,
                                  vdcName:vmData.vdcName,
                                  busSysName:vmData.busSysName,
                                  type:"云主机"
                              });
                          }
                     });
                      
                  }else if(resourceType=="PUBLICIP"){
                      //获取订单详情
                      var orderItem = orderItems[0];
                      if(!csc.util.isNotNull(orderItem)) return;
                      
                      //获取订单详情中json数据
                      var resourceUuid = orderItem.resourceUuid;
                      if(!csc.util.isNotNull(resourceUuid)) return;
                      
                      csc.rest.get("api/v5.0.0/publicIps?uuid="+resourceUuid,function(data){
                          var results = data.results;
                          if (results.length==0) return;
                          self.vmInfoVo.fromJSON({
                              name:results[0].name,
                              expiryDate:results[0].expiredDate,
                              vdcName:results[0].vdcName,
                              type:"公网IP"
                          });
                          
                      })
                  }else if(resourceType=="DISK"){
                      
                  }else if(resourceType=="OBJECT_STORAGE"){
                      
                  }
                 
              });
          })
      }
      ko.applyBindings(new ViewModel(), $('.resouce-recovery')[0]); 
  });
</script>