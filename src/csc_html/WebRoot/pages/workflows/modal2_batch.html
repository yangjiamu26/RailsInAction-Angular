  <div class="panel panel-info">
    <div class="panel-heading">申请信息</div>
    <div id="orderDetailedList" class="wrapper">
      <h5 class="text-info">云硬盘数：
      	<span class="badge bg-danger" data-bind="text:vdiskNum"></span>
      </h5>
      <div class="table-responsive no-height">
          <table class="table">
              <thead>
                  <tr>
                      <th>云硬盘名称</th>
                      <th>存储(GB)</th>
                      <th>所属VDC</th>
                      <th>挂载云主机</th>
                      <th>申请时长</th>
                      <th>收费标准</th>
                      <th>操作</th>
                  </tr>
              </thead>
              <tbody data-bind="foreach:vdiskList">
                  <tr>
                      <td data-bind="text:instanceName"></td>
                      <td data-bind="text:size"></td>
                      <td data-bind="text:vdcName"></td>
                      <td data-bind="text:vmName"></td>
                      <td data-bind="text:expireTime"></td>
                      <td data-bind="text:fee"></td>
                      <td>
                          <a class="expand-btn" onclick="expand(this)">查看 <i class="fa fa-angle-double-right"></i></a> | <a class="expand-btn" onclick="expand(this)">修改 <i class="fa fa-angle-double-right"></i></a> | <a onclick="systemMsg.alert('确定删除吗？')">删除</a>
                      </td>
                  </tr>
                  
                  <tr style="display: none">
                    <td colspan="8" class="no-padder">
                      <div id="orderDetailedList" class="wrapper form-horizontal">
                        <div class="row">
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">云硬盘名称<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <input type="text" class="form-control"  placeholder="云硬盘名称" data-bind="value:instanceName">
                              </div>
                            </div>
                          </div>
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">存储大小(G)</label>
                              <div class="col-sm-10">
                                <input type="text" class="form-control"  placeholder="存储大小" data-bind="value:size">
                              </div>
                            </div>
                          </div>  

                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">所属VDC<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <select class="form-control input-sm" data-bind="options:vdcList,optionsText:'name',optionsValue:'uuid',value:vdcUuid,optionsCaption:'请选择',event:{change:$root.vdcChange}"></select>
                              </div>
                            </div>
                          </div>
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">可用分区<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <select class="form-control input-sm" data-bind="options:azList,optionsText:'name',optionsValue:'uuid',value:azUuid,event:{change:$root.azChangeGetVm},optionsCaption:'请选择'"></select>
                              </div>
                            </div>
                          </div>
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">挂载云主机<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <select class="form-control input-sm"  data-bind="options:vmList,optionsText:'name',optionsValue:'uuid',value:vmUuid,event:{change:$root.vmChangeGetDate},optionsCaption:'请选择'"></select>
                              </div>
                            </div>
                          </div>  
                        </div>
                        <div class="row">
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">备注<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <textarea class="form-control" data-bind="value:desc"></textarea>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">申请时长：<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                有效期至 <input type="text" class="form-control" id="timerange" style="width:250px;display:inline-block;"  />
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-xs-6">
                            <div class="form-group">
                              <label class="col-sm-2 control-label">套餐：<i style="color:red">*</i></label>
                              <div class="col-sm-10">
                                <select class="form-control" style="width:150px;display:inline-block;">
                                  <option>包月</option>
                                  <option>包年</option>
                                </select> 费用：100元/月
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  
              </tbody>
          </table>
      </div>


    </div>

<script type="text/javascript">
	var scripts = [null, 'assets/lib/zTree/js/jquery.ztree.core.js',
               'assets/lib/zTree/js/jquery.ztree.excheck.js',
               "assets/lib/moment/moment.js",
               "assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {

    if(args.taskId){
		function ViewModel(){
		    var self = this;
		    this.vdiskNum = ko.observable("");
            this.vdiskList = ko.observableArray();
            
            this.vdcList = ko.observableArray();
            this.azList = ko.observable("");
            this.vmList = ko.observable("");
    	    this.mountVmUuid = ko.observable("");
    	    this.applyTime = ko.observable("");
            
            this.queryElement = function(object, event){
                
     		};
     
		     csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
	    	     var processInstanceId = data.taskInfo[0].processInstanceId;
	    	     //获取订单数据
		      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(data){
		      		 console.log(data)
		      		 var vdiskNum = 0;
		      		 data.orderItems.forEach(function(e){
		      			if(e.resourceType=='DISK'){
		      				vdiskNum ++;
		      			}
		      			
		      			if(e.expireType == "1"){ 
                           e.expireTime = "永久"; 
                         }else if(e.expireType == "2"){ 
                           e.expireTime = e.expireValue+"月"; 
                         }else if(e.expireType == "3"){ 
                           e.expireTime = e.expireTime; 
                         } 
		      			
		      			var disk = e;
		      			var metaData = JSON.parse(e.metaData);
		      			var resBaseInfo = JSON.parse(metaData.resBaseInfo);
		      			disk.size = resBaseInfo.volumeSize;
		      			disk.vmUuid = resBaseInfo.vmUuid;
		      			
		      			var vmName = resBaseInfo.vmName;
		      			disk.vmName = vmName;
		      			
		      			
		      			
		      			
		      			var serviceUuid=disk.serviceUuid; 
		                var vdcUuid=disk.vdcUuid; 
                        var azUuid=disk.azUuid; 
                        var vpcUuid=disk.vpcUuid; 
                        var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid; 
                        csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result){ 
                            disk.vdcList = result.vdcList;
                            disk.azList = result.azList; 
                             
                            csc.rest.get("api/v5.0.0/vms?vdcUuid=" + vdcUuid + "&azUuid=" + azUuid, function(result1) { 
                            	disk.vmList = result1.results; 
                                
        		      			self.vdiskList.push(disk);
                            }); 
                        });
		                
		                
		                
		                
		                /* var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid; 
		                csc.rest.get("api/v5.0.0/cart/getselect", function(data){
		                 	self.vdcList(data);
		                });
		                
		                this.vdcChange = function(obj){//根据变化的vdc及服务ID查找其下的可用分区
		        	        csc.rest.get("api/v5.0.0/cart/getAzList/"+obj.serviceUuid+"/"+obj.vdcUuid, function(data){
		        	        	self.azList(data);
		        	        });	        
		        	    };
		        	    
		        	    this.azChangeGetVm = function(obj){	
		                	console.log(obj)
		        	        csc.rest.get("api/v5.0.0/vms?vdcUuid="+obj.vdcUuid+"&azUuid="+obj.azUuid, function(data){
		        	        	self.vmList(data.results);
		        	        });	    	
		        	    }
		        	    
		        	    
		        	    this.vmChangeGetDate = function(obj){
		          			var vmItem = _.findWhere(self.vmList(), {uuid: self.mountVmUuid()});
		        			if (typeof(vmItem) == "undefined") { 
		        				self.applyTime("");
		        			}else{
		        				self.applyTime(vmItem.expiryTime);
		        			}
		        	    } */
		        	    
		        	    
		        	    
		      		})
		      		
		      		self.vdiskNum(vdiskNum);
		      	 })
		  })
		  $('.applyDateFormat').val(moment().format('YYYY/MM/DD')).daterangepicker(
		   	      {
		   	        format:'YYYY/MM/DD',
		   	        startDate: moment(),
		   	        singleDatePicker:true,
		   	        endDate: moment(),
		   	        separator:'至'
		   	      }
		   	   );	
	 	}
			
		ko.applyBindings(new ViewModel(), $('#approveContent')[0]); 
  	}
  })
  
  function expand(obj){
      $(obj).find('i').toggleClass("fa-angle-double-down");
      $(obj).parents('tr').next("tr").toggle();
	}
</script>