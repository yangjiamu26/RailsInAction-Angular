<div class="panel panel-info resouce-recovery">
    <div class="panel-heading">资源回收</div>
    <div id="orderDetailedList" class="wrapper">
      <div class="row">
        <div class="col-xs-4">资源名称：<span data-bind="text:vmInfoVo().name"></span> <a>查看</a></div>
        <div class="col-xs-4">所属VDC：<span data-bind="text:vmInfoVo().vdcName"></span></div>
        <div class="col-xs-4">资源类型：<span data-bind="text:vmInfoVo().type"></span></div>
      </div>
      <p>&nbsp;</p>
      <div class="row">
          <div class="col-xs-4">所属业务系统：<span data-bind="text:vmInfoVo().busSysName"></span></div>
          <div class="col-xs-4">失效时间：<span data-bind="text:vmInfoVo().name"></span></div>
          <!-- 
          <div class="col-xs-4">施工状态：<span data-bind="text:vmInfoVo().name"></span></div>
           -->
      </div>
    </div>
</div>


<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
      function ViewModel(){
          var self = this;
          this.vmInfoVo = ko.validatedObservable({
              name:ko.observable(""),
              type:ko.observable(""),
              vdcName:ko.observable(""),
              busSysName:ko.observable(""),
              expiryDate:ko.observable(""),
          });
          csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
              var processInstanceId = data.taskInfo[0].processInstanceId;
              csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(data){
                  var resourceType = data.resourceType;
                  var orderItems = data.orderItems;
                  if(orderItems.length==0) return;
                  debugger;
                  if(resourceType=="VM"){
                      
                      //获取订单详情
                      var orderItem = orderItems[0];
                      //获取订单详情中json数据
                      var resourceUuid = orderItem.resourceUuid;
                      var vdcName = orderItem.vdcName;
                      
                      //JSON结构体数据
                      var metaData = orderItem.metaData;
                      var metaDataJson = JSON.parse(metaData);
                      var resBaseInfo = metaDataJson.resBaseInfo;
                      var resBaseInfoJson = JSON.parse(resBaseInfo);
                      //获取资源uuid和类型
                      var uuid = resBaseInfoJson.uuid;
                      var type = resBaseInfoJson.type;
                      csc.rest.get("api/v5.0.0/vms?uuid="+uuid,function(data){
                          var results = data.results;
                          if (results.length==0) return;
                          
                          csc.rest.get("api/v5.0.0/vdcs", function(data){
                              self.vdcList(data.results);
                              self.vmInfoVo.fromJSON({
                                  name:results[0].name,
                                  expiryDate:results[0].expiryDate,
                                  vdcName:results[0].vdcName,
                                  busSysName:results[0].busSysName,
                                  type:"云主机"
                              });
                          });
                          
                      })
                  }else if(resourceType=="VM"){
                      
                  }else if(resourceType=="DISK"){
                      
                  }
                 
              });
          })
      }
      ko.applyBindings(new ViewModel(), $('.resouce-recovery')[0]); 
  });
</script>