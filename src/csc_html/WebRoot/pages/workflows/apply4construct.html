    <div class="panel panel-info" id="construct">
        <div class="panel-heading">申请信息</div>
        <div id="orderDetailedList" class="wrapper">
         
          <div class="table-responsive no-height" data-bind="visible: $root.vdiskList().length>0">
           <h5 class="text-info">云硬盘数：
            <span class="badge bg-danger" data-bind="text:vdiskNum"></span>
           </h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>云硬盘名称</th>
                        <th>所属VDC</th>
                        <th>挂载云主机</th>
                        <th>存储大小（G）</th>
                        <th>收费标准</th>
                        <th>可用分区</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach:vdiskList">
                    <tr>
                        <td data-bind="text:instanceName"></td>
                        <td data-bind="text:vdcName"></td>
                        <td data-bind="text:vmName"></td>
                        <td data-bind="text:size"></td>
                        <td data-bind="text:fee"></td>
                        <td data-bind="text:azName"></td>
                    </tr>
                </tbody>
            </table>
          </div>
          
          
          <div class="table-responsive no-height" data-bind="visible:$root.cnwareVdiskList().length>0">
           <h5 class="text-info">云硬盘数：
            <span class="badge bg-danger" data-bind="text:vdiskNum"></span>
           </h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>云硬盘名称</th>
                        <th>所属VDC</th>
                        <th>挂载云主机</th>
                        <th>存储大小（G）</th>
                        <th>收费标准</th>
                        <th>可用分区</th>
                        <th>存储池<span class="text-danger inline m-t-sm" style="margin-left: 5px">*</span></th>
                    </tr>
                </thead>
                <tbody data-bind="foreach: cnwareVdiskList">
                    <tr>
                        <td data-bind="text:instanceName"></td>
                        <td data-bind="text:vdcName"></td>
                        <td data-bind="text:vmName"></td>
                        <td data-bind="text:size"></td>
                        <td data-bind="text:fee"></td>
                        <td data-bind="text:azName"></td>
                        <td>
                        	<select data-bind="options:storagePoolList,optionsText:'name',optionsValue:'id',value: storagePoolId,optionsCaption:'请选择',attr:{id: 'storagePool'+$index()}">
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
          </div>

          <div class="table-responsive no-height" data-bind="visible:$root.publicNetworkNum()>0">
          <h5 class="text-info">公网IP数：1</h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>公网IP名称</th>
                        <th>所属VDC</th>
                        <th>申请时长</th>
                        <th>收费标准</th>
                        <th>VPC名称</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>公网IP1</td>
                        <td>研发部</td>
                        <td>永久</td>
                        <td>0.5元/月</td>
                        <td>
                            <select>
                                <option>VPC01</option>
                                <option>VPC02</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
          </div>

          <div class="table-responsive no-height" data-bind="visible:$root.lbNum()>0">
          <h5 class="text-info">负载均衡器数：<span class="badge bg-danger" data-bind="text:lbNum"></span></h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>负载均衡器名称</th>
                        <th>所属VDC</th>
                        <th>申请时长</th>
                        <th>收费标准</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach:lbList">
					<tr>
						<td data-bind="text: instanceName"></td>
						<td data-bind="text: vdcName"></td>
						<td data-bind="text: expireTime"></td>
						<td data-bind="text: fee"></td>						
					</tr>
				</tbody>
            </table>
          </div>

          <div class="table-responsive no-height" data-bind="visible:$root.sshNum()>0">
          <h5 class="text-info">SSH密钥数：<span class="badge bg-danger" data-bind="text:sshNum"></span></h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>SSH密钥名称</th>
                        <th>所属VDC</th>
                    </tr>
                </thead>
                <tbody data-bind="foreach:sshList">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vdcName"></td>
						</tr>
					</tbody>
            </table>
          </div>

          <div class="table-responsive no-height" data-bind="visible:$root.objectStorageNum()>0">
          <h5 class="text-info">对象存储数：1</h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>对象存储名称</th>
                        <th>所属VDC</th>
                        <th>存储大小（G）</th>
                        <th>申请时长</th>
                        <th>收费标准</th>
                        <th>可用分区</th>
                        <th>存储池</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>disk02</td>
                        <td>研发部</td>
                        <td>1</td>
                        <td>永久</td>
                        <td>0.5元/月</td>
                        <td>
                            <select>
                                <option>可用分区1</option>
                                <option>可用分区2</option>
                            </select>
                        </td>
                        <td>
                            <select>
                                <option>test1,剩余存储：4G，总共8G</option>
                                <option>test2,剩余存储：4G，总共8G</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
          </div>

        </div>
</div>

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null, null]
  var storagePoolId;
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
	  if(args.taskId){
		  csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
    	     var processInstanceId = data.taskInfo[0].processInstanceId;
    	     //获取订单数据
	      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(data){
				function ViewModel(){
				    var self = this;
		            this.vdiskNum = ko.observable("");
		            this.objectStorageNum = ko.observable(""); 
		            this.publicNetworkNum = ko.observable("");
		            this.lbNum = ko.observable("");
		            this.sshNum = ko.observable("");
		            this.ltNum = ko.observable("0"); //路由器数
		            
		            this.vdiskList = ko.observableArray();
		            this.cnwareVdiskList = ko.observableArray();
		            this.sshList = ko.observableArray();
		            this.lbList = ko.observableArray();
			     	
			      		
			            var vdiskNum = 0;
			            var objectStorageNum = 0;
			            var publicNetworkNum = 0;
			            var lbNum = 0;
			            var sshNum = 0;
			            
			      		data.orderItems.forEach(function(e){
			      			var metaData = JSON.parse(e.metaData);
			      			var resBaseInfo = {};
			      			if(metaData.resBaseInfo!=""){
			      				resBaseInfo = JSON.parse(metaData.resBaseInfo);
			      			}
			      			
			      			if(e.resourceType=='DISK'){
			      				vdiskNum ++;
			      				var diskVO = new DiskVO();
			      				var disk = e;
				      			disk.size = resBaseInfo.volumeSize;
				      			
				      			var vmName = resBaseInfo.vmName;
				      			disk.vmName = vmName;
				      			
				      			storagePoolId = metaData.storagePoolPlatformId
				      			
				      			diskVO.azName(disk.azName);
				      			diskVO.azUuid(disk.azUuid);
				      			diskVO.billCycle(disk.billCycle);
				      			diskVO.cloudPlatform(disk.cloudPlatform);
				      			diskVO.createTime(disk.createTime);
				      			diskVO.desc(disk.desc);
				      			diskVO.expireTime(disk.expireTime);
				      			diskVO.expireType(disk.expireType);
				      			diskVO.expireValue(disk.expireValue);
				      			diskVO.fee(disk.fee);
				      			diskVO.id(disk.id);
				      			diskVO.instanceName(disk.instanceName);
				      			diskVO.isBill(disk.isBill);
				      			diskVO.itemState(disk.itemState);
				      			diskVO.itemWorkProgress(disk.itemWorkProgress);
				      			diskVO.vdcName(disk.vdcName);
				      			diskVO.vdcUuid(disk.vdcUuid);
				      			diskVO.vmName(disk.vmName);
				      			diskVO.size(disk.size);
				      			diskVO.uuid(disk.uuid);
				      			
				      			disk.storagePoolList=[];
				      			disk.storagePoolId=resBaseInfo.storagePoolId;
				      			if(disk.cloudPlatform == "CNware"){
				      				csc.rest.get("api/v5.0.0/vms/"+resBaseInfo.vmUuid,function(result,textStatus,diskVO,resBaseInfo){
				      					//获取存储池列表
				      					csc.rest.get("api/v5.0.0/storagePools/targetStoragePools?azUuid="+diskVO.azUuid()+"&hostId="+result.ownerHostUuid, function(result,textStatus,diskVO,resBaseInfo){
		  	                        	     diskVO.storagePoolList(result.results);
		  	                        	     diskVO.storagePoolId(storagePoolId);
	  	                                },function(){},diskVO,resBaseInfo,true);
				      				},function(){},diskVO,resBaseInfo,true);
			      					self.cnwareVdiskList.push(diskVO);
				      			}else{
				      				self.vdiskList.push(disk);
				      			}
				      			
			      			}else if(e.resourceType=='SECRET_KEY'){
			      				sshNum ++;
			      				self.sshList.push(e);
			      			}else if(e.resourceType=='LOAD_BALANCING'){
			      				lbNum++;
			      				if(e.expireType == "1"){
			      					e.expireTime = "永久";
			      				}else if(e.expireType == "2"){
			      					e.expireTime = e.expireValue+"月";
			      				}else if(e.expireType == "3"){
			      					e.expireTime = e.expireTime;
			      				}
			      				self.lbList.push(e);
			      			}
			      		})
			      		
			      		self.vdiskNum(vdiskNum);
			      		self.sshNum(sshNum);
			      		self.lbNum(lbNum);
			      	 
			  
				  this.save = function(){
		       		saveComment(args.taskId,function(){
		       			if(self.cnwareVdiskList().length > 0){
		       				for(var j=0;j<data.orderItems.length;j++){
		        		    	var vmOrderItemVO = data.orderItems[j];
		        		  	    var metaData = JSON.parse(vmOrderItemVO.metaData);
		        		   	    var metaDataResBaseInfo= JSON.parse(metaData.resBaseInfo);
		       				
			       				for(var i=0;i<self.cnwareVdiskList().length;i++){
		        		  		    var applyCnDiskVo = self.cnwareVdiskList()[i];
		        		  		    if(applyCnDiskVo.uuid() == vmOrderItemVO.uuid){
		        		  		    	//cnware平台
		        		  		    	metaData.storagePoolPlatformId =  $("#storagePool"+i).val();
		        		  		    	if(metaData.storagePoolPlatformId == ""){
		        		  		    		alert("请检查必填项！");
		        		  		    		return;
		        		  		    	}
		        		  		    	vmOrderItemVO.metaData =  JSON.stringify(metaData);
		        		  		    	break;
		        		  		    }
		        		    	}
		       				}
		       				csc.rest.put("api/v5.0.0/orders/"+data.uuid,data, function(data){ 
	                    	   if(typeof(callback) != 'undefined'){
		           					callback();
		           					return;
		           			    }
	                           alert("保存成功！"); 
	                       });
		       			}else{
		       				alert("保存成功！");
		       			}
		       			
		       		});
				  }
			  
				  this.next = function(){
					if(isLast){
					  saveComment(args.taskId,function(){
						var databody = {"userId":"","action":"designated"};
						csc.rest.put('api/v5.0.0/workflows/tasks/'+args.taskId,databody,function(data){
						  alert("审核成功！");
						  location.href = "#pages/workflows/tasks?type=work";
						},function(){alert("操作失败！")});
					  });
				  	}else{		  
					  showModal("pages/workflows/next.html");
				  	}
				  }
				  //云盘实体
				  function DiskVO(){
					  this.azName = ko.observable();
					  this.azUuid = ko.observable();
					  this.billCycle = ko.observable();
					  this.cloudPlatform = ko.observable();
					  this.createTime = ko.observable();
					  this.desc = ko.observable();
					  this.expireTime = ko.observable();
					  this.expireType = ko.observable();
					  this.expireValue = ko.observable();
					  this.fee = ko.observable();
					  this.id = ko.observable();
					  this.instanceName = ko.observable();
					  this.isBill = ko.observable();
					  this.itemState = ko.observable();
					  this.itemWorkProgress = ko.observable();
					  this.storagePoolId = ko.observable();
					  this.storagePoolList = ko.observableArray();
					  this.vdcName = ko.observable();
					  this.vdcUuid = ko.observable();
					  this.vmName = ko.observable();
					  this.size = ko.observable();
					  this.uuid = ko.observable();
				  }
				  
				}		
			ko.applyBindings(new ViewModel(), $('#approveContent')[0]); 

       	})
 	  })
	  }
	});
</script>