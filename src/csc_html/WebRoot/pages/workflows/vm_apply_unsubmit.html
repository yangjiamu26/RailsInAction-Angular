  <div class="panel panel-info">
    <div class="panel-heading">申请信息</div>
    <div id="vmApplyDetailedList" class="wrapper">

          <h5 class="text-info">基本信息</h5>
          <div class='form-horizontal'>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">云主机名称</label>
              <div class="col-xs-2">
                <input type="text" class="form-control" data-bind="value: currentVO().instanceName"/>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">所属VDC</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options:currentVO().vdcList,optionsText:'name',optionsValue:'uuid',value: currentVO().vdcUuid,event:{change:$root.vdcChange},optionsCaption:'请选择'"></select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">可用分区</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options: currentVO().azList, optionsText: 'name', optionsValue: 'uuid',value: currentVO().azUuid,event:{change:$root.azChangeGetVpc},optionsCaption:'请选择'"></select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">操作系统类型</label>
              <div class="col-xs-2">
                <select class="form-control input-sm"   data-bind="options: currentVO().osTypeList, optionsText: $data, optionsValue: $data,value: currentVO().osType,event:{change:$root.osTypeChangeGetOsVersion},optionsCaption:'请选择'">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">操作系统版本</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options: currentVO().osVersionList, optionsText: 'imageName', optionsValue: 'uuid',value: currentVO().osVersion,optionsCaption:'请选择'">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">CPU(个)</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options: currentVO().cpuList, optionsText: $data, optionsValue: $data,value: currentVO().vcpu,optionsCaption:'请选择'">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">内存(GB)</label>
              <div class="col-xs-2">
                 <select class="form-control input-sm" data-bind="options: currentVO().memoryList, optionsText: $data, optionsValue: $data,value: currentVO().memory,optionsCaption:'请选择'">
                </select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">存储(GB)</label>
              <div class="col-xs-2">
                <input type="text" class="form-control" data-bind="value: currentVO().storage"/>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">VPC/IP池</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options: currentVO().vpcList, optionsText: 'name', optionsValue: 'uuid',value: currentVO().vpcUuid,event:{change:$root.vpcChange},optionsCaption:'请选择'"></select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">网络名称</label>
              <div class="col-xs-2">
                <select class="form-control input-sm" data-bind="options: currentVO().privateNetworkList, optionsText: 'name', optionsValue: 'uuid',value: currentVO().networkUuid,event:{change:$root.networkChangeGetIpList},optionsCaption:'请选择'"></select>
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
              <label class="col-xs-1 control-label no-padder-h">指定IP</label>
              <div class="col-xs-2">
                  <select class="form-control input-sm" data-bind="options: currentVO().availableIpList, optionsText: $data, optionsValue: $data,value: currentVO().ip,optionsCaption:'请选择'"></select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">主机账号</label>
              <div class="col-xs-2">
                <input type="text" class="form-control" data-bind="value: currentVO().account">
              </div>
              <label class="col-xs-1 control-label no-padder-h">密码</label>
              <div class="col-xs-2">
                <input type="password" class="form-control" data-bind="value: currentVO().password">
              </div>
              <label class="col-xs-1 control-label no-padder-h">重复密码</label>
              <div class="col-xs-2">
                <input type="password" class="form-control" data-bind="value: currentVO().repeatPassword">
              </div>
            </div>
            <div class="form-group">
              <div id="resource_instance_vm_add_ssh">
                <label class="col-xs-1 control-label no-padder-h">选择密钥</label>
                <div class="col-xs-2">
                  <select class="form-control input-sm" data-bind="options: currentVO().sshList, optionsText: 'name', optionsValue: 'uuid',value: currentVO().sshUuid,optionsCaption:'请选择'"></select>
                </div>
                <div class="col-xs-1">
                  <span class="text-danger inline m-l-n m-t-sm"></span>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">申请时长</label>
              <div class="col-xs-10">
                <label class="radio-inline" style="padding-top: 2px">
                  <input type="radio" name="inlineRadioOptions" id="inlineRadio1" value="1"  data-bind="checked:currentVO().expireType"   > 永久
                </label>
                <label class="radio-inline">
                  <input type="radio" name="inlineRadioOptions" id="inlineRadio2" value="2"   data-bind="checked:currentVO().expireType"   style="margin-top:10px"> 
                  <input type="text" class="form-control inline w-xxs" data-bind="value:currentVO().expireType()==2?currentVO().expireValue:''" >
                  <select class="form-control inline w-xs">
                    <option value="">月</option>
                  </select>  
                </label>
                <label class="radio-inline">
                  <input type="radio" name="inlineRadioOptions" id="inlineRadio3" value="3"  data-bind="checked:currentVO().expireType"  style="margin-top:10px"> 有效期至
                  <input type="text" value="" class="form-control inline w"  data-bind="value:currentVO().expireType()==3?currentVO().expireValue:''"  id="vm_duration">
                </label>                                    
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-1 control-label no-padder-h">套餐</label>
              <div class="col-xs-10">
                <select class="form-control inline w-xs"  data-bind="options:currentVO().billRuleList,optionsText:'name',optionsValue:'value',event:{change:function(data, event){ $root.chargeChangeCart(currentVO(),event) }},value:currentVO().billCycle,optionsCaption:'请选择'" >
                </select>    
               <span class="control-label col-sm-5 text-left" style="height:34px;" data-bind="text:currentVO().fee"></span>                      
              </div>
              <div class="col-xs-1">
                <span class="text-danger inline m-l-n m-t-sm">*</span>
              </div>
            </div>
          </div>

          <div class="clear">
            <h5 class="text-info pull-left">挂载云硬盘</h5>
            <a href="#" class="pull-right text-info m-t-sm" data-bind="click: addMountDisks">添加硬盘</a>
          </div>
          <div class="table-responsive no-height">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>序号</th>
                    <th>云硬盘名称<span class="text-danger">*</span></th>
                    <th>存储大小(GB)<span class="text-danger">*</span></th>
                    <th>所属服务<span class="text-danger">*</span></th>
                    <th>申请时长</th>
                    <th>套餐</th>
                    <th>收费标准</th>
                    <th>操作</th>
                  </tr>
                </thead>
                   <tbody data-bind="foreach:currentVO().mountDisks">
	                     <tr>
	                         <td><span data-bind="text: ($index()+1)"></span></td>
	                         <td><input type="text" class="form-control" data-bind="value:name"/></td>
	                         <td><input type="text" class="form-control" data-bind="value:size"/></td>
	                         <td><input type="text" data-bind="value:serviceName" disabled/> <a class="btn btn-xs btn-default" data-bind="click:$root.selectVdiskService_VM">选择</a></td>
	                         <td><span data-bind="text:$root.currentVO().expireText" ></span></td>
	                         <td><select class="form-control w-xs" data-bind="options: billRuleList,optionsText:'name',optionsValue:'value',value:billCycle,event:{change:$root.chargeChangeCart},optionsCaption:'请选择'"></select></td>
	                         <td><span data-bind="text: fee"></span></td>
	                         <td><a class="btn btn-xs btn-danger" data-bind="click:$root.delMountDisks">删除</a></td>
	                     </tr>
                   </tbody>
              </table>
          </div>
          
          
          <!-- 选择云服务页面 -->
		    <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: selectVdiskService }">
		      <div class='modal-dialog modal-lg' role='document'>
		        <div class='modal-content'>
		          <div class='modal-header'>
		            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>选择云硬盘服务</h3>
		          </div>
		          <div class='modal-body form-horizontal'>
		            <div class="panel panel-default table-responsive no-height" style="margin:0;margin-top:10px" data-bind="with: $root.table_Vdisk_VM">
		             <table class="table table-striped">
		               <thead>
		                 <th></th>
		                 <th>云硬盘服务名称<i style="color:red">*</i></th>
		                 <th>类型<i style="color:red">*</i></th>
		                 <th>是否收费<i style="color:red">*</i></th>
		               </thead>
		               <tbody>
		               <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
		                 <tr>
		                   <td><input type="radio" style="top:-2px;" name="optionsRadios0"  data-bind="checkedValue: $data, checked: $parent.chosenItems"></td>
		                   <td data-bind="text:serviceName"></td>
		                   <td data-bind="text:diskType">类型</td>
		                   <td data-bind="text:isFee">是/否</td>
		                 </tr>
		                 <!-- /ko -->
		               </tbody>
		             </table>
		             <footer class="panel-footer" data-bind="with: $root.table_Vdisk_VM">
		        <ul class="pagination">
		            <li data-bind="css: leftPagerClass, click: prevPage">
		              <a href="#">&laquo;</a>
		            </li>
		            <!-- ko foreach: {data: (new Array(pages()))} -->
		            <li data-bind="css: $parent.pageClass($index() + 1)">
		              <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
		            </li>
		            <!-- /ko -->
		            <li data-bind="css: rightPagerClass, click: nextPage">
		              <a href="#">&raquo;</a>
		            </li>
		        </ul>
		        </footer>
		           </div>
		           
		         </div>
		         <div class='modal-footer' style="text-align:center;">
		            <a class="btn btn-default btn-info" data-bind="click: submitVdiskService">确定添加</a>
		            <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
		          </div>
		        </div>
		      </div>
		    </div>
		    <!-- 选择云服务页面 -->

       <!--    <div class="clear">
            <h5 class="text-info pull-left">安装软件</h5>
            <a href="#" class="pull-right text-info m-t-sm">添加软件</a>
          </div>
          <div class="table-responsive no-height">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>软件名称</th>
                  <th>软件分类</th>
                  <th>软件类型</th>
                  <th>软件版本</th>
                  <th>静默安装属性</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>oracle</td>
                  <td>数据库</td>
                  <td>oracle</td>
                  <td>10g企业版</td>
                  <td>
                    <a class="expand-btn">查看 <i class="fa fa-angle-double-right"></i></a> |
                    <a class="expand-btn">修改 <i class="fa fa-angle-double-right"></i></a>
                  </td>
                  <td><a href="#">删除</a></td>
                </tr>
                <tr style="display: none">
                    <td colspan="7" class="no-padder">
                      <div class="b wrapper-sm">
                        <h5><i class="fa fa-minus fa-rotate-90 text-info"></i>静默安装属性</h5>
                        <div class="form-horizontal">
                          <div class="form-group">
                            <label class="col-xs-1 control-label">参数名称</label>
                            <div class="col-xs-3">
                              <input class="form-control" type="text" value="test1">
                            </div>
                            <label class="col-xs-1 control-label">参数代码</label>
                            <div class="col-xs-3">
                              <input class="form-control" type="text" value="test1">
                            </div>
                            <label class="col-xs-1 control-label">默认值</label>
                            <div class="col-xs-3">
                              <input class="form-control" type="text" value="test1">
                            </div>
                          </div>                        
                        </div>
                        <div class="wrapper-sm text-center"><button class="btn btn-sm btn-info">保存</button></div>
                      </div>                    
                    </td>
                </tr>                
              </tbody>
            </table>            
          </div>

          <div class="clear">
            <h5 class="text-info pull-left">系统盘分区</h5>
            <a href="#" class="pull-right text-info m-t-sm">添加分区</a>
          </div>
          <div class="table-responsive no-height">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>分区名称</th>
                  <th>分区大小</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>NFS</td>
                  <td>100G</td>
                  <td><a href="#">修改</a> | <a href="#">删除</a></td>
                </tr>
              </tbody>
            </table>            
          </div> -->

          <h5 class="text-info">高级选项</h5>
          <div class="form-horizontal">
            <div class="form-group">
              <label class="col-xs-2 control-label">所属业务系统</label>
              <div class="col-xs-5">
                <select class="form-control"  data-bind="options:currentVO().bussyList,optionsText:'name',optionsValue:'uuid',value:currentVO().busSysUuid,optionsCaption:'请选择'" >
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="col-xs-2 control-label">备注</label>
              <div class="col-xs-5">
                <textarea cols="5" rows="5" class="form-control"></textarea>
              </div>
            </div>            
          </div>

    </div>
</div>
<script type="text/javascript">

  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
	  csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
	   	     var processInstanceId = data.taskInfo[0].processInstanceId;
	   	     //获取订单数据
	      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(orderData){
	      		 
	      		 console.log("orderDataorderDataorderDataorderDataorderData",orderData)
	      		 
	      		 function ViewModel(){
	      		      var self = this;
	      		      this.currentVO = ko.validatedObservable({
	      		        id: ko.observable(),
	      		        serviceUuid: ko.observable(),
	      		        instanceName: ko.observable("").extend({required: true}),
	      		        vdcUuid: ko.observable("").extend({required: true}),
	      		        vpcUuid: ko.observable("").extend({required: true}),
	      		        azUuid: ko.observable("").extend({required: true}),
	      		        partition: ko.observable().extend({required: true}),
	      		        osType: ko.observable("").extend({required: true}),
	      		        osVersion: ko.observable("").extend({required: true}),
	      		        vcpu: ko.observable("").extend({required: true}),
	      		        memory: ko.observable("").extend({required: true}),
	      		        storage: ko.observable("").extend({required: true}),
	      		        ipPool: ko.observable("").extend({required: true}),
	      		        networkUuid: ko.observable("").extend({required: true}),
	      		        ip: ko.observable(""),
	      		        account: ko.observable("").extend({required: true}),
	      		        password: ko.observable("").extend({required: true}),
	      		        repeatPassword: ko.observable("").extend({required: true}),
	      		        isBind: ko.observable("").extend({required: true}),
	      		        fee:ko.observable(""),
	      		        sshUuid: ko.observable(""),
	      		        expireType:ko.observable(""),
	      		        expireValue:ko.observable(""),
	      		        expireText:ko.observable(""),
	      		        busSysUuid:ko.observable(""),
	      		        billCycle:ko.observable(""),
	      		        //分区
	      	            partitions: ko.observableArray([]),
	      	            //硬盘
	      	            mountDisks : ko.observableArray([]),
	      	            
	      	            softwares : ko.observableArray([]),
	      	            vdcList:ko.observableArray([]),
	      	            azList:ko.observableArray([]),
	      	            osTypeList:ko.observableArray([]),
	      	            osVersionList:ko.observableArray([]),
	      	            cpuList:ko.observableArray([]),
	      	            memoryList:ko.observableArray([]),
	      	            vpcList:ko.observableArray([]),
	      	            privateNetworkList:ko.observableArray([]),
	      	            bussyList:ko.observableArray([]),
	      	            sshList:ko.observableArray([]),
	      	            billRuleList:ko.observableArray([]),
	      	            availableIpList:ko.observableArray([]),
	      		      });
	      		      
	      		     self.currentVO.fromJSON({
	    	            "orderData":orderData
                     });
	      			  
	      		      this.addMountDisks = function(){
	      	              self.currentVO().mountDisks.push(new MountDiskVO());
	      	          }
	      	          this.delMountDisks = function (object){
	      	              self.currentVO().mountDisks.remove(object);
	      	          }
	      	          
	      	          

	                  this.vdcChange = function(arg, data, event) { //根据变化的vdc及服务ID查找其下的可用分区
	                	  self.currentVO().azList([]);
	                      csc.rest.get("api/v5.0.0/cart/getAzList/"+self.currentVO().serviceUuid()+"/" + self.currentVO().vdcUuid(), function(result) { //需修改为服务UUID作为参数传递
	                    	  self.currentVO().azList(result);
	                      });
	                  };

	                  this.azChangeGetVpc = function(arg, data, event) {
	                	  self.currentVO().vpcList([]);
	                      csc.rest.get("api/v5.0.0/cart/getVpcList/" + self.currentVO().vdcUuid() + "/" + self.currentVO().azUuid(), function(result) {
	                    	  self.currentVO().vpcList(result);
	                      });
	                  }


	                  this.vpcChange = function(arg, data, event) {
	                	  self.currentVO().privateNetworkList([]);
	                      csc.rest.get("api/v5.0.0/cart/getNetworkList/"+self.currentVO().serviceUuid()+"/" + self.currentVO().vpcUuid(), function(result) { //需修改为服务UUID作为参数传递
	                    	  self.currentVO().privateNetworkList(result);
	                      });
	                  }
	                  
	                  this.osTypeChangeGetOsVersion = function(arg, data, event) {
	                	  self.currentVO().osVersionList([]);
	                      csc.rest.get("api/v5.0.0/cart/getOsVersionList/" + self.currentVO().azUuid() + "/" + self.currentVO().osType(), function(result) {
	                    	  self.currentVO().osVersionList(result);
	                      });
	                  }
	                  
	                  this.networkChangeGetIpList = function(arg, data, event) {
	                	   self.currentVO().availableIpList([]);
	                	   csc.rest.get("api/v5.0.0/vpcNetworks/"+self.currentVO().networkUuid()+"/availableIp", function(result,textStatus){
		                 	     var ipList = [];
		                 	     if(result){
		                 	    	 for(var i=0;i<result.length;i++){
		                 	    		var objIp = result[i];
		                 	    		ipList.push(objIp.ip);
		                 	    	 }
		                 	     }
		                 	    self.currentVO().availableIpList(ipList);
		                	},function(){},selectIp);
	                  }
	                  
	                  
	                  
	                  this.currentVO().expireType.subscribe(function(){
	                      self.currentVO().expireText(getExpireText(self.currentVO().expireType(),self.currentVO().expireValue()));
	          	     });
	                  
	                  
	                 this.chargeChangeCart = function(data){//vm
	                      var serviceUuid=data.serviceUuid();
	                      var cycle=data.billCycle();
	           	    	csc.rest.get("api/v5.0.0/billing/rules/calculate?serviceUuid="+serviceUuid+"&cycle="+cycle, function(result){
	           	    		var price = 0;
	           	    		var cpu=data.cpu!=null?data.cpu():0;
	           	    		var memory=data.memory!=null?data.memory():0;
	           	    		var storage=data.storage!=null?data.storage():0;
	           	    		var size=data.size!=null?data.size():0;
	           	    		var type=data.billCycle();
	           	    	   
	                         if(typeof(type)=="undefined" ){
	                      	     data.fee("");
	             	    		 return;
	                         }
	          	               
	           	    		result.ruleList.forEach(function(e){
	           	    			if(e.attrType=='CPU'){
	           	    				price += cpu * e.unitPrice;
	           	    			}else if(e.attrType=='MEMORY'){
	           	    				price += memory * e.unitPrice;
	           	    			}else if(e.attrType=='STORAGE'){
	           	    				price += storage * e.unitPrice;
	           	    			}else if(e.attrType=='DISK'){
	           	    				price += size * e.unitPrice;
	           	    			}else if(e.attrType=='LOAD_BALANCING'){
	           	    				price +=e.unitPrice;
	           	    			}else if(e.attrType=='SECRET_KEY'){
	           	    				price +=e.unitPrice;
	           	    			}
	           	    		});
	           	    		if(type=="DAY"){
	           	    			price+="元/天";
	           	    		}else if(type=="MONTH"){
	           	    			price+="元/月";
	           	    		}else if(type=="QUARTER"){
	           	    			price+="元/季度";
	           	    		}else{
	           	    			price+="元/年";
	           	    		}
	           	    		data.fee(price);
	           	    	});	    	
	           	    }

	      	          
	      		      function MountDiskVO(){
	      	              this.name = ko.observable();
	      	              this.size = ko.observable();
	      	              this.type = ko.observable();
	      	              this.serviceUuid = ko.observable();
	      	              this.serviceName = ko.observable();
	      	              this.billCycle = ko.observable();
	      	              this.applyType = ko.observable();
	      	              this.applyNum = ko.observable();
	      	              this.applyTime = ko.observable();
	      	              this.applyText = ko.observable();
	      	              this.billRuleList=ko.observableArray([]);
	      	              this.fee = ko.observable();
	      	              this.uuid = ko.observable();
	      	              this.isBill = ko.observable();
	      	              this.relateUuid = ko.observable();
	      	          }
	      		      
	      		     function getExpireText(type,val){
   	                   var v = "";
   	                    if("1"==type){
   	                        v="永久";
   	                    }else if("2"==type){
   	                        v=val+"个月";
   	                    }else if("3"==type){
   	                        v= "有效期至:"+val.substr(0,10); 
   	                    }
   	                    return v;
   	                 }
	      		      
	      		      function setArrayCharge(attr){
	      	  	    	var arrayCharge = [];
	      	  	    	if(attr !=null){
	      	  	    		for(var i=0;i<attr.length;i++){
	      	      	    		if(attr[i]=="DAY"){
	      	      	    			arrayCharge.push({name:"按天",value:"DAY"});
	      	      	    		}else if(attr[i]=="MONTH"){
	      	      	    			arrayCharge.push({name:"按月",value:"MONTH"});
	      	      	    		}else if(attr[i]=="QUARTER"){
	      	      	    			arrayCharge.push({name:"按季度",value:"QUARTER"});
	      	      	    		}else if(attr[i]=="YEAR"){
	      	      	    			arrayCharge.push({name:"按年",value:"YEAR"});
	      	      	    		}
	      	      	    	}
	      	  	    	}
	      	  	    	return arrayCharge;
	      	  	    }
	      			  
	      			  /* var  inParamData = {"resourceType":"VM","orderItems":[
	      			                                                        {"instanceName":"d01","serviceUuid":"6d1dd0c2-7fcd-4e11-8f44-9a2e9cae58c0","isBill":"false","expireType":"2","expireValue":"3","billcycle":"DAY","fee":"1110元/天","metaData":"{\"resBaseInfo\":{\"volumeSize\":\"10\"}}","resourceType":"DISK","relateUuid":"99924abf-4b9e-4815-8c6c-d182061a3e07"},
	      			                                                        {"instanceName":"d02","serviceUuid":"ea312741-014f-4080-af58-6d0eb1c45cfc","isBill":"false","expireType":"2","expireValue":"3","billcycle":"MONTH","fee":"2000元/月","metaData":"{\"resBaseInfo\":{\"volumeSize\":\"20\"}}","resourceType":"DISK","relateUuid":"99924abf-4b9e-4815-8c6c-d182061a3e07"},
	      			                                                        {"instanceName":"xxx","serviceUuid":"8507c5d1-76c7-4e08-8a57-55e6b0375bc2","isBill":"false","expireType":"3","expireValue":"2016-08-09","billcycle":"DAY","fee":"52元/天","metaData":"{\"resBaseInfo\":{\"azUuid\":\"000eb1c8-ac92-4b39-96cc-b2dc19f2c4b7\",\"osType\":\"linux\",\"osVersion\":\"8c0b816e-3448-473a-854f-0c13315e0719\",\"memory\":\"8\",\"name\":\"xxx\",\"storage\":\"10\",\"vcpu\":\"8\",\"vdcUuid\":\"3b8a7d11-02e3-4e44-bb71-1e7f2fb36ecf\",\"vpcUuid\":\"d50125e6-9d32-4e02-941c-fbbf4688ee0f\",\"partitionList\":[{}],\"networkList\":[],\"ip\":\"10.10.10.10\",\"account\":\"a\",\"password\":\"b\",\"repeatPassword\":\"b\",\"sshIsMount\":\"NO\",\"busSysUuid\":\"ed81da58-e30d-4395-b089-857cf1890a44\"}}","desc":"tset","azUuid":"000eb1c8-ac92-4b39-96cc-b2dc19f2c4b7","resourceType":"VM","relateUuid":"99924abf-4b9e-4815-8c6c-d182061a3e07"}]}
	      	 */
	      			  //选择云硬盘服务
	      	          this.selectVdiskService = ko.observable(false);
	      	          this.table_Vdisk_VM = null;
	      	          var  diskEditObject;//用于临时存储磁盘对象
	      	          this.selectVdiskService_VM = function(object){
	      	        	  diskEditObject  = null;
	      	              self.table_Vdisk_VM = new DataTable([], {path: 'api/v5.0.0/service/getServiceList/DISK',perPage:6});
	      	              self.selectVdiskService(true);
	      	              diskEditObject = object;
	      	          } 
	      	          
	      	          this.submitVdiskService = function(){
	      	               console.log(diskEditObject)
	      	        	 diskEditObject.serviceName(self.table_Vdisk_VM.chosenItems().serviceName);
	      	        	 diskEditObject.serviceUuid(self.table_Vdisk_VM.chosenItems().serviceUuid);
	      	        	 diskEditObject.isBill(self.table_Vdisk_VM.chosenItems().isFee == "是" ?true:false);//其他地方时用的中文 
	      	              var attr;
	      	              if(self.table_Vdisk_VM.chosenItems().feeType !=null && self.table_Vdisk_VM.chosenItems().feeType!=""){
	      	              	attr=self.table_Vdisk_VM.chosenItems().feeType.split(",")
	      	              }
	      	              diskEditObject.billRuleList(setArrayCharge(attr)); 
	      	              self.selectVdiskService(false);
	      	          }
	      	          
	      			  
	      			  var vmOrderItems = [];
	      			  var diskOrderItems= [];
	      			  for(var i=0;i<orderData.orderItems.length;i++){
	      				  var orderItem = orderData.orderItems[i];
	      				  if(orderItem.resourceType == "VM"){
	      					  vmOrderItems.push(orderItem);
	      				  }else if(orderItem.resourceType == "DISK"){
	      					  diskOrderItems.push(orderItem);
	      				  }
	      			  }
	      			  
	      			  var vmOrderItemVO = vmOrderItems[0];
	      			  var serviceUuid=vmOrderItemVO.serviceUuid;
	      			  var metaData = JSON.parse(vmOrderItemVO.metaData);
	      			  var vmInParamData = JSON.parse(metaData.resBaseInfo);
	      	          var vdcUuid=vmInParamData.vdcUuid;
	      	          var azUuid=vmInParamData.azUuid;
	      	          var vpcUuid=vmInParamData.vpcUuid;
	      	          var osType=vmInParamData.osType;
	      	          
	      	          self.currentVO.fromJSON({
	      	        	    serviceUuid:serviceUuid
	                    });
	      	          
	      	          var callbackParam = {};
	                  callbackParam.vmOrderItemVO = vmOrderItemVO;
	                  callbackParam.self = self;
	      	          var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vdcUuid+"&azUuid="+azUuid+"&vpcUuid="+vpcUuid+"&osType="+osType;
	      	          csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result,textStatus,callbackParam){
	      	             csc.rest.get("api/v5.0.0/bussys?vdcuuid="+vdcUuid,function(result2,textStatus,callbackParam){
	      	                 csc.rest.get("api/v5.0.0/sshKeys?getList=true&azUuid="+azUuid+"&vcdUuid="+vdcUuid,function(result3,textStatus,callbackParam){
	      	                	 console.log("********************###################")
	      	                	 console.log(result)
	      	                	 console.log(result2)
	      	                	 console.log(result3)
	      	                	 console.log("********************###################")
	      	                	  
	      	                	var vmOrderItemVO = callbackParam.vmOrderItemVO;
	                      	    var self = callbackParam.self;
	      	                	 
	                      	    self.currentVO().bussyList(result2.results); 
	      	                    self.currentVO().sshList(result3);
	      	                    self.currentVO().vdcList(result.vdcList);
	      	                    self.currentVO().vpcList(result.vpcList);
	      	                    self.currentVO().privateNetworkList(result.networkList);
	      	                    self.currentVO().azList(result.azList);
	      	                    self.currentVO().osTypeList(result.osTypeList);
	      	                    self.currentVO().cpuList(result.cpuList);
	      	                    self.currentVO().memoryList(result.memoryList);
	      	                    self.currentVO().osVersionList(result.osVersionList);
	      	                    self.currentVO().billRuleList(setArrayCharge(result.chargeList));
	      	                    var networkUuid = "";//第一个网络ID 暂时只支持一个
	      	                    if(vmInParamData.networkList && vmInParamData.networkList.length > 0){
	      	                    	 networkUuid = vmInParamData.networkList[0].networkId;
	      	                    }
	      	                    
	      	                    if(networkUuid){ //查询网络下可用的IP
	      	                    	var callbackParam = {};
	      	                    	callbackParam.currentVO = self.currentVO;
	      	                    	callbackParam.ip = vmInParamData.ip;
		      	                    csc.rest.get("api/v5.0.0/vpcNetworks/"+networkUuid+"/availableIp", function(result,textStatus,callbackParam){
		      	                    	 var currentVO = callbackParam.currentVO;
		      	                    	 var ip = callbackParam.ip ;
		                        	     var ipList = [];
		                        	     if(result){
		                        	    	 for(var i=0;i<result.length;i++){
		                        	    		var objIp = result[i];
		                        	    		ipList.push(objIp.ip);
		                        	    	 }
		                        	     }
		                        	  currentVO().availableIpList(ipList);
		                        	  currentVO().ip(ip);
		                            },function(){},callbackParam); 
	      	                    }
	      	                    
	      	                    
	      	                    console.log(vmInParamData)
	      	                    console.log(vmOrderItemVO)
	      	                    self.currentVO.fromJSON(vmInParamData);
	      	                    var billCycle = vmOrderItemVO.billCycle;
	      	                    self.currentVO.fromJSON({
	      	                    	instanceName:vmOrderItemVO.instanceName,
	      	                    	expireType:vmOrderItemVO.expireType,
	      	                    	expireValue:vmOrderItemVO.expireValue,
	      	                    	fee:vmOrderItemVO.fee,
	      	                    	billCycle:vmOrderItemVO.billCycle,
	      	                    	networkUuid:networkUuid
	      	                    });
	      	                  console.log("self.currentVO.toJSON()---------",self.currentVO.toJSON())
	      	                   
	      	                    diskOrderItems.forEach(function(e){
	      	                    	var metaDataJson = JSON.parse(e.metaData);
	      	                    	var diskData = JSON.parse(metaDataJson.resBaseInfo);
	      	                    	csc.rest.get("api/v5.0.0/service/getServiceInfo/"+e.serviceUuid, function(serviceVO){
	      	                    		 csc.rest.get("api/v5.0.0/cart/getCartSelectList?serviceUuid="+e.serviceUuid, function(res){
	      	                    			console.log("---",serviceVO)
	      	                             	var vo=new MountDiskVO();
	      	                             	 vo.name(e.instanceName);
	      	                             	 vo.uuid(e.uuid);
	      	                                 vo.size(diskData.volumeSize);
	      	                                 vo.serviceUuid(e.serviceUuid);
	      	                                 vo.serviceName(serviceVO.name);
	      	                                 vo.billCycle(e.billCycle);
	      	                                 vo.billRuleList(setArrayCharge(res.chargeList));
	      	                                 vo.fee(e.fee);
	      	                                 vo.isBill(e.isBill);
	      	                                 vo.relateUuid(e.relateUuid);
	      	                                 self.currentVO().mountDisks.push(vo);
	      	                             });
	      	                    	})
	      	                    });
	      	                    
	      	                    var v= getExpireText(vmOrderItemVO.expireType,vmOrderItemVO.expireValue);
	      	                    self.currentVO().expireText(v);
	      	                   
	      	                    
	      	                 },function(){},callbackParam);                             
	      	             },function(){},callbackParam);
	      	         },function(){},callbackParam);
	      		  
	      	          
	      	        self.save = function(){
	      	        	debugger
		      		    var orderUuid = self.currentVO.toJSON().orderData.uuid;
		      		    var orderData =  self.currentVO.toJSON().orderData;
		      		    var vmOrderItems = [];
	        		    var diskOrderItems= [];
	        		    for(var i=0;i<orderData.orderItems.length;i++){
	        			  var orderItem = orderData.orderItems[i];
	        			  if(orderItem.resourceType == "VM"){
	        				  vmOrderItems.push(orderItem);
	        			  }else if(orderItem.resourceType == "DISK"){
	        				  diskOrderItems.push(orderItem);
	        			  }
	        		    }
	        		    
	        		    var relateUuid = "";//给磁盘的关联
	        		    var vmOrderItemVONew = [];
	        		    for(var j=0;j<vmOrderItems.length;j++){//现在只有一个
	        		    	var vmOrderItemVO = vmOrderItems[j];
	        		    	vmOrderItemVO.azUuid = self.currentVO().azUuid();
	        		    	vmOrderItemVO.billCycle = self.currentVO().billCycle();
	        		    	vmOrderItemVO.expireType = self.currentVO().expireType();
	        		    	vmOrderItemVO.expireValue = self.currentVO().expireValue();
	        		    	vmOrderItemVO.fee = self.currentVO().fee();
	        		    	vmOrderItemVO.instanceName = self.currentVO().instanceName();
	        		  	    var metaData = JSON.parse(vmOrderItemVO.metaData);
	        		   	    var metaDataResBaseInfo= JSON.parse(metaData.resBaseInfo);
	        		   	    metaDataResBaseInfo.networkList = [{networkId:self.currentVO().networkUuid()}];
	        		   	    metaDataResBaseInfo.azUuid = self.currentVO().azUuid();
		        		   	metaDataResBaseInfo.vdcUuid = self.currentVO().vdcUuid();
		        		   	metaDataResBaseInfo.vpcUuid = self.currentVO().vpcUuid();
	        		   	    metaDataResBaseInfo.osVersion = self.currentVO().osVersion();
		        		   	metaDataResBaseInfo.osType = self.currentVO().osType();
		        		 	metaDataResBaseInfo.account = self.currentVO().account();
		        		   	metaDataResBaseInfo.password = self.currentVO().password();
		        		 	metaDataResBaseInfo.repeatPassword = self.currentVO().repeatPassword();
		        		 	metaDataResBaseInfo.vcpu = self.currentVO().vcpu();
		        		   	metaDataResBaseInfo.memory = self.currentVO().memory();
		        		   	metaDataResBaseInfo.storage = self.currentVO().storage();
		        		 	metaDataResBaseInfo.ip = self.currentVO().ip();
		        		 	metaDataResBaseInfo.busSysUuid = self.currentVO().busSysUuid();
		        		   	metaDataResBaseInfo.sshUuid = self.currentVO().sshUuid();
		        			metaData.resBaseInfo =  metaDataResBaseInfo;
    		  		    	vmOrderItemVO.metaData =  JSON.stringify(metaData);
    		  		    	relateUuid = vmOrderItemVO.relateUuid;
    		  		    	vmOrderItemVONew.push(vmOrderItemVO);
	        		    } 
	        		    
	        		    
	        		    var diskOrderItemsNew = [];
	        		    var diskList = self.currentVO().mountDisks();
       		    	    for(var k=0;k<diskList.length;k++){
       		    	    	 var diskVO = diskList[k];
       		    	    	 var newDiskOrderItem = {};
       		    	    	newDiskOrderItem.billCycle = diskVO.billCycle();
       		    	    	newDiskOrderItem.expireType = self.currentVO().expireType();
       		    	    	newDiskOrderItem.expireValue = self.currentVO().expireValue();
       		    	    	newDiskOrderItem.fee = diskVO.fee();
       		    	    	newDiskOrderItem.instanceName = diskVO.name();
       		    	    	newDiskOrderItem.isBill =  diskVO.isBill(); 
       		    	    	newDiskOrderItem.itemState = "RESOURCE_APPLY";
       		    	    	newDiskOrderItem.orderUuid = orderUuid;
       		    	    	var metaData = {resBaseInfo:{}};
       		    	    	metaData.resBaseInfo.volumeSize = diskVO.size();
       		    	    	newDiskOrderItem.metaData = JSON.stringify(metaData)
       		    	    	newDiskOrderItem.relateUuid = diskVO.relateUuid();
       		    	    	newDiskOrderItem.resourceType ="DISK";
       		    	    	newDiskOrderItem.serviceUuid =diskVO.serviceUuid();
       		    	    	newDiskOrderItem.uuid =diskVO.uuid();
       		    	    	if(!newDiskOrderItem.relateUuid){
       		    	    		newDiskOrderItem.relateUuid = relateUuid;
       		    	    	}
       		    	    	diskOrderItemsNew.push(newDiskOrderItem);
       		    	    }
       		    	    
       		    	    orderData.orderItems = vmOrderItemVONew.concat(diskOrderItemsNew)
       		    	    
	        		    console.log(orderData)
		               	   csc.rest.put("api/v5.0.0/orders/"+orderUuid,orderData, function(data){
		               		   alert("保存成功！");
		               	   });
		     	   }
	      	          
	      			  
	      		   }
	      		  ko.applyBindings(new ViewModel(), $('#approveContent')[0]);
	      		 
	      	 });
	  });
	  

          // daterange             
          $('#vm_duration').val(moment().subtract('days', 29).format('YYYY/MM/DD') + ' 至 ' + moment().format('YYYY/MM/DD')).daterangepicker(
            {
              singleDatePicker:true,
              format:'YYYY/MM/DD',
              startDate: moment().subtract('days', 29),
              endDate: moment(),
              separator:'至',
              locale:{
                applyLabel: '确认',
                cancelLabel: '取消',
                fromLabel: '开始日期',
                toLabel: '结束日期',
                weekLabel: '周',
                customRangeLabel: '自定义范围',                            
                daysOfWeek:["日","一","二","三","四","五","六"],
                monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
              },
              ranges: {
               '当天': [moment(), moment()],
               '昨天': [moment().subtract('days', 1), moment().subtract('days', 1)],
               '近7天': [moment().subtract('days', 6), moment()],
               '近30天': [moment().subtract('days', 29), moment()],
               '当月': [moment().startOf('month'), moment().endOf('month')],
               '上月': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
              }
            }

          ); 
    
          $(".expand-btn").click(function(){
	          $(this).find('i').toggleClass("fa-angle-double-down");
	          $(this).parents('tr').next("tr").toggle();
          });
  })
</script>