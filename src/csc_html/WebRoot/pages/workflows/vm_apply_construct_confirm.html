   <div class="panel panel-info">
        <div class="panel-heading">申请信息</div>
        <div id="orderDetailedList" class="wrapper">
         <!--  <button class="btn btn-sm btn-primary pull-right" onclick="showModal('pages/workflows/handle_12.html')">重施工</button> -->
          <h5 class="text-info">云主机数：<span data-bind="text:currentVO().vmApplyList().length"></span></h5>
          <div class="table-responsive no-height" id="vm_apply_list">
            <table class="table">
                <thead>
                    <tr>
                        <th>云主机名称</th>
                        <th>所属VDC</th>
                        <th>可用分区</th>
                        <th>VPC名称</th>
                        <th>网络名称</th>
                        <th>IP地址</th>
                        <th>施工状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody  data-bind="foreach:currentVO().vmApplyList">
                    <tr>
                        <td><span data-bind="text: instanceName"></span></td>
                        <td><span data-bind="text: vdcName"></span></td>
                        <td><span data-bind="text: azName"></span></td>
                        <td><span data-bind="text: vpcName"></span></td>
                        <td><span data-bind="text: networkName"></span></td>
                        <td><span data-bind="text: ip"></span></td>
                        <td data-bind="html:itemStateHtml"></td>
                        <td>
                            <a class="expand-btn-detail">查看<i class="fa fa-angle-double-right"></i></a>
                            <span data-bind="visible: itemState() == 'CONSTRUCTION_FAILED'">
	                             |
	                            <a  data-bind="click:$root.reConstruct">重施工</a> | 
	                            <a data-bind="click:$root.vmErrorMsg">失败原因</a>
                            </span>
                        </td>
                    </tr>
                      <tr style="display: none">
                        <td colspan="11" class="no-padder">
                          <div class="b wrapper-sm">
                                    <h5>
										<i class="fa fa-minus fa-rotate-90 text-info"></i>基本信息
									</h5>
									<div class="bg-light b-t b-b wrapper-sm">
										<div class="row m-b">
											<div class="col-xs-1 font-bold">云主机名称：</div>
											<div class="col-xs-3">
												<span data-bind="text:instanceName"></span>
											</div>
											<div class="col-xs-1 font-bold">所属VDC：</div>
											<div class="col-xs-3">
												<span data-bind="text:vdcName"></span>
											</div>
											<div class="col-xs-1 font-bold">可用分区：</div>
											<div class="col-xs-3">
												<span data-bind="text:azName"></span>
											</div>
										</div>
										<div class="row m-b">
											<div class="col-xs-1 font-bold">操作系统类型：</div>
											<div class="col-xs-3">
												<span data-bind="text:osType"></span>
											</div>
											<div class="col-xs-1 font-bold">操作系统版本：</div>
											<div class="col-xs-3">
												<span data-bind="text:osVersionName"></span>
											</div>
											<div class="col-xs-1 font-bold">CPU(个)：</div>
											<div class="col-xs-3">
												<span data-bind="text:vcpu"></span>
											</div>
										</div>
										<div class="row m-b">
											<div class="col-xs-1 font-bold">内存(GB)：</div>
											<div class="col-xs-3">
												 <span data-bind="text:memory"></span>
											</div>
											<div class="col-xs-1 font-bold">存储(GB)：</div>
											<div class="col-xs-3">
												<span data-bind="text:storage"></span>
											</div>
											<div class="col-xs-1 font-bold">VPC/IP池：</div>
											<div class="col-xs-3">
												<span data-bind="text:vpcName"></span>
											</div>
										</div>
										<div class="row m-b">
											<div class="col-xs-1 font-bold">网络名称：</div>
											<div class="col-xs-3">
												<span data-bind="text:networkName"></span>
											</div>
											<div class="col-xs-1 font-bold">指定IP：</div>
											<div class="col-xs-3">
												<span  data-bind="text:ip"></span>
											</div>
											<div class="col-xs-1 font-bold">主机账号：</div>
											<div class="col-xs-3">
												<span data-bind="text:account"></span>
											</div>
										</div>
										<div class="row m-b">
											<div class="col-xs-1 font-bold">选择密钥：</div>
											<div class="col-xs-3">
												<span data-bind="text:sshKeyName"></span>
											</div>
											<div class="col-xs-1 font-bold">申请时长：</div>
											<div class="col-xs-3">
												<span data-bind="text:expireText"></span>
											</div>
										</div>
										<div class="row m-b">
											<div class="col-xs-1 font-bold">套餐：</div>
											<div class="col-xs-3">
												<span data-bind="text:billCycleText"></span>
											</div>
											<div class="col-xs-1 font-bold">费用：</div>
											<div class="col-xs-3">
												<span  data-bind="text:fee"></span>
											</div>
										</div>
									</div>
									
									
									 	<h5><i class="fa fa-minus fa-rotate-90 text-info"></i>安装软件</h5>
				                        <div class="table-responsive no-height">
				                          <table class="table table-striped table-hover">
				                            <thead>
				                              <tr>
				                                <th>软件名称</th>
				                                <th>软件分类</th>
				                                <th>软件类型</th>
				                                <th>软件版本</th>
				                                <th>静默安装属性</th>
				                              </tr>
				                            </thead>
				                            <tbody>
				                              <tr>
				                                <td>oracle</td>
				                                <td>数据库</td>
				                                <td>oracle</td>
				                                <td>10g企业版</td>
				                                <td>
				                                  <a class="expand-btn-detail">查看 <i class="fa fa-angle-double-right"></i></a>
				                                </td>
				                              </tr>
				                              <tr style="display: none">
				                                  <td colspan="7" class="no-padder">
				                                    <div class="wrapper-sm sub-detail" style="display: none">
				                                      <h5 class="text-info">静默安装属性</h5>
				                                      <div class="bg-light b-t b-b wrapper-sm">
				                                        <div class="row m-b">
				                                          <div class="col-xs-1">参数名称：</div>
				                                          <div class="col-xs-3">15137</div>
				                                          <div class="col-xs-1">参数代码：</div>
				                                          <div class="col-xs-3">abc</div>
				                                          <div class="col-xs-1">默认值：</div>
				                                          <div class="col-xs-3">000</div>
				                                        </div>
				                                      </div>                                      
				                                    </div>                    
				                                  </td>
				                              </tr>                
				                            </tbody>
				                          </table>            
				                        </div>          
				
				                     <!--    <h5><i class="fa fa-minus fa-rotate-90 text-info"></i>系统盘分区</h5>
				                        <table class="table table-striped table-hover">
				                          <thead>
				                            <tr>
				                              <th>分区名称</th>
				                              <th>分区大小</th>
				                            </tr>
				                          </thead>
				                          <tbody>
				                            <tr>
				                              <td>NFS</td>
				                              <td>100G</td>
				                            </tr>
				                          </tbody>
				                        </table>  -->
				
				                        <h5><i class="fa fa-minus fa-rotate-90 text-info"></i>高级选项</h5>
				                        <div class="bg-light b-t b-b wrapper-sm">
				                          <div class="row m-b">
				                            <div class="col-xs-1">所属业务系统：</div>
				                            <div class="col-xs-3"><span data-bind="text:busSysName"></span></div>
				                            <div class="col-xs-1">备注：</div>
				                            <div class="col-xs-7"></div>
				                          </div>
				                        </div> 
                          </div>
                        </td>
                      </tr>                    
                </tbody>
            </table>          
          </div>



          <h5 class="text-info">云硬盘数：<span data-bind="text:currentVO().diskApplyList().length"></span></h5>
          <div class="table-responsive no-height">
            <table class="table">
                <thead>
                    <tr>
                        <th>云硬盘名称</th>
                        <th>所属VDC</th>
                        <th>挂载云主机</th>
                        <th>存储大小（G）</th>
                        <th>收费标准</th>
                        <th>可用分区</th>
                        <th>施工状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                
                  <tbody data-bind="foreach:currentVO().diskApplyList">
                    <tr>
                        <td><span data-bind="text: instanceName"></span></td>
                        <td><span data-bind="text: vdcName"></span></td>
                        <td><span data-bind="text: vmName"></span></td>
                        <td><span data-bind="text: volumeSize"></span></td>
                        <td><span data-bind="text: fee"></span></td>
                        <td><span data-bind="text: azName"></span></td>
                        <td data-bind="html:itemStateHtml"></td>
                        <td>
                            <span data-bind="visible: itemState() == 'CONSTRUCTION_FAILED'">
	                             |
	                            <a data-bind="click:$root.reConstruct" >重施工</a> | 
	                            <a data-bind="click:$root.vmErrorMsg">失败原因</a>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
          </div>
   </div>
   </div>
   <!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null, null]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
	 csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
	   	     var processInstanceId = data.taskInfo[0].processInstanceId;
	   	     //获取订单数据
	      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(orderData){
	      		 console.log(orderData)
	      		 function ViewModel(){
		      		 var self = this;
		      	      this.currentVO = ko.validatedObservable({
		      	    	     vmApplyList : ko.observableArray([]),
		      	             diskApplyList : ko.observableArray([]),
		      	             orderData: ko.observable(orderData)
		      	      });
		      	    
		      	      function getServiceRelationInfo(callback,serviceUuid,vmInParamData,callbackCustParam){//获取服务关联的信息
		      	    	  var uri="serviceUuid="+serviceUuid+"&vdcUuid="+vmInParamData.vdcUuid+"&azUuid="+vmInParamData.azUuid+"&vpcUuid="+vmInParamData.vpcUuid+"&osType="+vmInParamData.osType;
		                    csc.rest.get("api/v5.0.0/cart/getCartSelectList?"+uri, function(result,textStatus,callbackCustParam){
		                     csc.rest.get("api/v5.0.0/bussys?vdcuuid="+vmInParamData.vdcUuid,function(result2,textStatus,callbackCustParam){
		                         csc.rest.get("api/v5.0.0/sshKeys?getList=true&azUuid="+vmInParamData.azUuid+"&vcdUuid="+vmInParamData.vdcUuid+"&userUuid=",function(result3,textStatus,callbackCustParam){
		                        	 callback(result,result2,result3,callbackCustParam);
		                         },function(){},callbackCustParam);
		                     },function(){},callbackCustParam);
		                   },function(){},callbackCustParam);
		      	      }
		      	      
		      	      
		      		  var vmOrderItems = [];
		      		  var diskOrderItems= [];
		      		  for(var i=0;i<orderData.orderItems.length;i++){
		      			  var orderItem = orderData.orderItems[i];
		      			  if(orderItem.resourceType == "VM"){
		      				vmOrderItems.push(orderItem);
		      				var serviceUuid=orderItem.serviceUuid;
		 	      		    var metaData = JSON.parse(orderItem.metaData);
		 	      		    var vmInParamData = JSON.parse(metaData.resBaseInfo);
		 	                var networks = vmInParamData.networkList;
		 	                var selelctNetworkUuid = networks[0]?networks[0].networkId:"";
		 	           	    var vmInfo = new VmInfo();
		 	                var callbackCustParam = vmInfo;
		 	                getServiceRelationInfo(function(result,result2,result3,callbackCustParam){
		 	                	  var vmInfo = callbackCustParam;
		                          vmInfo.sshList(result3.results);
		 	                	  vmInfo.bussyList(result2.results); 
		                          vmInfo.vdcList(result.vdcList);
		                          vmInfo.vpcList(result.vpcList);
		                          vmInfo.privateNetworkList(result.networkList);
		                          vmInfo.azList(result.azList);
		                          vmInfo.osTypeList(result.osTypeList);
		                          vmInfo.cpuList(result.cpuList);
		                          vmInfo.memoryList(result.memoryList);
		                          var osVersionList = result.osVersionList;
		                          vmInfo.osVersionList(result.osVersionList);
		                          
		 	                },serviceUuid,vmInParamData,callbackCustParam);
		 	                
		 	                vmInfo.selectIp = vmInParamData.ip;//用于查询网络有效ip的回调取值
		 	                csc.rest.get("api/v5.0.0/vpcNetworks/"+selelctNetworkUuid+"/availableIp", function(result,textStatus,vmInfo){
                        	     var ipList = [];
                        	     if(result){
                        	    	 for(var i=0;i<result.length;i++){
                        	    		var objIp = result[i];
                        	    		ipList.push(objIp.ip);
                        	    	 }
                        	     }
                        	     vmInfo.availableIpList(ipList);
                        	     vmInfo.ip(vmInfo.selectIp);
                             },function(){},vmInfo); 
		 	                
		 	                vmInfo.uuid(orderItem.uuid);
		 	                vmInfo.orderUuid(orderItem.orderUuid);
		      				vmInfo.serviceUuid(orderItem.serviceUuid);
		      				vmInfo.instanceName(orderItem.instanceName);
		      				vmInfo.vdcUuid(vmInParamData.vdcUuid);
		      				vmInfo.azUuid(vmInParamData.azUuid);
		      				vmInfo.vpcUuid(vmInParamData.vpcUuid);
		      				vmInfo.osType(vmInParamData.osType);
		      				vmInfo.osVersion(vmInParamData.osVersion);
		      				vmInfo.vcpu(vmInParamData.vcpu);
		      				vmInfo.memory(vmInParamData.memory);
		      				vmInfo.storage(vmInParamData.storage);
		      				vmInfo.networkUuid(selelctNetworkUuid);
		      				vmInfo.ip(vmInParamData.ip);
		      				vmInfo.account(vmInParamData.account);
		      				vmInfo.password(vmInParamData.password);
		      				vmInfo.repeatPassword(vmInParamData.repeatPassword);
		      				vmInfo.sshKeyUuid(vmInParamData.sshUuid);
		      				if(vmInfo.sshKeyUuid()){
		      					 csc.rest.get('api/v5.0.0/sshKeys/'+vmInfo.sshKeyUuid(),function(data,textStatus,vmInfo){
		      						vmInfo.sshKeyName(data.name);
		    	    		    },function(){},vmInfo); 
		      					
		      				}
		      				vmInfo.billCycle(orderItem.billCycle);
		      				vmInfo.fee(orderItem.fee);
		      				vmInfo.expireType(orderItem.expireType);
		      				vmInfo.expireValue(orderItem.expireValue);
		      				var expireText = csc.util.getExpireText(orderItem.expireType,orderItem.expireValue);
		      				vmInfo.expireText(expireText);
		      				vmInfo.busSysUuid(vmInParamData.busSysUuid);
		      				vmInfo.relateUuid(orderItem.relateUuid);
		      				vmInfo.itemState(orderItem.itemState);
		      				vmInfo.workFailedMessage(orderItem.workFailedMessage);
		      				self.currentVO().vmApplyList.push(vmInfo);
		      			  }else if(orderItem.resourceType == "DISK"){
		      				  diskOrderItems.push(orderItem);
		      				  var serviceUuid=orderItem.serviceUuid;
		 	      		      var metaData = JSON.parse(orderItem.metaData);
		 	      		      var diskInParamData = JSON.parse(metaData.resBaseInfo);
		      				  var diskInfo = new DiskInfo();
		      				  diskInfo.orderUuid(orderItem.orderUuid);
		      				  diskInfo.serviceUuid(orderItem.serviceUuid);
		      				  diskInfo.instanceName(orderItem.instanceName);
		      				  diskInfo.vdcUuid(orderItem.vdcUuid);
		      				  diskInfo.azUuid(orderItem.azUuid);
		      				  diskInfo.vpcUuid(orderItem.vpcUuid);
		      				  diskInfo.volumeSize(diskInParamData.volumeSize);
		      				  diskInfo.billCycle(orderItem.billCycle);
		      				  diskInfo.fee(orderItem.fee);
		      				  diskInfo.itemState(orderItem.itemState); 
		      				  diskInfo.workFailedMessage(orderItem.workFailedMessage);
		      				  var callbackCustParam = diskInfo;
		      			 	  csc.rest.get("api/v5.0.0/service/getServiceInfo/"+serviceUuid, function(serviceVO,textStatus,callbackCustParam){
	                    	  csc.rest.get("api/v5.0.0/cart/getCartSelectList?serviceUuid="+serviceUuid, function(res,textStatus,callbackCustParam){
	                    		      var diskInfo = callbackCustParam;
	                    		     diskInfo.serviceName(serviceVO.name);
	                    	     },function(){},callbackCustParam);
		      			 	  },function(){},callbackCustParam);
		      				  
		      				  //diskInfo.expireType(diskInParamData.expireType); 从云主机获取
		      				  //diskInfo.expireValue(diskInParamData.expireValue);
		      				  diskInfo.relateUuid(orderItem.relateUuid);
		      				  //var expireText = csc.util.getExpireText(diskInParamData.expireType,diskInParamData.expireValue);
		      				 // diskInfo.expireText(expireText);
		      				  self.currentVO().diskApplyList.push(diskInfo);
		      			  }
		      		  }
		      		  
		      		  
		      		  self.reConstruct = function(data){
		      			  var orderUuid = data.orderUuid();
		      			  var uuid = data.uuid();
		      			  csc.rest.put("api/v5.0.0/orders/"+orderUuid+"/items/"+uuid+"/construction",function(data){
		      				console.log(data)  
		      			  });
		      		  }
		      		  
		      		  console.log("self.currentVO().diskApplyLis()-----------",self.currentVO().diskApplyList())
		      		 
		      		  var vmList = self.currentVO().vmApplyList();
		      		  var diskList = self.currentVO().diskApplyList();
		      	 
		      		  for(var j=0;j<vmList.length;j++){
		      			  var vmVO = vmList[j];
		          		  for(var i=0;i<diskList.length;i++){
		          			  var diskVo = diskList[i];
		          			  if(vmVO.relateUuid()  && vmVO.relateUuid() == diskVo.relateUuid()){
		          				  diskVo.expireText(vmVO.expireText())
	          				      diskVo.vdcName(vmVO.vdcName());//把虚拟机的值给磁盘 然后监听虚拟机的值
		          				  vmVO.vdcName.subscribe(function(val){
		          					   this.vdcName(val);
				    			   },diskVo);
		          				  diskVo.azName(vmVO.azName())
		          				  vmVO.azName.subscribe(function(val){
		          					    this.azName(val);
				    			   },diskVo);
		          				  diskVo.vmName(vmVO.instanceName());
		          				  vmVO.mountDiskList.push(diskVo);
		          			  }
		          		  }
		      		  }
		      		  
		      		  
		      		function DiskInfo(){
		      			this.uuid= ko.observable(""),
		      			this.orderUuid= ko.observable(""),
		      			this.serviceUuid= ko.observable(""),
		      			this.serviceName = ko.observable(""),
		      	        this.instanceName= ko.observable(""),
		      	        this.vmName= ko.observable(""),
		      	        this.vdcUuid= ko.observable(""),
		      	        this.vdcName=ko.observable(""),
		      	        this.azUuid=ko.observable(""),
		      	        this.azName=ko.observable(""),
		      	        this.vpcUuid=ko.observable(""),
		      	        this.vpcName=ko.observable(""),
		      	        this.volumeSize = ko.observable(""),
		      	        this.billCycle= ko.observable(""),
		      	        this.billCycleText = ko.pureComputed(function(){
		 	            	 return csc.util.getBillCycleText(this.billCycle);
		 	            }, this);
		      	        this.fee= ko.observable(""),
		      	        this.expireType=ko.observable(""),
		      	        this.expireValue=ko.observable(""),
		      	        this.expireText=ko.observable(""),
		      	        this.isBill=ko.observable(""),
		      	        this.relateUuid=ko.observable(""),
		      	        this.itemState = ko.observable(); 
			      	  	this.itemStateHtml =  ko.pureComputed(function(){
		 	            	 return getStateHtml(this.itemState());
		 	            }, this);
	        	    	this.workFailedMessage = ko.observable(); 
		      	   }
		      		
		      		 function getStateHtml(itemState){
	      			     var stateHtml = "";
                         if(itemState == "CONSTRUCTION_FAILED"){
                        	stateHtml="<span class=\"label label-danger\">施工失败</span>";
                         }else if(itemState == "CONSTRUCTION_SUCCESS"){
                        	stateHtml="<span class=\"label label-success\">施工成功</span>";
                         }else{
                        	stateHtml="<span class=\"label label-info\">施工中</span>";
                         }  
                         return stateHtml;
		      		 }
		      		
		      		  
		      		  function VmInfo(){
		      			this.uuid= ko.observable(""),
		      			this.orderUuid= ko.observable(""),
		      			this.serviceUuid= ko.observable(""),
		      	        this.instanceName= ko.observable(""),
		      	        this.vdcUuid= ko.observable(""),
		      	        this.vdcName=ko.observable(""),
		 	      	    this.vdcName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.vdcList(), {uuid: this.vdcUuid()});
		 	            	if(item!=null){
		 	            		return item.name;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.azUuid=ko.observable(""),
		      	        this.azName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.azList(), {uuid: this.azUuid()});
		 	            	if(item!=null){
		 	            		return item.name;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.vpcUuid=ko.observable(""),
		      	        this.vpcName=ko.observable(""),
		      	        this.vpcName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.vpcList(), {uuid: this.vpcUuid()});
		 	            	if(item!=null){
		 	            		return item.name;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.osType= ko.observable(""),
		      	        this.osVersion= ko.observable(""),
		      	        this.osVersionName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.osVersionList(), {uuid: this.osVersion()});
		 	            	if(item!=null){
		 	            		return item.opSysVersion;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.vcpu= ko.observable(""),
		      	        this.memory= ko.observable(""),
		      	        this.storage= ko.observable(""),
		      	        this.networkUuid= ko.observable(""),
		      	        this.networkName= ko.observable(""),
		      	        this.networkName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.privateNetworkList(), {uuid: this.networkUuid()});
		 	            	if(item!=null){
		 	            		return item.name;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.ip= ko.observable(""),
		      	        this.account= ko.observable(""),
		      	        this.password= ko.observable(""),
		      	        this.repeatPassword= ko.observable(""),
		      	        this.sshKeyUuid= ko.observable(""),
		      	        this.sshKeyName= ko.observable(""),
		      	        this.billCycle= ko.observable(""),
		 	      	    this.billCycleText = ko.pureComputed(function(){
		 	            	 return csc.util.getBillCycleText(this.billCycle);
		 	            }, this);
		      	        this.fee= ko.observable(""),
		      	        this.expireType=ko.observable(""),
		      	        this.expireValue=ko.observable(""),
		      	        this.expireText=ko.observable(""),
		      	        this.isBill=ko.observable(""),
		      	        this.busSysUuid=ko.observable(""),
		      	        this.busSysName = ko.pureComputed(function(){
		 	            	var item = _.findWhere(this.bussyList(), {uuid: this.busSysUuid()});
		 	            	if(item!=null){
		 	            		return item.name;
		 	            	}else{
		 	            		return "";
		 	            	}
		 	            }, this);
		      	        this.relateUuid=ko.observable(""),
		      	        this.itemState = ko.observable(); 
	        	    	this.itemStateHtml =  ko.pureComputed(function(){
		 	            	 return getStateHtml(this.itemState());
		 	            }, this);
	        	    	this.workFailedMessage = ko.observable(); 
		      	        this.mountDiskList =  ko.observableArray([]),
		      	        this.vdcList = ko.observableArray([]),
		 	      	    this.vpcList = ko.observableArray([]),
		 	      	    this.azList = ko.observableArray([]),
		 	      	    this.privateNetworkList = ko.observableArray([]),
		 	      	    this.osTypeList = ko.observableArray([]),
		 	      	    this.cpuList = ko.observableArray([]),
		 	      	    this.memoryList = ko.observableArray([]),
		 	      	    this.osVersionList = ko.observableArray([]),
		 	      	    this.sshList = ko.observableArray([]),
		      			this.bussyList = ko.observableArray([]),
		      			this.availableIpList = ko.observableArray([])
		      		  }
	      		  
	                  
	                  self.vmErrorMsg = function(data){
	                	    if(data.workFailedMessage()){
	                	    	 systemMsg.alert(data.workFailedMessage());
	                	    }else{
	                	    	 systemMsg.alert("未知异常！");
	                	    }
	                  }
	                  
	                  this.save = function(){
	  	           		saveComment(args.taskId,function(){
	  	           			alert("保存成功！");
	  	           		});
	  	    		  }
	  	    		  
	  	    		  this.next = function(){
	  	    			if(isLast){
	  	    			  saveComment(args.taskId,function(){
	  	    				var databody = {"userId":"","action":"designated"};
	  	    				csc.rest.put('api/v5.0.0/workflows/tasks/'+args.taskId,databody,function(data){
	  	    				  alert("审核成功！");
	  	    				  location.href = "#pages/workflows/tasks?type=work";
	  	    				},function(){alert("操作失败！")});
	  	    			  });
	  	    		  	}else{		  
	  	    			  showModal("pages/workflows/next.html");
	  	    		  	}
	  	    		  }
	                  
	        	   }
	      	 	  ko.applyBindings(new ViewModel(), $('#approveContent')[0]);
	       	 });
	   	     
	  }); 
 
	  $("#vm_apply_list").on("click",".expand-btn-detail",function(){
		  $(this).find('i').toggleClass("fa-angle-double-down");
	      $(this).parents('tr').next("tr").toggle();
	      $(this).parents('tr').next("tr").find('.sub-detail').toggle();
	  })

  });
</script>