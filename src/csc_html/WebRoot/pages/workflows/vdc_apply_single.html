<div class="panel panel-info applyModeShow">
    <div class="panel-heading">申请信息</div>
    <div id="orderDetailedList" class="wrapper">
        <div class="form-horizontal">
          <div class="form-group">
            <label class="col-xs-2 control-label">VDC名称：</label>
            <div class="col-xs-7">
              <input type="text" class="form-control col-xs-5" placeholder="请输入名称" data-bind="value: vdc().instanceName">
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-2 control-label">支持操作系统：</label>
              <div class="col-xs-7">
                <label class="checkbox-inline i-checks">
                  <input type="checkbox" value="option1" data-bind="checked: windows"><i></i> windows
                </label>
                <label class="checkbox-inline i-checks">
                  <input type="checkbox" value="option1" data-bind="checked: linux"><i></i> linux
                </label>
                <label class="checkbox-inline i-checks">
                  <input type="checkbox" value="option1" data-bind="checked: aix"><i></i> aix
                </label>
              </div>
          </div>
          <div class="form-group">
            <label class="col-xs-2 control-label">是否限制配额：</label>
            <div class="col-xs-7 form-inline">
              <div class="form-inline">
                <div class="radio">
                  <label>
                    <input type="radio" name="optionsRadiosi" id="optionsRadiosi1" value="yes" data-bind="checked: showItems"> 限制
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="optionsRadiosi" id="optionsRadiosi2" value="no" data-bind="checked: showItems"> 不限制
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group row" data-bind="visible: showItems()=='yes'">
            <div class="form-group">
                <label class="col-xs-2 control-label">CPU配额(个)：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: cpu">
                </div>
                <label class="col-xs-2 control-label">内存配额(GB)：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: memory">
                </div>
                <label class="col-xs-2 control-label">存储配额(GB)：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: storage">
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-2 control-label">云主机最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: vm">
                </div>
                <label class="col-xs-2 control-label">云硬盘最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: disk">
                </div>
                <label class="col-xs-2 control-label">对象存储最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: objectStorage">
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-2 control-label">VPC最大可创建数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: vpc">
                </div>
                <label class="col-xs-2 control-label">路由器最大可创建数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: router">
                </div>
                <label class="col-xs-2 control-label">防火墙最大可创建数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: firewall">
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-2 control-label">公网IP最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: publicIp">
                </div>
                <label class="col-xs-2 control-label">负载均衡器最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: loadBalance">
                </div>
                <label class="col-xs-2 control-label">SSH密钥最大申请数：</label>
                <div class="col-xs-1">
                  <input type="text" class="form-control" data-bind="value: secretKey">
                </div>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-2 control-label">备注：</label>
            <div class="col-xs-7">
              <textarea class="form-control" cols="30" rows="5" data-bind="value: desc"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label class="col-xs-2 control-label">申请时长：</label>
            <div class="col-xs-7">
              <div class="radio">
                <label class="form-inline">
                  <input type="radio" name="optionsRadios" id="optionsRadios1" value="1" data-bind="checked: expireType=='1'"> 永久
                </label>
              </div>
              <div class="radio">
                <label class="form-inline">
                  <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios2" value="2" data-bind="checked: expireType=='2'"> 
                <select class="form-control" data-bind="value: expireValue"><option value="1">1</option><option value="1">2</option></select> 个月
              </label>
            </div>
            <div class="radio">
              <label class="form-inline">
                <input type="radio" class="form-control" style="top:2px;" name="optionsRadios" id="optionsRadios3" value="3" data-bind="checked: expireType=='3'">
                <input type="text" style="width:206px" class="form-control applyDateFormat" id="applyServer_daterange" >
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div>
            <label class="col-xs-2 control-label">套餐：</label>
            <!-- <div class="col-xs-2">
              <select class="form-control">
                <option value="1">按天</option><option value="1">包月</option><option value="1">按季度</option><option value="1">包年</option>
              </select>
            </div> -->
            <span class="col-xs-3 control-label text-left" data-bind="text: fee"></span>
          </div>
        </div>
      
      </div>

  </div>
</div>


<!-- page specific plugin scripts -->
<script type="text/javascript">
	var scripts = [null, 'assets/lib/zTree/js/jquery.ztree.core.js',
               'assets/lib/zTree/js/jquery.ztree.excheck.js',
               "assets/lib/moment/moment.js",
               "assets/lib/bootstrap-daterangepicker/daterangepicker.js", null];
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
	function ViewModel(){
	  var self = this;
	  
	  this.order = ko.observable("");
  	  this.vdc = ko.observable("");
  	  this.resBaseInfo = ko.observable("");
  	  this.osType = ko.observable("");
  	  this.metaData = ko.observable("");
  	  this.vdcQuotaList = ko.observable("");
  	  this.expireType = ko.observable("");
  	  this.expireValue = ko.observable("");
  	
  	  this.windows = ko.observable("");
  	  this.linux = ko.observable("");
  	  this.aix = ko.observable("");
  	  
  	  this.cpu = ko.observable("");
  	  this.memory = ko.observable("");
  	  this.storage = ko.observable("");
	  this.vpc = ko.observable("");
	  this.vm = ko.observable("");
  	  this.disk = ko.observable("");
  	  this.publicIp = ko.observable("");
	  this.router = ko.observable("");
	  this.firewall = ko.observable("");
  	  this.secretKey = ko.observable("");
  	  this.objectStorage = ko.observable("");
	  this.loadBalance = ko.observable("");
  	  
  	  this.fee = ko.observable("");
  	  this.desc = ko.observable("");
  	  
  	  this.showItems = ko.observable('no');
	  csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
   	     var processInstanceId = data.taskInfo[0].processInstanceId;
		 //获取订单数据
      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+processInstanceId,function(data){
      		var orderData = data;
      		var itemListData = data.orderItems;
      		var metaData = JSON.parse(itemListData[0].metaData);
      		var resBaseInfo = JSON.parse(metaData.resBaseInfo);
      		var osType = metaData.osType;
      		var vdcQuotaList = resBaseInfo.vdcQuotaList;
      		self.order(orderData);
      		self.vdc(itemListData[0]);
      		self.metaData(metaData);
      		self.desc(itemListData[0].desc);
      		if(resBaseInfo.limitQuota=='true'){
      			self.showItems('yes');
      		}else{
      			self.showItems('no');
      		}
      		for(var i=0;i<vdcQuotaList.length;i++){
      			if(vdcQuotaList[i].type=='CPU'){
      				self.cpu(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='MEMORY'){
      				self.memory(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='STORAGE'){
      				self.storage(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='VPC'){
      				self.vpc(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='VM'){
      				self.vm(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='DISK'){
      				self.disk(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='PUBLICIP'){
      				self.publicIp(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='ROUTER'){
      				self.router(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='FIREWALL'){
      				self.firewall(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='SECRET_KEY'){
      				self.secretKey(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='OBJECT_STORAGE'){
      				self.objectStorage(vdcQuotaList[i].value);
      			}else if(vdcQuotaList[i].type=='LOAD_BALANCING'){
      				self.loadBalance(vdcQuotaList[i].value);
      			}
      		}
      		for(var i=0;i<osType.length;i++){
      			if(osType[i]=='windows'){
      				self.windows(true);
      			}else if(osType[i]=='linux'){
      				self.linux(true);
      			}else if(osType[i]=='aix'){
      				self.aix(true);
      			}
      		}
      		self.vdcQuotaList(vdcQuotaList);
      		self.expireType(itemListData[0].expireType);
      		self.expireValue(itemListData[0].expireValue);
      		$("input[name='optionsRadios'][value='"+itemListData[0].expireType+"']").attr("checked",true);
      		if(itemListData[0].expireType == '3'){
      			$("#applyServer_daterange").val(itemListData[0].expireValue);
      		}else{
      			$("#applyServer_daterange").val('');
      		}
      		self.fee(itemListData[0].fee);
      	 })
	  })
	  
	  this.save = function(){
        	if(args.state=='UNSUBMIT'){
        		var value = {};
				value.name=self.vdc().instanceName;
			    csc.rest.put('api/v5.0.0/vdcs/verifyNameExist',value,function(result){
			 		if(result.isExist==true){
						alert("VDC名称已存在！");
					}else{
						var metaData = self.metaData();
						var resBaseInfo = JSON.parse(metaData.resBaseInfo);
						var limitQuota = resBaseInfo.limitQuota;
						var vdcQuotaList = resBaseInfo.vdcQuotaList;
						
						var osType = [];
						if(self.windows()){
							osType.push('windows');
						}
						if(self.linux()){
							osType.push('linux');
						}
						if(self.aix()){
							osType.push('aix');
						}
						var limitQuota = '';
						var vdcQuotaList = [];
						if(self.showItems()=='yes'){
							limitQuota = 'true';
							vdcQuotaList.push({type:"CPU",value:self.cpu()});
							 vdcQuotaList.push({type:"MEMORY",value:self.memory()});
							 vdcQuotaList.push({type:"STORAGE",value:self.storage()});
							 vdcQuotaList.push({type:"VPC",value:self.vpc()});
							 vdcQuotaList.push({type:"VM",value:self.vm()});
							 vdcQuotaList.push({type:"DISK",value:self.disk()});
							 vdcQuotaList.push({type:"PUBLICIP",value:self.publicIp()});
							 vdcQuotaList.push({type:"ROUTER",value:self.router()});
							 vdcQuotaList.push({type:"FIREWALL",value:self.firewall()});
							 vdcQuotaList.push({type:"SECRET_KEY",value:self.secretKey()});
							 vdcQuotaList.push({type:"OBJECT_STORAGE",value:self.objectStorage()});
							 vdcQuotaList.push({type:"LOAD_BALANCING",value:self.loadBalance()});
						}else{
							limitQuota = 'false';
						}
						var expireValue;
						var expireType = $("input[name='optionsRadios']:checked").val();
						if(self.expireType()=="1"){
							expireValue = "";
						}else if(self.expireType()=="2"){
							expireValue = self.expireValue;
						}else{
							expireValue = $("#applyServer_daterange").val();
						}
						var desc = self.desc();
						
						var meta = {"instanceName":self.vdc().instanceName,"osType":osType,
								"resBaseInfo":{"limitQuota":limitQuota,"vdcQuotaList":vdcQuotaList}};
						meta = JSON.stringify(meta);
					    var itemResults = {"instanceName":self.vdc().instanceName,"expireType":expireType,"expireValue":expireValue,"metaData":meta,"desc":desc};
						csc.rest.put('api/v5.0.0/orders/'+self.order().uuid+'/modifyItem/'+self.vdc().uuid,itemResults,function(data){
			          		alert('保存成功！');
		  		    	});
					}
			    })
        	}else{
        		saveComment(args.taskId,function(){
        			alert("保存成功！");
        		});
        	}
		}
	  
    	$('.applyDateFormat').val(moment().format('YYYY/MM/DD')).daterangepicker(
	   	      {
	   	        format:'YYYY/MM/DD',
	   	        startDate: moment(),
	   	        singleDatePicker:true,
	   	        endDate: moment(),
	   	        separator:'至'
	   	      }
	   	    );		  
	}
	ko.applyBindings(new ViewModel(), $('#approveContent')[0]); 
	  
  });
  
</script>