<div class="bg-light lter b-b wrapper-sm">
	<ol class="breadcrumb">
		<li>当前位置：</li>
		<li><a href="#pages/vdcs/vpcs/index?type=0">VPC管理</a></li>
		<li class="active">VPC详情</li>
	</ol>
</div>

<div class='wrapper-md'>
	<div class="nav-tabs-alt bg-white-only b b-blue">
		<ul class="nav nav-tabs" role="tablist">
			<li class="active" role="presentation">
				<a aria-controls="VPC" data-toggle="tab" href="#baseInfo" role="tab">基本信息</a>
			</li>
			<li role="presentation" id="topoBox">
				<a aria-controls="router" data-toggle="tab" href="#topo" role="tab">网络拓扑图</a>
			</li>
		</ul>
		<div class="tab-content">
			<div class="tab-pane active" id="baseInfo" role="tabpanel">
				<div class="wrapper"><a class="btn btn-sm btn-default" href="#pages/vdcs/vpcs/index?type=0"><i class="fa fa-arrow-left"></i> 返回</a></div>
				<div class="wrapper">
	                <div class="bg-light b-t b-b wrapper-sm">
	                  <div class="row m-b">
	                    <div class="col-xs-1 font-bold text-nowrap">VPC名称：</div>
	                    <div class="col-xs-3" data-bind="text:vpcVO().name"></div>
	                    <div class="col-xs-1 font-bold text-nowrap">所属VDC：</div>
	                    <div class="col-xs-3" data-bind="text:vpcVO().vdcName"></div>
	                    <div class="col-xs-1 font-bold text-nowrap">可用分区：</div>
	                    <div class="col-xs-3" data-bind="text:vpcVO().azName"></div>
	                  </div>
	                  <div class="row m-b">
	                    <div class="col-xs-1 font-bold text-nowrap">外部网络：</div>
	                     <div class="col-xs-3" data-bind="text:vpcExtNetQuery().name">
	                     </div>
	                     <button class="btn btn-info btn-sm" data-bind="click:addVpcExtNet,visible: shouldShowAddExt">添加</button>
	                     <button class="btn btn-info btn-sm" data-bind="click:removeVpcExtNet,visible: shouldShowRemoveExt">移除</button>
	                  </div>
	                 </div>
				</div>
				
				<div class="wrapper">
					<h5 class="text-black"><i class="fa fa-minus fa-rotate-90 text-info"></i>私有网络</h5>
					<div class="row m-t m-b-sm">
						<div class="col-xs-8">
							<button class="btn btn-info btn-sm"  data-bind="click:createVpcNet" >创建</button>
						</div>
						<div class="col-xs-3">          
	                        <div class="input-group">
	                          <span class="input-group-addon">名称</span>
	                          <input type="text" class="input-sm form-control" placeholder="请输入名称" data-bind="value: searchVpcNetParam().name">
	                        </div>
	                    </div>
	                    <div class="col-xs-1">
	                        <button class="btn btn-sm btn-default" type="button" data-bind="click:searchVpcNet">搜索</button>
	                    </div>
					</div>	
					<table class="table table-striped"  data-bind="with: netListTable">
						<thead>
							<tr>
								<th>子网名称</th>
								<th>网络类型</th>
								<th>网段</th>
								<th>IP总数</th>
								<th>创建时间</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
						   	<tr data-bind="visible: showNoData">
							            <td colspan=6 class="aligncenter">
							              This table has no data.
							            </td>
							</tr>
						    <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
							<tr>
								<td data-bind="text: $row.name"></td>
								<td data-bind="text: $row.name"></td>
								<td data-bind="text: $row.cidr"></td>
								<td data-bind="text: $row.ipTotal"></td>
								<td data-bind="text: $row.createTime"></td>
								<td>
									 <a data-bind="click:$root.delVpcNet">删除</a>
								</td>
							</tr>
							<!-- /ko -->
						</tbody>
					</table>
					 <footer class="panel-footer" data-bind="with: netListTable, visible: netListTable.pages() > 1">
					     <ul class="pagination">
					       <li data-bind="css: leftPagerClass, click: gotoPage(1)">
					         <a href="#">首页</a>
					       </li>
					       <li data-bind="css: leftPagerClass, click: prevPage">
					         <a href="#">&laquo;</a>
					       </li>
					       <li >
					         <a href="#"  data-bind="text: currentPage"></a>
					       </li>
					       <li data-bind="css: rightPagerClass, click: nextPage">
					         <a href="#">&raquo;</a>
					       </li>
					       <li data-bind="css: rightPagerClass, click: gotoPage(pages())">
					         <a href="#">末页</a>
					       </li>
					       <li class="page-control-li">
					         <div class="input-group form-group-sm">
					           <input type="text" class="form-control" data-bind="value: targetPage"  />
					           <div class="input-group-btn">
					             <a href="#" class="btn btn-sm btn-default" data-bind="click: gotoTargetPage()">跳转</a>
					           </div>
					         </div>
					         <div class="page-info-div" data-bind="text: recordsText"></div>
					       </li>
					     </ul>
				   </footer>		
				</div>
			<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: addVpcExtNetModal }">
			  <div class='modal-dialog modal-lg' role='document'>
			    <div class='modal-content'>
			      <div class='modal-header'>
			        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>添加子网</h3>
			      </div>
			      <div class='modal-body form-horizontal'>
			        <div class="form-group string required">
			          <span>网络名称：</span>
			          <select class="form-control" style="display:inline-block;width:150px"  data-bind="options:vpcExtNetList,optionsText:'netWorkName',optionsValue:'netWorkUuid',value:vpcExtNetVO().vpcExtNetUuid"  id="netSelect">
			          </select>
			        </div>
			        </div>
			      <div class='modal-footer'>
			        <input type="button" name="commit" value="确定" data-bind="click:confirmAddVpcExtNet" class="btn btn-default btn-info" />
			        <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
			      </div>
			    </div>
			  </div>
			</div>
				 
		   <div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: createVpcNetModal }">
			 <div class='modal-dialog' role='document' >
			    <div class='modal-content'>
			      <div class='modal-header'>
			        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>创建网络</h3>
			      </div>
			      <div class='modal-body form-horizontal'>
			        <div class="form-group">
			          <label class="col-xs-3 control-label">网络名称</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text"  data-bind="value: vpcNetVO().name"/>
			          </div>
			          <div class="col-xs-4">
			            <span class="text-danger inline m-l-n m-t-sm">*</span>
			          </div>          
			        </div>
			        <div class="form-group">
			          <label class="col-xs-3 control-label">网段</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text" data-bind="value: vpcNetVO().cidr,valueUpdate: 'afterkeydown'"/>
			          </div>
			          <div class="col-xs-4">
			            <span class="text-danger inline m-l-n m-t-sm">*</span> 格式如：192.168.1.0/24
			          </div>          
			        </div> 
			        <div class="form-group">
			          <label class="col-xs-3 control-label">子网掩码</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text" data-bind="value: vpcNetVO().mask,enable:false"/>
			          </div>
			        </div> 
			        <div class="form-group form-inline">
			          <label class="col-xs-3 control-label">可用IP段 </label>
			          <div class="col-xs-9 ">
			            <div>
			              <a data-bind="click: addNetPoolsItem">添加</a>
			            </div>      
			           </div>
			          <div class="col-xs-9 " data-bind="foreach: vpcNetVO().netPools">
			            <div>
			              <input class="form-control" style="width:140px" type="text"  data-bind="value:start" /> ~ <input class="form-control" style="width:140px" type="text" data-bind="value:end" /> 
			              <a data-bind="click: $root.removeNetPoolsItem">删除</a>
			            </div>
			          </div>       
			        </div>   
			        <div class="form-group">
			          <label class="col-xs-3 control-label">网关</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text" data-bind="value: vpcNetVO().gateway"/>
			          </div>
			          <div class="col-xs-4">
			            <span class="text-danger inline m-l-n m-t-sm">*</span>
			          </div>         
			        </div>
			        <div class="form-group">
			          <label class="col-xs-3 control-label">主DNS</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text" data-bind="value: vpcNetVO().masterDns"/>
			          </div>
			        </div>
			        <div class="form-group">
			          <label class="col-xs-3 control-label">备DNS</label>
			          <div class="col-xs-5">
			            <input class="form-control" type="text" data-bind="value: vpcNetVO().slaverDns"/>
			          </div>
			        </div>  
			      </div>
			      <div class='modal-footer'>
			        <input type="button" name="commit" value="确定" data-bind="click: vpcNetSubmit" class="btn btn-default btn-info" />
			        <button name="button" type="submit" class="btn btn-default btn btn-default" data-dismiss="modal">取消</button>
			      </div>
			    </div>
			  </div>
			</div>
		   </div>
			
			
			
			<div class="tab-pane" id="topo" role="tabpanel">
				<div class="row">
					<div class="col-xs-9" style="padding-top:15px;">
						<div class="col-md-2" style="position:relative;">
							<div class="panel panel-default">
							   <div class="panel-body">
							       <div class="thumbnail">
								      <div class="img" ><img src="assets/img/topo/images/network.png"  class="network"></div>
								      <div class="caption">网络</div>
								    </div>
								    <div class="thumbnail">
								      <div class="img" ><img src="assets/img/topo/images/Router.png" class="Router"></div>
								      <div class="caption">路由器</div>
								    </div>
								    <div class="thumbnail">
								      <div class="img" ><img src="assets/img/topo/images/ICF.png" class="ICF"></div>
								      <div class="caption">防火墙</div>
								    </div>
								    <div class="thumbnail">
								      <div class="img" ><img src="assets/img/topo/images/cloudHost.png" class="cloudHost"></div>
								      <div class="caption">云主机</div>
								    </div>
								    <div class="thumbnail">
								      <div class="img" ><img src="assets/img/topo/images/loadBalance.png" class="loadBalance"></div>
								      <div class="caption">负载均衡</div>
								    </div>
							      </div>
							   </div>
							 
							</div>
						<div class="col-md-10">
							<canvas id="canvas1" width=810 height=550></canvas>
						</div>
					</div>
					<!-- network Router  ICF cloudHost loadBalance -->
					<div class="col-xs-3 form-horizontal" style="padding-right:30px;padding-top:15px;">
						<div class="panel panel-default networkInfo">
							<div class="panel-heading">网络配置</div>
							<div class="panel-body">
							
								<div class="form-group">
									<label  class="col-xs-4 control-label">网络名称：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">网段：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">子网俺码：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">可用IP段：</label>
									<div class="col-xs-7">
										<button type="button" class="btn btn-link">添加</button>
									</div>
									<div class="col-xs-1">
							            <span class="text-default inline m-l-n m-t-sm"></span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label"> </label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
										
							           <button type="button" class="btn btn-link inline m-l-n text-danger">X</button>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">网关：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">主DNS：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">备DNS：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
							</div>
						</div>


						<div class="panel panel-default RouterInfo">
							<div class="panel-heading">路由器配置</div>
							<div class="panel-body">
								<div class="form-group">
									<label  class="col-xs-4 control-label">路由器名称：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">路由器地址：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
							</div>
						</div>

						<div class="panel panel-default RouterInfo">
							<div class="panel-heading">路由器配置</div>
							<div class="panel-body">
								<div class="form-group">
									<label  class="col-xs-4 control-label">路由器名称：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">网络名称：</label>
									<div class="col-xs-7">
										<select class="form-control">
											<option>网络1</option>
											<option>网络2</option>
										</select>
									</div>
								</div>
							</div>
						</div>

						<div class="panel panel-default ICFInfo">
							<div class="panel-heading">防火墙配置</div>
							<div class="panel-body">
								<div class="form-group">
									<label  class="col-xs-4 control-label">配置方式：</label>
									<div class="col-xs-7">
										<select class="form-control">
											<option>网络1</option>
											<option>网络2</option>
										</select>
									</div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">防火墙名称：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">路由器：</label>
									<div class="col-xs-7">
										<select class="form-control">
											<option>路由器1</option>
											<option>路由器2</option>
										</select>
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">规则：</label>
									<div class="col-xs-7">
										<a class="btn btn-link" onclick="showModal('pages/vpcs/topo_firewall.html')">查看</a>
									</div>
								</div>
							</div>
						</div>

						<div class="panel panel-default ICFInfo">
							<div class="panel-heading">防火墙配置</div>
							<div class="panel-body">
								<div class="form-group">
									<label  class="col-xs-4 control-label">配置方式：</label>
									<div class="col-xs-7">
										<select class="form-control">
											<option>网络1</option>
											<option>网络2</option>
										</select>
									</div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">防火墙名称：</label>
									<div class="col-xs-7">
										<input type="text" class="form-control">
									</div>
									<div class="col-xs-1">
							            <span class="text-danger inline m-l-n m-t-sm">*</span>
							        </div>
								</div>
								<div class="form-group">
									<label  class="col-xs-4 control-label">规则：</label>
									<div class="col-xs-7">
										<a class="btn btn-link" onclick="showModal('pages/vpcs/topo_firewall.html')">查看</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- page specific plugin scripts -->
<script type="text/javascript">
	var scripts = [null,'assets/js/jtopo.js', "api/vpc/vpc.js", "api/vdc/vdc.js"]
	$('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
		//创建topo
			var isData=true;
			var canvas = document.getElementById('canvas1');			
			var stage = new JTopo.Stage(canvas);
			var scene = new JTopo.Scene(stage);
			scene.backgroundColor='255,255,255';
			stage.add(scene);

		//创建固定节点
			
			addNode("Internet",false,10,200)

		//创建固定分隔线
			function circlenode(a1,a2){
				 circleNode = new JTopo.CircleNode("");
			            circleNode.radius = 10; // 半径
			            circleNode.alpha = 0;
			            circleNode.fillColor = '255, 255, 255'; // 填充颜色
			            circleNode.setLocation(a1, a2);
			            circleNode.textPosition = 'Middle_Center'; // 文本位置
			            circleNode.dragable=false;
						circleNode.visible=false;
			            scene.add(circleNode);
			            return circleNode;
			}

			var circ1=circlenode(60,60);
			var circ2=circlenode(60,440);
			
			var linkcustom = new JTopo.Link(circ1, circ2, "");
			linkcustom.strokeColor = '165,165,165';
			linkcustom.dashedPattern = 3;
			linkcustom.lineWidth = 2; // 线宽
			linkcustom.dragable=false;
			linkcustom.editAble=false;
			scene.add(linkcustom);

		//模拟数据  network Router  ICF cloudHost loadBalance
		data=["network", "Router","ICF","cloudHost","loadBalance","network","network","network","network"];

		//根据数据生成topo
		function addNode(str,dragable,x,y){
			var node = new JTopo.Node(str);							
			node.setLocation(x, y);
			node.setImage( "assets/img/topo/images/"+str+".png", false);
			node.width=48;
			node.height=48;
			node.fontColor="0,0,0";
			node.dragable=dragable;
			node.editAble=false;
			scene.add(node);
		}
		if(isData){
			var ICFNum=0,routerNum=0,networkNum=0,loadBalanceNum=0,cloudHostNum=0;
			for (var i = 0; i <data.length; i++) {
				
				switch(data[i]){
						case "ICF":
							var x=175
							if(ICFNum==0){
								var y=15;
							}else{
								var y=15+ICFNum*60
							}
							addNode(data[i],true,x,y);
							ICFNum++;
							break;
						case "Router":
						    var x=305
						    if(routerNum==0){
								var y=15;
							}else{
								var y=15+routerNum*60
							}
							addNode(data[i],true,x,y);
						    routerNum++;
						    break;
						case "network":
							var x=435
							if(networkNum==0){
								var y=15;
							}else{
								var y=15+networkNum*60;
							}
							addNode(data[i],true,x,y);
							networkNum++;
							break;
						case "loadBalance":
							var x=565
							if(loadBalanceNum==0){
								var y=15;
							}else{
								var y=15+loadBalanceNum*60
							}
							addNode(data[i],true,x,y);
							loadBalanceNum++;
							break;
						case "cloudHost":
							var x=690;
							if(cloudHostNum==0){
								var y=15;
							}else{
								var y=15+cloudHostNum*60
							}
							addNode(data[i],true,x,y);
							cloudHostNum++;
							break;
					}
			};


		}
		//画线
		
		var getDisp=scene.getDisplayedElements(),router=[],network=[],loadBalance=[];
		for (var i = 0; i < getDisp.length; i++) {
			if(getDisp[i].elementType=="node" && getDisp[i].alpha!=0){
			//	var image=$(getDisp[i].image).attr("src");
				var imageName=getDisp[i].text;
				if(imageName=="Router"){
					router.push(getDisp[i])
				}else if(imageName=="network"){
					network.push(getDisp[i])
				}else if(imageName=="loadBalance"){
					loadBalance.push(getDisp[i])
				}
			}

		};
		for (var j =0; j < router.length; j++) {
			for(var k=0; k<network.length; k++){
	                var link = new JTopo.Link(router[j], network[k]);
	               // link.text = 'L'+i;
	                link.lineWidth = 3; // 线宽
	                link.bundleGap = 30; // 线条之间的间隔
	                link.textOffsetY = 3; // 文本偏移量（向下3个像素）
	                link.strokeColor = JTopo.util.randomColor(); // 线条颜色随机
	                link.type = 'loop'; // 自定义属性
	                scene.add(link);
	            }
        };
        for (var j =0; j < loadBalance.length; j++) {
			for(var k=0; k<network.length; k++){
	                var link = new JTopo.Link(loadBalance[j], network[k]);
	               // link.text = 'L'+k;
	                link.lineWidth = 3; // 线宽
	                link.bundleGap = 30; // 线条之间的间隔
	                link.textOffsetY = 3; // 文本偏移量（向下3个像素）
	                link.strokeColor = JTopo.util.randomColor(); // 线条颜色随机
	                link.type = 'loop'; // 自定义属性
	                scene.add(link);
	            }
        };
		//拖拽生成画布节点

		var isDrag = false;
		function isIE(){
		  if(navigator.userAgent.indexOf("MSIE")>0){return true;}
		  else{return false;}
		}
		function addListener(element,e,fn){
		  if(isIE()){element.attachEvent("on" + e,fn);}
		 else{element.addEventListener(e,fn,false);}
		}
		function drag(e){
		 var e = e || window.event;
		 var element = e.srcElement || e.target;
		 if(e.preventDefault)e.preventDefault();
		 else e.returnvalue=false;
		 isDrag = true;
		 var relLeft = e.clientX - parseInt(element.style.left);
		 var relTop = e.clientY - parseInt(element.style.top);
		 element.onmouseup = function(){ isDrag = false; }
		 document.onmousemove = function(e_move){
		   var e_move = e_move || window.event;
		   if(isDrag){
		     element.style.left=e_move.clientX - relLeft + "px";
		     element.style.top=e_move.clientY - relTop + "px";
		     return false;
		   }
		 }
		}

		
		$("#topoBox").click(function(){
			var timeTemp=setInterval(function(){
				var thumbnail=$(".thumbnail").position();
				if(thumbnail.left>0){
					var dragE=$(".thumbnail").find("img");
					dragE.each(function(){
						var position=$(this).position();
						if($(this).css("position")!="absolute"){
							$(this).css({"position":"absolute","left":position.left+15,"top":position.top+5,"z-index":10});
						}
						addListener($(this).get(0),"mousedown",drag);
					})
					dragE.click(function(e){
						if ("static"==$(this).css("position")){
								var position=$(this).position();
								var left=position.left+15;
								var top=position.top+5;
								
								$(this).css({"position":"absolute","left":left,"top":top,"z-index":10});
								addListener($(this).get(0),"mousedown",drag);
							}

					 })
					dragE.mouseup(function(e){
						$(this).css({"position":"static"});
						var thisClass=$(this).attr("class")
						var xx=e.pageX;
						var yy=e.pageY;
						var canvasxy=$("#canvas1").offset();
						var px=xx-canvasxy.left;
						var y=yy-canvasxy.top;
						var attrsrc=$(this).attr("src");
						var text=$(this).parent().siblings(".caption").text();
						
						switch(thisClass){
							case "ICF":
								var x=100+ 130* Math.random();
								break;
							case "Router":
							    var x=230+ 130* Math.random();
							    break;
							case "network":
								var x=360+ 130* Math.random();
								break;
							case "loadBalance":
								var x=490+ 130* Math.random();
								break;
							case "cloudHost":
								var x=620 + 130* Math.random();
								break;

						}
						if(px>10){console.log(text);
							var node = new JTopo.Node(text);							
							node.setLocation(x, y);
							node.setImage(attrsrc, false);
							node.fontColor="0,0,0";
							node.width=48;
							node.height=48;
							scene.add(node);
							node.addEventListener('mouseup', function(event){
				                currentNode = this;
				            });
						}
						

					})
					clearInterval(timeTemp);
				}

			},50)
		})
		//选中节点显示属性
		scene.click(function(){
			if(scene.selectedElements.length>0){console.log(scene.selectedElements[0])
				var image=$(scene.selectedElements[0].image).attr("src");
				var imageName=image.slice(image.lastIndexOf('/')+1,image.lastIndexOf('.'));
				switch(imageName){
							case "ICF":
								$(".ICFInfo").show();
								$(".RouterInfo,.networkInfo,.loadBalanceInfo,.cloudHostInfo").hide();
								break;
							case "Router":
							    $(".RouterInfo").show();
							    $(".ICFInfo,.networkInfo,.loadBalanceInfo,.cloudHostInfo").hide();
							    break;
							case "network":
								 $(".networkInfo").show();
								 $(".ICFInfo,.RouterInfo,.loadBalanceInfo,.cloudHostInfo").hide();
								break;
							case "loadBalance":
								 $(".loadBalanceInfo").show();
								 $(".ICFInfo,.RouterInfo,.networkInfo,.cloudHostInfo").hide();
								break;
							case "cloudHost":
								 $(".cloudHostInfo").show();
								 $(".ICFInfo,.RouterInfo,.networkInfo,.loadBalanceInfo").hide();
								break;

						}
			}
			
		})
		

		var vpcUuid = args.vpcUuid;
		$.VPC.getVpcs({uuid:vpcUuid},function(data){console.log(data);
			  if(data.results && data.results.length > 0){
				    var vpcObj = data.results[0];
					function vpcInfoViewModel(){
			    		var self = this;
			    		self.vpcVO = ko.validatedObservable(vpcObj);
			    		
			    		self.vpcExtNetQuery = ko.observable({
			    			"name":"",
			    			 "uuid":""
			    		});
						self.shouldShowAddExt = ko.observable(false);
						self.shouldShowRemoveExt = ko.observable(false);
						
			    		$.VPC.getVpcNet({vpcUuid:vpcUuid,type:"EXTERNAL"},function(data){
			    			  if(data && data.results && data.results.length > 0){
			    				  var vpcNet = data.results[0];
			    				  self.vpcExtNetQuery(
			    						  {
			    							  "name":vpcNet.name,
			    							  "uuid":vpcNet.uuid
			    						  });
			    				  self.shouldShowAddExt(false);
			    				  self.shouldShowRemoveExt(true);
			    			  }else{
			    				  self.shouldShowAddExt(true);
			    				  self.shouldShowRemoveExt(false);
			    			  }
			    		});
			    		
			    		self.netListTable = new DataTable([], {path: 'api/v5.0.0/vpcNetworks?type=INNER&vpcUuid='+vpcUuid});
			    		self.searchVpcNetParam = ko.observable({
		        	        name: ""
		        	    })
		        	    
			       	    self.searchVpcNet = function(){
			       	      self.netListTable.params(this.searchVpcNetParam());
			       	    }
			    		
			    		 /*  ko.validation.rules['ipRuleCheck'] = {
			    			    validator: function (val, otherVal) {
			    			        return val === otherVal;
			    			        	if(/^([1-9]|[1-9]\d|1\d\d|2[0-1]\d|22[0-3])(\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])){2}\.([1-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-4])$/.test(value)){
												return true;
										}
			    			    },
			    			    message: 'ip地址格式不正确，正确格式如：192.168.1.1'
			    			};
			    			ko.validation.registerExtenders();   */
			    		
			    		self.vpcNetVO = ko.validatedObservable({
		    			     "name":ko.observable().extend({required: true}),
							 "cidr":ko.observable().extend({required: true}),
							 "gateway":ko.observable().extend({required: true}),
							 "masterDns":ko.observable(),
							 "slaverDns":ko.observable(),
							 "mask":ko.observable(),
							 netPools: ko.observableArray()
							});
			    			
		    			  this.vpcNetVO().cidr.subscribe(function(){
		    				    try{
		    				    	 var mask = csc.util.segGetMask(self.vpcNetVO.toJSON().cidr);
				    				     self.vpcNetVO.fromJSON({mask:mask});
		    				    }catch(e){
		    				    }
		    			   });
			    			
			    		self.addNetPoolsItem = function(){
			    			self.vpcNetVO().netPools.push({
			    				start: "",
			    				end: ""
			    			});
			    		}
			    		self.removeNetPoolsItem = function(obj){
			    			self.vpcNetVO().netPools.remove(obj);
			    		}
			    		
			    		this.createVpcNetModal = ko.observable(false);
			    		this.createVpcNet = function(){
			    			self.vpcNetVO.fromJSON({"name":"testnet",
								 "cidr":"10.0.8.0/24",
								 "gateway": "10.0.8.254",
								 "masterDns":"8.8.8.8",
								 "slaverDns":"114.114.114.114"
								});
			    			self.createVpcNetModal(true)	
			    		}
			    		
			    		self.vpcNetSubmit = function(){
		    				    ko.validation.group(self.vpcNetVO).showAllMessages();
		    				    console.log(self.vpcNetVO.toJSON())
		    	    	        if(self.vpcNetVO.isValid()){
		    	    	        	var vpcNetJson = self.vpcNetVO.toJSON();
		    	    	        	var param = {};
		    	    	        	param.vpcUuid = vpcUuid;
		    	    	        	param.name = vpcNetJson.name;
		    	    	        	param.cidr = vpcNetJson.cidr;
		    	    	        	param.gateway = vpcNetJson.gateway;
		    	    	        	param.type="INNER";
		    	    	        	param.enableDhcp="true";
		    	    	        	param.dnsNames = [vpcNetJson.masterDns,vpcNetJson.slaverDns];
		    	    	        	param.pools =  vpcNetJson.netPools;
		    	    	        	/* var netPoolList = vpcNetJson.netPools;
		    	    	        	for(var i=0;i<netPoolList.length;i++){
		    	    	        		var netPool = netPoolList[i];
		    	    	        		param.netPool += netPool.start+"-"+netPool.end;
		    	    	        		if(i != netPoolList.length-1){
		    	    	        			param.netPool+=","
		    	    	        		}
		    	    	        	} */
		    	    	        	$.VPC.createVpcNetwork(param,function(data){
		    	        			 	self.createVpcNetModal(false);
		    	        		    	self.netListTable.refreshData();
		    	        			});
		    	    	        }
			    		}
			    		
			    		
			    		self.delVpcNet = function(rowObj){
			    			var vpcNetName = rowObj.name;
			    			confirm("确定删除网络["+vpcNetName+"]？",function(arg){
			    				$.VPC.delVpcNet(rowObj.uuid,function(data){
			    					  self.netListTable.refreshData();
			    					  alert("删除网络["+vpcNetName+"]成功！")
			           			});
			    			 });
			    		}
			    		
			    		
			    		/********ext network*******/
			    		self.vpcExtNetVO = ko.validatedObservable({
		    			        "vpcExtNetUuid":ko.observable().extend({required: true})
							});
			    		
			    		self.vpcExtNetList = ko.observableArray();
			    		self.addVpcExtNetModal = ko.observable(false);
			    		this.addVpcExtNet = function(){
			    			$.VDC.getVdcNetworks(vpcObj.vdcUuid,{},function(data){
			    				 if(data && data.results){
			    					 var extNetworkList = [];
			    					 var netList = data.results;
			    					 for(var i=0;i<netList.length;i++){
			    						 var net = netList[i];
			    						 if(net.azUuid == vpcObj.azUuid){
			    							 extNetworkList.push(net);
			    						 }
			    					 }
			    					 self.vpcExtNetList(extNetworkList);
			    				 }
			    			});
			    			
			    			self.addVpcExtNetModal(true)	
			    		}
			    		
			    		self.removeVpcExtNet = function(){
			    			var extName = self.vpcExtNetQuery().name;
			    			var extUuid = self.vpcExtNetQuery().uuid;
			    			confirm("确定移除外部网络["+extName+"]？",function(arg){
			    				$.VPC.delVpcNet(extUuid,function(data){
			    					 self.vpcExtNetQuery({
		    							  "name":"",
		    							  "uuid":""
		    						  })
			    					 self.shouldShowAddExt(true);
									 self.shouldShowRemoveExt(false);
			    					  alert("移除外部网络["+extName+"]成功！")
			           			});
			    			 });
			    		}
			    		
			    		self.confirmAddVpcExtNet = function(){
			    			var vpcExtNetUuid = self.vpcExtNetVO.toJSON().vpcExtNetUuid;
			    			var param = {};
		    	    	     param.vpcUuid = vpcObj.uuid;
		    	    	     param.uuid = vpcExtNetUuid;
		    	    	     param.type = "EXTERNAL";
			    			$.VPC.createVpcNetwork(param,function(data){
			    				console.log(data)
			    				 if(data){
			    					 self.vpcExtNetQuery({
		    							  "name":data.name,
		    							  "uuid":data.uuid
		    						  })
				    				 self.shouldShowAddExt(false);
									 self.shouldShowRemoveExt(true);
			    				 }
			    				self.addVpcExtNetModal(false)	
			    			});
			    		}
			    	
			    		/************ext network******/
					}
					
				    ko.applyBindings(new vpcInfoViewModel(), $("#page-content")[0]);
			  }
	    });
		
 
});
</script>