<div class="bg-light lter b-b wrapper-sm">
  <ol class="breadcrumb">
    <li>当前位置：</li>
    <li>订单</li>
    <li><a href="#pages/orders/service_orders">订单管理</a></li>
    <li class="active">15137订单详情</li>
  </ol>
</div>

<div class="wrapper-md" >
	<div class="panel panel-default" data-bind="with:orderList().order">
		<div class="panel-heading">基本信息</div>
		<div class="panel-body">
			<div class="row">
				<div class="col-xs-4">
					<p><strong>订单号：</strong><span data-bind="text:code"></span></p>
				</div>
				<div class="col-xs-4">
					<p><strong>流程类型：</strong>
						<span data-bind="visible: type=='RESOURCE_APPLY'">资源申请</span>
						<span data-bind="visible: type=='RESOURCEC_HANGE'">资源变更</span>
						<span data-bind="visible: type=='RESOURCER_ECYCLE'">资源删除</span>
						<span data-bind="visible: type=='RESOURCE_DELETE'">资源删除</span>
						<span data-bind="visible: type=='VALIDTIME_CHANGE'">有效时间变更</span>
						<span data-bind="visible: type=='VDC_APPLY'">VDC申请</span>
						<span data-bind="visible: type=='VDC_CHANGE'">VDC变更</span>
					</p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>流程状态：</strong>
						<span class="label label-warning" data-bind="visible: state=='UNSUBMIT'">未提交</span>
						<span class="label label-info" data-bind="visible: state=='DOING'">审批中</span>
						<span class="label label-success" data-bind="visible: state=='FINISHED'">审批完成</span>
						<a>查看</a>
					</p>
				</div>
				<div class="col-xs-4">
					<p><strong>当前节点：</strong><label data-bind="text:flowState"></label></p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>申请人：</strong><label data-bind="text:userName"></label></p>
				</div>
				<div class="col-xs-4">
					<p><strong>申请数量：</strong><label data-bind="text:itemCount"></label></p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>申请日期：</strong><label data-bind="text:createTime"></label></p>
				</div>
			</div>
		</div>
	</div>

	<div class="panel panel-default" >
		<div class="panel-heading">订单信息</div>
		<div id="orderDetailedList">
			<div item="orderdetailed-VM" >
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>云主机 2</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th></th>
							<th>云主机名称</th>
							<th>CPU(个)</th>
							<th>内存(G)</th>
							<th>存储(G)</th>
							<th>所属VDC</th>
							<th>申请时长</th>
							<th>收费标准</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">

						<tr>
							<td><a class="expand-btn" onclick = "expandForResourceDetailed(this)"><i class="fa fa-arrow-right"></i></a></td>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vcpu"></td>
							<td data-bind="text:memorySize"></td>
							<td data-bind="text:diskSize"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:applyTime"></td>
							<td ></td>
							<td data-bind="text:itemState"></td>
							<td>
								<div class="progress progress-sm">
                  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="text:itemWorkProgress" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                    60%
                  </div>
                </div>
              </td>
              <td><a>失败原因</a></td>
						</tr>
						<tr style="display:none">
							<td colspan="11">
								<h5><strong>基本信息</strong></h5>
								<div class="row">
									<div class="col-xs-2">云主机名称：<label ></label></div>
									<div class="col-xs-2">计算机名称：<label data-bind="text:computerName"></label></div>
									<div class="col-xs-2">所属VDC：<label data-bind="text:vdcName"></label></div>
								</div>
								<p></p>
								<div class="row">
									<div class="col-xs-2">业务系统：<label data-bind="text:operationSystem"></label></div>
									<div class="col-xs-2">申请时长：<label data-bind="text:applyTime"></label></div>
									<div class="col-xs-2">收费标准：<label ></label></div>
									<div class="col-xs-2">备注：<label data-bind="text:remark"></label></div>
								</div>
								<hr />
								<h5><strong>规格配置</strong></h5>
								<div class="row">
									<div class="col-xs-2">操作系统：<label data-bind="text:operationSystem"></label></div>
									<div class="col-xs-2">操作版本：<label data-bind="text:osVersion"></label></div>
									<div class="col-xs-2">CPU：<label data-bind="text:vcpu"></label></div>
									<div class="col-xs-2">内存：<label data-bind="text:memorySize"></label></div>
									<div class="col-xs-2">存储：<label ></label></div>
								</div>
								<hr />
								<h5><strong>网络配置</strong></h5>
								<div class="row">

									<div class="col-xs-2">网络类型：<label data-bind="text:netType"></label></div>
									<div class="col-xs-2">VPC/IP池：<label data-bind="text:createTime"></label></div>
								</div>
								<hr />
								<h5><strong>系统盘分区</strong></h5>
								<table class="table table-striped table-bordered" style="width:250px">
									<thead>
										<tr>
											<th>分区名称</th>
											<th>分区大小</th>
										</tr>
									</thead>
									<tbody data-bind="foreach: { data: cscOrderItemVmStorageZoneList }">
										<tr>
											<td data-bind="text:systemAzName"></td>
											<td data-bind="text:azSize"></td>
										</tr>
									</tbody> 
								</table>
							</td>
						</tr>
						
					</tbody>
				</table>
			</div>
			<div item="orderdetailed-DISK">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>云硬盘 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>云硬盘名称</th>
							<th>云硬盘类型</th>
							<th>存储大小（G）</th>
							<th>所属VDC</th>
							<th>挂载云主机</th>
							<th>收费标准</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>失败原因</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:diskType"></td>
							<td data-bind="text:diskSize"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:vmName"></td>
							<td ></td>
							<td ></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td><a>失败原因</a></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div item="orderdetailed-ROUTER">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>路由器 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>路由器名称</th>
							<th>所属VDC</th>
							<th>网络类型</th>
							<th>网络名称</th>
							<th>指定IP</th>
							<th>申请时长</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>失败原因</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vdcName"></td>
							<td >
								<span data-bind="visible: netType=='PUBLIC_IP'">公网</span>
								<span data-bind="visible: netType=='INNER_IP'">私网</span>
							</td>
							<td data-bind="text:vpcName"></td>
							<td data-bind="text:ip"></td>
							<td data-bind="text:applyTime"></td>
							<td ></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div item="orderdetailed-PUBLICIP">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>公网IP</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>公网IP名称</th>
							<th>所属VDC</th>
							<th>VPC名称</th>
							<th>指定IP</th>
							<th>申请时长</th>
							<th>收费标准</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:vpcName"></td>
							<td data-bind="text:ip"></td>
							<td data-bind="text:applyTime"></td>
							<td>
								<span data-bind="visible: billRuleUUID=='DAY'">按天</span>
								<span data-bind="visible: billRuleUUID=='MONTH'">按月</span>
								<span data-bind="visible: billRuleUUID=='QUARTER'">按季度</span>
								<span data-bind="visible: billRuleUUID=='YEAR'">按年</span>
							</td>
							<td>
								<span data-bind="visible: itemState=='READY_CONSTRUCTION'">待施工</span>
								<span data-bind="visible: itemState=='CONSTRUCTION_DOING'">施工中</span>
								<span data-bind="visible: itemState=='CONSTRUCTION_SUCCESS'">施工成功</span>
								<span data-bind="visible: itemState=='CONSTRUCTION_FAILED'">施工失败</span>
								<span data-bind="visible: itemState=='INVALID'">失效</span>
								<span data-bind="visible: itemState=='DELETE'">删除</span>
								<span data-bind="visible: itemState=='RECOVER'">回收</span>
							</td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuemin="0" aria-valuemax="100" data-bind="style: {width: itemWorkProgress+'%'}">
			                        <label data-bind="text:itemWorkProgress+'%'"></label>
			                      </div>
			                    </div>
							</td>
							<td><a>失败原因</a></td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div item="orderdetailed-LOAD_BALANCING">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>负载均衡器 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>负载均衡器名称</th>
							<th>所属VDC</th>
							<th>申请时长</th>
							<th>收费标准</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>失败原因</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:applyTime"></td>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:instanceName"></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td><a>失败原因</a></td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<!-- <div item="orderdetailed-firewall">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>防火墙 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>防火墙名称</th>
							<th>所属VDC</th>
							<th>申请时长</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>失败原因</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:instanceName"></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div> -->
			
			<div item="orderdetailed-SECRET_KEY">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>SSH密钥 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>SSH密钥</th>
							<th>所属VDC</th>
							<th>挂载云主机</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:vmName"></td>
							<td ></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td><a>失败原因</a></td>
						</tr>
					</tbody>
				</table>
			</div>

			<div item="orderdetailed-OBJECT_STORAGE">
				<h5>&nbsp;&nbsp;&nbsp;&nbsp;<strong>对象存储 1</strong></h5>
				<table class="table table-striped">
					<thead>
						<tr>
							<th>对象存储名称</th>
							<th>存储大小(G)</th>
							<th>所属VDC</th>
							<th>申请时长</th>
							<th>收费标准</th>
							<th>施工状态</th>
							<th>施工进度</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody data-bind="foreach:orderList().orderItem">
						<tr>
							<td data-bind="text:instanceName"></td>
							<td data-bind="text:diskSize"></td>
							<td data-bind="text:vdcName"></td>
							<td data-bind="text:applyTime"></td>
							<td ></td>
							<td ></td>
							<td>
								<div class="progress progress-sm">
			                      <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
			                        60%
			                      </div>
			                    </div>
							</td>
							<td><a>失败原因</a></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	function expandForResourceDetailed(obj){
		$(obj).find('i').toggleClass("fa-arrow-down");
		$(obj).parents('tr').next("tr").toggle();
	}
	var scripts = [null, null];
	$('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
		function ViewModel(){
			var self = this;
			self.orderList = ko.observableArray();
			//self.orderList = [];
			//this.table = new DataTable([], {path:'api/v5.0.0/orders/'+args.uuid+'/items'});
			this.loadOrderAndResource = function(){
				$.ajax("api/v5.0.0/orders/"+args.uuid+"/items").done(function(data){
					self.orderList(data);
				});
			}
			this.loadOrderAndResource();
		}
		
		var showItems = args.items.split('-');
		var orderDetailedList = $("#orderDetailedList");
		$.each($("#orderDetailedList > div"),function(n,v){
			var hasItem = false;
			$.each(showItems,function(a,b){
				if($(v).attr("item").indexOf(b) > -1)
					hasItem = true;
			});
			if(!hasItem)
				$(this).remove();
		});
		
		ko.applyBindings(new ViewModel(), $('#page-content')[0]);  
	});
	
</script>