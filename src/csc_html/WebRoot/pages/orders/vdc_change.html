<div class="bg-light lter b-b wrapper-sm">
  <ol class="breadcrumb">
    <li>当前位置：</li>
    <li>订单</li>
    <li><a href="#pages/orders/service_orders">订单管理</a></li>
    <li class="active">15137订单详情</li>
  </ol>
</div>

<div class="wrapper-md" id="vdcChangeDetail">
	<div class="panel panel-info">
		<div class="panel-heading">基本信息</div>
		<div class="panel-body" data-bind="with:$root.order">
			<div class="row">
				<div class="col-xs-4">
					<p><strong>订单号：</strong><span data-bind="text:code"></span></p>
				</div>
				<div class="col-xs-4">
					<p><strong>流程类型：</strong>
						<span data-bind="visible: type=='RESOURCE_APPLY'">资源申请</span>
						<span data-bind="visible: type=='RESOURCEC_HANGE'">资源变更</span>
						<span data-bind="visible: type=='RESOURCER_ECYCLE'">资源删除</span>
						<span data-bind="visible: type=='RESOURCE_DELETE'">资源删除</span>
						<span data-bind="visible: type=='VALIDTIME_CHANGE'">有效时间变更</span>
						<span data-bind="visible: type=='VDC_APPLY'">VDC申请</span>
						<span data-bind="visible: type=='VDC_CHANGE'">VDC变更</span>
					</p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>流程状态：</strong>
						<span class="label label-warning" data-bind="visible: state=='UNSUBMIT'">未提交</span>
						<span class="label label-info" data-bind="visible: state=='DOING'">审批中</span>
						<span class="label label-success" data-bind="visible: state=='FINISHED'">审批完成</span>
						<a>查看</a>
					</p>
				</div>
				<div class="col-xs-4">
					<p><strong>当前节点：</strong><label data-bind="text:flowState"></label></p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>申请人：</strong><label data-bind="text:userName"></label></p>
				</div>
				<div class="col-xs-4">
					<p><strong>申请数量：</strong><label data-bind="text:itemCount"></label></p>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-4">
					<p><strong>申请日期：</strong><label data-bind="text:createTime"></label></p>
				</div>
			</div>
		</div>
	</div>

	<div class="panel panel-info">
		<div class="panel-heading">订单信息</div>
		<div class="panel panel-default">
              <div class="panel-body"><strong>VDC名称：</strong><span data-bind="text: vdc().instanceName"></span></div>
              <div class="panel-body no-padder form-inline">
                <div class="form-group" style="padding:15px;">
                  <label for="exampleInputName2"><strong>支持的操作系统：</strong></label>
                  <div class="checkbox"><label><input checked disabled class="form-group" type="checkbox" data-bind="checked: windows"/> Windows</label></div>&nbsp;&nbsp;
                  <div class="checkbox"><label><input disabled class="form-group" type="checkbox" data-bind="checked: linux"/> Linux</label></div>&nbsp;&nbsp;
                  <div class="checkbox"><label><input disabled class="form-group" type="checkbox" data-bind="checked: aix"/> Aix</label></div>
                </div>
                <div class="table-responsive no-height">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th></th>
                        <th>申请前</th>
                        <th>申请后</th>
                        <th></th>
                        <th>申请前</th>
                        <th>申请后</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>CPU(个)</td>
                        <td data-bind="text: metaVdc().cpu"></td>
                        <td data-bind="text: changeVdc().cpu"></td>
                        <td>内存(G)</td>
                        <td data-bind="text: metaVdc().memory"></td>
                        <td data-bind="text: changeVdc().memory"></td>
                      </tr>
                      <tr>
                        <td>存储(G)</td>
                        <td data-bind="text: metaVdc().storage"></td>
                        <td data-bind="text: changeVdc().storage"></td>
                        <td>VPC(个)</td>
                        <td data-bind="text: metaVdc().vpc"></td>
                        <td data-bind="text: changeVdc().vpc"></td>
                      </tr>
                      <tr>
                        <td>云主机(个)</td>
                        <td data-bind="text: metaVdc().vm"></td>
                        <td data-bind="text: changeVdc().vm"></td>
                        <td>云硬盘(个)</td>
                        <td data-bind="text: metaVdc().disk"></td>
                        <td data-bind="text: changeVdc().disk"></td>
                      </tr>
                      <tr>
                        <td>公网IP(个)</td>
                        <td data-bind="text: metaVdc().publicIp"></td>
                        <td data-bind="text: changeVdc().publicIp"></td>
                        <td>路由器(个)</td>
                        <td data-bind="text: metaVdc().router"></td>
                        <td data-bind="text: changeVdc().router"></td>
                      </tr>
                      <tr>
                        <td>防火墙(个)</td>
                        <td data-bind="text: metaVdc().firewall"></td>
                        <td data-bind="text: changeVdc().firewall"></td>
                        <td>负载均衡器(个)</td>
                        <td data-bind="text: metaVdc().loadBalance"></td>
                        <td data-bind="text: changeVdc().loadBalance"></td>
                      </tr>
                      <tr>
                        <td>SSH密钥(对)</td>
                        <td data-bind="text: metaVdc().secretKey"></td>
                        <td data-bind="text: changeVdc().secretKey"></td>
                        <td>对象存储(GB)</td>
                        <td data-bind="text: metaVdc().objectStorage"></td>
                        <td data-bind="text: changeVdc().objectStorage"></td>
                      </tr>
                      <tr>
                        <td>安全组(个)</td>
                        <td data-bind="text: metaVdc().securityGroup"></td>
                        <td data-bind="text: changeVdc().securityGroup"></td>
                        <td>VPN(个)</td>
                        <td data-bind="text: metaVdc().vpn"></td>
                        <td data-bind="text: changeVdc().vpn"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
		
	</div>
</div>
<script type="text/javascript">
	var scripts = [null, "api/vdc/vdc.js"];
	$('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
		var flowInstanceUuid = args.flowInstanceId;
		function ViewModel(){
		  var self = this;
		  
		  this.order = ko.observable("");
	  	  this.vdc = ko.observable("");
	  	  this.resBaseInfo = ko.observable("");
	  	  this.osType = ko.observable("");
	  	  this.metaData = ko.observable("");
	  	  this.vdcQuotaList = ko.observable("");
	  	  this.expireType = ko.observable("");
	  	  this.expireValue = ko.observable("");
	  	
	  	  this.windows = ko.observable("");
	  	  this.linux = ko.observable("");
	  	  this.aix = ko.observable("");
	  	  
	  	  
	  	  this.changeVdc = ko.validatedObservable({
	        cpu: ko.observable(""),
	        memory: ko.observable(""),
	        storage: ko.observable(""),
	        vpc: ko.observable(""),
	        vm: ko.observable(""),
	        disk: ko.observable(""),
	        publicIp: ko.observable(""),
	        router: ko.observable(""),
	        firewall: ko.observable(""),
	        loadBalance: ko.observable(""),
	        secretKey: ko.observable(""),
	        objectStorage: ko.observable(""),
	  	    securityGroup: ko.observable(""),
	  	    vpn: ko.observable("")
	      });
		  
		  this.metaVdc = ko.validatedObservable({
	        cpu: ko.observable(""),
	        memory: ko.observable(""),
	        storage: ko.observable(""),
	        vpc: ko.observable(""),
	        vm: ko.observable(""),
	        disk: ko.observable(""),
	        publicIp: ko.observable(""),
	        router: ko.observable(""),
	        firewall: ko.observable(""),
	        loadBalance: ko.observable(""),
	        secretKey: ko.observable(""),
	        objectStorage: ko.observable(""),
	        securityGroup: ko.observable(""),
	  	    vpn: ko.observable("")
	      });
	  	  
		  //csc.rest.get('api/v5.0.0/workflows/tasks/'+args.taskId,function(data){
	   	  //   var processInstanceId = data.taskInfo[0].processInstanceId;
			 //获取订单数据
	      	 csc.rest.get('api/v5.0.0/orders/byFlowInstanceUuid/'+flowInstanceUuid,function(data){
	      		var orderData = data;
	      		var itemListData = data.orderItems;
	      		var metaData = JSON.parse(itemListData[0].metaData);
	      		var resBaseInfo = JSON.parse(metaData.resBaseInfo);
	      		var osType = metaData.osType;
	      		var vdcQuotaList = resBaseInfo.vdcQuotaList;
	      		self.order(orderData);
	      		self.vdc(itemListData[0]);
	      		self.metaData(metaData);
	      		for(var i=0;i<vdcQuotaList.length;i++){
	      			if(vdcQuotaList[i].type=='CPU'){
	      				self.changeVdc().cpu(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='MEMORY'){
	      				self.changeVdc().memory(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='STORAGE'){
	      				self.changeVdc().storage(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='VPC'){
	      				self.changeVdc().vpc(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='VM'){
	      				self.changeVdc().vm(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='DISK'){
	      				self.changeVdc().disk(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='PUBLICIP'){
	      				self.changeVdc().publicIp(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='ROUTER'){
	      				self.changeVdc().router(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='FIREWALL'){
	      				self.changeVdc().firewall(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='SECRET_KEY'){
	      				self.changeVdc().secretKey(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='OBJECT_STORAGE'){
	      				self.changeVdc().objectStorage(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='LOAD_BALANCING'){
	      				self.changeVdc().loadBalance(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='SECURITY_GROUP'){
	      				self.changeVdc().securityGroup(vdcQuotaList[i].value);
	      			}else if(vdcQuotaList[i].type=='VPN'){
	      				self.changeVdc().vpn(vdcQuotaList[i].value);
	      			}
	      		}
	      		for(var i=0;i<osType.length;i++){
	      			if(osType[i]=='windows'){
	      				self.windows(true);
	      			}else if(osType[i]=='linux'){
	      				self.linux(true);
	      			}else if(osType[i]=='aix'){
	      				self.aix(true);
	      			}
	      		}
	      		self.vdcQuotaList(vdcQuotaList);
	      		console.log(itemListData.length);
	      		console.log(itemListData[0].resourceUuid);
	      		$.VDC.getVdcQuota(itemListData[0].resourceUuid,"",function(data){
		    		var vdcQuotaList = data.results;
		    		for(var i=0;i<vdcQuotaList.length;i++){
		    			if(vdcQuotaList[i].type=='CPU'){
		      				self.metaVdc().cpu(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='MEMORY'){
		      				self.metaVdc().memory(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='STORAGE'){
		      				self.metaVdc().storage(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='VPC'){
		      				self.metaVdc().vpc(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='VM'){
		      				self.metaVdc().vm(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='DISK'){
		      				self.metaVdc().disk(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='PUBLICIP'){
		      				self.metaVdc().publicIp(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='ROUTER'){
		      				self.metaVdc().router(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='FIREWALL'){
		      				self.metaVdc().firewall(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='SECRET_KEY'){
		      				self.metaVdc().secretKey(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='OBJECT_STORAGE'){
		      				self.metaVdc().objectStorage(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='LOAD_BALANCING'){
		      				self.metaVdc().loadBalance(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='SECURITY_GROUP'){
		      				self.metaVdc().securityGroup(vdcQuotaList[i].value);
		      			}else if(vdcQuotaList[i].type=='VPN'){
		      				self.metaVdc().vpn(vdcQuotaList[i].value);
		      			}
		    		}
		    	})
	      	 })
		  //})
		}
		
		ko.applyBindings(new ViewModel(), $('#vdcChangeDetail')[0]);  
	});
	
</script>