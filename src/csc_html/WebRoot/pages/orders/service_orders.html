<div class="bg-light lter b-b wrapper-sm">
  <ol class="breadcrumb">
    <li>当前位置：</li>
    <li>订单</li>
    <li class="active">订单管理--开发中....</li>
  </ol>
</div>

<div class='wrapper-md'>

		<div class="panel panel-default b-blue">

		<div class="wrapper bg-white-only">
			<div class="row">
		        <div class="col-xs-3">
		          <div class="input-group">
		            <span class="input-group-addon">流程类型</span>
		            <select class="form-control input-sm" data-bind="value: searchParam().catelog, options: $root.catelogs, optionsText: 'name', optionsValue: 'id'"></select>
		          </div>      
		        </div>
		        <div class="col-xs-2">
		          <div class="input-group">
		            <span class="input-group-addon">流程状态</span>
		            <select class="form-control input-sm" data-bind="value: searchParam().status">
		              <option value="1">全部</option>
		              <option value="2">审批中</option>
		            </select>
		          </div>      
		        </div>
		        <div class="col-xs-3">
		            <div class="input-group">
		               <span class="input-group-addon">实例名称</span>
		               <input type="text" value="" class="form-control input-sm" data-bind="value: searchParam().instanceName">
		            </div>        
		        </div>
		        <div class="col-xs-2">
		            <button class="btn btn-sm" type="button" data-bind="click: reset">重置</button>
		            <button class="btn btn-default btn-sm" type="submit" data-bind="click: search">搜索</button>
		        </div>				
    				<div class="col-xs-2">
    					<a class="inline senior-search-btn" onclick="$('#senior').slideToggle()">高级搜索 <i class="fa fa-angle-down"></i></a>
    				</div>
			</div>
			<div class="senior-search m-t" id="senior" style="display:none">
				<div class="row">
			        <div class="col-xs-3">
			            <div class="input-group">
			               <span class="input-group-addon">订单号</span>
			               <input type="text" value="" class="form-control input-sm" data-bind="value: searchParam().orderNo">
			            </div>        
			        </div>	
			        <div class="col-xs-3">
			          <div class="input-group">
			            <span class="input-group-addon">所属VDC</span>
			            <select class="form-control input-sm" data-bind="value: searchParam().vdc, options: $root.vdcs, optionsText: 'name', optionsValue: 'id'"></select>
			          </div>      
			        </div>	
			        <div class="col-xs-3">
			          <div class="input-group">
			            <span class="input-group-addon">产品类型</span>
			            <select class="form-control input-sm" data-bind="value: searchParam().vdc, options: $root.vdcs, optionsText: 'name', optionsValue: 'id'"></select>
			          </div>      
			        </div>
			    </div>
			    <div class="row">
			        <div class="col-xs-3">
			            <div class="input-group">
			               <span class="input-group-addon">申请人</span>
			               <input type="text" value="" class="form-control input-sm" data-bind="value: searchParam().userName">
			            </div>        
			        </div>		
			        <div class="col-xs-3">
			            <div class="input-group">
			               <span class="input-group-addon">申请日期</span>
			               <input type="text" class="form-control" id="timerange" style="width:250px;display:inline-block;"  />
			            </div>        
			        </div>	        		
				</div>
			</div>
		</div>	
		  <div class="table-responsive" data-bind="with: table">
				<table class="table table-striped">
					<thead>
						<tr>
							<th>订单号</th>
							<th>流程类型</th>
							<th>流程状态</th>
							<th>当前节点</th>
							<th>申请人</th>
							<th>申请数量</th>
							<th>申请日期</th>
							<th>所属VDC</th>
							<th>产品类型</th>
							<th>实例名称</th>
							<th>流程跟踪</th>
							<th>操作</th>
						</tr>
					</thead>
					<tbody>
					<tr data-bind="visible: showNoData">
	                    <td colspan="12" class="aligncenter">
	                        This table has no data.
	                    </td>
	                 </tr>
	          <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
						<tr>
								
							<td><a data-bind="text:code, attr:{href:'#pages/orders/show?items=' + resourceType+'&uuid='+uuid}"></a></td>
							<td>
								<span data-bind="visible: type=='RESOURCE_APPLY'">资源申请</span>
								<span data-bind="visible: type=='RESOURCEC_HANGE'">资源变更</span>
								<span data-bind="visible: type=='RESOURCER_ECYCLE'">资源回收</span>
								<span data-bind="visible: type=='RESOURCE_DELETE'">资源删除</span>
								<span data-bind="visible: type=='VALIDTIME_CHANGE'">有效时间变更</span>
								<span data-bind="visible: type=='VDC_APPLY'">VDC申请</span>
								<span data-bind="visible: type=='VDC_CHANGE'">VDC变更</span>
							</td>
							<td >
								<span class="label label-warning" data-bind="visible: state=='UNSUBMIT'">未提交</span>
								<span class="label label-info" data-bind="visible: state=='DOING'">审批中</span>
								<span class="label label-success" data-bind="visible: state=='FINISHED'">审批完成</span>
							</td>
							<td data-bind="text:flowState"></td>
							<td data-bind="text:userName"></td>
							<td data-bind="text:itemCount"></td>
							<td data-bind="text:createTime"></td>
							<td data-bind="text:vdcName"></td>
							<td >
								<span data-bind="visible: resourceType=='VM'">云主机</span>
								<span data-bind="visible: resourceType=='DISK'">云硬盘</span>
								<span data-bind="visible: resourceType=='ROUTER'">路由器</span>
								<span data-bind="visible: resourceType=='PUBLICIP'">公网IP</span>
								<span data-bind="visible: resourceType=='LOAD_BALANCING'">负载均衡</span>
								<span data-bind="visible: resourceType=='SECRET_KEY'">SSH密钥对</span>
								<span data-bind="visible: resourceType=='OBJECT_STORAGE'">对象存储</span>
								<span data-bind="visible: resourceType=='VDC'">VDC</span>
							</td>
							<td data-bind="text:resourceNames"></td>
							<td ><a href="#">查看</a></td>
							<td>
								<a data-bind="attr:{href:'#pages/orders/show?items=' + resourceType+'&uuid='+uuid}">查看</a> <span data-bind="visible: state=='UNSUBMIT'">| <a data-url="pages/orders/tasks" href="#pages/orders/modal1">办理</a> | <a onclick="systemMsg.alert('确定删除吗？')">删除</a></span>
							</td>
						</tr>
						<!-- /ko -->
					</tbody>
				</table>
			</div>
	    <footer class="panel-footer" data-bind="with: table, visible: table.pages() > 1">
	      <ul class="pagination">
	        <li data-bind="css: leftPagerClass, click: prevPage">
	          <a href="#">&laquo;</a>
	        </li>
	        <!-- ko foreach: {data: (new Array(pages()))} -->
	        <li data-bind="css: $parent.pageClass($index() + 1)">
	          <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a>
	        </li>
	        <!-- /ko -->
	        <li data-bind="css: rightPagerClass, click: nextPage">
	          <a href="#">&raquo;</a>
	        </li>
	      </ul>
	    </footer>
		</div>

</div>

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var getOrdersUrl = "api/v5.0.0/orders";

  var scripts = [null, "assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js", null]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
  	$('#timerange').val(moment().subtract('days', 29).format('YYYY/MM/DD') + ' 至 ' + moment().format('YYYY/MM/DD')).daterangepicker(
      {
        format:'YYYY/MM/DD',
        startDate: moment().subtract('days', 29),
        endDate: moment(),
        separator:'至',
        locale:{
          applyLabel: '确认',
          cancelLabel: '取消',
          fromLabel: '开始日期',
          toLabel: '结束日期',
          weekLabel: '周',
          customRangeLabel: '自定义范围',                            
          daysOfWeek:["日","一","二","三","四","五","六"],
          monthNames:['01月','02月','03月','04月','05月','06月','07月','08月','09月','10月','11月','12月',]
        }
      });
    function ViewModel(){
      var self = this;
      this.searchParam = ko.observable({
      	catelog: "",
        status: "",
        instanceName: "",
        vdc: "",
        orderNo: "",
        userName: ""
      })
      this.reset = function(){
      	this.searchParam({
	      	catelog: "",
	        status: "",
	        instanceName: "",
	        vdc: "",
	        orderNo: "",
	        userName: ""
	      })	
        this.table.params({});
      }
      this.search = function(){
        this.table.params(this.searchParam());
      }

      //this.table = new DataTable([], {path: 'pages/orders/service_orders.json'});
      this.table = new DataTable([], {path: getOrdersUrl});

      this.catelogs = ko.observableArray([]);
      this.vdcs = ko.observableArray([]);

      //vdc下拉选择
      this.loadVdcs = function(){
        $.ajax("pages/vdcs/vdcs/index.json").done(function(data){
          self.vdcs(data.results);
        });
      }
      this.loadCatelogs = function(){
        $.ajax("pages/workflows/workflows_catelogs.json").done(function(data){
          self.catelogs(data.results);
        });
      }
      this.loadVdcs();
      this.loadCatelogs();
    }

    ko.applyBindings(new ViewModel(), $('#page-content')[0]);  
  });
</script>