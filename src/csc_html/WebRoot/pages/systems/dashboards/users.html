<div class="simple_form form-horizontal">
  <div class='modal-dialog modal-lg' style="width:600px;">
    <div class='modal-content'>
      <div class='modal-header'>
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>角色配置</h3>
      </div>
      <div class='modal-body row' data-bind="with: configVO">
        <div class="form-group">
          <label class="col-xs-2 control-label">角色选择：</label>
          <div class="col-xs-10 form-inline row" style="top:-5px;">
            <div class="col-xs-12">
              <div class="checkbox">
                <label class="i-checks">
                  <input type="checkbox" data-bind="checked: fields_all">
                  <i></i>
                </label>
                <span class="control-label">全选</span>
              </div>
            </div>
            
              <!-- ko foreach: {data: pagedRows, as: '$row'}  -->
            <div data-bind="foreach: fields">
			  <div class="col-xs-4">
				 <div class="checkbox">
					  <label class="i-checks">
					      <input type="checkbox"  data-bind="checkedValue: $data.id, checked: $parent.conditions_selected_ids">
					           <i></i><a data-bind="text: name"></a>
					  </label>
				 </div>
			  </div>
			</div>
          </div>
        </div>

      </div>
      <div class='modal-footer' style="text-align:center;">
        <a class="btn btn-default btn-info">确定</a>
        <a class="btn btn-default btn btn-default" data-dismiss="modal">取消</a>
      </div>
    </div>
  </div>
</div>

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = ["assets/lib/moment/moment.js","assets/lib/bootstrap-daterangepicker/daterangepicker.js"]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
	
    function ViewModel(fields){
    	var self = this;
    	var perPage = 5;
    	
      	//报表自定义界面操作
      	this.configVO = ko.observable({
      		fields: fields,
      	  	fields_selected_ids: ko.observableArray([]),
      	  	fields_all: ko.pureComputed({
		        read: function () {
		            return this.configVO().fields_selected_ids().length === this.configVO().fields.length;
		        },
		        write: function (value) {
		            this.configVO().fields_selected_ids(value ? _.pluck(this.configVO().fields, 'id') : []);
		        },
		        owner: this
		    }),
      	});
    	this.fields_selected_ids = ko.observableArray([]);
      	//整合选中的展示字段
      	this.makeup_fields_selected_ids = function(){
      		self.fields_selected_ids([]);
      		
      		var fields = _.filter(self.configVO().fields, function(field){
          		return _.contains(self.configVO().fields_selected_ids(), field.id)
          	}, self);
      		_.each(fields, function(field){
      			self.fields_selected_ids.push(field);
      		}, self)
      	}
      	
      	//vdc报表定义页面操作
    	this.isAdd = ko.observable(false);
      	this.configAdd = function(report){
        	this.isAdd(true);
        	this.addOpen(report);  
      	}
      	this.configSave = function(report){
      		var putBody = {
      			fields: ""+self.configVO().fields_selected_ids()+"",
      		}
      		csc.rest.get('/api/v5.0.0/roles',function(data){
      			if(data == 0){
      				csc.rest.post('api/v5.0.0/reports/define/'+report, putBody,function(data){
      			 		systemMsg.alert('报表定义创建成功！');
      			 		self.makeup_fields_selected_ids();
      			    }); 
      			}else{
      				csc.rest.put('api/v5.0.0/reports/define/'+report, putBody,function(data){
      			 		systemMsg.alert('报表定义修改成功！');
      			 		self.makeup_fields_selected_ids();
      			    });
      			}
      			self.table.perPage(self.configVO().pageSize());
      		});
      		
  		}
    	
    }
    
    ko.applyBindings(new ViewModel(), $('#page-content')[0]);
  });
</script>