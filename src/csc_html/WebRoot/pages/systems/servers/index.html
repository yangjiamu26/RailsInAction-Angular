<div class="bg-light lter b-b wrapper-sm">
  <ol class="breadcrumb">
    <li>当前位置：</li>
    <li>系统</li>
    <li class="active">服务器配置</li>
  </ol>
</div>
<div class='wrapper-md'>
  <div class="nav-tabs-alt bg-white-only">
    <ul class="nav nav-tabs" role="tablist">
      <li class="active" role="presentation">
        <a aria-controls="report" data-toggle="tab" href="#report" role="tab">集算报表平台配置</a>
      </li>
      <li role="presentation">
        <a aria-controls="ftp" data-toggle="tab" href="#ftp" role="tab">FTP配置</a>
      </li>
      <li role="presentation">
        <a aria-controls="chef" data-toggle="tab" href="#chef" role="tab">Chef配置</a>
      </li>
      <li role="presentation">
        <a aria-controls="email" data-toggle="tab" href="#email" role="tab">邮件服务器配置</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="report" role="tabpanel">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="text-muted">CSC与集算报表平台对接，为自定义报表提供上传报表文件、下载报表文件、删除报表文件、查看报表文件、检测报表文件接口</span></div>
          <div class="panel-body">
            <form class="form-horizontal" data-bind="with: server().report">
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">URL地址：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: urlAddr">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">用户名：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: userName">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">密码：</label>
                    <div class="col-xs-6">
                        <input type="password" class="form-control" placeholder="" data-bind="value: userPwd">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <div class="col-xs-6 col-xs-offset-2">
                        <button class="btn btn-primary" type="button" data-bind="click: $root.reportTest">连接测试</button>
                        <button class="btn btn-info" type="button" data-bind="click: $root.reportSave">保存</button>
                    </div>                 
                </div>            
            </form>
          </div>
        </div>      
      </div>
      <div class="tab-pane" id="ftp" role="tabpanel">
        <div class="panel panel-default">
          <div class="panel-heading"><span class="text-muted">通过配置FTP服务器软件库及脚本库的存放目录，可将软件及脚本上传至FTP服务器</span></div>
          <div class="panel-body">
            <form class="form-horizontal" data-bind="with: server().ftp">
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">服务器地址：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: serverAddr">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">端口：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: portNum">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">软件库存放目录：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: softWareAddr">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">脚本库存放目录：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: scriptAddr">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">用户名：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: username">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>                      
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">密码：</label>
                    <div class="col-xs-6">
                        <input type="password" class="form-control" placeholder="" data-bind="value: userPwd">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <div class="col-xs-6 col-xs-offset-2">
                        <button class="btn btn-primary" type="button" data-bind="click: $root.ftpTest">连接测试</button>
                        <button class="btn btn-info" type="button" data-bind="click: $root.ftpSave">保存</button>
                    </div>                 
                </div>            
            </form>
          </div>
        </div>      
      </div>
      <div class="tab-pane" id="chef" role="tabpanel">
        <div class="panel panel-default">
          <div class="panel-body">
            <form class="form-horizontal" data-bind="with: server().chef">
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">IP地址：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: ipAddr">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>                  
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">端口：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: portNum">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>                      
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">用户名：</label>
                    <div class="col-xs-6">
                        <input type="text" class="form-control" placeholder="" data-bind="value: username">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>                      
                <div class="form-group">
                    <label class="col-xs-2 control-label" for="">密码：</label>
                    <div class="col-xs-6">
                        <input type="password" class="form-control" placeholder="" data-bind="value: userPwd">
                    </div>
                    <div class="col-xs-1">
                      <span class="text-danger inline m-l-n m-t-sm">*</span>
                    </div>                    
                </div>            
                <div class="form-group">
                    <div class="col-xs-6 col-xs-offset-2">
                        <button class="btn btn-primary" type="button" data-bind="click: $root.chefTest">连接测试</button>
                        <button class="btn btn-info" type="button" data-bind="click: $root.chefSave">保存</button>
                    </div>                 
                </div>            
            </form>
          </div>
        </div>      
      </div>
      <div class="tab-pane" id="email" role="tabpanel">
        <div class="panel panel-default">
          <div class="panel-heading">
              <span class="text-muted">是否启用邮件发送通知</span>
              <label class="i-switch v-middle">
                <input type="checkbox" data-bind="checked: server().email.active">
                <i></i>
              </label>              
          </div>
          <div class="panel-body">
            <div class="row">
              <div class="col-xs-6">
                  <div class="panel-heading m-b font-bold">邮件发送服务器配置</div>
                  <form class="form-horizontal" data-bind="with: server().email">      
                      <div class="form-group">
                          <label class="col-xs-4 control-label" for="">服务器名：</label>
                          <div class="col-xs-6">
                              <input type="text" class="form-control" placeholder="" data-bind="value: url">
                          </div>
                          <div class="col-xs-1">
                            <span class="text-danger inline m-l-n m-t-sm">*</span>
                          </div>                    
                      </div>            
                      <div class="form-group">
                          <label class="col-xs-4 control-label" for="">用户名：</label>
                          <div class="col-xs-6">
                              <input type="text" class="form-control" placeholder="" data-bind="value: username">
                          </div>
                          <div class="col-xs-1">
                            <span class="text-danger inline m-l-n m-t-sm">*</span>
                          </div>                    
                      </div>                      
                      <div class="form-group">
                          <label class="col-xs-4 control-label" for="">密码：</label>
                          <div class="col-xs-6">
                              <input type="password" class="form-control" placeholder="" data-bind="value: password">
                          </div>
                          <div class="col-xs-1">
                            <span class="text-danger inline m-l-n m-t-sm">*</span>
                          </div>                    
                      </div>            
                      <div class="form-group">
                          <div class="col-xs-7 col-xs-offset-4">
                              <button class="btn btn-info" type="button" data-bind="click: $root.emailSave">保存</button>
                          </div>                 
                      </div>            
                  </form>                
              </div>
              <div class="col-xs-6" data-bind="with: email_test">
                  <div class="panel-heading m-b font-bold">邮件发送测试</div>
                  <form class="form-horizontal" data-bind="">      
                      <div class="form-group">
                          <label class="col-xs-3 control-label" for="">邮箱：</label>
                          <div class="col-xs-8">
                              <input type="email" class="form-control" placeholder="" data-bind="value: email">
                          </div>                  
                      </div>            
                      <div class="form-group">
                          <label class="col-xs-3 control-label" for="">标题：</label>
                          <div class="col-xs-8">
                              <input type="text" class="form-control" placeholder="" data-bind="value: title">
                          </div>                  
                      </div>                      
                      <div class="form-group">
                          <label class="col-xs-3 control-label" for="">内容：</label>
                          <div class="col-xs-8">
                              <textarea cols="5" rows="5" class="form-control" data-bind="value: content"></textarea>
                          </div>                 
                      </div>            
                      <div class="form-group">
                          <div class="col-xs-8 col-xs-offset-3">
                              <button class="btn btn-primary" type="button" data-bind="click: $root.emailTest">发送测试</button>
                          </div>                 
                      </div>            
                  </form>
              </div>
            </div>
          </div>
        </div>      
      </div>

    </div>

  </div>
</div>

<!-- page specific plugin scripts -->
<script type="text/javascript">
  var scripts = [null, null]
  $('.page-content-area').ace_ajax('loadScripts', scripts, function(args) {
    function ViewModel(){
    	var self = this;

		/* self.currentVO = ko.observable({});
		self.oldVO = ko.observable({}); */
		
      this.server = ko.observable({
         "report": {
          "urlAddr": "",
          "userName": "",
          "userPwd": ""
        },
        "ftp":{
          "serverAddr": "",
          "portNum": "",
          "softWareAddr": "",
          "scriptAddr": "",
          "username": "",
          "userPwd": ""
        },
        "chef": {
          "ipAddr": "",
          "portNum": "",
          "username": "",
          "userPwd": ""
        },
        "email": {
          "active": false,
          "url": "",
          "username": "",
          "password": ""
        }
      });
      
      

      this.email_test = ko.observable({
        "email": "",
        "title": "",
        "content": ""
      }) 

      
       var self = this;
      this.isAdd = ko.observable(false);
      
      this.loadData = function(){
        $.ajax("pages/systems/servers/index.json").done(function(data){
          self.server(data);
        })
      } 

      this.loadData(); 

      this.reportTest = function(object){
          console.log(object);
          var param = {
                  "urlAddr": this.urlAddr,
                  "userName": this.userName,
                  "userPwd": this.userPwd
                }; 
          $FTP_CONF.checkCollRepoIsConnect(param , function(data){
      		if(data && data.msg) {
      			alert(data.msg + '！');
      		}
      	})
        
      }
      this.reportSave = function(object){
        console.log(object);
        var param = {
                "urlAddr": this.urlAddr,
                "userName": this.userName,
                "userPwd": this.userPwd
              }; 
       /*  var ipReg =  "^(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])(\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])){3}$";

    	var ipPatt = new RegExp(ipReg); */
        if(this.urlAddr==""){
        	alert("请输入正确的url地址！");
        }else if(this.userName==""||this.userPwd==""){
        	alert("请输入用户名或密码！");
        }else{
        	csc.rest.post('api/v5.0.0/severconfsrepo',param , function(){
                 self.isAdd(false);
               })
               alert("保存配置成功！");
        }   
        
      }
      
     

      this.ftpTest = function(object){
        console.log(object);
        var param={
                "serverAddr": this.serverAddr,
                "portNum": this.portNum,
                "softWareAddr": this.softWareAddr,
                "scriptAddr": this.scriptAddr,
                "username": this.username,
                "userPwd": this.userPwd
              };
        $FTP_CONF.checkFtpIsConnect(param , function(data){
    		if(data && data.msg) {
    			alert(data.msg + '！');
    		}
    	})
        
      }
      this.ftpSave = function(object){
        console.log(object);
        var param={
                "serverAddr": this.serverAddr,
                "portNum": this.portNum,
                "softWareAddr": this.softWareAddr,
                "scriptAddr": this.scriptAddr,
                "username": this.username,
                "userPwd": this.userPwd
              };
        if(this.serverAddr == ""){
        	alert("请输入服务器地址！");
        }else if(this.portNum == ""){
        	alert("请输入端口号！");
        }else if(this.softWareAddr == ""){
        	alert("请输入软件库地址！");
        }else if(this.scriptAddr == ""){
        	alert("请输入脚本库地址！");
        }else if(this.userName == ""||this.userPwd == ""){
        	alert("请输入用户名或密码！");
        }else{
        	csc.rest.post('api/v5.0.0/severconfsftp', param, function(){
                self.isAdd(false);
              })
            alert("保存配置成功！");
        }
        
      }
      
      

      this.chefTest = function(object){
        console.log(object);        
      }
      this.chefSave = function(object){
        console.log(object);
        var param = {
                "ipAddr": this.ipAddr,
                "portNum": this.portNum,
                "username": this.username,
                "userPwd": this.userPwd
              };
        var ipReg =  "^(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])(\\.(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])){3}$";//ip地址的正则表达式
    	var ipPatt = new RegExp(ipReg);
       if(this.ipAddr == ""||!ipPatt.test(this.ipAddr)){
    	   alert("请输入正确的ip地址！");
       }else if(this.portNum == ""){
    	   alert("请输入端口号！");
       }else if(this.userName == ""||this.userPwd == ""){
    	   alert("请输入用户名或密码！");
       }else{
    	   csc.rest.post('api/v5.0.0/severconfschef', param, function(){
               self.isAdd(false);
             })
             alert("保存配置成功！");
       }        
        
      }

      this.emailTest = function(object){
        console.log(object);
      }
      this.emailSave = function(object){
          console.log(object);
      }
    }

    ko.applyBindings(new ViewModel(), $('#page-content')[0]); 
  });
</script>