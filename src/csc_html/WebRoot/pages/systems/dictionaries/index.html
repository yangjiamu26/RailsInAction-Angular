<div class="bg-light lter b-b wrapper-sm"> 
<ol class="breadcrumb"> 
  <li>当前位置：</li> 
  <li>系统</li> 
  <li class="active">字典管理</li> 
</ol> 
</div> 
<div class='wrapper-md'> 
  <div class="panel panel-default b-blue"> 
    <div class="row wrapper"> 
        <div class="col-xs-3"> 
          <div class="input-group"> 
             <span class="input-group-addon">名称</span> 
             <input type="text" value="" class="form-control input-sm" data-bind="value:searchParam().name, enterKey: search"> 
          </div> 
        </div> 
        <div class="col-xs-3"> 
          <div class="input-group"> 
             <span class="input-group-addon">所属组</span> 
             <input type="text" value="" class="form-control input-sm" data-bind="value:searchParam().group, enterKey: search"> 
          </div>         
        </div> 
        <div class="col-xs-1"> 
          <button class="btn btn-default btn-sm" type="submit" data-bind="click: search">搜索</button>       
        </div>           
    </div> 

    <div class='table-responsive' data-bind="with:table"> 
      <table class='table table-striped table-hover'> 
        <thead> 
          <tr> 
            <th>名称</th> 
            <th>所属组</th> 
            <th>说明</th> 
            <th>值</th> 
            <th>操作</th></tr> 
        </thead> 
        <tbody> 
          <tr data-bind="visible: showNoData"> 
            <td colspan=5 class="aligncenter"> 
                                                   暂无数据 
           </td> 
          </tr> 
          <!-- ko foreach: {data: pagedRows, as: '$row'}  --> 
          <tr> 
            <td data-bind="text: $row.name"></td> 
            <td data-bind="text: $row.group"></td> 
            <td data-bind="text: $row.desc"></td> 
            <td data-bind="text: $row.values"></td> 
            <td> 
              <a data-bind="click:$root.edit">修改</a> 
            </td> 
          </tr> 
          <!-- /ko --> 
        </tbody> 
      </table> 
    </div> 
    <footer class="panel-footer" data-bind="with: table, visible: table.pages() > 1"> 
      <ul class="pagination"> 
        <li data-bind="css: leftPagerClass, click: prevPage"> 
          <a href="#">&laquo;</a> 
        </li> 
        <!-- ko foreach: {data: (new Array(pages()))} --> 
        <li data-bind="css: $parent.pageClass($index() + 1)"> 
          <a href="#" data-bind="text: $index() + 1, click: $parent.gotoPage($index() + 1)"></a> 
        </li> 
        <!-- /ko --> 
        <li data-bind="css: rightPagerClass, click: nextPage"> 
          <a href="#">&raquo;</a> 
        </li> 
      </ul> 
    </footer> 
  </div>     
     
</div> 

<div role="dialog" aria-hidden="true" class="modal fade" data-bind="modal: { show: isEdit }"> 
<form class="form-horizontal" action="" method="post"> 
    <div class='modal-dialog' role='document'> 
        <div class='modal-content'> 
            <div class='modal-header'> 
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button><h3 class='modal-title'>修改字典</h3> 
            </div> 
            <div class='modal-body'> 
                <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="">所属组：</label> 
                    <div class="col-xs-8"> 
                        <input type="text" class="form-control" placeholder="" data-bind="value:currentVO().group" disabled> 
                    </div> 
                    <div class="col-xs-1"> 
                      <span class="text-danger inline m-l-n m-t-sm">*</span> 
                    </div>                     
                </div> 
                <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="">后端代码：</label> 
                    <div class="col-xs-8"> 
                        <input type="text" class="form-control" placeholder="" data-bind="value:currentVO().code" disabled> 
                    </div> 
                    <div class="col-xs-1"> 
                      <span class="text-danger inline m-l-n m-t-sm">*</span> 
                    </div>                     
                </div> 
                <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="">名称：</label> 
                    <div class="col-xs-8"> 
                        <input type="mail" class="form-control" placeholder="" data-bind="value:currentVO().name" disabled> 
                    </div> 
                    <div class="col-xs-1"> 
                      <span class="text-danger inline m-l-n m-t-sm">*</span> 
                    </div>                     
                </div> 
                <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="">说明：</label> 
                    <div class="col-xs-8"> 
                        <input type="text" class="form-control" placeholder="" data-bind="value:currentVO().desc"> 
                    </div>                 
                </div> 
               <!--  <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="" >值：</label> 
                    <div class="col-xs-8"> 
                      <select class="form-control"> 
                        <option>开</option> 
                        <option selected="selected">关</option> 
                      </select> 
                    </div> 
                    <div class="col-xs-1"> 
                      <span class="text-danger inline m-l-n m-t-sm">*</span> 
                    </div>                     
                </div> --> 
                <div class="form-group"> 
                    <label class="col-xs-3 control-label" for="">值：</label> 
                    <div class="col-xs-8"> 
                      <input type="mail" class="form-control" placeholder="" data-bind="value: currentVO().values"> 
                    </div> 
                    <div class="col-xs-1"> 
                      <span class="text-danger inline m-l-n m-t-sm">*</span> 
                    </div>                     
                </div> 
            </div> 
            <div class='modal-footer'> 
                <input type="button" name="commit" value="确定" class="btn btn-info" data-bind="click: okBtnFun" /> 
                <button name="button" type="button" class="btn btn-default btn btn-default" data-dismiss="modal" data-bind="click: offBtnFun">取消</button> 
            </div> 
        </div> 
    </div> 
</form> 
</div> 

<!-- page specific plugin scripts --> 
<script type="text/javascript"> 

  var scripts = [null,"api/systems/wordBook/wordBook.js"] 
  $('.page-content-area').ace_ajax( 
        'loadScripts', 
        scripts, 
        function(args) { 
           function ViewModel() { 
              this.isEdit = ko.observable(false); 
/*                this.currentVO = ko.validatedObservable({ 
                       
               }); */ 
                 
                 
              var self = this; 
              self.currentVO = ko.validatedObservable({ 
                 values : ko.observable('').extend({required: true,min: { params:0, message: "请输入非负整数" }}) 
              }); 
              self.oldVO = ko.observable({}); 
                 
                 
              /*  this.server_ftp = ko.validatedObservable({ 
                    url:ko.observable('').extend({required: true,ip: true}), 
                    port:ko.observable('').extend({required: true,portRange:true}), 
                    softPath:ko.observable('').extend({required: true,notCH:true}), 
                    scriptPath:ko.observable('').extend({required: true,notCH:true}), 
                    user:ko.observable('').extend({required: true}), 
                      password:ko.observable('').extend({required: true}) 
                 }); */ 
              //显示编辑字典页面 
             this.edit = function(object, event) { 
                 self.table.refreshData(); 
                 self.currentVO.fromJSON(object); 
                 self.isEdit(true); 
              }; 
                 
              //判断字典是否已修改 
             self.isChanged = function(o1, o2){ 
                 if(o1.values == o2.values && o1.desc == o2.desc){ 
                    return false; 
                 }else{ 
                    return true; 
                 } 
              } 
                 
              //修改字典信息 
             self.editWordBook = function(currentVO) { 
            	 ko.validation.group(self.currentVO()).showAllMessages(); 
                 if(self.isChanged(self.oldVO(), self.currentVO())){ 
                    params = { 
                          group : self.currentVO().group, 
                          code : self.currentVO().code, 
                          name : self.currentVO().name, 
                          desc : self.currentVO().desc, 
                          values : self.currentVO().values(), 
                       }; 
                       $.WORDBOOK.updateWord(self.currentVO().uuid, params, function(data) { 
                          self.table.refreshData(); 
                          self.isEdit(false); 
                          alert("修改信息成功！"); 
                       }); 
                 } 
              } 

              //确定按钮 
             this.okBtnFun = function() { 
                     if(self.currentVO.isValid()){ 
                        self.editWordBook(self.currentVO());                           
                     } 
              } 
              this.offBtnFun = function(object) { 
                     self.table.refreshData(); 
               } 
              this.searchParam = ko.observable({ 
                 name : "", 
                 group : "", 
              }); 

              //查询按钮 
             this.search = function() { 
                 this.table.params(this.searchParam()); 
              }; 
              this.table = new DataTable([], { 
                 path : '/csc/api/v5.0.0/wordBooks' 
              }); 
           } 
           ko.applyBindings(new ViewModel(), $('#page-content')[0]); 
        }); 
</script>